<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Preparing the execution environment for RHOCP worker3 node | OpenShift Container Platform 4.12 on HPE DL AMD Gen11 Servers</title>
    <meta name="description" content="Hewlett Packard Enterprise">
    
    
    <link rel="preload" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/css/0.styles.a849afd6.css" as="style"><link rel="preload" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/app.0d1574a4.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/17.1613574f.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/10.539836e4.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/11.1b423092.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/12.4498dbf8.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/13.9d6af473.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/14.4ae5ee31.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/15.cb17d948.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/16.986bad40.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/18.f269a761.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/2.7eec81cc.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/3.b21611b0.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/4.aed6a745.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/5.d1b8d5dc.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/6.f8a6678b.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/7.b8b816fa.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/8.af258e43.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/9.9453a156.js">
    <link rel="stylesheet" href="/hpe-solutions-openshift/4.12-AMD-LTI/assets/css/0.styles.a849afd6.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-openshift/4.12-AMD-LTI/" class="home-link router-link-active"><!----> <span class="site-name">OpenShift Container Platform 4.12 on HPE DL AMD Gen11 Servers</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-openshift/4.12-AMD-LTI/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-openshift/4.12-AMD-LTI/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Red Hat OpenShift Container Platform 4.12 on HPE DL325 &amp; DL385 Gen11 Servers</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Solution Deployment</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/hpe-solutions-openshift/4.12-AMD-LTI/Solution-Deployment/Solution-deployment-flow.html" class="sidebar-link">SOLUTION DEPLOYMENT WORKFLOW</a></li><li><a href="/hpe-solutions-openshift/4.12-AMD-LTI/Solution-Deployment/Preparing-execution-environment.html" aria-current="page" class="active sidebar-link">Preparing the execution environment for RHOCP worker3 node</a></li><li><a href="/hpe-solutions-openshift/4.12-AMD-LTI/Solution-Deployment/OCP-Cluster-deployment.html" class="sidebar-link">Deploying RHOCP cluster using Ansible playbooks</a></li><li><a href="/hpe-solutions-openshift/4.12-AMD-LTI/Solution-Deployment/OCP-worker-nodes.html" class="sidebar-link">Adding RHEL 8.6 worker nodes to RHOCP cluster using Ansible playbooks</a></li><li><a href="/hpe-solutions-openshift/4.12-AMD-LTI/Solution-Deployment/OCP-CoreOSWorker-nodes.html" class="sidebar-link">Adding RH CoreOS worker nodes to RHOCP cluster using Ansible playbooks</a></li><li><a href="/hpe-solutions-openshift/4.12-AMD-LTI/Solution-Deployment/Deploying-sample-application-using-Ephemeral-storage.html" class="sidebar-link">Deploying sample application on RHOCP 4.12 using Ephemeral storage</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Additional Features and Functionality</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Resosurces and Additional Links</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="preparing-the-execution-environment-for-rhocp-worker3-node"><a href="#preparing-the-execution-environment-for-rhocp-worker3-node" class="header-anchor">#</a> Preparing the execution environment for RHOCP worker3 node</h1> <p><strong>Prerequisites:</strong></p> <ul><li>RedHat Enterprise Linux8.6 must be <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/performing_a_standard_rhel_8_installation/index" target="_blank" rel="noopener noreferrer">installed and registered<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> on your host machine</li> <li>Configure <strong>BOND &gt; VLAN &gt; Bridge</strong></li></ul> <p><strong>Setting up RHEL 8.6 installer machine</strong></p> <p>This section assumes the following considerations for our deployment environment:</p> <ul><li>A server running Red Hat Enterprise Linux (RHEL) 8.6 exists within the deployment environment and is accessible to the installation user to be used as an installer machine. This server must have internet connectivity.</li> <li>A virtual machine is used to act as an installer machine and the same host is utilized as an Ansible Engine host. We are using one of the worker3 machines as an installer machine to execute Ansible Playbook.</li></ul> <p><strong>Prerequisites to execute ansible playbook:</strong></p> <p>RHEL 8.6 installer machine must have the following configurations:</p> <ol><li>The installer machine must have at least 500 GB disk space (especially in the &quot;/&quot; partition), 4 CPU cores and 16 GB RAM.</li> <li>RHEL 8.6 installer machine must be subscribed with valid Red Hat credentials. To register the installer machine for the Red Hat subscription, run the following command:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> subscription-manager register <span class="token parameter variable">--username</span><span class="token operator">=</span><span class="token operator">&lt;</span>username<span class="token operator">&gt;</span> <span class="token parameter variable">--password</span><span class="token operator">=</span><span class="token operator">&lt;</span>password<span class="token operator">&gt;</span> --auto-attach 
</code></pre></div><ol start="3"><li>Sync time with NTP server.</li> <li>SSH key pair must be available on the installer machine. If the SSH key is not available, generate a new SSH key pair with the following command:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ssh-keygen 
</code></pre></div><p><strong>To set up the installer machine:</strong></p> <ol start="5"><li>Create and activate a Python3 virtual environment for deploying this solution with the following commands:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ python3 <span class="token parameter variable">-m</span> venv <span class="token operator">&lt;</span>virtual_environment_name<span class="token operator">&gt;</span> 

$ <span class="token builtin class-name">source</span> <span class="token operator">&lt;</span>virtual_environment_name<span class="token operator">&gt;</span>/bin/activate 
</code></pre></div><ol start="6"><li>Download the OpenShift repositories using the following commands in the Ansible Engine:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">mkdir</span> /opt 

$ <span class="token builtin class-name">cd</span> /opt 

$ yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">git</span> 

$ <span class="token function">git</span> clone <span class="token operator">&lt;</span>https://github.com/HewlettPackard/hpe-solutions-openshift.git<span class="token operator">&gt;</span> 
</code></pre></div><ol start="7"><li>Setup the installer machine to configure the nginx, development tools, and other python packages required for LTI installation. Navigate to the $BASE_DIR directory and run the following command:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> <span class="token variable">$BASE_DIR</span>
$ <span class="token function">sh</span> setup.sh 
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">Note</p> <p>$BASE_DIR refers to <strong>/opt/hpe-solutions-openshift/DL-LTI-Openshift/</strong></p></div> <ol start="8"><li><p>As part of setup.sh script it will create nginx service, so user must download and copy Rhel 8.6 DVD ISO to <strong>/usr/share/nginx/html/</strong></p></li> <li><p>Minimum Storage requirement for management servers</p></li></ol> <table><thead><tr><th><strong>Management Servers</strong></th> <th><strong>Host OS disk</strong></th> <th><strong>Storage Pool disk</strong></th></tr></thead> <tbody><tr><td>Server 1</td> <td>2 x 960GB</td> <td>1 TB</td></tr> <tr><td>Server 2</td> <td>2 x 960GB</td> <td>1 TB</td></tr> <tr><td>Server 3</td> <td>2 x 960GB</td> <td>1 TB</td></tr></tbody></table> <p>Host OS disk – raid1 for redundancy</p> <ol start="10"><li><strong>Creating and deleting logical drives</strong></li></ol> <p>Create and delete logical drives on the head nodes following below steps.</p> <p><strong>Input File Update:-</strong></p> <ol><li><p>User has to update the input.yaml file in $BASE_DIR/create_delete_logicaldrives directory to execute the logical drive script.</p></li> <li><p>User needs to update all the details in the input.yaml file which include:-</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>
		ILOServers:

			- ILOIP: <span class="token number">172.28</span>.*.*

				ILOuser: admin

				ILOPassword: Password

				controller: <span class="token number">12</span>  

				RAID: Raid1

				PhysicalDrives: 1I:1:1,1I:1:2  

			- ILOIP: <span class="token number">172.28</span>.*.*

				ILOuser: admin

				ILOPassword: Password

				controller: <span class="token number">1</span>

				RAID: Raid1

				PhysicalDrives: 1I:3:1,1I:3:2

			- ILOIP: <span class="token number">172.28</span>.*.*

				ILOuser: admin

				ILOPassword: Password

				controller: <span class="token number">11</span>

				RAID: Raid1

				PhysicalDrives: 1I:3:1,1I:3:2   
</code></pre></div><p><strong>Note:-</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">1</span>. To <span class="token function">find</span> controller <span class="token function">id</span> login to the respective ILO -<span class="token operator">&gt;</span> System Information -<span class="token operator">&gt;</span> Storage tab where inside Location <span class="token function">find</span> the **slot number** as the controller id. 

			 <span class="token comment"># Example - Slot = 12 </span>

<span class="token number">2</span>. To <span class="token function">find</span> the PhysicalDrives login to the respective ILO -<span class="token operator">&gt;</span> System Information -<span class="token operator">&gt;</span> Storage tab inside Unconfigured Drives where under Location you can deduce PhysicalDrives based on these information:

		 <span class="token comment"># Slot: 12:Port=1I:Box=1:Bay=1</span>

		<span class="token comment"># Example - 1I:1:1 ('Port:Box:Bay')</span>

		<span class="token comment"># Slot: 12:Port=1I:Box=1:Bay=2</span>

		<span class="token comment"># Example - 1I:1:2 ('Port:Box:Bay') </span>
</code></pre></div><p><strong>Playbook Execution:-</strong></p> <p>To delete all the existing logical drives in the server in case if any and to create new logical drives named 'RHEL Boot Volume' in respective ILO servers run the site.yml playbook inside create_delete_logicaldrives directory with the below mentioned command</p> <div class="language-bash extra-class"><pre class="language-bash"><code>	$ ansible-playbook site.yml --ask-vault-pass
</code></pre></div><p>We can provide the input variables in any one of the below methods</p> <p>Method 1. <strong>Input.py : Automation way of taking input</strong></p> <p>Through the input.py, go to the directory /opt/hpe-solutions-openshift/DL-LTI-Openshift/ and run the below command.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>   python input.py
</code></pre></div><p>Here it will prompt for values which are not obtained from SCID json files.</p> <p>A sample input collection through input.py is as follows.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>	Enter server serial number <span class="token keyword">for</span> the first <span class="token function">head</span> <span class="token function">node</span> server <span class="token punctuation">(</span> Example: 2M2210020X <span class="token punctuation">)</span>
	2M205107TH
	Enter ILO address <span class="token keyword">for</span> the first <span class="token function">head</span> <span class="token function">node</span> server <span class="token punctuation">(</span> Example: <span class="token number">192.28</span>.201.5 <span class="token punctuation">)</span>
	<span class="token number">172.28</span>.201.13
	Enter ILO username <span class="token keyword">for</span> the first <span class="token function">head</span> <span class="token function">node</span> server <span class="token punctuation">(</span> Example: admin <span class="token punctuation">)</span>
	admin
	Enter ILO password <span class="token keyword">for</span> the first <span class="token function">head</span> <span class="token function">node</span> server <span class="token punctuation">(</span> Example: Password <span class="token punctuation">)</span>
	Password
	Enter Host FQDN <span class="token keyword">for</span> the first <span class="token function">head</span> <span class="token function">node</span> server <span class="token punctuation">(</span> Example: kvm1.xyz.local <span class="token punctuation">)</span>
	headnode1.isv.local
	etc <span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.'
</code></pre></div><p>After execution of input.py, it will generate input.yaml and hosts file in the same location.</p> <p>Method 2. <strong>Input.yaml: Manually editing input file</strong></p> <p>Go to the directory $BASE_DIR(<strong>/opt/hpe-solutions-openshift/DL-LTI-Openshift/</strong>), here we will have input.yaml and hosts files.</p> <ol><li>A preconfigured Ansible vault file (input.yaml) is provided as a part of this solution, which consists of sensitive information to support the host and virtual machine deployment.</li></ol> <div class="language- extra-class"><pre class="language-text"><code>cd $BASE_DIR
</code></pre></div><p>Run the following commands on the installer VM to edit the vault to match the installation environment.</p> <div class="language- extra-class"><pre class="language-text"><code>ansible-vault edit input.yaml
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">NOTE</p> <p>The default password for the Ansible vault file is <strong>changeme</strong></p> <p>Sample input_sample.yml can be found in the $BASE_DIR along with description of each input variable.</p></div> <p>A sample input.yaml file is as follows with a few filled parameters.</p> <div class="language-bash extra-class"><pre class="language-bash"><code> - Server_serial_number: 2M20510XXX
   ILO_Address: <span class="token number">172.28</span>.*.*
   ILO_Username: admin
   ILO_Password: *****
   Hostname: headnode3.XX.XX                <span class="token comment">#ex. headnode3.isv.local</span>
   Host_Username: root
   Host_Password: ******
   HWADDR1: XX:XX:XX:XX:XX:XX             <span class="token comment">#mac address for server physical interface1 </span>
   HWADDR2: XX:XX:XX:XX:XX:XX             <span class="token comment">#mac address for server physical interface2</span>
   Host_OS_disk: sda
   Host_VlanID: <span class="token number">230</span>
   Host_IP: <span class="token number">172.28</span>.*.*
   Host_Netmask: <span class="token number">255</span>.*.*.*
   Host_Prefix: XX                          <span class="token comment">#ex. 8,24,32</span>
   Host_Gateway: <span class="token number">172.28</span>.*.*
   Host_DNS: <span class="token number">172.28</span>.*.*
   Host_Domain: XX.XX                       <span class="token comment">#ex. isv.local</span>
   corporate_proxy: <span class="token number">172.28</span>.*.*              <span class="token comment">#provide corporate proxy, ex. proxy.houston.hpecorp.net</span>
   corporate_proxy_port: XX               <span class="token comment">#corporate proxy port no, ex. 8080</span>

config:
   HTTP_server_base_url: http://172.28.*.*/  <span class="token comment">#Installer IP address</span>
   HTTP_file_path: /usr/share/nginx/html/    
   OS_type: rhel8
   OS_image_name: rhel-8.6-x86_64-dvd.iso    <span class="token comment"># ISO image should be present in /usr/share/nginx/html/</span>
   base_kickstart_filepath: /opt/hpe-solutions-openshift/DL-LTI-Openshift/playbooks/roles/rhel8_os_deployment/tasks/ks_rhel8.cfg

</code></pre></div><p>A sample <strong>hosts</strong> files is as follows</p> <div class="language-bash extra-class"><pre class="language-bash"><code>		   <span class="token string">'[kvm_nodes]
			172.28.*.*
			172.28.*.*
			172.28.*.*

			[ansible_host]
			172.28.*.*

			[rhel8_installerVM]
			172.28.*.*

			[binddns_masters]
			172.28.*.*

			[binddns_slaves]
			172.28.*.*
			172.28.*.*

			[masters_info]
			master1 ip=172.28.*.* hostname=headnode1

			[slaves_info]
			slave1 ip=172.28.*.* hostname=headnode2
			slave2 ip=172.28.*.* hostname=headnode3'</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/hpe-solutions-openshift/4.12-AMD-LTI/Solution-Deployment/Solution-deployment-flow.html" class="prev">
          SOLUTION DEPLOYMENT WORKFLOW
        </a></span> <span class="next"><a href="/hpe-solutions-openshift/4.12-AMD-LTI/Solution-Deployment/OCP-Cluster-deployment.html">
          Deploying RHOCP cluster using Ansible playbooks
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/app.0d1574a4.js" defer></script><script src="/hpe-solutions-openshift/4.12-AMD-LTI/assets/js/17.1613574f.js" defer></script>
  </body>
</html>
