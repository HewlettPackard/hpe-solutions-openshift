<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Adding RHEL 8.6 worker nodes to RHOCP cluster using Ansible playbooks | OpenShift Container Platform 4.12 on HPE DL INTEL Gen11 Servers</title>
    <meta name="description" content="Hewlett Packard Enterprise">
    
    
    <link rel="preload" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/css/0.styles.5ab10b28.css" as="style"><link rel="preload" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/app.1dde5221.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/16.986bad40.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/10.539836e4.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/11.1b423092.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/12.4498dbf8.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/13.08beb01e.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/14.4ae5ee31.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/15.2fb52989.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/17.1613574f.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/18.f269a761.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/2.1d3e673d.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/3.eb38ed32.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/4.aed6a745.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/5.d1b8d5dc.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/6.f8a6678b.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/7.b8b816fa.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/8.be24348a.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/9.ce2a245f.js">
    <link rel="stylesheet" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/css/0.styles.5ab10b28.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-openshift/4.12-INTEL-LTI/" class="home-link router-link-active"><!----> <span class="site-name">OpenShift Container Platform 4.12 on HPE DL INTEL Gen11 Servers</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-openshift/4.12-INTEL-LTI/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-openshift/4.12-INTEL-LTI/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Red Hat OpenShift Container Platform 4.12 on HPE DL360 &amp; DL380 Gen11 Servers</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Solution Deployment</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/hpe-solutions-openshift/4.12-INTEL-LTI/Solution-Deployment/Solution-deployment-flow.html" class="sidebar-link">SOLUTION DEPLOYMENT WORKFLOW</a></li><li><a href="/hpe-solutions-openshift/4.12-INTEL-LTI/Solution-Deployment/Preparing-execution-environment.html" class="sidebar-link">Preparing the execution environment for RHOCP worker3 node</a></li><li><a href="/hpe-solutions-openshift/4.12-INTEL-LTI/Solution-Deployment/OCP-Cluster-deployment.html" class="sidebar-link">Deploying RHOCP cluster using Ansible playbooks</a></li><li><a href="/hpe-solutions-openshift/4.12-INTEL-LTI/Solution-Deployment/OCP-worker-nodes.html" aria-current="page" class="active sidebar-link">Adding RHEL 8.6 worker nodes to RHOCP cluster using Ansible playbooks</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/hpe-solutions-openshift/4.12-INTEL-LTI/Solution-Deployment/OCP-CoreOSWorker-nodes.html" class="sidebar-link">Adding RH CoreOS worker nodes to RHOCP cluster using Ansible playbooks</a></li><li><a href="/hpe-solutions-openshift/4.12-INTEL-LTI/Solution-Deployment/Deploying-sample-application-using-Ephemeral-storage.html" class="sidebar-link">Deploying sample application on RHOCP 4.12 using Ephemeral storage</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Additional Features and Functionality</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Resosurces and Additional Links</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="adding-rhel-8-6-worker-nodes-to-rhocp-cluster-using-ansible-playbooks"><a href="#adding-rhel-8-6-worker-nodes-to-rhocp-cluster-using-ansible-playbooks" class="header-anchor">#</a> <strong>Adding RHEL 8.6 worker nodes to RHOCP cluster using Ansible playbooks</strong></h1> <p>The Lite Touch Installation (LTI) package includes Ansible playbooks with scripts to add the RHEL 8.6 worker nodes to the RHOCP cluster. You can use one of the following two methods to add the RHEL 8.6 worker nodes:</p> <ul><li><strong>Run a consolidated playbook:</strong> This method includes a single playbook, site.yml, that contains a script to perform all the tasks for adding the RHEL 8.6 worker nodes to the existing RHOCP cluster. To run LTI using a consolidated playbook:</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> inventory/hosts site.yml --ask-vault-pass
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">NOTE</p> <p>The default password for the Ansible vault file is <strong>changeme</strong></p></div> <ul><li><strong>Run individual playbooks:</strong> This method includes multiple playbooks with scripts that enable you to deploy specific tasks for adding the RHEL 8.6 worker nodes to the existing RHOCP cluster. The playbooks in this method must be executed in a specific sequence to add the worker nodes.</li></ul> <p>The following table includes the purpose of each playbook required for the deployment:</p> <p><strong>TABLE 9.</strong> Add RHEL 8.6 nodes using Ansible playbooks</p> <table><thead><tr><th style="text-align:left">Playbook</th> <th style="text-align:left">Description</th></tr></thead> <tbody><tr><td style="text-align:left">rhel8_os_deployment.yml</td> <td style="text-align:left">This playbook contains the scripts to deploy RHEL 8.6 OS on worker nodes.</td></tr> <tr><td style="text-align:left">copy_ssh.yml</td> <td style="text-align:left">This playbook contains the script to copy the SSH public key to the RHEL 8.6 worker nodes.</td></tr> <tr><td style="text-align:left">prepare_worker_nodes.yml</td> <td style="text-align:left">This playbook contains the script to prepare nodes for the RHEL 8.6 worker nodes.</td></tr> <tr><td style="text-align:left">ntp.yml</td> <td style="text-align:left">This playbook contains the script to create NTP setup to enable time synchronization on the worker nodes.</td></tr> <tr><td style="text-align:left">openshift-ansible/playbooks/scaleup.yml</td> <td style="text-align:left">This playbook contains the script to add worker nodes to the RHOCP cluster. This playbook queries the master, generates and distributes new certificates for the new hosts, and then runs the configuration playbooks on the new hosts.</td></tr></tbody></table> <p>To run individual playbooks do one of the following:</p> <ol><li>Edit site.yaml file and add a comment for all the playbooks except the ones that you want to execute.</li></ol> <p>For example, add the following comments in the site.yaml file to deploy RHEL 8.6 OS on the worker nodes:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>import_playbook: playbooks/rhel8_os_deployment.yml

<span class="token comment"># import_playbook: playbooks/copy_ssh.yml</span>

<span class="token comment"># import_playbook: playbooks/prepare_worker_nodes.yml</span>

<span class="token comment"># import_playbook: playbooks/ntp.yml</span>

<span class="token comment"># import_playbook: openshift-ansible/playbooks/scaleup.yml</span>
</code></pre></div><p>OR</p> <p>Run the individual YAML files using the following command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/<span class="token operator">&lt;</span>yaml_filename<span class="token operator">&gt;</span>.yml --ask-vault-pass
</code></pre></div><p>For example, run the following YAML file to deploy RHEL 8.6 OS on the worker nodes:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/rhel8_os_deployment.yml --ask-vault-pass
</code></pre></div><p>For more information on executing individual playbooks, see the consecutive sections.</p> <h3 id="adding-rhel-8-6-worker-nodes"><a href="#adding-rhel-8-6-worker-nodes" class="header-anchor">#</a> <strong>Adding RHEL 8.6 worker nodes</strong></h3> <p>This section describes how to add RHEL 8.6 worker nodes to an existing RHOCP cluster.</p> <p>To add RHEL 8.6 worker nodes to the RHOCP cluster:</p> <ol><li>Login to the Installer VM.</li></ol> <p>This installer VM was created as a KVM VM on one of the head nodes using the rhel8_installerVM.yml playbook. For more information, see the <a href="/hpe-solutions-openshift/4.12-INTEL-LTI/Solution-Deployment/OCP-Cluster-deployment.html#creating-rhel-8-installer-machine">Creating RHEL 8 installer machine</a> section.</p> <ol start="2"><li>Navigate to the directory $BASE_DIR/worker_nodes/</li></ol> <div class="language- extra-class"><pre class="language-text"><code>cd $BASE_DIR/worker_nodes/
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">NOTE</p> <p>$BASE_DIR refers to <strong>/opt/hpe-solutions-openshift/DL-LTI-Openshift/</strong></p></div> <p>Run the following commands on the rhel8 installer VM to edit the vault input file.</p> <div class="language- extra-class"><pre class="language-text"><code>ansible-vault edit input.yaml
</code></pre></div><p>The installation user should review hosts file (located on the installer VM at $BASE_DIR/inventory/hosts)</p> <div class="language- extra-class"><pre class="language-text"><code>vi inventory/hosts

</code></pre></div><ol start="3"><li>Copy Rhel8.6 DVD ISO to <strong>/usr/share/nginx/html/</strong></li> <li>Navigate to the $BASE_DIR/worker_nodes/ directory and run the following command:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sh</span> setup.sh
</code></pre></div><ol start="5"><li>Add the worker nodes to the cluster using one of the following methods:</li></ol> <ul><li>Run the following sequence of playbooks:</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/rhel8_os_deployment.yml --ask-vault-pass

ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/copy_ssh.yml --ask-vault-pass

ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/prepare_worker_nodes.yml --ask-vault-pass

ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/ntp.yml --ask-vault-pass

ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/scaleup.yml --ask-vault-pass
</code></pre></div><p>OR</p> <ul><li>If you want to deploy the entire solution to add the worker nodes to the cluster, execute the following playbook:</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> inventory/hosts site.yml --ask-vault-pass
</code></pre></div><ol start="6"><li>Once all the playbooks are executed successfully, check the status of the node using the following command:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ oc get nodes
</code></pre></div><p>The following output is displayed:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>NAME			STATUS	ROLES		AGE	VERSION

master0.ocp.ngs.local	Ready	master,worker	13d	v1.23.3+e419edf

master1.ocp.ngs.local	Ready	master,worker	13d	v1.23.3+e419edf

master2.ocp.ngs.local	Ready	master,worker	13d	v1.23.3+e419edf

worker1.ocp.ngs.local	Ready	worker		23h	v1.23.5+3afdacb

worker2.ocp.ngs.local	Ready	worker		23h	v1.23.5+3afdacb

worker3.ocp.ngs.local	Ready	worker		23h	v1.23.5+3afdacb

</code></pre></div><ol start="7"><li>Once the worker nodes are added to the cluster, set the “mastersSchedulable” parameter as false to ensure that the master nodes are not used to schedule pods.</li> <li>Edit the schedulers.config.openshift.io resource.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ oc edit schedulers.config.openshift.io cluster
</code></pre></div><p>Configure the mastersSchedulable field.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>apiVersion: config.openshift.io/v1 

kind: Scheduler 

metadata: 

<span class="token variable"><span class="token variable">`</span>	<span class="token variable">`</span></span>creationTimestamp: “2019-09-10T03:04:05Z<span class="token string">&quot;

<span class="token variable"><span class="token variable">`</span>	<span class="token variable">`</span></span>generation: 1

<span class="token variable"><span class="token variable">`</span>	<span class="token variable">`</span></span>name: cluster

<span class="token variable"><span class="token variable">`</span>	<span class="token variable">`</span></span>resourceVersion: “433&quot;</span>

<span class="token variable"><span class="token variable">`</span>	<span class="token variable">`</span></span>selfLink: /apis/config.openshift.io/v1/schedulers/cluster

<span class="token variable"><span class="token variable">`</span>	<span class="token variable">`</span></span>uid: a636d30a-d377-11e9-88d4-0a60097bee62

spec:

<span class="token variable"><span class="token variable">`</span>	<span class="token variable">`</span></span>mastersSchedulable: <span class="token boolean">false</span> 

<span class="token variable"><span class="token variable">`</span>	<span class="token variable">`</span></span>policy:

<span class="token variable"><span class="token variable">`</span>		<span class="token variable">`</span></span>name: “&quot;

status: <span class="token punctuation">{</span> <span class="token punctuation">}</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">NOTE</p> <p>Set the mastersSchedulable to true to allow Control Plane nodes to be schedulable or false to disallow Control Plane nodes to be schedulable.</p></div> <ol start="9"><li>Save the file to apply the changes.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ oc get nodes
</code></pre></div><p>The following output is displayed:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>NAME			STATUS	ROLES	AGE	VERSION

master0.ocp.ngs.local	Ready	master	13d	v1.23.3+e419edf

master1.ocp.ngs.local	Ready	master	13d	v1.23.3+e419edf

master2.ocp.ngs.local	Ready	master	13d	v1.23.3+e419edf

worker1.ocp.ngs.local	Ready	worker	23h	v1.23.5+3afdacb

worker2.ocp.ngs.local	Ready	worker	23h	v1.23.5+3afdacb

worker3.ocp.ngs.local	Ready	worker	23h	v1.23.5+3afdacb
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">NOTE</p> <p>To add more worker nodes, update worker details in HAProxy and binddns on head nodes and then add RHEL 8.6 worker nodes to the RHOCP cluster.</p></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/hpe-solutions-openshift/4.12-INTEL-LTI/Solution-Deployment/OCP-Cluster-deployment.html" class="prev">
          Deploying RHOCP cluster using Ansible playbooks
        </a></span> <span class="next"><a href="/hpe-solutions-openshift/4.12-INTEL-LTI/Solution-Deployment/OCP-CoreOSWorker-nodes.html">
          Adding RH CoreOS worker nodes to RHOCP cluster using Ansible playbooks
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/app.1dde5221.js" defer></script><script src="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/16.986bad40.js" defer></script>
  </body>
</html>
