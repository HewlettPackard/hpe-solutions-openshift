<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deploying RHOCP cluster using Ansible playbooks | OpenShift Container Platform 4.12 on HPE DL INTEL Gen11 Servers</title>
    <meta name="description" content="Hewlett Packard Enterprise">
    
    
    <link rel="preload" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/css/0.styles.5ab10b28.css" as="style"><link rel="preload" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/app.1dde5221.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/11.1b423092.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/10.539836e4.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/12.4498dbf8.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/13.08beb01e.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/14.4ae5ee31.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/15.2fb52989.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/16.986bad40.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/17.1613574f.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/18.f269a761.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/2.1d3e673d.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/3.eb38ed32.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/4.aed6a745.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/5.d1b8d5dc.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/6.f8a6678b.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/7.b8b816fa.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/8.be24348a.js"><link rel="prefetch" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/9.ce2a245f.js">
    <link rel="stylesheet" href="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/css/0.styles.5ab10b28.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-openshift/4.12-INTEL-LTI/" class="home-link router-link-active"><!----> <span class="site-name">OpenShift Container Platform 4.12 on HPE DL INTEL Gen11 Servers</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-openshift/4.12-INTEL-LTI/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-openshift/4.12-INTEL-LTI/" class="nav-link">Home</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Red Hat OpenShift Container Platform 4.12 on HPE DL360 &amp; DL380 Gen11 Servers</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Solution Deployment</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/hpe-solutions-openshift/4.12-INTEL-LTI/Solution-Deployment/Solution-deployment-flow.html" class="sidebar-link">SOLUTION DEPLOYMENT WORKFLOW</a></li><li><a href="/hpe-solutions-openshift/4.12-INTEL-LTI/Solution-Deployment/Preparing-execution-environment.html" class="sidebar-link">Preparing the execution environment for RHOCP worker3 node</a></li><li><a href="/hpe-solutions-openshift/4.12-INTEL-LTI/Solution-Deployment/OCP-Cluster-deployment.html" aria-current="page" class="active sidebar-link">Deploying RHOCP cluster using Ansible playbooks</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/hpe-solutions-openshift/4.12-INTEL-LTI/Solution-Deployment/OCP-worker-nodes.html" class="sidebar-link">Adding RHEL 8.6 worker nodes to RHOCP cluster using Ansible playbooks</a></li><li><a href="/hpe-solutions-openshift/4.12-INTEL-LTI/Solution-Deployment/OCP-CoreOSWorker-nodes.html" class="sidebar-link">Adding RH CoreOS worker nodes to RHOCP cluster using Ansible playbooks</a></li><li><a href="/hpe-solutions-openshift/4.12-INTEL-LTI/Solution-Deployment/Deploying-sample-application-using-Ephemeral-storage.html" class="sidebar-link">Deploying sample application on RHOCP 4.12 using Ephemeral storage</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Additional Features and Functionality</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Resosurces and Additional Links</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="deploying-rhocp-cluster-using-ansible-playbooks"><a href="#deploying-rhocp-cluster-using-ansible-playbooks" class="header-anchor">#</a> <strong>Deploying RHOCP cluster using Ansible playbooks</strong></h1> <p>The Lite Touch Installation (LTI) package includes Ansible playbooks with scripts to deploy RHOCP cluster. You can use one of the following two methods to deploy RHOCP cluster:</p> <ul><li><strong>Run a consolidated playbook:</strong> This method includes a single playbook for deploying the entire solution. This site.yml playbook contains a script that performs all the tasks starting from the OS deployment until the RHOCP cluster is successfully installed and running. To run LTI using a consolidated playbook:</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts site.yml --ask-vault-pass
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">NOTE</p> <p>The default password for the Ansible vault file is <strong>changeme</strong></p></div> <ul><li><strong>Run individual playbooks:</strong> This method includes multiple playbooks with scripts that enable you to deploy specific parts of the solution depending on your requirements. The playbooks in this method must be executed in a specific sequence to deploy the solution. The following table includes the purpose of each playbook required for the deployment:</li></ul> <p><strong>TABLE 8.</strong> RHOCP cluster deployment using Ansible playbooks</p> <table><thead><tr><th style="text-align:left">Playbook</th> <th style="text-align:left">Description</th></tr></thead> <tbody><tr><td style="text-align:left">rhel8_os_deployment.yml</td> <td style="text-align:left">This playbook contains the script to deploy RHEL 8.6 OS on BareMetal servers.</td></tr> <tr><td style="text-align:left">copy_ssh_headnode.yml</td> <td style="text-align:left">This playbook contains the script to copy the SSH public key from the installer machine to the head nodes.</td></tr> <tr><td style="text-align:left">prepare_rhel_hosts.yml</td> <td style="text-align:left">This playbook contains the script to prepare nodes for the RHOCP head nodes.</td></tr> <tr><td style="text-align:left">ntp.yml</td> <td style="text-align:left">This playbook contains the script to create NTP setup to enable time synchronization on head nodes.</td></tr> <tr><td style="text-align:left">binddns.yml</td> <td style="text-align:left">This playbook contains the script to deploy Bind DNS on three head nodes and acts as active-passive cluster configuration.</td></tr> <tr><td style="text-align:left">haproxy.yml</td> <td style="text-align:left">This playbook contains the script to deploy HAProxy on the head nodes and acts as active-active cluster configuration.</td></tr> <tr><td style="text-align:left">squid_proxy.yml</td> <td style="text-align:left">This playbook contains the script to deploy the Squid proxy on the head nodes to get web access.</td></tr> <tr><td style="text-align:left">storage_pool.yml</td> <td style="text-align:left">This playbook contains the script to create the storage pools on the head nodes.</td></tr> <tr><td style="text-align:left">rhel8_installerVM.yml</td> <td style="text-align:left">This playbook contains the script to create a RHEL 8 installer machine, which will also be used as an installer at a later stage.</td></tr> <tr><td style="text-align:left">copy_ssh_installerVM.yml</td> <td style="text-align:left">This playbook contains the script to copy the SSH public key to the RHEL 8 installer machine.</td></tr> <tr><td style="text-align:left">prepare_rhel8_installer.yml</td> <td style="text-align:left">This playbook contains the script to prepare the RHEL 8 installer.</td></tr> <tr><td style="text-align:left">copy_scripts.yml</td> <td style="text-align:left">This playbooks contains the script to copy ansible code to rhel8 installer and headnodes.</td></tr> <tr><td style="text-align:left">download_ocp_packages.yml</td> <td style="text-align:left">This playbook contains the script to download the required RHOCP packages.</td></tr> <tr><td style="text-align:left">generate_manifest.yml</td> <td style="text-align:left">This playbook contains the script to generate the manifest files.</td></tr> <tr><td style="text-align:left">copy_ocp_tool.yml</td> <td style="text-align:left">This playbook contains the script to copy the RHOCP tools from the current installer to the head nodes and RHEL 8 installer.</td></tr> <tr><td style="text-align:left">deploy_ipxe_ocp.yml</td> <td style="text-align:left">This playbook contains the script to deploy the iPXE server on the head nodes.</td></tr> <tr><td style="text-align:left">ocp_vm.yml</td> <td style="text-align:left">This playbook contains the script to create bootstrap and master nodes.</td></tr></tbody></table> <p>To run individual playbooks:</p> <ul><li>Do one of the following:</li></ul> <ol><li>Edit site.yml file and add a comment for all the playbooks you do not want to execute.</li></ol> <p>For example, add the following comments in the site.yml file to deploy RHEL 8.6 OS:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>- import_playbook: playbooks/rhel8_os_deployment.yml
- import_playbook: playbooks/copy_ssh_headnode.yml
- import_playbook: playbooks/prepare_rhel_hosts.yml
- import_playbook: playbooks/ntp.yml
- import_playbook: playbooks/binddns.yml
- import_playbook: playbooks/haproxy.yml
- import_playbook: playbooks/squid_proxy.yml
- import_playbook: playbooks/storage_pool.yml
- import_playbook: playbooks/rhel8_installerVM.yml
- import_playbook: playbooks/copy_ssh_installerVM.yml
- import_playbook: playbooks/prepare_rhel8_installer.yml
- import_playbook: playbooks/download_ocp_packages.yml
- import_playbook: playbooks/generate_manifest.yml
- import_playbook: playbooks/copy_ocp_tool.yml
- import_playbook: playbooks/deploy_ipxe_ocp.yml
- import_playbook: playbooks/ocp_vm.yml
</code></pre></div><ol start="2"><li>Run the individual YAML files using the following command:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/<span class="token operator">&lt;</span>yaml_filename<span class="token operator">&gt;</span>.yml --ask-vault-pass
</code></pre></div><p>For example, run the following YAML file to deploy RHEL 8.6 OS:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/rhel8_os_deployment.yml --ask-vault-pass
</code></pre></div><p>For more information on executing individual playbooks, see the consecutive sections.</p> <h3 id="deploying-rhel8-os-on-baremetal-servers"><a href="#deploying-rhel8-os-on-baremetal-servers" class="header-anchor">#</a> Deploying RHEL8 OS on baremetal servers</h3> <p>This section describes how to run the playbook that contains the script for deploying RHEL 8.6 OS on BareMetal servers.
To deploy RHEL 8.6 OS on the head nodes:</p> <ol><li>Navigate to the $BASE_DIR(<strong>/opt/hpe-solutions-openshift/DL-LTI-Openshift/</strong>) directory on the installer.</li> <li>Run the following playbook:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/rhel8_os_deployment.yml --ask-vault-pass
</code></pre></div><h3 id="copying-ssh-key-to-head-nodes"><a href="#copying-ssh-key-to-head-nodes" class="header-anchor">#</a> Copying SSH key to head nodes</h3> <p>Once the OS is installed on the head nodes, copy the ssh key from the installer machine to the head nodes. It uses playbook that contains the script to copy the SSH public key from the installer machine to the head nodes.</p> <p>To copy the SSH key to the head node run the following playbook:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/copy_ssh_headnode.yml --ask-vault-pass
</code></pre></div><h3 id="setting-up-head-nodes"><a href="#setting-up-head-nodes" class="header-anchor">#</a> Setting up head nodes</h3> <p>This section describes how to run the playbook that contains the script to prepare nodes for the RHOCP head nodes.</p> <p>To register the head nodes to Red Hat subscription and download and install KVM Virtualization packages run the following playbook:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/prepare_rhel_hosts.yml --ask-vault-pass
</code></pre></div><h3 id="setting-up-ntp-server-on-head-nodes"><a href="#setting-up-ntp-server-on-head-nodes" class="header-anchor">#</a> <strong>Setting up NTP server on head nodes</strong></h3> <p>This section describes how to run the playbook that contains the script to set up NTP server and enable time synchronization on all head nodes.</p> <p>To set up NTP server on head nodes run the following playbook:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/ntp.yml --ask-vault-pass
</code></pre></div><h3 id="deploying-bind-dns-on-head-nodes"><a href="#deploying-bind-dns-on-head-nodes" class="header-anchor">#</a> <strong>Deploying Bind DNS on head nodes</strong></h3> <p>This section describes how to deploy Bind DNS service on all three head nodes for active-passive cluster configuration.</p> <p>To deploy Bind DNS service on head nodes run the following playbook:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/binddns.yml --ask-vault-pass
</code></pre></div><h3 id="deploying-haproxy-on-head-nodes"><a href="#deploying-haproxy-on-head-nodes" class="header-anchor">#</a> <strong>Deploying HAProxy on head nodes</strong></h3> <p>The RHOCP 4.12 uses an external load balancer to communicate from outside the cluster with services running inside the cluster. This section describes how to deploy HAProxy on all three head nodes for active-active cluster configuration.</p> <p>To deploy HAProxy server configuration on head nodes run the following playbook:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/haproxy.yml --ask-vault-pass
</code></pre></div><h3 id="deploying-squid-proxy-on-head-nodes"><a href="#deploying-squid-proxy-on-head-nodes" class="header-anchor">#</a> <strong>Deploying Squid proxy on head nodes</strong></h3> <p>Squid is a proxy server that caches content to reduce bandwidth and load web pages more quickly. This section describes how to set up Squid as a proxy for HTTP, HTTPS, and FTP protocol, as well as authentication and restricting access. It uses a playbook that contains the script to deploy the Squid proxy on the head nodes to get web access.</p> <p>To deploy Squid proxy server on head nodes run the following playbook:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/squid_proxy.yml --ask-vault-pass
</code></pre></div><h3 id="creating-storage-pools-on-head-nodes"><a href="#creating-storage-pools-on-head-nodes" class="header-anchor">#</a> <strong>Creating storage pools on head nodes</strong></h3> <p>This section describes how to use the storage_pool.yml playbook that contains the script to create the storage pools on the head nodes.</p> <p>To create the storage pools run the following playbook:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/storage_pool.yml --ask-vault-pass
</code></pre></div><h3 id="creating-rhel-8-installer-machine"><a href="#creating-rhel-8-installer-machine" class="header-anchor">#</a> <strong>Creating RHEL 8 installer machine</strong></h3> <p>This section describes how to create a RHEL 8 installer machine using the rhel8_installerVM.yml playbook. This installer machine is also used as an installer for deploying the RHOCP cluster and adding RHEL 8.6 worker nodes.</p> <p>To create a RHEL 8 installer machine run the following playbook:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/rhel8_installerVM.yml --ask-vault-pass
</code></pre></div><h3 id="copying-ssh-key-to-rhel-8-installer-machine"><a href="#copying-ssh-key-to-rhel-8-installer-machine" class="header-anchor">#</a> Copying SSH key to RHEL 8 installer machine</h3> <p>This section describes how to copy the SSH public key to the RHEL 8 installer machine using the copy_ssh_installerVM.yml playbook.</p> <p>To copy the SSH public key to the RHEL 8 installer machine run the following playbook:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/copy_ssh_installerVM.yml --ask-vault-pass
</code></pre></div><h3 id="setting-up-rhel-8-installer"><a href="#setting-up-rhel-8-installer" class="header-anchor">#</a> Setting up RHEL 8 installer</h3> <p>This section describes how to set up the RHEL 8 installer using the prepare_rhel8_installer.yml playbook.</p> <p>To set up the RHEL 8 installer run the following playbook:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/prepare_rhel8_installer.yml --ask-vault-pass
</code></pre></div><h3 id="downloading-rhocp-packages"><a href="#downloading-rhocp-packages" class="header-anchor">#</a> <strong>Downloading RHOCP packages</strong></h3> <p>This section provides details about downloading the required RHOCP 4.12 packages using a playbook.</p> <p>To download RHOCP 4.12 packages:</p> <p>Download the required packages on the installer VM with the following playbook:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/download_ocp_packages.yml --ask-vault-pass
</code></pre></div><h3 id="generating-kubernetes-manifest-files"><a href="#generating-kubernetes-manifest-files" class="header-anchor">#</a> <strong>Generating Kubernetes manifest files</strong></h3> <p>The manifests and ignition files define the master node and worker node configuration and are key components of the RHOCP 4.12 installation. This section describes how to use the generate_manifest.yml playbook that contains the script to generate the manifest files.</p> <p>To generate Kubernetes manifest files run the following playbook:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/generate_manifest.yml --ask-vault-pass
</code></pre></div><h3 id="copying-rhocp-tools"><a href="#copying-rhocp-tools" class="header-anchor">#</a> Copying RHOCP tools</h3> <p>This section describes how to copy the RHOCP tools from the present installer to head nodes and RHEL 8 installer using the copy_ocp_tool.yml playbook.</p> <p>To copy the RHOCP tools to the head nodes and RHEL 8 installer run the following playbook:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/copy_ocp_tool.yml --ask-vault-pass
</code></pre></div><h3 id="deploying-ipxe-server-on-head-nodes"><a href="#deploying-ipxe-server-on-head-nodes" class="header-anchor">#</a> Deploying iPXE server on head nodes</h3> <p>This section describes how to deploy the iPXE server on the head nodes using the deploy_ipxe_ocp.yml playbook.</p> <p>To deploy the iPXE server run the following playbook:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/deploy_ipxe_ocp.yml --ask-vault-pass
</code></pre></div><h3 id="creating-bootstrap-and-master-nodes"><a href="#creating-bootstrap-and-master-nodes" class="header-anchor">#</a> Creating bootstrap and master nodes</h3> <p>This section describes how to create bootstrap and master nodes using the scripts in the ocp_vm.yml playbook.</p> <p>To create bootstrap and master VMs on Kernel-based Virtual Machine (KVM):</p> <p>Run the following playbook:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook <span class="token parameter variable">-i</span> hosts playbooks/ocp_vm.yml --ask-vault-pass
</code></pre></div><h3 id="deploying-rhocp-cluster"><a href="#deploying-rhocp-cluster" class="header-anchor">#</a> <strong>Deploying RHOCP cluster</strong></h3> <p>Once the playbooks are executed successfully and the Bootstrap and master nodes are deployed with the RHCOS, deploy the RHOCP cluster.</p> <p>To deploy the RHOCP cluster:</p> <ol><li>Login to the installer VM.</li></ol> <p>This installer VM was created as a KVM VM on one of the head nodes using the rhel8_installerVM.yml playbook. For more information, see the <a href="#creating-rhel-8-installer-machine">Creating RHEL 8 installer machine</a> section.</p> <ol start="2"><li>Add the kubeconfig path in the environment variables using the following command:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span>/opt/hpe-solutions-openshift/DL-LTI-Openshift/playbooks/roles/generate_ignition_files/ignitions/auth/kubeconfig
</code></pre></div><ol start="3"><li>Run the following command:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ openshift-install wait-for bootstrap-complete <span class="token parameter variable">--dir</span><span class="token operator">=</span>/opt/hpe-solutions-openshift/DL-LTI-Openshift/playbooks/roles/generate_ignition_files/ignitions --log-level debug
</code></pre></div><ol start="4"><li>Complete the RHOCP 4.12 cluster installation with the following command:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token variable">$openshift</span>-install wait-for install-complete <span class="token parameter variable">--dir</span><span class="token operator">=</span>/opt/hpe-solutions-openshift/DL-LTI-Openshift/playbooks/roles/generate_ignition_files/ignitions --log-level<span class="token operator">=</span>debug
</code></pre></div><p>The following output is displayed:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>DEBUG OpenShift Installer v4.12

DEBUG Built from commit 6ed04f65b0f6a1e11f10afe658465ba8195ac459 

INFO Waiting up to 30m0s <span class="token keyword">for</span> the cluster at https://api.rrocp.pxelocal.local:6443 to initialize<span class="token punctuation">..</span>. 

DEBUG Still waiting <span class="token keyword">for</span> the cluster to initialize: Working towards <span class="token number">4.12</span>: <span class="token number">99</span>% complete 

DEBUG Still waiting <span class="token keyword">for</span> the cluster to initialize: Working towards <span class="token number">4.12</span>: <span class="token number">99</span>% complete, waiting on authentication, console,image-registry 

DEBUG Still waiting <span class="token keyword">for</span> the cluster to initialize: Working towards <span class="token number">4.12</span>: <span class="token number">99</span>% complete 

DEBUG Still waiting <span class="token keyword">for</span> the cluster to initialize: Working towards <span class="token number">4.12</span>: <span class="token number">100</span>% complete, waiting on image-registry 

DEBUG Still waiting <span class="token keyword">for</span> the cluster to initialize: Cluster operator image-registry is still updating 

DEBUG Still waiting <span class="token keyword">for</span> the cluster to initialize: Cluster operator image-registry is still updating 

DEBUG Cluster is initialized 

INFO Waiting up to 10m0s <span class="token keyword">for</span> the openshift-console route to be created<span class="token punctuation">..</span>.

DEBUG Route found <span class="token keyword">in</span> openshift-console namespace: console 

DEBUG Route found <span class="token keyword">in</span> openshift-console namespace: downloads 

DEBUG OpenShift console route is created 

INFO Install complete<span class="token operator">!</span> 

INFO Access the OpenShift web-console here: https://console-openshift-console.apps.ocp.ngs.local

INFO Login to the console with user: kubeadmin, password: a6hKv-okLUA-Q9p3q-UXLc3
</code></pre></div><p>The RHOCP cluster is successfully installed.</p> <ol start="5"><li>After the installation is complete, check the status of the created cluster:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ oc get nodes
</code></pre></div><h3 id="running-red-hat-openshift-container-platform-console"><a href="#running-red-hat-openshift-container-platform-console" class="header-anchor">#</a> <strong>Running Red Hat OpenShift Container Platform Console</strong></h3> <p><strong>Prerequisites:</strong></p> <p>The RHOCP cluster installation must be complete.</p> <div class="tip custom-block"><p class="custom-block-title">NOTE</p> <p>The installer machine provides the Red Hat OpenShift Container Platform Console link and login details when the RHOCP cluster installation is complete.</p></div> <p>To access the Red Hat OpenShift Container Platform Console:</p> <ol><li>Open a web browser and enter the following link:</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>https://console-openshift-console.apps.<span class="token operator">&lt;</span>customer.defined.domain<span class="token operator">&gt;</span> 

Sample one <span class="token keyword">for</span> reference:  https://console-openshift-console.apps.ocp.ngs.local
</code></pre></div><p>Log in to the Red Hat OpenShift Container Platform Console with the following credentials:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>- Username: kubeadmin
- Password: <span class="token operator">&lt;</span>password<span class="token operator">&gt;</span>
</code></pre></div><div class="tip custom-block"><p class="custom-block-title">NOTE</p> <p>If the password is lost or forgotten, search for the kubeadmin-password file located in the /opt/hpe-solutions-openshift/DL-LTI-Openshift/playbooks/roles/generate_ignition_files/ignitions/auth/kubeadmin-password directory on the installer machine.</p></div> <p>The following figure shows the Red Hat OpenShift Container Platform Console after successful deployment:</p> <p><img src="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/img/Aspose.Words.d1fc7ddd-52aa-4c6c-b4c8-7a1fb8d3e951.010.48c8f1fc.png" alt></p> <p><strong>FIGURE 8.</strong> Red Hat OpenShift Container Platform Console login screen</p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/hpe-solutions-openshift/4.12-INTEL-LTI/Solution-Deployment/Preparing-execution-environment.html" class="prev">
          Preparing the execution environment for RHOCP worker3 node
        </a></span> <span class="next"><a href="/hpe-solutions-openshift/4.12-INTEL-LTI/Solution-Deployment/OCP-worker-nodes.html">
          Adding RHEL 8.6 worker nodes to RHOCP cluster using Ansible playbooks
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/app.1dde5221.js" defer></script><script src="/hpe-solutions-openshift/4.12-INTEL-LTI/assets/js/11.1b423092.js" defer></script>
  </body>
</html>
