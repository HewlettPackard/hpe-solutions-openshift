<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Red Hat OpenShift Container Platform deployment | RED HAT OPENSHIFT CONTAINER PLATFORM 4 ON HPE SYNERGY</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/hpe-solutions-openshift/assets/css/0.styles.03110986.css" as="style"><link rel="preload" href="/hpe-solutions-openshift/assets/js/app.adad66b3.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/assets/js/2.ac0f675e.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/assets/js/9.cd9b026d.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/10.bbe6a8b1.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/11.c231a443.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/12.381ec328.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/13.bc9c4fc5.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/14.6c2a59eb.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/15.10105a64.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/16.de305cb4.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/17.c566bc9d.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/18.1a3abf91.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/19.e7a9cad7.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/20.826352b1.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/21.e9b44a36.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/3.f3b6057a.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/4.d098f71d.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/5.c9b2efa3.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/6.e3886d8a.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/7.8d533ade.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/8.97285f82.js">
    <link rel="stylesheet" href="/hpe-solutions-openshift/assets/css/0.styles.03110986.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-openshift/" class="home-link router-link-active"><!----> <span class="site-name">RED HAT OPENSHIFT CONTAINER PLATFORM 4 ON HPE SYNERGY</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-openshift/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-openshift/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/hpe-solutions-openshift/" class="sidebar-link">Introduction</a></li><li><a href="/hpe-solutions-openshift/Solution overview/Solution overview.html" class="sidebar-link">Solution overview</a></li><li><a href="/hpe-solutions-openshift/Solution components/Solution components.html" class="sidebar-link">Solution components</a></li><li><a href="/hpe-solutions-openshift/Preparing the execution environment/Preparing the execution environment.html" class="sidebar-link">Preparing the execution environment</a></li><li><a href="/hpe-solutions-openshift/Physical environment configuration/Physical environment configuration.html" class="sidebar-link">Physical environment configuration</a></li><li><a href="/hpe-solutions-openshift/Physical node configuration/Physical node configuration.html" class="sidebar-link">Physical node configuration</a></li><li><a href="/hpe-solutions-openshift/Virtual nodes configuration/Virtual nodes configuration.html" class="sidebar-link">Virtual nodes configuration</a></li><li><a href="/hpe-solutions-openshift/Red Hat OpenShift Container Platform deployment/Red Hat OpenShift Container Platform deployment.html" class="active sidebar-link">Red Hat OpenShift Container Platform deployment</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/Red Hat OpenShift Container Platform deployment/Red Hat OpenShift Container Platform deployment.html#deploying-an-openshift-cluster" class="sidebar-link">Deploying an OpenShift Cluster</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/Red Hat OpenShift Container Platform deployment/Red Hat OpenShift Container Platform deployment.html#adding-red-hat-coreos-worker-nodes" class="sidebar-link">Adding Red Hat CoreOS worker nodes</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/Red Hat OpenShift Container Platform deployment/Red Hat OpenShift Container Platform deployment.html#adding-rhel-7-6-worker-nodes" class="sidebar-link">Adding RHEL 7.6 worker nodes</a></li></ul></li><li><a href="/hpe-solutions-openshift/Red Hat Local Storage Operator/Red Hat Local Storage Operator.html" class="sidebar-link">Red Hat Local Storage Operator</a></li><li><a href="/hpe-solutions-openshift/Securing RedHat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor/Securing RedHat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor.html" class="sidebar-link">Securing RedHat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor</a></li><li><a href="/hpe-solutions-openshift/Physical worker node labeling in OpenShift/Physical worker node labeling in OpenShift.html" class="sidebar-link">Physical worker node labeling in OpenShift</a></li><li><a href="/hpe-solutions-openshift/OpenShift Operators/OpenShift Operators.html" class="sidebar-link">OpenShift Operators</a></li><li><a href="/hpe-solutions-openshift/Validating OpenShift Container Platform deployment/Validating OpenShift Container Platform deployment.html" class="sidebar-link">Validating OpenShift Container Platform deployment</a></li><li><a href="/hpe-solutions-openshift/Resources and additional links/Resources and additional links.html" class="sidebar-link">Resources and additional links</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="red-hat-openshift-container-platform-deployment"><a href="#red-hat-openshift-container-platform-deployment" class="header-anchor">#</a> Red Hat OpenShift Container Platform deployment</h1> <p>This section describes the process to deploy Red Hat OpenShift Container Platform 4.</p> <h2 id="deploying-an-openshift-cluster"><a href="#deploying-an-openshift-cluster" class="header-anchor">#</a> Deploying an OpenShift Cluster</h2> <p>This section covers the steps to deploy a Red Hat OpenShift Container Platform 4 cluster with master nodes and worker nodes running RHCOS. After the operating system is installed on the nodes, verify the installation and then perform the following steps:</p> <ol><li><p>Login to the installer VM.</p></li> <li><p>Execute the following command to bootstrap the nodes.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> /etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/library/openshift_components/openshift-install wait-for bootstrap-complete --log-level<span class="token operator">=</span>debug
</code></pre></div><p><strong>RESULT</strong></p> <div class="language- extra-class"><pre class="language-text"><code>DEBUG OpenShift Installer v4.3

DEBUG Built from commit 425e4ff0037487e32571258640b39f56d5ee5572

INFO Waiting up to 30m0s for the Kubernetes API atÂ https://api.ocp.pxelocal.local:6443...

INFO API v1.14.6+76aeb0c up

INFO Waiting up to 30m0s for bootstrapping to complete...

DEBUG Bootstrap status: complete

INFO It is now safe to remove the bootstrap resources
</code></pre></div><p><strong>NOTE</strong></p> <p>You can shut down or remove the bootstrap node after the completion of step 1 and step 2.</p></li> <li><p>Run the following command to append the kubeconfig path to environment variables.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span>/etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/ignitions/auth/kubeconfig
</code></pre></div></li> <li><p>Run the following command to append the oc utility path to environment variables.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/library/openshift_components
</code></pre></div></li> <li><p>Provide the PV storage for the registry. Execute the following command to set the image registry storage to an empty directory.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc patch configs.imageregistry.operator.openshift.io cluster --type merge --patch <span class="token string">'{&quot;spec&quot;:{&quot;storage&quot;:{&quot;emptyDir&quot;:{}}}}'</span> 
</code></pre></div></li> <li><p>Execute the following command to complete the RedHat OpenShift Container Platform 4 cluster installation.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> /etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/library/openshift_components/openshift-install wait-for install-complete --log-level<span class="token operator">=</span>debug
</code></pre></div><p>The result should appear like what appears below.</p> <div class="language- extra-class"><pre class="language-text"><code>DEBUG OpenShift Installer v4.3

DEBUG Built from commit 6ed04f65b0f6a1e11f10afe658465ba8195ac459Â 

INFOÂ WaitingÂ up to 30m0s for the cluster at https://api.rrocp.pxelocal.local:6443 to initialize...Â 

DEBUG Still waiting for the cluster to initialize: Working towards 4.3: 99% completeÂ 

DEBUG Still waiting for the cluster to initialize: Working towards 4.3: 99% complete, waiting on authentication, console,Â image-registryÂ 

DEBUG Still waiting for the cluster to initialize: Working towards 4.3: 99% completeÂ 

DEBUG Still waiting for the cluster to initialize: Working towards 4.3: 100% complete, waiting on image-registryÂ 

DEBUGÂ StillÂ waiting for the cluster to initialize: Cluster operator image-registry is still updatingÂ 

DEBUGÂ StillÂ waiting for the cluster to initialize: Cluster operator image-registry is still updatingÂ 

DEBUG Cluster is initializedÂ 

INFOÂ WaitingÂ up to 10m0s for theÂ openshift-console route to be created...Â 

DEBUG Route found inÂ openshift-console namespace: consoleÂ 

DEBUG Route found inÂ openshift-console namespace: downloadsÂ 

DEBUG OpenShift console route is createdÂ 

INFO Install complete!Â 

INFO To access the cluster as theÂ system:adminÂ user when using 'oc', run 'export KUBECONFIG=/root/ocp42-8/auth/kubeconfig'Â 

INFO Access the OpenShift web-console here:Â https://console-openshift-console.apps.ocp.pxelocal.localÂ 

INFO Login to the console withÂ user:Â kubeadmin, password: a6hKv-okLUA-Q9p3q-UXLc3Â 
</code></pre></div><p><strong>NOTE</strong></p> <p>Make a note of the cluster URL and the username for future access.</p> <p>If the password is lost or forgotten, view the fileÂ kubeadmin-password located in the installer machine at <em>/etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/library/ignitions/auth/.</em></p></li></ol> <p><strong>Figure 9</strong> shows the OpenShift Container Platform console view upon successful deployment.</p> <p><img src="/hpe-solutions-openshift/assets/img/figure9.4dd71c02.png" alt="OpenShift Web Console login screen"></p> <p><strong>Figure 9.</strong> OpenShift Web Console login screen</p> <h2 id="adding-red-hat-coreos-worker-nodes"><a href="#adding-red-hat-coreos-worker-nodes" class="header-anchor">#</a> Adding Red Hat CoreOS worker nodes</h2> <p>This section covers the steps to add RHCOS worker nodes to an existing OpenShift Container Platform 4 cluster.</p> <h3 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h3> <ol><li><p>A Red Hat OpenShift Container Platform 4 cluster is available within the deployment environment.</p></li> <li><p>A worker node ignition file is generated along with the bootstrap and master ignition files. Refer to the section <a href="/hpe-solutions-openshift/Preparing the execution environment/Preparing the execution environment.html#kubernetes-manifests-and-ignition-files">Kubernetes manifests and ignition files</a> in this document for details on generating manifest and ignition files.</p> <p><strong>NOTE</strong></p> <p>It is important to use the <em>worker.ign</em> ignition file generated along with the <em>master.ign</em> file used to create the OpenShift cluster. If this is not the case, then âcertificate signing requestsâ in OpenShift will not recognize these worker nodes.</p></li> <li><p>A working node is available that needs to be attached to the existing OpenShift cluster and used as the worker node.</p></li></ol> <h3 id="procedure"><a href="#procedure" class="header-anchor">#</a> Procedure</h3> <ol><li><p>Login to the installer VM.</p></li> <li><p>Execute the following command to get the nodes associated with the OpenShift cluster.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span>/etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/ignitions/auth/kubeconfig 
<span class="token operator">&gt;</span> <span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span>:/etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/library/openshift_components
<span class="token operator">&gt;</span> oc get nodes
</code></pre></div><p>The output is as follows.</p> <div class="language- extra-class"><pre class="language-text"><code>NAME STATUS ROLES AGE VERSION

master1.ocp.twentynet.local Ready master,worker 5d v1.14.6+888f9c630

master2.ocp.twentynet.local Ready master,worker 5d v1.14.6+888f9c630

master3.ocp.twentynet.local Ready master,worker 5d v1.14.6+888f9c630
</code></pre></div></li> <li><p>Since the worker node is booted with the existing worker ignition file, the node is recognized by the current OpenShift cluster. However, the certificate signing request is pending. Execute the following command to get the certificate signing requests.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get csr
</code></pre></div><p>The output is as follows.</p> <div class="language- extra-class"><pre class="language-text"><code>NAME AGE REQUESTOR CONDITION

csr-8pj6k 28m system:node:worker1.ocp.twentynet.local Pending

csr-9pj7c 28m system:node:worker2.ocp.twentynet.local Pending

csr-9pj1s 28m system:node:worker3.ocp.twentynet.local Pending
</code></pre></div></li> <li><p>Execute the following command to approve all of the pending certificate signing requests and to add the worker nodes to the cluster.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get csr <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'{print <span class="token variable">$1</span>}'</span><span class="token operator">|</span> <span class="token keyword">while</span> <span class="token builtin class-name">read</span> line<span class="token punctuation">;</span> <span class="token keyword">do</span> ./oc adm certificate approve <span class="token variable">$line</span><span class="token punctuation">;</span> <span class="token keyword">done</span>
</code></pre></div></li> <li><p>Verify that the certificate signing requests for the worker nodes are approved using the following command.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get csr
</code></pre></div><p>The output is as follows.</p> <div class="language- extra-class"><pre class="language-text"><code>NAME AGE REQUESTOR CONDITION

csr-8pj6k 28m system:node:worker1.ocp.twentynet.local Approved,Issued

csr-9pj7c 28m system:node:worker2.ocp.twentynet.local Approved,Issued

csr-9pj1s 28m system:node:worker3.ocp.twentynet.local Approved,Issued
</code></pre></div></li> <li><p>Verify that the worker nodes are added to the cluster using the following command.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get nodes
</code></pre></div><p>The output is as follows.</p> <div class="language- extra-class"><pre class="language-text"><code>NAME STATUS ROLES AGE VERSION

master1.ocp.twentynet.local Ready master,worker 5d v1.14.6+888f9c630

master2.ocp.twentynet.local Ready master,worker 5d v1.14.6+888f9c630

master3.ocp.twentynet.local Ready master,worker 5d v1.14.6+888f9c630

worker1.ocp.twentynet.local Ready worker 5d v1.14.6+888f9c630

worker2.ocp.twentynet.local Ready worker 5d v1.14.6+888f9c630

worker3.ocp.twentynet.local Ready worker 5d v1.14.6+888f9c630
</code></pre></div></li> <li><p>Execute the following command to set the parameter <em>mastersSchedulable</em> parameter as <em>false</em>, so that master nodes will not be used to schedule pods.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc edit scheduler
</code></pre></div><p>The output is as follows.</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: config.openshift.io/v1Â 

kind: SchedulerÂ 

metadata:Â 

Â Â creationTimestamp: &quot;2019-12-13T10:34:48Z&quot;Â 

Â  generation: 2Â 

Â  name: clusterÂ 

Â Â resourceVersion: &quot;1748652&quot;Â 

Â Â selfLink: /apis/config.openshift.io/v1/schedulers/clusterÂ 

Â Â uid: 30245db9-1d94-11ea-8066-000c29c3ee8eÂ 

spec:Â 

Â Â **mastersSchedulable: falseÂ **

Â  policy:Â 

Â Â Â  name: &quot;&quot;Â 

status: {}Â 
</code></pre></div></li> <li><p>Execute the following command to verify the master roles have been reset.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get nodes
</code></pre></div><p>The output is as follows.</p> <div class="language- extra-class"><pre class="language-text"><code>NAME STATUS ROLES AGE VERSION

master1.ocp.twentynet.local Ready master 5d v1.14.6+888f9c630

master2.ocp.twentynet.local Ready master 5d v1.14.6+888f9c630

master3.ocp.twentynet.local Ready master 5d v1.14.6+888f9c630

worker1.ocp.twentynet.local Ready worker 5d v1.14.6+888f9c630

worker2.ocp.twentynet.local Ready worker 5d v1.14.6+888f9c630

worker3.ocp.twentynet.local Ready worker 5d v1.14.6+888f9c630
</code></pre></div></li></ol> <h2 id="adding-rhel-7-6-worker-nodes"><a href="#adding-rhel-7-6-worker-nodes" class="header-anchor">#</a> Adding RHEL 7.6 worker nodes</h2> <p>This section covers the steps to add RHEL 7.6 worker nodes to an existing Red Hat OpenShift Container Platform 4 cluster.</p> <h3 id="prerequisites-2"><a href="#prerequisites-2" class="header-anchor">#</a> Prerequisites</h3> <ol><li><p>Ensure the required packages are installed and any necessary configuration is performed on the installer VM. Refer to the section <a href="/hpe-solutions-openshift/Preparing the execution environment/Preparing the execution environment.html#installer-machine">Installer machine</a> of this document for details on the prerequisites and configuration steps.</p></li> <li><p>RHEL nodes are prepared for installation. Refer to the section <a href="/hpe-solutions-openshift/Physical node configuration/Physical node configuration.html#preparing-worker-nodes-with-rhel">Preparing worker nodes with RHEL</a> of this document for details on preparing the RHEL 7.6 worker nodes.</p></li></ol> <h3 id="procedure-2"><a href="#procedure-2" class="header-anchor">#</a> Procedure</h3> <p>Perform the following steps on the installer VM:</p> <ol><li><p>Download the Red Hat OpenShift Container Platform 4 Ansible package to enable the addition of RHEL 7.6 worker nodes to an existing OpenShift cluster.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">sudo</span> yum <span class="token function">install</span> openshift-ansible openshift-clients jq
</code></pre></div></li> <li><p>Create an Ansible inventory file exclusively for adding RHEL worker nodes that is named <em>&lt;path&gt;/inventory/hosts</em> that defines your compute machine nodes and required variables as listed.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>all:vars<span class="token punctuation">]</span>

<span class="token comment"># Username that runs the Ansible tasks on the remote compute machines</span>

<span class="token comment"># ansible_user=root</span>

<span class="token comment"># If you do not specify root for the ansible_user,</span>

<span class="token comment"># you must set ansible_become to True and assign the user sudo permissions.</span>

<span class="token assign-left variable">ansible_become</span><span class="token operator">=</span>True

<span class="token comment"># Path to the kubeconfig file for your cluster</span>

<span class="token assign-left variable">openshift_kubeconfig_path</span><span class="token operator">=</span><span class="token string">&quot;~/.kube/config&quot;</span>

<span class="token comment"># FQDN of each RHEL machine to add to the cluster</span>

<span class="token punctuation">[</span>new_workers<span class="token punctuation">]</span>

worker-0.example.com

worker-1.example.com
</code></pre></div></li> <li><p>Execute the following commands to run the playbook which adds RHEL 7.6 worker nodes to the existing cluster.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> /usr/share/ansible/openshift-ansible
<span class="token operator">&gt;</span> ansible-playbook -i <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>path to inventory hosts <span class="token function">file</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> playbooks/scaleup.yml
</code></pre></div></li></ol> <h3 id="approving-the-certificate-signing-requests-for-your-machines"><a href="#approving-the-certificate-signing-requests-for-your-machines" class="header-anchor">#</a> Approving the certificate signing requests for your machines</h3> <p>When new machines are added to the cluster, pending certificate signing requests (CSRs) are generated for each machine that is added. Confirm these CSRs are approved. You can also approve the CSR if necessary.</p> <h4 id="prerequisites-3"><a href="#prerequisites-3" class="header-anchor">#</a> Prerequisites</h4> <ul><li>jq package is installed.</li></ul> <h3 id="procedure-3"><a href="#procedure-3" class="header-anchor">#</a> Procedure</h3> <ol><li><p>Confirm that the cluster recognizes the machines by executing the following command. The output lists all of the machines that have been created.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get nodes

NAME STATUS ROLES AGE VERSION

master-0 Ready master 63m v1.14.6+c4799753c

master-1 Ready master 63m v1.14.6+c4799753c

master-2 Ready master 64m v1.14.6+c4799753c

worker-0 NotReady worker 76s v1.14.6+c4799753c

worker-1 NotReady worker 70s v1.14.6+c4799753c
</code></pre></div></li> <li><p>Review the pending CSRs and ensure that there is a client and server request with Pending or Approved status for each machine added to the cluster.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get csr

NAME AGE REQUESTOR CONDITION

csr-8b2br 15m system:serviceaccount:openshift-machine-config-operator:node-bootstrapper Pending

csr-8vnps 15m system:serviceaccount:openshift-machine-config-operator:node-bootstrapper Pending

csr-bfd72 5m26s system:node:ip-10-0-50-126.us-east-2.compute.internal Pending

csr-c57lv 5m26s system:node:ip-10-0-95-157.us-east-2.compute.internal Pending
</code></pre></div><p>Since the CSRs rotate automatically, it is important to approve the CSRs within an hour of adding the machines to the cluster. If the CSRs are not approved within an hour, the certificates will rotate, and more than two certificates will be present for each node. All certificates must be approved. After the initial CSRs are approved, the subsequent node client CSRs are automatically approved by the cluster kube-controller-manager.</p> <p>To approve CSRs individually, run the following command for each valid CSR. In this example, &lt;csr_name&gt; is the name of a CSR from the list of current CSRs.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc adm certificate approve <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>csr<span class="token punctuation">\</span>_name<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span>
</code></pre></div><p>If all CSRs are valid, approve all of them by running the following command.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get csr -ojson <span class="token operator">|</span> jq -r <span class="token string">'.items\[\] | select(.status == {} ) | .metadata.name'</span> <span class="token operator">|</span> <span class="token function">xargs</span> oc adm certificate approve
</code></pre></div></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      â
      <a href="/hpe-solutions-openshift/Virtual nodes configuration/Virtual nodes configuration.html" class="prev">
        Virtual nodes configuration
      </a></span> <span class="next"><a href="/hpe-solutions-openshift/Red Hat Local Storage Operator/Red Hat Local Storage Operator.html">
        Red Hat Local Storage Operator
      </a>
      â
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-openshift/assets/js/app.adad66b3.js" defer></script><script src="/hpe-solutions-openshift/assets/js/2.ac0f675e.js" defer></script><script src="/hpe-solutions-openshift/assets/js/9.cd9b026d.js" defer></script>
  </body>
</html>
