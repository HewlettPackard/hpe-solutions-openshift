<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Securing RedHat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor | RED HAT OPENSHIFT CONTAINER PLATFORM 4 ON HPE SYNERGY</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/hpe-solutions-openshift/assets/css/0.styles.03110986.css" as="style"><link rel="preload" href="/hpe-solutions-openshift/assets/js/app.adad66b3.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/assets/js/2.ac0f675e.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/assets/js/3.f3b6057a.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/10.bbe6a8b1.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/11.c231a443.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/12.381ec328.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/13.bc9c4fc5.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/14.6c2a59eb.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/15.10105a64.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/16.de305cb4.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/17.c566bc9d.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/18.1a3abf91.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/19.e7a9cad7.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/20.826352b1.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/21.e9b44a36.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/4.d098f71d.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/5.c9b2efa3.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/6.e3886d8a.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/7.8d533ade.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/8.97285f82.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/9.cd9b026d.js">
    <link rel="stylesheet" href="/hpe-solutions-openshift/assets/css/0.styles.03110986.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-openshift/" class="home-link router-link-active"><!----> <span class="site-name">RED HAT OPENSHIFT CONTAINER PLATFORM 4 ON HPE SYNERGY</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-openshift/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-openshift/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/hpe-solutions-openshift/" class="sidebar-link">Introduction</a></li><li><a href="/hpe-solutions-openshift/Solution overview/Solution overview.html" class="sidebar-link">Solution overview</a></li><li><a href="/hpe-solutions-openshift/Solution components/Solution components.html" class="sidebar-link">Solution components</a></li><li><a href="/hpe-solutions-openshift/Preparing the execution environment/Preparing the execution environment.html" class="sidebar-link">Preparing the execution environment</a></li><li><a href="/hpe-solutions-openshift/Physical environment configuration/Physical environment configuration.html" class="sidebar-link">Physical environment configuration</a></li><li><a href="/hpe-solutions-openshift/Physical node configuration/Physical node configuration.html" class="sidebar-link">Physical node configuration</a></li><li><a href="/hpe-solutions-openshift/Virtual nodes configuration/Virtual nodes configuration.html" class="sidebar-link">Virtual nodes configuration</a></li><li><a href="/hpe-solutions-openshift/Red Hat OpenShift Container Platform deployment/Red Hat OpenShift Container Platform deployment.html" class="sidebar-link">Red Hat OpenShift Container Platform deployment</a></li><li><a href="/hpe-solutions-openshift/Red Hat Local Storage Operator/Red Hat Local Storage Operator.html" class="sidebar-link">Red Hat Local Storage Operator</a></li><li><a href="/hpe-solutions-openshift/Securing RedHat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor/Securing RedHat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor.html" class="active sidebar-link">Securing RedHat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/Securing RedHat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor/Securing RedHat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/Securing RedHat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor/Securing RedHat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor.html#playbooks-for-configuring-sysdig-for-openshift-container-platform" class="sidebar-link">Playbooks for configuring Sysdig for OpenShift Container Platform</a></li></ul></li><li><a href="/hpe-solutions-openshift/Physical worker node labeling in OpenShift/Physical worker node labeling in OpenShift.html" class="sidebar-link">Physical worker node labeling in OpenShift</a></li><li><a href="/hpe-solutions-openshift/OpenShift Operators/OpenShift Operators.html" class="sidebar-link">OpenShift Operators</a></li><li><a href="/hpe-solutions-openshift/Validating OpenShift Container Platform deployment/Validating OpenShift Container Platform deployment.html" class="sidebar-link">Validating OpenShift Container Platform deployment</a></li><li><a href="/hpe-solutions-openshift/Resources and additional links/Resources and additional links.html" class="sidebar-link">Resources and additional links</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="securing-redhat-openshift-container-platform-using-sysdig-secure-and-sysdig-monitor"><a href="#securing-redhat-openshift-container-platform-using-sysdig-secure-and-sysdig-monitor" class="header-anchor">#</a> Securing RedHat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor</h1> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>This section describes how to install the Sysdig agents in an automated way on Red Hat OpenShift Container Platform 4 running on HPE Synergy Composable Infrastructure. Sysdig agents can be installed on a wide array of Linux hosts. The assumption is that the installation user will run the Sysdig agent as a pod which then enables the Sysdig agent to automatically detect and monitor Red Hat OpenShift Container Platform 4.</p> <p></p> <p>To install Sysdig agents on the Red Hat OpenShift Container Platform 4 nodes, use the repository located on the HPE OpenShift Solutions GitHub at  <a href="https://github.com/HewlettPackard/hpe-solutions-openshift/tree/master/synergy/" target="_blank" rel="noopener noreferrer">https://github.com/HewlettPackard/hpe-solutions-openshift/tree/master/synergy/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. This repository contains Ansible plays and scripts to automate installation. Sysdig security components are stored at the location <em>/etc/ansible/hpe-solutions-openshift/synergy/scalable/platform/security-sysdig</em>.</p> <p></p> <h2 id="playbooks-for-configuring-sysdig-for-openshift-container-platform"><a href="#playbooks-for-configuring-sysdig-for-openshift-container-platform" class="header-anchor">#</a> Playbooks for configuring Sysdig for OpenShift Container Platform</h2> <p>To install the Sysdig agents in an automated way on Red Hat OpenShift Container Platform 4, use the repository located at the HPE OpenShift Solutions GitHub at <a href="https://github.com/HewlettPackard/hpe-solutions-openshift/tree/master/synergy/" target="_blank" rel="noopener noreferrer">https://github.com/HewlettPackard/hpe-solutions-openshift/tree/master/synergy/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. This repository contains the following:</p> <ul><li><p><strong>Playbooks:</strong> This folder contains the playbooks required for Sysdig agent installation.</p></li> <li><p><strong>Roles:</strong> This folder contains a role called &quot;sysdig-agent-deploy-ocp&quot; which is responsible for performing the actions required for Sysdig agent integration.</p></li> <li><p><strong>Hosts:</strong> This is the inventory file which will be used by the installer VM to reference hosts during sysdig agent deployment. Provide the installer VM IP or fully qualified domain name in this file.</p></li> <li><p><strong>site.yaml</strong>: This file defines the entire workflow for Sysdig integration.</p></li></ul> <p></p> <h3 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h3> <p>To successfully deploy Sysdig agents on the nodes, the following prerequisites must be met:</p> <ul><li><p>Red Hat OpenShift Container Platform 4 is up and running.</p></li> <li><p>Worker nodes in the Red Hat OpenShift Container Platform deployment could be virtual or physical and must be running RHCOS/RHEL operating system.</p></li> <li><p>The installation user has SaaS-based access to Sysdig Secure and Sysdig Monitor for the purpose of container security.</p></li> <li><p>The installation user has admin privileges for Sysdig Secure and Sysdig Monitor.</p></li> <li><p>Sysdig agents with version 9.5.0 are deployed on OpenShift Container Platform.</p></li> <li><p>The installation user has a valid access token that is given by Sysdig and is specific to their credentials on Sysdig Monitor and Sysdig Secure.</p></li></ul> <h3 id="custom-attributes-or-variable-files-and-plays"><a href="#custom-attributes-or-variable-files-and-plays" class="header-anchor">#</a> Custom attributes or variable files and plays</h3> <p>Each playbook has a role associated with it. Each role has a set of tasks under the &quot;<em>task</em>&quot; folder and variables under the &quot;<em>var</em>&quot; folder. These variable values must be defined by the installation user according to the installation environment prior to running the plays:</p> <ul><li><p><strong>sysdig-agent-deploy-ocp/vars/main.yml</strong>: Used during Sysdig agent deployment to OpenShift. This file contains Sysdig related variables.</p></li> <li><p><strong>sysdig-agent-deploy-ocp/tasks/main.yml</strong>: This file contains the actual Sysdig agent installation steps.</p></li> <li><p><strong>sysdig-agent-deploy-ocp/files/sysdig-agent-configmap.yaml</strong>: This file is provided by Sysdig and handles the Sysdig software related configuration.</p></li> <li><p><strong>sysdig-agent-deploy-ocp/files/sysdig-agent-daemonset-redhat-openshift.yaml</strong>: This file is provided by Sysdig and handles the Sysdig daemon related configuration.</p></li></ul> <p></p> <h3 id="executing-the-playbooks"><a href="#executing-the-playbooks" class="header-anchor">#</a> Executing the playbooks</h3> <p>This section describes the steps that need to be performed to use the playbooks:</p> <ol><li><p>Login to the installer VM.</p></li> <li><p>Browse the cloned directory and navigate to the following sub-directory.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> etc/ansible/hpe-solutions-openshift/synergy/scalable/platform/security-sysdig 
</code></pre></div></li> <li><p>Update the variables in the following files.</p> <p>a.  Provide the OpenShift Installer VM fully qualified domain name or IP address under [master].</p> <p>b.  Edit the file roles /sysdig-agent-deploy-ocp/vars/main.yml</p> <ul><li><p>Provide a value for the project name for Sysdig integration with OpenShift container Platform under the “projectname” variable.</p></li> <li><p>Provide the Sysdig access key/token value. This value is retrieved from the user setting by logging into Sysdig Secure or Sysdig Monitor GUI in “accesskeyval” variable.</p></li></ul> <p>c.  Edit the file /<em>roles/sysdig-agent-deploy-ocp/files/sysdig-agent-configmap.yaml</em></p> <ul><li><p>Enter “OpenShift” as the cluster type.</p></li> <li><p>Enter the Sysdig Collector address and port. Check with Sysdig on which collector is accessible in the installation environment and over which port.</p></li> <li><p>Hewlett Packard Enterprise recommends access of Sysdig collector over Secure Socket Layer (SSL) port. For both the “ssl” and “ssl certificate validate” keys, set the value as “true”.</p></li> <li><p>Set the variable related to the underlying Kubernetes deployment (OpenShift in this solution), to true.</p></li> <li><p>Enter the cluster name of the OpenShift cluster.</p></li></ul></li> <li><p>Run the play using following command.</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ansible-playbook -i hosts site.yml  
</code></pre></div><ol start="5"><li><p>To verify the deployment, log in to the installer VM and execute the following command.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get pods 
</code></pre></div><p>The output of this command displays the Sysdig agent names running on each of the nodes within the OpenShift cluster as shown in Figure 10. If you see a pod with a pending status, then there might be a possibility that the underlying OpenShift node is not functional.</p> <p><img src="/hpe-solutions-openshift/assets/img/figure10.64b2bd74.png" alt="Sysdig agents running on OpenShift nodes"></p> <p><strong>Figure 10</strong>. Sysdig agents running on OpenShift nodes</p></li> <li><p>Execute the following command to verify the number of pods that are currently up and running in the OpenShift Container Platform deployment.</p> <div class="language- extra-class"><pre class="language-text"><code>&gt; oc get nodes
</code></pre></div><p>The output is shown in Figure 11.</p> <p><img src="/hpe-solutions-openshift/assets/img/figure11.18ffcf4f.png" alt="OpenShift nodes information"></p> <p><strong>Figure 11</strong>. OpenShift nodes information</p></li></ol> <p></p> <ol start="7"><li><p>Login to Sysdig Secure web interface at <a href="https://sysdig.com/" target="_blank" rel="noopener noreferrer">https://sysdig.com/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> as a user with administrative privileges.</p></li> <li><p>From the Sysdig Secure web interface, click the icon named <strong>POLICY EVENTS</strong> and you will see the web interface for <strong>Policy Events</strong> tab. On the <strong>Policy Events</strong> tab, click the <strong>Groupings</strong> drop-down list and select <strong>Entire Infrastructure</strong>. The user with administrative privileges should be able to see all the OpenShift nodes as in <strong>Figure 12</strong>.</p></li></ol> <p><img src="/hpe-solutions-openshift/assets/img/figure12.14af882f.png" alt=" OpenShift cluster in Sysdig Secure"></p> <p><strong>Figure 12.</strong> OpenShift cluster in Sysdig Secure</p> <ol start="9"><li><p>From the Sysdig Monitor web interface, click <strong>Explore</strong> icon and you will see the web interface for the <em>Explore</em> tab. On the <em>Explore</em> tab, click the <strong>Data Source</strong> (two rectangles) drop-down menu and select the data source named <em>Sysdig Agents</em> from the drop-down list.</p></li> <li><p>Open the <em>Groupings</em> drop-down list and select <strong>Clusters and Nodes</strong>. The user with administrative privileges should be able to see all the OpenShift nodes as shown in <strong>Figure 13</strong>.</p></li></ol> <p><img src="/hpe-solutions-openshift/assets/img/figure13.1929af56.png" alt="OpenShift cluster in Sysdig Monitor"></p> <p><strong>Figure 13</strong>. OpenShift cluster in Sysdig Monitor</p> <p><strong>NOTE</strong></p> <p>For an explanation of host requirements for agent installation, refer to, <a href="https://docs.sysdig.com/en/host-requirements-for-agent-installation.html" target="_blank" rel="noopener noreferrer">https://docs.sysdig.com/en/host-requirements-for-agent-installation.html<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <p>It is recommended to use port 6443 to transfer data over Secure Socket Layer/ Transport Layer Security (SSL/TLS) protocol. Sysdig agents transfer data to Sysdig Cloud over HTTPS that encrypts and decrypts the requests and the responses returned by the Sysdig Cloud.</p> <ol start="11"><li>From the Sysdig Monitor web interface, click <strong>EXPLORE</strong> icon. On the <em>Explore</em> tab, click the <strong>Data Source</strong> (two rectangles) drop-down menu and select the data source named <em>Sysdig Agents</em> from the drop-down list. Open the <strong>Groupings</strong> drop-down list and select <strong>Deployment and Pods</strong>. A user with administrative privileges should be able to see all the agents and their details as shown in <strong>Figure 14</strong>.</li></ol> <p><img src="/hpe-solutions-openshift/assets/img/figure14.1c357c85.png" alt="Sysdig agents running on the OpenShift cluster"></p> <p><strong>Figure 14.</strong> Sysdig agents running on the OpenShift cluster</p> <p><strong>NOTE</strong></p> <p>This section is based on Sysdig SaaS deployment approach. It is recommended that the installation user waits for some time until the OpenShift node statistics are visible in the Sysdig Secure and Sysdig Monitor user interface.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-openshift/Red Hat Local Storage Operator/Red Hat Local Storage Operator.html" class="prev">
        Red Hat Local Storage Operator
      </a></span> <span class="next"><a href="/hpe-solutions-openshift/Physical worker node labeling in OpenShift/Physical worker node labeling in OpenShift.html">
        Physical worker node labeling in OpenShift
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-openshift/assets/js/app.adad66b3.js" defer></script><script src="/hpe-solutions-openshift/assets/js/2.ac0f675e.js" defer></script><script src="/hpe-solutions-openshift/assets/js/3.f3b6057a.js" defer></script>
  </body>
</html>
