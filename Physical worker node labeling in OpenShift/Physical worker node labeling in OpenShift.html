<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Physical worker node labeling in OpenShift | RED HAT OPENSHIFT CONTAINER PLATFORM 4 ON HPE SYNERGY</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/hpe-solutions-openshift/assets/css/0.styles.03110986.css" as="style"><link rel="preload" href="/hpe-solutions-openshift/assets/js/app.adad66b3.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/assets/js/2.ac0f675e.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/assets/js/14.6c2a59eb.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/10.bbe6a8b1.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/11.c231a443.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/12.381ec328.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/13.bc9c4fc5.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/15.10105a64.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/16.de305cb4.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/17.c566bc9d.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/18.1a3abf91.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/19.e7a9cad7.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/20.826352b1.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/21.e9b44a36.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/3.f3b6057a.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/4.d098f71d.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/5.c9b2efa3.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/6.e3886d8a.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/7.8d533ade.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/8.97285f82.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/9.cd9b026d.js">
    <link rel="stylesheet" href="/hpe-solutions-openshift/assets/css/0.styles.03110986.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-openshift/" class="home-link router-link-active"><!----> <span class="site-name">RED HAT OPENSHIFT CONTAINER PLATFORM 4 ON HPE SYNERGY</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-openshift/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-openshift/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/hpe-solutions-openshift/" class="sidebar-link">Introduction</a></li><li><a href="/hpe-solutions-openshift/Solution overview/Solution overview.html" class="sidebar-link">Solution overview</a></li><li><a href="/hpe-solutions-openshift/Solution components/Solution components.html" class="sidebar-link">Solution components</a></li><li><a href="/hpe-solutions-openshift/Preparing the execution environment/Preparing the execution environment.html" class="sidebar-link">Preparing the execution environment</a></li><li><a href="/hpe-solutions-openshift/Physical environment configuration/Physical environment configuration.html" class="sidebar-link">Physical environment configuration</a></li><li><a href="/hpe-solutions-openshift/Physical node configuration/Physical node configuration.html" class="sidebar-link">Physical node configuration</a></li><li><a href="/hpe-solutions-openshift/Virtual nodes configuration/Virtual nodes configuration.html" class="sidebar-link">Virtual nodes configuration</a></li><li><a href="/hpe-solutions-openshift/Red Hat OpenShift Container Platform deployment/Red Hat OpenShift Container Platform deployment.html" class="sidebar-link">Red Hat OpenShift Container Platform deployment</a></li><li><a href="/hpe-solutions-openshift/Red Hat Local Storage Operator/Red Hat Local Storage Operator.html" class="sidebar-link">Red Hat Local Storage Operator</a></li><li><a href="/hpe-solutions-openshift/Securing RedHat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor/Securing RedHat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor.html" class="sidebar-link">Securing RedHat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor</a></li><li><a href="/hpe-solutions-openshift/Physical worker node labeling in OpenShift/Physical worker node labeling in OpenShift.html" class="active sidebar-link">Physical worker node labeling in OpenShift</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/Physical worker node labeling in OpenShift/Physical worker node labeling in OpenShift.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/Physical worker node labeling in OpenShift/Physical worker node labeling in OpenShift.html#sample-scripts-for-labeling-worker-nodes" class="sidebar-link">Sample scripts for labeling worker nodes</a></li></ul></li><li><a href="/hpe-solutions-openshift/OpenShift Operators/OpenShift Operators.html" class="sidebar-link">OpenShift Operators</a></li><li><a href="/hpe-solutions-openshift/Validating OpenShift Container Platform deployment/Validating OpenShift Container Platform deployment.html" class="sidebar-link">Validating OpenShift Container Platform deployment</a></li><li><a href="/hpe-solutions-openshift/Resources and additional links/Resources and additional links.html" class="sidebar-link">Resources and additional links</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="physical-worker-node-labeling-in-openshift"><a href="#physical-worker-node-labeling-in-openshift" class="header-anchor">#</a> Physical worker node labeling in OpenShift</h1> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>Discovering the node properties and advertising them through node labels can be used to control workload placement in an OpenShift cluster. With OpenShift running on HPE server platforms, organizations can automate the discovery of hardware properties and use that information to schedule workloads that benefit from the different capabilities that the underlying hardware provides. Using HPE iLO and its REST or Redfish API- based discovery capabilities (proliantutils), the following properties can be discovered about the nodes:</p> <ul><li><p>Presence of GPUs</p></li> <li><p>Underlying RAID configurations</p></li> <li><p>Presence of disks by type</p></li> <li><p>Persistent-memory availability</p></li> <li><p>Status of CPU virtualization features</p></li> <li><p>SR-IOV capabilities</p></li> <li><p>CPU architecture</p></li> <li><p>CPU core count</p></li> <li><p>Platform information including model, iLO and BIOS versions</p></li> <li><p>Memory capacity</p></li> <li><p>UEFI Security settings</p></li> <li><p>Health status of compute, storage, and network components</p></li></ul> <p>After these properties are discovered for the physical worker nodes, OpenShift node labeling can be applied to group nodes based on the underlying features of the nodes. By default, every node will have its node name as a label.</p> <p>The following properties can be used to label nodes:</p> <ol><li>Overall health status of the node.</li></ol> <p>If current status of &quot;BIOS, Fans, Temperature Sensors, Battery, Processor, Memory, Network, and Storage&quot; is ok, node health status is labeled as &quot;Ok&quot;. Otherwise it will appear as &quot;Degraded&quot;.</p> <ol start="2"><li>Overall security status of the node.</li></ol> <p>If the current status of the following BIOS configuration items (which are important for security) are as expected, then security status of the node is &quot;Ok&quot;. Otherwise, they will be labeled as &quot;Degraded&quot;.</p> <p><strong>NOTE</strong></p> <p>Based on the HPE Gen10 Security Reference Guide, the recommended values for the chosen parameters are as follows.</p> <ul><li><p>Secure Boot: Enabled</p></li> <li><p>Asset tag: Locked</p></li> <li><p>UEFI Shell Script Verification: Enabled</p></li> <li><p>UEFI Shell Startup: Disabled</p></li> <li><p>Processor AES: Enabled</p></li></ul> <p>For more information, refer HPE Gen10 Security Reference Guide at <a href="https://support.hpe.com/hpesc/public/docDisplay?docId=a00018320en_us" target="_blank" rel="noopener noreferrer">https://support.hpe.com/hpesc/public/docDisplay?docId=a00018320en_us<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <ol start="3"><li>Custom Labeling.</li></ol> <p>User defined labels (key, value) are assigned to desired physical worker nodes. Users can use these Python scripts to retrieve the properties of the underlying hardware and then decide on required labels that should be assigned to each physical worker nodes.</p> <h2 id="sample-scripts-for-labeling-worker-nodes"><a href="#sample-scripts-for-labeling-worker-nodes" class="header-anchor">#</a> Sample scripts for labeling worker nodes</h2> <p>To label the physical worker node in Red Hat OpenShift Container Platform, use the repository located at the HPE OpenShift Solutions GitHub at <a href="https://github.com/hewlettpackard/hpe-solutions-openshift" target="_blank" rel="noopener noreferrer">https://github.com/hewlettpackard/hpe-solutions-openshift<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. This repository contains Python scripts to automate the labeling of physical worker nodes by discovering the physical node properties in a Red Hat OpenShift Container Platform 4 deployment and advertising them through node labels. Node labels can be targeted for deployment using node selectors which can be set at a project level (can be used to restrict which nodes a project gets access to) or pod level.</p> <h3 id="contents-of-the-repository"><a href="#contents-of-the-repository" class="header-anchor">#</a> Contents of the repository</h3> <ol><li><p><strong>config.json</strong>: This file contains variables holding information about the OpenShift specific environment variables.</p> <ul><li><p><strong>kubeconfig_path</strong>: Specifies the path of kubeconfig and this path is used by the &quot;oc&quot; command at runtime.</p></li> <li><p><strong>oc_command_path</strong>: Specifies the oc command path and is used to run the &quot;oc&quot; command.</p></li></ul></li> <li><p><strong>hosts.json</strong>: This is the inventory file which will be used by OpenShift installer VM to reference physical worker nodes and user-defined labels.</p> <ul><li><p><strong>host_fqdn</strong>: Specifies the physical worker node fully qualified domain name or IP.</p></li> <li><p><strong>ilo_ip</strong>: iLO IP of the physical worker node.</p></li> <li><p><strong>username</strong>: Username used to log in to the iLO of the physical worker node.</p></li> <li><p><strong>password</strong>: Password to log in to the iLO of the physical worker node.</p></li> <li><p><strong>custom_label_required</strong>: The value is &quot;yes&quot; if the user wishes to use custom labels. Otherwise, it should be set to &quot;no&quot;.</p></li> <li><p><strong>custom_labels</strong>: Specify the custom labels key and value.</p></li></ul></li> <li><p><strong>json_parser.py</strong>: This file contains the logic to derive value of any standalone key or nested keys from the json file.</p></li> <li><p><strong>physical_node_labelling.py</strong>: This file contains the logic to derive the physical hardware properties and label of the Red Hat OpenShift Container Platform physical worker nodes based on properties and user-defined label names. To extract hardware properties, Python module &quot;proliantutils&quot; is used in this script.</p></li></ol> <h3 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h3> <ol><li><p>Red Hat OpenShift Container Platform 4 is up and running.</p></li> <li><p>There must be at least one physical worker node in the Red Hat OpenShift Container Platform 4 deployment.</p></li></ol> <h3 id="executing-the-playbooks"><a href="#executing-the-playbooks" class="header-anchor">#</a> Executing the playbooks</h3> <ol><li><p>Login to the installer VM.</p></li> <li><p>Activate the Python 3 virtual environment as mentioned in the section <a href="/hpe-solutions-openshift/Preparing the execution environment/Preparing the execution environment.html#installer-machine">Installer machine</a> in this document.</p></li> <li><p>Proliantutils is a set of utility libraries for interfacing and managing various components (like iLO) for HPE ProLiant Servers. Execute the following command to install proliantutils.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">sudo</span> pip <span class="token function">install</span> <span class="token assign-left variable">proliantutils</span><span class="token operator">==</span><span class="token number">2.9</span>.2
</code></pre></div></li> <li><p>Verify the version of proliantutils using the following command.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">sudo</span> pip freeze <span class="token operator">|</span> <span class="token function">grep</span> proliantutils
</code></pre></div><p>The output is as follows.</p> <div class="language- extra-class"><pre class="language-text"><code>You are using pip version 9.0.1, however version 20.0.2 is available.
You should consider upgrading via the 'pip install --upgrade pip' command.
 proliantutils==2.9.2
</code></pre></div></li> <li><p>Execute the following command to install sushy module.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">sudo</span> pip <span class="token function">install</span> <span class="token assign-left variable">sushy</span><span class="token operator">==</span><span class="token number">3.0</span>.0
</code></pre></div></li> <li><p>Verify the version of sushy.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">sudo</span> pip freeze <span class="token operator">|</span> <span class="token function">grep</span> sushy

Output: <span class="token number">3.0</span>.0
</code></pre></div></li> <li><p>Execute the following command and navigate to the directory physical-worker labeling.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> etc/ansible/hpe-solutions-openshift/synergy/scalable/platform/physical-workerlabeling 
```  

</code></pre></div></li> <li><p>Update the <em>config.json</em> and <em>hosts.json</em> files with appropriate values.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">sudo</span> <span class="token function">vi</span> config.json

<span class="token operator">&gt;</span> <span class="token function">sudo</span> <span class="token function">vi</span> hosts.json
</code></pre></div></li> <li><p>After the files mentioned in step 8 are updated, execute the script using the following command. The installation user will see the output similar to the following.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> python physical<span class="token punctuation">\</span>_node<span class="token punctuation">\</span>_labelling.py
</code></pre></div><p>The output is as follows.</p> <div class="language- extra-class"><pre class="language-text"><code>1: Get the physical worker node details.

2: Get current health status of the physical worker node

3: Get security parameters of the physical worker node

4: Label the physical worker with health status

5: Label the physical worker with security status

6: Custom labels

7: Display current labels on the node

8: Quit

Enter the choice number:
</code></pre></div></li> <li><p>Select option 1 to retrieve the physical worker node details. The output is similar to the following.</p> <div class="language- extra-class"><pre class="language-text"><code>Enter the choice number: 1

{'server1': {'host\_fqdn': 'ocs1.jocp.twentynet.local', 'ilo\_ip': '10.0.x.x',

'username': 'admin', 'password': 'admin123', 'custom\_label\_required': 'yes',

'custom\_labels': {'label1': {'label\_name': 'trial', 'label\_val': 'trail123'},'label2':

{'label\_name': 'trial2', 'label\_val': 'trial456'}}}}

</code></pre></div></li> <li><p>Select option 2 to retrieve the current health status of the physical worker node. The output is similar to the following.</p> <div class="language- extra-class"><pre class="language-text"><code>Enter the choice number: 2

{'ocs1.jocp.twentynet.local': 'OK'}

</code></pre></div></li> <li><p>Select option 3 to retrieve the security parameters of the physical worker node. The output is similar to the following.</p> <div class="language- extra-class"><pre class="language-text"><code>Enter the choice number: 3

{'ocs1.jocp.twentynet.local': 'Degraded'}

</code></pre></div></li> <li><p>Select option 4 to label the physical worker with its current hardware health status. The output is similar to the following.</p> <div class="language- extra-class"><pre class="language-text"><code>Enter the choice number: 4

NAME STATUS ROLES AGE VERSION LABELS

ocs1.jocp.twentynet.local Ready worker 6d4h v1.16.2

beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,health=OK,kubernet

es.io/arch=amd64,kubernetes.io/hostname=ocs1.jocp.twentynet.local,kubernetes

.io/os=linux,node-

role.kubernetes.io/worker=,node.openshift.io/os\_id=rhcos,qa\_shree1=1,qa\_shree

2=2,security=Degraded,shreeman=new\_label2,trial2=trial456,trial=trail123

Verified - Label health=OK is added to the node ocs1.jocp.twentynet.local

b''
</code></pre></div></li> <li><p>Select option 5 to label the physical worker with security status. The output is similar to the following.</p> <div class="language- extra-class"><pre class="language-text"><code> Enter the choice number: 5

 NAME STATUS ROLES AGE VERSION LABELS

 ocs1.jocp.twentynet.local Ready worker 6d4h v1.16.2

 beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,health=OK,kubernet

 es.io/arch=amd64,kubernetes.io/hostname=ocs1.jocp.twentynet.local,kubernetes

 .io/os=linux,node-

 role.kubernetes.io/worker=,node.openshift.io/os\_id=rhcos,qa\_shree1=1,qa\_shree

 2=2,security=Degraded,shreeman=new\_label2,trial2=trial456,trial=trail123

 Verified - Label security=Degraded is added to the node

 ocs1.jocp.twentynet.local

 b''

</code></pre></div></li> <li><p>Select option 6 to define custom labels. The output is similar to the following.</p> <div class="language- extra-class"><pre class="language-text"><code>Enter the choice number: 6

NAME STATUS ROLES AGE VERSION LABELS

ocs1.jocp.twentynet.local Ready worker 6d4h v1.16.2

beta.kubernetes.io/arch=amd64,beta.k

ubernetes.io/os=linux,health=OK,kubernetes.io/arch=amd64,kubernetes.io/hostn

ame=ocs1.jocp.twentynet

.local,kubernetes.io/os=linux,node-

role.kubernetes.io/worker=,node.openshift.io/os\_id=rhcos,qa\_shre

e1=1,qa\_shree2=2,security=Degraded,shreeman=new\_label2,trial2=trial456,trial

=trail123

Verified - Label trial=trail123 is added the node ocs1.jocp.twentynet.local

NAME STATUS ROLES AGE VERSION LABELS

ocs1.jocp.twentynet.local Ready worker 6d4h v1.16.2

beta.kubernetes.io/arch=amd64,beta.k

ubernetes.io/os=linux,health=OK,kubernetes.io/arch=amd64,kubernetes.io/hostn

ame=ocs1.jocp.twentynet

.local,kubernetes.io/os=linux,node-

role.kubernetes.io/worker=,node.openshift.io/os\_id=rhcos,qa\_shre

e1=1,qa\_shree2=2,security=Degraded,shreeman=new\_label2,trial2=trial456,trial

=trail123

Verified - Label trial2=trial456 is added the node ocs1.jocp.twentynet.local

b''
</code></pre></div></li> <li><p>Select option 7 to display current labels on the node. The output is similar to the following.</p> <div class="language- extra-class"><pre class="language-text"><code>Enter the choice number: 7

NAME STATUS ROLES AGE VERSION LABELS

ocs1.jocp.twentynet.local Ready worker 6d4h v1.16.2

beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,health=OK,kubernet

es.io/arch=amd64,kubernetes.io/hostname=ocs1.jocp.twentynet.local,kubernetes

.io/os=linux,node-

role.kubernetes.io/worker=,node.openshift.io/os\_id=rhcos,qa\_shree1=1,qa\_shree

2=2,security=Degraded,shreeman=new\_label2,trial2=trial456,trial=trail123
</code></pre></div></li> <li><p>Select option 8 to quit the script. The output is shown as follows.</p> <div class="language- extra-class"><pre class="language-text"><code>Enter the choice number: 8

Exiting!!
</code></pre></div></li></ol> <h3 id="verify-scheduling-of-pods-using-nodeselector"><a href="#verify-scheduling-of-pods-using-nodeselector" class="header-anchor">#</a> Verify scheduling of pods using NodeSelector</h3> <ol><li><p>Execute the following command to get all the nodes in the Red Hat OpenShift Container Platform installation.</p> <div class="language- extra-class"><pre><code>```bash
&gt; oc get nodes
```
</code></pre></div><p>The output is similar to the following.</p> <div class="language- extra-class"><pre><code>```
NAME STATUS ROLES AGE VERSION

master1.jocp.twentynet.local Ready master 37d v1.16.2

master2.jocp.twentynet.local Ready master 37d v1.16.2

master3.jocp.twentynet.local Ready master 37d v1.16.2

worker1.jocp.twentynet.local Ready worker 34d v1.16.2

worker2.jocp.twentynet.local Ready worker 31d v1.16.2

worker3.jocp.twentynet.local Ready worker 31d v1.16.2

worker4.jocp.twentynet.local Ready worker 16d v1.16.2

worker5.jocp.twentynet.local Ready worker 16d v1.16.2

ocs1.jocp.twentynet.local Ready worker 16d v1.16.2
```
</code></pre></div><p><strong>NOTE</strong></p> <p>Node “ocs1.jocp.twentynet.local” is the physical worker node and other worker nodes are virtual machines.</p></li> <li><p>Execute the following command to create a new project.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc new-project test4
</code></pre></div></li> <li><p>Execute the following command to create a new application in the newly created project “test4”.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc new-app django-psql-example
</code></pre></div></li> <li><p>Execute the following command to get the pods for the newly created application.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get pods
</code></pre></div><p>The output is similar to the following.</p> <div class="language- extra-class"><pre class="language-text"><code>NAME READY STATUS RESTARTS AGE

postgresql-1-bgzjm 0/1 Running 0 15s

postgresql-1-deploy 1/1 Running 0 23s
</code></pre></div></li> <li><p>Execute the following command to describe the application pod.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc describe pod postgresql-1-bgzjm
</code></pre></div><p>The output is similar to the following.</p> <div class="language- extra-class"><pre class="language-text"><code>Name: postgresql-1-bgzjm

Namespace: test

Priority: 0

Node: worker1.jocp.twentynet.local/20.0.x.x
</code></pre></div></li> <li><p>Execute the following command to check the deployment configuration.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get <span class="token function">dc</span>
</code></pre></div><p>The output is similar to the following.</p> <div class="language- extra-class"><pre class="language-text"><code>NAME REVISION DESIRED CURRENT TRIGGERED BY

django-psql-example 0 1 0 config,image(django-psql-example:latest)

postgresql 1 1 1 config,image(postgresql:10)
</code></pre></div></li> <li><p>Patch the deployment configuration with the “NodeSelector” as “health=OK”. This labeling will notify the scheduler about the application associated with this deployment configuration and is expected to run on a node with a label of “health=OK”. The command is as shown:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc patch <span class="token function">dc</span> postgresql –p <span class="token string">'{&quot;spec&quot;: {&quot;template&quot;:{&quot;spec&quot;:{&quot;nodeSelector&quot;:{&quot;health&quot;: &quot;OK&quot;}}}}}'</span>
deploymentconfig.apps.openshift.io/postgresql patched
</code></pre></div></li> <li><p>Execute the following command to validate new pods that are created for the same application after the deployment configuration is updated with node selector information.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get pods
</code></pre></div><p>The output is similar to the following.</p> <div class="language- extra-class"><pre class="language-text"><code>NAME READY STATUS RESTARTS AGE

postgresql-1-deploy 0/1 Completed 0 5m7s

postgresql-2-deploy 0/1 Completed 0 56s

postgresql-2-vvqcf 1/1 Running 0 45s
</code></pre></div></li> <li><p>Execute the following command to describe the newly created application pod to validate to see if it is deployed on the node with the desired label.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc describe pod postgresql-2-vvqcf
</code></pre></div><p>The output is similar to the following. It shows that the application is deployed on the node <em>“ocs1.jocp.twentynet.local”</em> which was labeled as “health=OK” in step 11 of the section <a href="/hpe-solutions-openshift/Physical worker node labeling in OpenShift/Physical worker node labeling in OpenShift.html#executing-the-playbooks">Executing the playbooks</a> in this document.</p> <div class="language- extra-class"><pre class="language-text"><code>Name: postgresql-2-vvqcf

Namespace: test

Priority: 0

Node: ocs1.jocp.twentynet.local /20.0.x.x

Node-Selectors: health=OK
</code></pre></div></li></ol> <p><strong>NOTE</strong></p> <p>These scripts have been tested on Red Hat OpenShift Container Platform 4.3 with the following configuration parameters:</p> <ul><li><p>Worker nodes are running RHCOS as the operating system</p></li> <li><p>Installer VM OS Version: RHEL 7.6</p></li> <li><p>Python: 3.6.9</p></li> <li><p>proliantutils: 2.9.2</p></li> <li><p>sushy: 3.0.0</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-openshift/Securing RedHat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor/Securing RedHat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor.html" class="prev">
        Securing RedHat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor
      </a></span> <span class="next"><a href="/hpe-solutions-openshift/OpenShift Operators/OpenShift Operators.html">
        OpenShift Operators
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-openshift/assets/js/app.adad66b3.js" defer></script><script src="/hpe-solutions-openshift/assets/js/2.ac0f675e.js" defer></script><script src="/hpe-solutions-openshift/assets/js/14.6c2a59eb.js" defer></script>
  </body>
</html>
