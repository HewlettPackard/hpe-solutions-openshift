(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{320:function(e,v,t){"use strict";t.r(v);var o=t(13),r=Object(o.a)({},(function(){var e=this,v=e._self._c;return v("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[v("p",[v("strong",[e._v("Installing and configuring master/slave Bind DNS on head nodes")])]),e._v(" "),v("p",[e._v("Domain Name System (DNS) is a distributed database system that associates hostnames with their respective IP addresses. Berkeley Internet Name Domain (BIND) comprises a set of DNS-related programs. It is also known as the service named in Red Hat Enterprise Linux. The /etc/named.conf is the main configuration file in the BIND configuration. This section focuses on installing, configuring, and managing BIND on the DNS server for all head nodes to create master and slave configuration.")]),e._v(" "),v("p",[e._v("Prerequisites:")]),e._v(" "),v("ul",[v("li",[e._v("All hosts must be running RHEL 8.5 OS.")]),e._v(" "),v("li",[e._v("Red Hat subscription must be active.")]),e._v(" "),v("li",[v("code"),e._v("DNS server must be configured with the following settings:")])]),e._v(" "),v("p",[v("strong",[e._v("TABLE 9.")]),e._v(" DNS server settings")]),e._v(" "),v("table",[v("thead",[v("tr",[v("th",{staticStyle:{"text-align":"left"}},[e._v("DNS server settings")]),e._v(" "),v("th",{staticStyle:{"text-align":"left"}},[e._v("Description")])])]),e._v(" "),v("tbody",[v("tr",[v("td",{staticStyle:{"text-align":"left"}},[e._v("isv.local")]),e._v(" "),v("td",{staticStyle:{"text-align":"left"}},[e._v("Zone (Domain name)")])]),e._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[e._v("172.28.230.11")]),e._v(" "),v("td",{staticStyle:{"text-align":"left"}},[e._v("IP address of master DNS node")])]),e._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[e._v("172.28.230.12")]),e._v(" "),v("td",{staticStyle:{"text-align":"left"}},[e._v("IP address of the 1st slave DNS node")])]),e._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[e._v("172.28.230.13")]),e._v(" "),v("td",{staticStyle:{"text-align":"left"}},[e._v("IP address of the 2nd slave DNS node")])])])]),e._v(" "),v("p",[e._v("Installing and configuring Bind DNS service on master nodes")]),e._v(" "),v("p",[e._v("To install and configure Bind DNS service on master nodes:")]),e._v(" "),v("ol",[v("li",[e._v("Install Bind DNS service on the master node with the following command:")])]),e._v(" "),v("p",[e._v("# yum -y install bind bind-utils vim")]),e._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[e._v("Configure BIND DNS on the master node.")]),e._v(" "),v("li",[e._v("Edit /etc/named.conf configuration file.")])]),e._v(" "),v("p",[e._v("Options {")]),e._v(" "),v("p",[e._v("listen-on port 53 { 127.0.0.1; 172.28.230.11; }😐")]),e._v(" "),v("p",[e._v("llsten-on-v6 port 53 { ::1; };")]),e._v(" "),v("p",[e._v('directory  "/var/named";')]),e._v(" "),v("p",[e._v('dump-file "/var/named/data/cache_dump.db";')]),e._v(" "),v("p",[e._v('statistics-file "/var/named/data/named _stats.txt";')]),e._v(" "),v("p",[e._v('memstatistics-file "/var/named/data/named_mem_stats.txt";')]),e._v(" "),v("p",[e._v('secroots-file "/var/named/data/named.secroots";')]),e._v(" "),v("p",[e._v('recursing-file "/var/named/data/named.recursing";')]),e._v(" "),v("p",[e._v("allow-query  { localhost; 172.0.0.0/24; };")]),e._v(" "),v("p",[e._v("allow-transfer { localhost; 172-28.230.12; 172.28.230.13; };")]),e._v(" "),v("p",[e._v("recursion no;")]),e._v(" "),v("p",[e._v("dnssec-enable yes;")]),e._v(" "),v("p",[e._v("dnssec-validation yes;")]),e._v(" "),v("p",[e._v('managed-keys-directory "/var/named/dynamic ";')]),e._v(" "),v("p",[e._v('pid:-file "/run/named/named.pid";')]),e._v(" "),v("p",[e._v('session-keyfile "/run/named./session.key";')]),e._v(" "),v("p",[e._v('include" /etc/crypto-policies/back.-ends/blind.config";')]),e._v(" "),v("p",[e._v("};")]),e._v(" "),v("p",[e._v("logging {")]),e._v(" "),v("p",[e._v("channel default_debug {")]),e._v(" "),v("p",[e._v('file "data/named.run";')]),e._v(" "),v("p",[e._v("severity dynamic;")]),e._v(" "),v("p",[v("code"),e._v("};")]),e._v(" "),v("p",[e._v(");")]),e._v(" "),v("p",[e._v('zone "." IN {')]),e._v(" "),v("p",[e._v("type hint;")]),e._v(" "),v("p",[e._v('file "named.ca";')]),e._v(" "),v("p",[e._v("};")]),e._v(" "),v("p",[e._v('zone "isv.local" IN{')]),e._v(" "),v("p",[e._v("type master;")]),e._v(" "),v("p",[e._v('file "forward,isv";')]),e._v(" "),v("p",[e._v("allow-update { none; };")]),e._v(" "),v("p",[e._v("};")]),e._v(" "),v("p",[e._v('zone "230.28.172.in-addr.arpa" IN{')]),e._v(" "),v("p",[e._v("type master;")]),e._v(" "),v("p",[e._v('file "reverse. isv";')]),e._v(" "),v("p",[e._v("allow-update { none; };")]),e._v(" "),v("p",[e._v("};")]),e._v(" "),v("p",[e._v('include "/etc/named.rfc1912.zones";')]),e._v(" "),v("p",[e._v('include "/etc/named.root.key";')]),e._v(" "),v("ol",{attrs:{start:"3"}},[v("li",[e._v("Create zone files.")]),e._v(" "),v("li",[e._v("After setting the files in the named.conf configuration file, create the zone files in the /var/named/ director directory and place all the records that you would wish to add such as A/AAAA, MX, PTR, and so on.")])]),e._v(" "),v("p",[e._v("[root@kvm~]# cat /var/named/forward.isv")]),e._v(" "),v("p",[e._v("$TTL 86400")]),e._v(" "),v("p",[e._v("@     IN SOA kvm1.isv.local. root.isv.local.(")]),e._v(" "),v("p",[e._v("2011071001; serial")]),e._v(" "),v("p",[e._v("300 ; refresh")]),e._v(" "),v("p",[e._v("1800; retry")]),e._v(" "),v("p",[e._v("604800; expire")]),e._v(" "),v("p",[e._v("86400 ) ; minimum")]),e._v(" "),v("p",[e._v("@      IN     NS      kvm1.isv.local.")]),e._v(" "),v("p",[e._v("@      IN     NS      kvm2.isv.local.")]),e._v(" "),v("p",[e._v("@      IN     NS      kvm3.isv.local.")]),e._v(" "),v("p",[e._v("@      IN      A       172.28.230.11")]),e._v(" "),v("p",[e._v("@      IN      A       172.28.230.12")]),e._v(" "),v("p",[e._v("@      IN      A       172.28.230.13")]),e._v(" "),v("p",[e._v("boot.ocp.isv.local.           IN     A     172.28.230.21")]),e._v(" "),v("p",[e._v("master0.ocp.isv.local.     IN     A     172.28.230.22")]),e._v(" "),v("p",[e._v("master1.ocp.isv.local.     IN     A     172.28.230.23")]),e._v(" "),v("p",[e._v("master2.ocp.isv.local.     IN     A     172.28.230.24")]),e._v(" "),v("p",[e._v("haproxy.ocp.isv.local.     IN     A     172.28.230.25")]),e._v(" "),v("p",[e._v("api.int.ocp.isv.local.        IN     A     172.28.230.25")]),e._v(" "),v("p",[e._v("api.ocp.isv.local.             IN     A     172.28.230.25")]),e._v(" "),v("p",[e._v("workerl.ocp.isv.local.     IN     A     172.28.230.26")]),e._v(" "),v("p",[e._v("worker2.ocp.isv.local.    IN     A     172.28.230.27")]),e._v(" "),v("p",[e._v("worker3.ocp.isv.local.    IN     A     172.28.230.28")]),e._v(" "),v("p",[e._v("* .apps.ocp.isv.local.      IN     A     172.28.230.25")]),e._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[e._v("Create the corresponding reverse records for the same domain that were defined in the named.conf configuration file.")])]),e._v(" "),v("p",[e._v("[root@kvm1 ~]# cat /var/named/reverse.isv")]),e._v(" "),v("p",[e._v("$TTL 86400")]),e._v(" "),v("p",[e._v("@ IN SOA kvm1.isv.local.root.isv.local(")]),e._v(" "),v("p",[e._v("2011071001 ; serial")]),e._v(" "),v("p",[e._v("300 ; refresh")]),e._v(" "),v("p",[e._v("1800; retry")]),e._v(" "),v("p",[e._v("604800 ; expire")]),e._v(" "),v("p",[e._v("86400 ) ; minimum")]),e._v(" "),v("p",[e._v("@    IN    NS     kvml.isv.local.")]),e._v(" "),v("p",[e._v("@    IN    NS     kvm2.isv.local.")]),e._v(" "),v("p",[e._v("@    IN    NS     kvm3.isv.local.")]),e._v(" "),v("p",[e._v("@    IN    PTR    isv.local.")]),e._v(" "),v("p",[e._v("@    IN    A      172.28.230.11")]),e._v(" "),v("p",[e._v("4P   IN    A      172.28.230.12")]),e._v(" "),v("p",[e._v("11   IN    A      172.28.230.13")]),e._v(" "),v("p",[e._v("11   IN    PTR    kvm1.isv.local.")]),e._v(" "),v("p",[e._v("12   IN    PTR    kvm2.isv.local.")]),e._v(" "),v("p",[e._v("13   IN    PTR    kvm3.isv.local.")]),e._v(" "),v("p",[e._v("21   IN    PTR    boot.ocp.isv.local.")]),e._v(" "),v("p",[e._v("22   IN    PTR    master0.ocp.isv.local.")]),e._v(" "),v("p",[e._v("23   IN    PTR    master1.ocp.isv.local.")]),e._v(" "),v("p",[e._v("24   IN    PTR    master2.ocp.isv.local.")]),e._v(" "),v("p",[e._v("25   IN    PTR    haproxy.ocp.isv.local.")]),e._v(" "),v("p",[e._v("25   IN    PTR    api.int.ocp.isv.local.")]),e._v(" "),v("p",[e._v("25   IN    PTR    api.ocp.isv.local.")]),e._v(" "),v("p",[e._v("26   IN    PTR    worker1.ocp.isv.local.")]),e._v(" "),v("p",[e._v("27   IN    PTR    worker2.ocp.isv.local.")]),e._v(" "),v("p",[e._v("28   IN    PTR    worker3.ocp.isv.local.")]),e._v(" "),v("ol",{attrs:{start:"4"}},[v("li",[e._v("Modify DNS settings on the master server.")]),e._v(" "),v("li",[e._v("Set the new DNS server as the default name server.")]),e._v(" "),v("li",[e._v("Edit /etc/resolv.conf configuration file and add the following lines:")])]),e._v(" "),v("p",[v("strong",[e._v("NOTE")])]),e._v(" "),v("p",[e._v("Ensure that the IP address is replaced to match your environment.")]),e._v(" "),v("p",[e._v("[root@kvm1~]# cat/etc/resolv.conf.")]),e._v(" "),v("p",[e._v("search isv.local")]),e._v(" "),v("p",[e._v("nameserver 172.28.230.11")]),e._v(" "),v("ol",{attrs:{start:"5"}},[v("li",[e._v("Configure firewall to allow DNS service.")])]),e._v(" "),v("p",[e._v("# sudo firewall-cmd--add-service=dns--permanent")]),e._v(" "),v("p",[e._v("# sudo firewall-cmd--reload")]),e._v(" "),v("p",[e._v("# sudo named-checkconf")]),e._v(" "),v("p",[e._v("# sudo systemctl start named")]),e._v(" "),v("p",[e._v("# sudo systemctl enable named")]),e._v(" "),v("p",[e._v("The master BIND DNS server configuration is complete.")]),e._v(" "),v("p",[e._v("Installing Bind DNS service on slave nodes")]),e._v(" "),v("p",[e._v("To install Bind DNS service on slave nodes:")]),e._v(" "),v("ol",[v("li",[e._v("On the both the slave nodes with IP addresses as 172.28.230.12 and 172.28.230.13, install bind and bind-utils:")])]),e._v(" "),v("p",[e._v("# yum -y install bind bind-utils vim")]),e._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[e._v("Configure the slave nodes and edit /etc/named.conf configuration file.")])]),e._v(" "),v("p",[e._v("options {")]),e._v(" "),v("p",[e._v("listen-on port 53 { 127.0.0.1; 172.28.230.12; 172.28.230.13; };")]),e._v(" "),v("p",[e._v("listen-on-v6 port 53 { ::1; };")]),e._v(" "),v("p",[e._v('directory " /var/named";')]),e._v(" "),v("p",[e._v('dump-file "/var/named/data/cache_dump.db";')]),e._v(" "),v("p",[e._v('statistics-file "/var/named/data/named_stats.txt";')]),e._v(" "),v("p",[e._v('memstatistics-file "/var/named/data/named_mem_stats.txt";')]),e._v(" "),v("p",[e._v('secroots-file "/var/named/data/named.secroots";')]),e._v(" "),v("p",[e._v('recursing-file "var/named/data/named.recursing";')]),e._v(" "),v("p",[e._v("allow-query { localhost; 172.0.0.0/24; };")]),e._v(" "),v("p",[e._v("recursion yes;")]),e._v(" "),v("p",[e._v("dnssec-enable yes;")]),e._v(" "),v("p",[e._v("dnssec-validation yes;")]),e._v(" "),v("p",[e._v('managed-keys-directory "/var/named/dynamic";')]),e._v(" "),v("p",[e._v('pid-file " /run/named/named.pid";')]),e._v(" "),v("p",[e._v('session-keyfile "/run/named/session.key";')]),e._v(" "),v("p",[e._v('include "/etc/crypto-policies/back-ends/bind_config";')]),e._v(" "),v("p",[e._v("};")]),e._v(" "),v("p",[e._v("logging {")]),e._v(" "),v("p",[e._v("channel default_debug {")]),e._v(" "),v("p",[e._v('file "data/named.run";')]),e._v(" "),v("p",[e._v("severity dynamic;")]),e._v(" "),v("p",[e._v("};")]),e._v(" "),v("p",[e._v("};")]),e._v(" "),v("p",[e._v('zone "." IN {')]),e._v(" "),v("p",[e._v("type hint;")]),e._v(" "),v("p",[e._v('file "named.ca";')]),e._v(" "),v("p",[e._v("};")]),e._v(" "),v("p",[e._v('zone "isv.local" IN{')]),e._v(" "),v("p",[e._v("type slave;")]),e._v(" "),v("p",[e._v('file "slaves/forward,isv";')]),e._v(" "),v("p",[e._v("master { 172.28.230.11; };")]),e._v(" "),v("p",[e._v("};")]),e._v(" "),v("p",[e._v('zone "230.28.172.in-addr.arpa" IN{')]),e._v(" "),v("p",[e._v("type slave;")]),e._v(" "),v("p",[e._v('file "slaves/reverse. isv";')]),e._v(" "),v("p",[e._v("master { 172.28.230.11; };")]),e._v(" "),v("p",[e._v("};")]),e._v(" "),v("p",[e._v('include "/etc/named.rfc1912.zones";')]),e._v(" "),v("p",[e._v('include "/etc/named.root.key" ;')]),e._v(" "),v("ol",{attrs:{start:"3"}},[v("li",[e._v("Modify DNS settings on the slave server.")]),e._v(" "),v("li",[e._v("Set the new DNS servers (both master and slaves) as the default name servers.")]),e._v(" "),v("li",[e._v("Edit /etc/resolv.conf configuration file and add the following lines:")])]),e._v(" "),v("p",[v("strong",[e._v("NOTE")])]),e._v(" "),v("p",[e._v("Ensure that the IP addresses are replaced to match your environment.")]),e._v(" "),v("p",[e._v("[root.kvm2~]9# cat/etc/resolv.conf")]),e._v(" "),v("p",[e._v("search isv.local")]),e._v(" "),v("p",[e._v("nameserver 172.28.230.11")]),e._v(" "),v("p",[e._v("nameserver 172.28.230.12")]),e._v(" "),v("p",[e._v("nameserver 172.28.230.13")]),e._v(" "),v("ol",{attrs:{start:"3"}},[v("li",[e._v("Check the configurations and then start and enable BIND:")])]),e._v(" "),v("p",[e._v("# sudo named-checkconf")]),e._v(" "),v("p",[e._v("# sudo systemctl start named")]),e._v(" "),v("p",[e._v("# sudo systemctl enable named")]),e._v(" "),v("ol",{attrs:{start:"4"}},[v("li",[e._v("Verify that the /var/named/slaves directory includes the zone files that were transferred from the master node.")])]),e._v(" "),v("p",[e._v("[root@kvm2~]# ls -| /var/named/slaves/")]),e._v(" "),v("p",[e._v("-rw-r-r-1 named named 900 Jun 23 09:11 forward.isv")]),e._v(" "),v("p",[e._v("-rw-r-r-1 named named 1168 Jun 23 09:12 reverse.isv")]),e._v(" "),v("p",[e._v("[root@)kvm3~]#ls-| /var/named/slaves/")]),e._v(" "),v("p",[e._v("-rw-r-r-1 named named 900 Jun 23 09:11 forward.isv")]),e._v(" "),v("p",[e._v("-rw-r-r-1 named named 1168 Jun 23 09:12 reverse.isv")]),e._v(" "),v("p",[e._v("Testing master/slave DNS configuration")]),e._v(" "),v("p",[e._v("To test the DNS resolution from the master/slave DNS servers:")]),e._v(" "),v("ol",[v("li",[e._v("On the master DNS server, run the following command:")])]),e._v(" "),v("ul",[v("li",[e._v("Master DNS node:")])]),e._v(" "),v("p",[e._v("[root@kvm1~]# dig +short master0.ocp.isv.local")]),e._v(" "),v("p",[e._v("172.28.230.22")]),e._v(" "),v("p",[e._v("[root@kvm1~]# dig +short -x 172.28.230.22")]),e._v(" "),v("p",[e._v("master0.ocp.isv.local.")]),e._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[e._v("On both the slave DNS servers, run the following commands:")])]),e._v(" "),v("ul",[v("li",[e._v("1st Slave DNS node:")])]),e._v(" "),v("p",[e._v("[root@kvm2~]# dig +short master0.ocp.isv.local")]),e._v(" "),v("p",[e._v("172.28.230.22")]),e._v(" "),v("p",[e._v("[root@kvm2~]# dig +short -x 172.28.230.22")]),e._v(" "),v("p",[e._v("master0.ocp.isv.local.")]),e._v(" "),v("ul",[v("li",[e._v("2nd Slave DNS node:")])]),e._v(" "),v("p",[e._v("[root@kvm3~]# dig +short master0.ocp.isv.local")]),e._v(" "),v("p",[e._v("172.28.230.22")]),e._v(" "),v("p",[e._v("[root@kvm3~]# dig +short -x 172.28.230.22")]),e._v(" "),v("p",[e._v("master0.ocp.isv.local.")]),e._v(" "),v("p",[v("strong",[e._v("Configuring load balancer on head nodes")])]),e._v(" "),v("p",[e._v("The RH OCP 4.10 uses an external load balancer to communicate from outside the cluster with services running inside the cluster. This section assumes that there is a load balancer available within our deployment environment and is available for use. Our deployment environment is developed using HAProxy, an open-source solution with one virtual machine for load balancing functionality.")]),e._v(" "),v("p",[e._v("In a production environment, Hewlett Packard Enterprise recommends the use of enterprise load balancing such as F5 Networks Big-IP and its associated products.")]),e._v(" "),v("p",[e._v("To configure load balancer on all head nodes:")]),e._v(" "),v("ol",[v("li",[e._v("Install haproxy and keepalived service on all head nodes.")])]),e._v(" "),v("p",[e._v("# yum install haproxy")]),e._v(" "),v("p",[e._v("# systemctl enable haproxy")]),e._v(" "),v("p",[e._v("# systemctl start haproxy")]),e._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[e._v("Edit /etc/haproxy/haproxy.conf configuration file on all head nodes.")])]),e._v(" "),v("p",[e._v("frontend openshift-api-server")]),e._v(" "),v("p",[v("code"),e._v("bind *:6443")]),e._v(" "),v("p",[v("code"),e._v("default_backend openshift-api-server")]),e._v(" "),v("p",[v("code"),e._v("mode tcp")]),e._v(" "),v("p",[v("code"),e._v("option tcplog")]),e._v(" "),v("p",[e._v("backend openshift-api-server")]),e._v(" "),v("p",[v("code"),e._v("balance source")]),e._v(" "),v("p",[v("code"),e._v("mode tcp")]),e._v(" "),v("p",[e._v("server ocpboot1 boot.ocp.isv.local:6443 check")]),e._v(" "),v("p",[v("code"),e._v("server ocpmaster1 master0.ocp.isv.local:6443 check")]),e._v(" "),v("p",[v("code"),e._v("server ocpmaster2 master1.ocp.isv.local:6443 check")]),e._v(" "),v("p",[v("code"),e._v("server ocpmaster3 master2.ocp.isv.local:6443 check")]),e._v(" "),v("p",[e._v("frontend machine-config-server68")]),e._v(" "),v("p",[v("code"),e._v("bind *:22623")]),e._v(" "),v("p",[v("code"),e._v("default_backend machine-config-server")]),e._v(" "),v("p",[v("code"),e._v("mode tcp")]),e._v(" "),v("p",[v("code"),e._v("option tcplog")]),e._v(" "),v("p",[e._v("backend machine-config-server")]),e._v(" "),v("p",[v("code"),e._v("balance source")]),e._v(" "),v("p",[v("code"),e._v("mode tcp")]),e._v(" "),v("p",[e._v("server ocpboot1 boot.ocp.isv.local:22623 check")]),e._v(" "),v("p",[v("code"),e._v("server ocpmaster1 master0.ocp.isv.local:22623 check")]),e._v(" "),v("p",[v("code"),e._v("server ocpmaster2 master1.ocp.isv.local:22623 check")]),e._v(" "),v("p",[v("code"),e._v("server ocpmaster3 master2.ocp.isv.local:22623 check")]),e._v(" "),v("p",[e._v("frontend ingress-http")]),e._v(" "),v("p",[v("code"),e._v("bind *:80")]),e._v(" "),v("p",[v("code"),e._v("default_backend ingress-http")]),e._v(" "),v("p",[v("code"),e._v("mode tcp")]),e._v(" "),v("p",[v("code"),e._v("option tcplog")]),e._v(" "),v("p",[e._v("backend ingress-http")]),e._v(" "),v("p",[v("code"),e._v("balance source")]),e._v(" "),v("p",[v("code"),e._v("mode tcp")]),e._v(" "),v("p",[v("code"),e._v("server ocpworker1 worker1.ocp.isv.local:80 check")]),e._v(" "),v("p",[v("code"),e._v("server ocpworker2 worker2.ocp.isv.local:80 check")]),e._v(" "),v("p",[v("code"),e._v("server ocpworker3 worker3.ocp.isv.local:80 check")]),e._v(" "),v("p",[e._v("# if creating a cluster with only master nodes to begin with and later adding the worker nodes, master nodes should be added in this section instead of worker nodes. Once all the worker nodes are added into the cluster, this configuration needs to be updated with the worker nodes.")]),e._v(" "),v("p",[v("code"),e._v("# server ocpmaster01 master0.ocp.isv.local:80 check")]),e._v(" "),v("p",[v("code"),e._v("# server ocpmaster02 master1.ocp.isv.local:80 check")]),e._v(" "),v("p",[v("code"),e._v("# server ocpmaster03 master2.ocp.isv.local:80 check")]),e._v(" "),v("p",[e._v("frontend ingress-https")]),e._v(" "),v("p",[v("code"),e._v("bind *:443")]),e._v(" "),v("p",[v("code"),e._v("default_backend ingress-https")]),e._v(" "),v("p",[v("code"),e._v("mode tcp")]),e._v(" "),v("p",[v("code"),e._v("option tcplog")]),e._v(" "),v("p",[e._v("backend ingress-https")]),e._v(" "),v("p",[v("code"),e._v("balance source")]),e._v(" "),v("p",[v("code"),e._v("mode tcp")]),e._v(" "),v("p",[v("code"),e._v("server ocpworker1 worker1.ocp.isv.local:443 check")]),e._v(" "),v("p",[v("code"),e._v("server ocpworker2 worker2.ocp.isv.local:443 check")]),e._v(" "),v("p",[v("code"),e._v("server ocpworker3 worker3.ocp.isv.local:443 check")]),e._v(" "),v("p",[e._v("# if creating a cluster with only master nodes to begin with and later adding the worker nodes, master nodes should be added in this section instead of worker nodes. Once all the worker nodes are added into the cluster, this configuration needs to be updated with the worker nodes.")]),e._v(" "),v("p",[v("code"),e._v("# server ocpmaster01 master0.ocp.isv.local:443 check")]),e._v(" "),v("p",[v("code"),e._v("# server ocpmaster02 master1.ocp.isv.local:443 check")]),e._v(" "),v("p",[v("code"),e._v("# server ocpmaster03 master2.ocp.isv.local:443 check")]),e._v(" "),v("p",[v("strong",[e._v("NOTE")])]),e._v(" "),v("p",[e._v("The load balancer configuration should contain values that are aligned to the installation environment.")]),e._v(" "),v("p",[e._v("Installing Keepalived service for HAProxy servers")]),e._v(" "),v("p",[e._v("The Keepalived service provides highly available capabilities on the load balancer for HAProxy server configuration.")]),e._v(" "),v("p",[e._v("To install the Keepalived service on all three head nodes:")]),e._v(" "),v("ol",[v("li",[e._v("Install Keepalived and psmisc service.")])]),e._v(" "),v("p",[v("strong",[e._v("NOTE")])]),e._v(" "),v("p",[e._v("The psmisc service provides killall to check the HAProxy for VRRP.")]),e._v(" "),v("p",[e._v("# yum install -y keepalived psmisc")]),e._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[e._v("Determine the interface that can be used with the services. For example, the highlighted interface is used with the services on our load balancer for HAProxy servers.")])]),e._v(" "),v("p",[e._v("[root@kvm3 slaves]# ip a")]),e._v(" "),v("p",[e._v("1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000")]),e._v(" "),v("p",[v("code"),e._v("link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00")]),e._v(" "),v("p",[v("code"),e._v("inet 127.0.0.1/8 scope host lo")]),e._v(" "),v("p",[v("code"),e._v("valid_lft forever preferred_lft forever")]),e._v(" "),v("p",[v("code"),e._v("inet6 ::1/128 scope host")]),e._v(" "),v("p",[v("code"),e._v("valid_lft forever preferred_lft forever")]),e._v(" "),v("p",[e._v("2: ens2: <BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP> mtu 1500 qdisc mq master bond0 state UP group default qlen 1000")]),e._v(" "),v("p",[v("code"),e._v("link/ether 88:e9:a4:41:55:b8 brd ff:ff:ff:ff:ff:ff")]),e._v(" "),v("p",[e._v("3: ens3: <BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP> mtu 1500 qdisc mq master bond0 state UP group default qlen 1000")]),e._v(" "),v("p",[v("code"),e._v("link/ether 88:e9:a4:41:55:b8 brd ff:ff:ff:ff:ff:ff permaddr 88:e9:a4:40:f6:d8")]),e._v(" "),v("p",[e._v("4: bridge0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000")]),e._v(" "),v("p",[v("code"),e._v("link/ether 88:e9:a4:41:55:b8 brd ff:ff:ff:ff:ff:ff")]),e._v(" "),v("p",[v("code"),e._v("inet6 fe80::8034:bdc:f7d0:b444/64 scope link noprefixroute")]),e._v(" "),v("p",[v("code"),e._v("valid_lft forever preferred_lft forever")]),e._v(" "),v("p",[e._v("5: bond0: <BROADCAST,MULTICAST,MASTER,UP,LOWER_UP> mtu 1500 qdisc noqueue master bridge0 state UP group default qlen 1000")]),e._v(" "),v("p",[v("code"),e._v("link/ether 88:e9:a4:41:55:b8 brd ff:ff:ff:ff:ff:ff")]),e._v(" "),v("p",[e._v("6: bridge0.230: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000")]),e._v(" "),v("p",[v("code"),e._v("link/ether 88:e9:a4:41:55:b8 brd ff:ff:ff:ff:ff:ff")]),e._v(" "),v("p",[v("code"),e._v("inet 172.28.230.13/24 brd 172.28.230.255 scope global noprefixroute bridge0.230")]),e._v(" "),v("p",[v("strong",[e._v("NOTE")])]),e._v(" "),v("p",[e._v("This interface could be a dedicated interface or a shared interface. It needs to belong on the same broadcast domain as the VIP.")]),e._v(" "),v("ol",[v("li",[e._v("Allow all connections from the interface for traffic use. Use the following IP addresses as interfaces for HAProxy:")])]),e._v(" "),v("p",[e._v("# iptables -A INPUT -s 172.28.230.11 -j ACCEPT")]),e._v(" "),v("p",[e._v("# iptables -A INPUT -s 172.28.230.12 -j ACCEPT")]),e._v(" "),v("p",[e._v("# iptables -A INPUT -s 172.28.230.13 -j ACCEPT")]),e._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[e._v("Allocate an IP address from the existing HAproxy network for the floating IP address of the load balancers.")]),e._v(" "),v("li",[e._v("Update the existing cluster DNS name to the newly assigned IP address.")]),e._v(" "),v("li",[e._v("Generate a random external password for Keepalived AUTH_PASS.")])]),e._v(" "),v("p",[e._v("# uuidgen")]),e._v(" "),v("p",[e._v("f30fedc5-2b19-414f-b67e-f05742a82e78")]),e._v(" "),v("p",[e._v("Configuring Keepalived service for each node")]),e._v(" "),v("p",[e._v("To configure Keepalived service for each node:")]),e._v(" "),v("ol",[v("li",[e._v("Edit /etc/keepalived/keepalived.conf configuration file on all three nodes for active/active VIP.")])]),e._v(" "),v("p",[e._v("[root@kvm3 slaves]# vi /etc/keepalived/keepalived.conf")]),e._v(" "),v("p",[e._v("router_id ovp_vrrp")]),e._v(" "),v("p",[e._v("}")]),e._v(" "),v("p",[e._v("vrrp_script haproxy_check {")]),e._v(" "),v("p",[v("code"),e._v('script "killall -0 haproxy"')]),e._v(" "),v("p",[v("code"),e._v("interval 2")]),e._v(" "),v("p",[v("code"),e._v("weight 2")]),e._v(" "),v("p",[v("code"),e._v("}")]),e._v(" "),v("p",[e._v("vrrp_instance OCP_EXT {")]),e._v(" "),v("p",[v("code"),e._v("interface bridge0.230")]),e._v(" "),v("p",[e._v("virtual_router_id 51")]),e._v(" "),v("p",[e._v("priority 100")]),e._v(" "),v("p",[v("code"),e._v("state MASTER")]),e._v(" "),v("p",[v("code"),e._v("virtual_ipaddress {")]),e._v(" "),v("p",[v("code"),e._v("172.28.230.25 dev bridge0.230}")]),e._v(" "),v("p",[v("code"),e._v("track_script {")]),e._v(" "),v("p",[v("code"),e._v("haproxy_check")]),e._v(" "),v("p",[e._v("}")]),e._v(" "),v("p",[v("code"),e._v("authentication {")]),e._v(" "),v("p",[v("code"),e._v("auth_type PASS")]),e._v(" "),v("p",[v("code"),e._v("auth_pass 1cee4b6e-2cdc-48bf-83b2-01a96d1593e4")]),e._v(" "),v("p",[v("code"),e._v("}")]),e._v(" "),v("p",[v("code"),e._v("}")]),e._v(" "),v("p",[e._v("The keepalived configuration file consists of the following parts:")]),e._v(" "),v("ul",[v("li",[v("strong",[e._v("state MASTER:")]),e._v(" It is the primary HAproxy server.")]),e._v(" "),v("li",[v("strong",[e._v("priority line:")]),e._v(" It determines the priority of the server configuration. If a master server must be elected, the server with the highest priority is selected.")]),e._v(" "),v("li",[v("strong",[e._v("virtual_ipaddress:")]),e._v(" It denotes the IP address to be used for floating VIP and the local device to bind to 10.0.15.30 and enp1s0 interface.")])]),e._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[e._v("Start and enable the services on all head nodes.")])]),e._v(" "),v("p",[e._v("# systemctl enable keepalived; systemctl start keepalived")]),e._v(" "),v("p",[e._v("Testing HAProxy with Keepalived service")]),e._v(" "),v("p",[e._v("After successful deployment of Keepalived service on the head nodes, the HAProxy nodes route traffic via HAProxy when the VRRP VIP is available.")]),e._v(" "),v("p",[e._v("[root@kvm3 slaves]# ip a")]),e._v(" "),v("p",[e._v("1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000")]),e._v(" "),v("p",[v("code"),e._v("link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00")]),e._v(" "),v("p",[v("code"),e._v("inet 127.0.0.1/8 scope host lo")]),e._v(" "),v("p",[v("code"),e._v("valid_lft forever preferred_lft forever")]),e._v(" "),v("p",[v("code"),e._v("inet6 ::1/128 scope host")]),e._v(" "),v("p",[v("code"),e._v("valid_lft forever preferred_lft forever")]),e._v(" "),v("p",[e._v("2: ens2: <BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP> mtu 1500 qdisc mq master bond0 state UP group default qlen 1000")]),e._v(" "),v("p",[v("code"),e._v("link/ether 88:e9:a4:41:55:b8 brd ff:ff:ff:ff:ff:ff")]),e._v(" "),v("p",[e._v("3: ens3: <BROADCAST,MULTICAST,SLAVE,UP,LOWER_UP> mtu 1500 qdisc mq master bond0 state UP group default qlen 1000")]),e._v(" "),v("p",[v("code"),e._v("link/ether 88:e9:a4:41:55:b8 brd ff:ff:ff:ff:ff:ff permaddr 88:e9:a4:40:f6:d8")]),e._v(" "),v("p",[e._v("4: bridge0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000")]),e._v(" "),v("p",[v("code"),e._v("link/ether 88:e9:a4:41:55:b8 brd ff:ff:ff:ff:ff:ff")]),e._v(" "),v("p",[v("code"),e._v("inet6 fe80::8034:bdc:f7d0:b444/64 scope link noprefixroute")]),e._v(" "),v("p",[v("code"),e._v("valid_lft forever preferred_lft forever")]),e._v(" "),v("p",[e._v("5: bond0: <BROADCAST,MULTICAST,MASTER,UP,LOWER_UP> mtu 1500 qdisc noqueue master bridge0 state UP group default qlen 1000")]),e._v(" "),v("p",[v("code"),e._v("link/ether 88:e9:a4:41:55:b8 brd ff:ff:ff:ff:ff:ff")]),e._v(" "),v("p",[e._v("6: bridge0.230: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000")]),e._v(" "),v("p",[v("code"),e._v("link/ether 88:e9:a4:41:55:b8 brd ff:ff:ff:ff:ff:ff")]),e._v(" "),v("p",[v("code"),e._v("inet 172.28.230.13/24 brd 172.28.230.255 scope global noprefixroute bridge0.230")]),e._v(" "),v("p",[v("code"),e._v("valid_lft forever preferred_lft forever")]),e._v(" "),v("p",[v("code"),e._v("inet 172.28.230.25/32 scope global bridge0.230")]),e._v(" "),v("p",[v("code"),e._v("valid_lft forever preferred_lft forever")]),e._v(" "),v("p",[v("code"),e._v("inet6 fe80::c48b:8f0f:9902:b9a1/64 scope link noprefixroute")]),e._v(" "),v("p",[v("code"),e._v("valid_lft forever preferred_lft forever")])])}),[],!1,null,null,null);v.default=r.exports}}]);