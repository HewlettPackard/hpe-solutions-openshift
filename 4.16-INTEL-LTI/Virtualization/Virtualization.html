<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.18" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>OpenShift Virtualization | OpenShift Container Platform 4.16 on HPE ProLiant Intel Gen11 Servers</title><meta name="description" content="Hewlett Packard Enterprise">
    <link rel="preload" href="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/style-PoWje89h.css" as="style"><link rel="stylesheet" href="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/style-PoWje89h.css">
    <link rel="modulepreload" href="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/app-Do4L8dKy.js"><link rel="modulepreload" href="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/Virtualization.html-CPcgEJDt.js">
    <link rel="prefetch" href="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/index.html-DovuHnyw.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/OADP-AirGap-ACM.html-D6EN0lG5.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/Introduction.html-CjHfsJBH.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/Solution-deployment-flow.html-hI-Emv4v.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/Resources.html-CbjPhZn_.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/Solution-Overview.html-CQqKT67W.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/Solution-Physical-components.html-DqsQIMtv.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/Storage.html-D9e23RQO.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/404.html-C-04X2cs.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/setupDevtools-7MC2TMWH-D6lIonQ2.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/hpe-solutions-openshift/4.16-INTEL-LTI/"><!----><span class="vp-site-name" aria-hidden="true">OpenShift Container Platform 4.16 on HPE ProLiant Intel Gen11 Servers</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/hpe-solutions-openshift/4.16-INTEL-LTI/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="http://www.hpe.com/info/ra" aria-label="RA Library" rel="noopener noreferrer" target="_blank"><!---->RA Library<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/hpe-solutions-openshift/4.16-INTEL-LTI/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="http://www.hpe.com/info/ra" aria-label="RA Library" rel="noopener noreferrer" target="_blank"><!---->RA Library<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading"> <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/hpe-solutions-openshift/4.16-INTEL-LTI/RED-HAT-OpenShift-Container-Platform-4-on-HPE-DL-Servers/Introduction.html" aria-label="Introduction"><!---->Introduction<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading"> <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/hpe-solutions-openshift/4.16-INTEL-LTI/Solution-Overview/Solution-Overview.html" aria-label="Solution Overview"><!---->Solution Overview<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading"> <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/hpe-solutions-openshift/4.16-INTEL-LTI/Solution-Components/Solution-Physical-components.html" aria-label="Solution Components"><!---->Solution Components<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading"> <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/hpe-solutions-openshift/4.16-INTEL-LTI/Solution-Deployment/Solution-deployment-flow.html" aria-label="Solution Deployment Workflow"><!---->Solution Deployment Workflow<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading"> <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/hpe-solutions-openshift/4.16-INTEL-LTI/Storage/Storage.html" aria-label="Storage Options"><!---->Storage Options<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active"> <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/hpe-solutions-openshift/4.16-INTEL-LTI/Virtualization/Virtualization.html" aria-label="OpenShift Virtualization"><!---->OpenShift Virtualization<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading"> <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/hpe-solutions-openshift/4.16-INTEL-LTI/Additional-Features-and-Functionality/OADP-AirGap-ACM.html" aria-label="Additional Features and Functionality"><!---->Additional Features and Functionality<!----></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading"> <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/hpe-solutions-openshift/4.16-INTEL-LTI/Resources-and-additional-links/Resources.html" aria-label="Resources and Additional Links"><!---->Resources and Additional Links<!----></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="openshift-virtualization" tabindex="-1"><a class="header-anchor" href="#openshift-virtualization"><span><strong>OpenShift Virtualization</strong></span></a></h1><h2 id="install-and-configure-openshift-virtulization" tabindex="-1"><a class="header-anchor" href="#install-and-configure-openshift-virtulization"><span><strong>Install and Configure Openshift Virtulization</strong></span></a></h2><h4 id="introduction" tabindex="-1"><a class="header-anchor" href="#introduction"><span>Introduction</span></a></h4><p>RedHat OpenShift Virtualization stands as a cornerstone of Red Hat&#39;s OpenShift Container Platform, seamlessly blending virtual machines and containers to offer a unified management interface. This integration empowers organizations to efficiently deploy both modern and traditional applications, encompassing virtual machines, containers, and serverless functions within a single platform. Built upon the &quot;container-native virtualization&quot; concept, driven by the KubeVirt project, it harnesses the RHEL KVM hypervisor to seamlessly merge virtual machines with Kubernetes and KubeVirt for streamlined management and orchestration. Through this infrastructure, OpenShift Virtualization enables the coexistence of virtual machines and containers within a Kubernetes environment, providing a cohesive solution for workload management.</p><p>OpenShift Virtualization adds new objects into your OpenShift Container Platform cluster via Kubernetes custom resources to enable virtualization tasks. These tasks include:</p><ul><li><p>Creating and managing Linux and Windows virtual machines</p></li><li><p>Connecting to virtual machines through a variety of consoles and CLI tools</p></li><li><p>Importing and cloning existing virtual machines</p></li><li><p>Managing network interface controllers and storage disks attached to virtual machines</p></li><li><p>Live migrating virtual machines between nodes</p></li><li><p>An enhanced web console provides a graphical portal to manage these virtualized resources alongside the OpenShift Container Platform cluster containers and infrastructure.</p></li><li><p>OpenShift Virtualization is tested with OpenShift Data Foundation (ODF) and Alletra MP Storage.</p></li><li><p>OpenShift Virtualization allows the usage with either the [OVN-Kubernetes] (opens new window)or the [OpenShiftSDN] (opens new window)default Container Network Interface (CNI) network provider</p></li></ul><h4 id="enabling-openshift-virtualization" tabindex="-1"><a class="header-anchor" href="#enabling-openshift-virtualization"><span>Enabling OpenShift Virtualization</span></a></h4><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-1-BM7iYMkm.png" alt=""></p><p><strong>FIGURE 33</strong> Red Hat OpenShift Virtualization deployment flow</p><h4 id="installing-openshift-virtualization-operator-from-operatorhub" tabindex="-1"><a class="header-anchor" href="#installing-openshift-virtualization-operator-from-operatorhub"><span>Installing OpenShift Virtualization Operator from OperatorHub</span></a></h4><ol><li><p>Log into the OpenShift Container Platform web console and navigate to Operators → OperatorHub</p></li><li><p>Type OpenShift Virtualization and Select OpenShift Virtualization tile</p></li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-2-C3oCv5Fu.png" alt=""></p><p><strong>FIGURE 34</strong> OpenShift Virtualization in OperatorHub</p><ol start="3"><li>Click and Install the Operator to the &quot;openshift-cnv&quot; namespace</li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-3-CpPtHoTq.png" alt=""></p><p><strong>FIGURE 35</strong> Inputs for the OpenShift Virtualization operator</p><ol start="4"><li>Once OpenShift Virtualization is successfully installed , Create HyperConverged Custom resource</li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-4-BZ8ed62V.png" alt=""></p><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-5-4HA_qxO0.png" alt=""></p><p><strong>FIGURE 36</strong> Creation of HyperConverged in OpenShift Virtualization operator</p><p>After successful deployment of operator and creation of HyderConverged. Virtualization will be enabled in webconsole.</p><h4 id="network-configuration" tabindex="-1"><a class="header-anchor" href="#network-configuration"><span>Network configuration</span></a></h4><p>You would have internal pod network as default network after successful deployment of OpenShift Virtualization. For additional network, we would deploy the network operator &quot;NMState Operator&quot; and configure Linux bridge network for external VM access and live migration.</p><p>Administrators can also install SR-IOV Operator to manage SR-IOV network devices and MetalLB Operator for lifecycle management.</p><h4 id="configuring-a-linux-bridge-network" tabindex="-1"><a class="header-anchor" href="#configuring-a-linux-bridge-network"><span>Configuring a Linux bridge Network</span></a></h4><ol><li><p>To install NMState Operator, navigate to Operators → OperatorHub in webconsole</p></li><li><p>Type NMState, Select Kubernetes NMState Operator tile and Install the Operator</p></li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-6-BRegZRwa.png" alt=""></p><p><strong>FIGURE 37</strong> Installation of NMState in OperatorHub</p><ol start="3"><li>Once the NMState operator is installed, Create a instance for &quot;nmstate&quot;</li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-7-ykyQqYfj.png" alt=""></p><p><strong>FIGURE 38</strong> Inputs for NMState in operator</p><h4 id="creating-a-linux-bridge-nncp" tabindex="-1"><a class="header-anchor" href="#creating-a-linux-bridge-nncp"><span>Creating a Linux bridge NNCP</span></a></h4><p>Create a NodeNetworkConfigurationPolicy (NNCP) manifest for a Linux bridge network for network interface card(enp1s0) and apply the created NNCP manifest</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">apiVersion: nmstate.io/v1</span>
<span class="line">kind: NodeNetworkConfigurationPolicy</span>
<span class="line">metadata:</span>
<span class="line">  name: br1-policy</span>
<span class="line">spec:</span>
<span class="line">  desiredState:</span>
<span class="line">    interfaces:</span>
<span class="line">      - name: bridge1</span>
<span class="line">        type: linux-bridge</span>
<span class="line">        state: up</span>
<span class="line">        ipv4:</span>
<span class="line">          dhcp: <span class="token boolean">true</span></span>
<span class="line">          enabled: <span class="token boolean">true</span></span>
<span class="line">        bridge:</span>
<span class="line">          options:</span>
<span class="line">            stp:</span>
<span class="line">              enabled: <span class="token boolean">false</span></span>
<span class="line">          port:</span>
<span class="line">             - name: enp1s0           <span class="token comment">#NIC/Bond</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="creating-a-linux-bridge-nad" tabindex="-1"><a class="header-anchor" href="#creating-a-linux-bridge-nad"><span>Creating a Linux bridge NAD</span></a></h4><ol><li><p>Log in to the OpenShift Container Platform web console and click Networking → NetworkAttachmentDefinitions</p></li><li><p>Click Create Network Attachment Definition (NAD). And provide the required details</p></li><li><p>Click the Network Type list and select CNV Linux bridge</p></li><li><p>Enter the name of the bridge (Previously created NodeNetworkConfigurationPolicy object as interfaces name ex: bridge1) in the Bridge Name field</p></li><li><p>Click Create</p></li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-8-LQxWsJEh.png" alt=""></p><p><strong>FIGURE 39</strong> Creation of NAD</p><h4 id="creating-a-dedicated-network-for-live-migration" tabindex="-1"><a class="header-anchor" href="#creating-a-dedicated-network-for-live-migration"><span>Creating a dedicated network for live migration</span></a></h4><ol><li>Administrators have to create additional NAD for creating a dedicated live migration network. Create a NAD manifest as below</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">apiVersion: <span class="token string">&quot;k8s.cni.cncf.io/v1&quot;</span></span>
<span class="line">kind: NetworkAttachmentDefinition</span>
<span class="line">metadata:</span>
<span class="line">  name: migration-network </span>
<span class="line">  namespace: openshift-cnv </span>
<span class="line">spec:</span>
<span class="line">  config: <span class="token string">&#39;{</span>
<span class="line">    &quot;cniVersion&quot;: &quot;0.3.1&quot;,</span>
<span class="line">    &quot;name&quot;: &quot;migration-bridge&quot;,</span>
<span class="line">    &quot;type&quot;: &quot;macvlan&quot;,</span>
<span class="line">    &quot;master&quot;: &quot;enp1s1&quot;, </span>
<span class="line">    &quot;mode&quot;: &quot;bridge&quot;,</span>
<span class="line">    &quot;ipam&quot;: {</span>
<span class="line">      &quot;type&quot;: &quot;whereabouts&quot;, </span>
<span class="line">      &quot;range&quot;: &quot;20.0.0.0/24&quot; </span>
<span class="line">    }</span>
<span class="line">  }&#39;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>Goto the custom resource of Hydercoverged that was created during &quot;OpenShift Virtualization&quot; operator deployment and Specify the created network name for &quot;spec.liveMigrationConfig&quot;</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">apiVersion: hco.kubevirt.io/v1beta1</span>
<span class="line">kind: HyperConverged</span>
<span class="line">metadata:</span>
<span class="line">  name: kubevirt-hyperconverged</span>
<span class="line">spec:</span>
<span class="line">  liveMigrationConfig:</span>
<span class="line">    completionTimeoutPerGiB: <span class="token number">800</span></span>
<span class="line">    network: migration-network  <span class="token comment">#specify migration network name</span></span>
<span class="line">    parallelMigrationsPerCluster: <span class="token number">5</span></span>
<span class="line">    parallelOutboundMigrationsPerNode: <span class="token number">2</span></span>
<span class="line">    progressTimeout: <span class="token number">150</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="create-a-virtual-machine" tabindex="-1"><a class="header-anchor" href="#create-a-virtual-machine"><span>Create a virtual machine</span></a></h4><p>The web console features an interactive wizard that guides you through General, Networking, Storage, Advanced, and Review steps to simplify the process of creating virtual machines. All required fields are marked by a *. When the required fields are completed, you can review and create your virtual machine.</p><p>Network Interface Cards (NICs) and storage disks can be created and attached to virtual machines after they have been created.</p><p>Use one of these procedures to create a virtual machine:</p><ul><li><p>Creating virtual machines from templates</p></li><li><p>Creating virtual machines from instance types</p></li><li><p>Creating virtual machines from CLI</p></li></ul><h4 id="creating-virtual-machines-from-templates" tabindex="-1"><a class="header-anchor" href="#creating-virtual-machines-from-templates"><span>Creating virtual machines from templates</span></a></h4><p>You can create virtual machines from templates provided by Red Hat using web console. You can also create customized templates as per requirements.</p><ol><li>Log into the OpenShift Container Platform web console and navigate to Virtualization → Catalog → Template Catalog</li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-9-CVQgMWDn.png" alt=""></p><p><strong>FIGURE 40</strong> Templates available by default in Virtualization</p><ol start="2"><li><p>Apply the filter &quot;Boot source available&quot;.</p></li><li><p>Click the required template to view the details (for example: fedora)</p></li><li><p>Click &quot;Quick create VirtualMachine&quot; to create a VM from the template. You can customize the CPU/Memory/Storage as required.</p></li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-10-DzWqRIlZ.png" alt=""></p><p><strong>FIGURE 41</strong> Sample deployment of fedora VM using templates</p><h4 id="creating-virtual-machines-from-instance-types" tabindex="-1"><a class="header-anchor" href="#creating-virtual-machines-from-instance-types"><span>Creating virtual machines from instance types</span></a></h4><ol><li>Log into the OpenShift Container Platform web console and navigate to Virtualization → Catalog → Instance Types</li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-11-BJlGf62l.png" alt=""></p><p><strong>FIGURE 42</strong> Virtual Machine creation from Catalog</p><ol start="2"><li><p>Select the bootable volumes</p><ul><li>Images provided by RedHat, these images are available in &quot;openshift-virtualization-os-images&quot; namespace.</li><li>Click Add Volume. You can either use any of the existing volume where you have the boot images or you can upload images and create a new volume(PVC) and provide the required parameter.</li></ul><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-12-BD5EaoZ9.png" alt=""></p><p><strong>FIGURE 43</strong> Add volumes to import OS images</p></li><li><p>Click the required boot volume.</p></li><li><p>Select the required Instance type</p></li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-13-L8F32yMY.png" alt=""></p><p><strong>FIGURE 44</strong> Selection of Instance type and boot image</p><ol start="5"><li>Click &quot;Create VirtualMachine&quot; to create a VM from the instance types.</li></ol><p>You can Customize and create user Instance type as required by navigating to Virtualization → Instance Types → Create.</p><h4 id="creating-virtual-machines-from-cli" tabindex="-1"><a class="header-anchor" href="#creating-virtual-machines-from-cli"><span>Creating virtual machines from CLI</span></a></h4><ol><li>Create a VirtualMachine manifest required for creating a VM</li></ol><p>Below is an example manifest for creating fedora VM</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">apiVersion: kubevirt.io/v1</span>
<span class="line">kind: VirtualMachine</span>
<span class="line">metadata:</span>
<span class="line">  name: my-vm</span>
<span class="line">spec:</span>
<span class="line">  running: <span class="token boolean">false</span></span>
<span class="line">  template:</span>
<span class="line">    metadata:</span>
<span class="line">      labels:</span>
<span class="line">        kubevirt.io/domain: my-vm</span>
<span class="line">    spec:</span>
<span class="line">      domain:</span>
<span class="line">        devices:</span>
<span class="line">          disks:</span>
<span class="line">          - disk:</span>
<span class="line">              bus: virtio</span>
<span class="line">            name: containerdisk</span>
<span class="line">          - disk:</span>
<span class="line">              bus: virtio</span>
<span class="line">            name: cloudinitdisk</span>
<span class="line">        resources:</span>
<span class="line">          requests:</span>
<span class="line">            memory: 8Gi</span>
<span class="line">      volumes:</span>
<span class="line">      - name: containerdisk</span>
<span class="line">        containerDisk:</span>
<span class="line">          image: kubevirt/fedora-cloud-registry-disk-demo</span>
<span class="line">      - name: cloudinitdisk</span>
<span class="line">        cloudInitNoCloud:</span>
<span class="line">          userData: <span class="token operator">|</span></span>
<span class="line">            <span class="token comment">#cloud-config</span></span>
<span class="line">            password: fedora</span>
<span class="line">            chpasswd: <span class="token punctuation">{</span> expire: False <span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>Apply the created manifest file for virtual machine creation.</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">oc apply <span class="token parameter variable">-f</span> <span class="token operator">&lt;</span> file-name <span class="token operator">&gt;</span>.yaml</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="reading-viewing-virtual-machine" tabindex="-1"><a class="header-anchor" href="#reading-viewing-virtual-machine"><span>Reading/Viewing virtual machine</span></a></h4><p>You can check the virtual machine status, Metrics , resources utilization (CPU, memory, storage) for overall cluster by navigate to Virtualization → Overview.</p><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-16-CIHrmnav.png" alt=""></p><p><strong>FIGURE 45</strong> Overview Virtual machines in the Cluster</p><p>and access configuration details of VM&#39;s, networks and storage volumes.</p><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-17-C51kizt4.png" alt=""></p><p><strong>FIGURE 46</strong> Overview of Sample Virtual machines deployed in the RHOCP platform</p><h4 id="updating-a-virtual-machine" tabindex="-1"><a class="header-anchor" href="#updating-a-virtual-machine"><span>Updating a virtual machine</span></a></h4><p>You can update virtual machine configuration using CLI or from the web console.</p><h4 id="virtual-machine-configuration-using-cli" tabindex="-1"><a class="header-anchor" href="#virtual-machine-configuration-using-cli"><span>virtual machine configuration using CLI</span></a></h4><ol><li>Virtual machine configuration can be edit/updated</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">oc edit vm <span class="token operator">&lt;</span> vm-name <span class="token operator">&gt;</span> <span class="token parameter variable">-n</span> <span class="token operator">&lt;</span> namespace <span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol start="2"><li>Apply the updated configuration</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">oc apply vm <span class="token operator">&lt;</span> vm_name <span class="token operator">&gt;</span> <span class="token parameter variable">-n</span> <span class="token operator">&lt;</span> namespace <span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="virtual-machine-configuration-using-web-console" tabindex="-1"><a class="header-anchor" href="#virtual-machine-configuration-using-web-console"><span>virtual machine configuration using web console</span></a></h4><ol><li><p>Log into the OpenShift Container Platform web console and navigate to Virtualization → VirtualMachines</p></li><li><p>Select the virtual machine For example: addition of the disk navigate to Configuration → Storage → Add disk <img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-14-FjJS-r7d.png" alt=""></p><p><strong>FIGURE 47</strong> Storage disk addition</p><p>Specify the fields like Source, Size, Storage class as required</p><p>Click Add we can add additional networks, secrets, config map to virtual machines.</p></li></ol><p>Some of the changes are applied once the virtual machine are restarted only. For restarting of any virtual machines navigate to Virtualization → VirtualMachines Click the Options menu <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAATCAYAAACp65zuAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAE2SURBVDhPY/wPBAxEACYoTRCgmPj02XOG3Xv2M/Dy8TB4ubsycHJyQmWQFL55+5ahpb2b4ffvP2AJGWkphsqyIjAbBOBWv3jxCq4IBJ48fcbw798/KA9JoZKiAgMHBweUx8Cgqa7GwMSE8AKKG1+8fMmwfeceBn5+PrAbkTViBM/r128YuLi5GLi5uKAiEABXCHLPoiUrGE6fPQe2Mjw0iMHGygKsCATgjrh56zZYEQiANK1as54B2TK4Qi40q1hZWbErlJeTZbCGWgWyOjI8GLev8QEUhceOn2TYsn0nAx8vL0NURCiDnKwMVAbJ6oePHjMsXbGa4ePHTwyPnzxlmDxtJlQGAuAKv337BmVBwLdv3xn+/P0L5SEpBEWhsJAQlMfAYGpsxMDCzAzlkeAZhP/xAgYGABivf09+EIdPAAAAAElFTkSuQmCC" alt=""> beside a virtual machine name and select Restart or select the virtual machine → Actions → Restart</p><h4 id="deleting-a-virtual-machine" tabindex="-1"><a class="header-anchor" href="#deleting-a-virtual-machine"><span>Deleting a virtual machine</span></a></h4><p>You can delete a virtual machine by using CLI or from the web console.</p><h4 id="delete-a-virtual-machine-using-cli" tabindex="-1"><a class="header-anchor" href="#delete-a-virtual-machine-using-cli"><span>Delete a virtual machine using CLI</span></a></h4><ol><li>Delete the virtual machine by executing the below command:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">oc delete vm <span class="token operator">&lt;</span> vm_name <span class="token operator">&gt;</span> <span class="token parameter variable">-n</span> <span class="token operator">&lt;</span> namespace <span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="delete-a-virtual-machine-using-web-console" tabindex="-1"><a class="header-anchor" href="#delete-a-virtual-machine-using-web-console"><span>Delete a virtual machine using web console</span></a></h4><ol><li><p>Log into the OpenShift Container Platform web console and navigate to Virtualization → VirtualMachines</p></li><li><p>Click the Options menu <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAATCAYAAACp65zuAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAE2SURBVDhPY/wPBAxEACYoTRCgmPj02XOG3Xv2M/Dy8TB4ubsycHJyQmWQFL55+5ahpb2b4ffvP2AJGWkphsqyIjAbBOBWv3jxCq4IBJ48fcbw798/KA9JoZKiAgMHBweUx8Cgqa7GwMSE8AKKG1+8fMmwfeceBn5+PrAbkTViBM/r128YuLi5GLi5uKAiEABXCHLPoiUrGE6fPQe2Mjw0iMHGygKsCATgjrh56zZYEQiANK1as54B2TK4Qi40q1hZWbErlJeTZbCGWgWyOjI8GLev8QEUhceOn2TYsn0nAx8vL0NURCiDnKwMVAbJ6oePHjMsXbGa4ePHTwyPnzxlmDxtJlQGAuAKv337BmVBwLdv3xn+/P0L5SEpBEWhsJAQlMfAYGpsxMDCzAzlkeAZhP/xAgYGABivf09+EIdPAAAAAElFTkSuQmCC" alt=""> beside a virtual machine name and select Delete or Select the virtual machine → Actions → Delete</p></li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-26-Dz6spvHW.png" alt=""></p><p><strong>FIGURE 48.</strong> Deleting a Virtual Machine</p><h2 id="hotplugging" tabindex="-1"><a class="header-anchor" href="#hotplugging"><span>HotPlugging</span></a></h2><h4 id="hot-plugging-vcpus" tabindex="-1"><a class="header-anchor" href="#hot-plugging-vcpus"><span>Hot Plugging vCPUs</span></a></h4><p>Hot plugging means enabling or disabling devices while a virtual machine is running.</p><p>Prerequisites:</p><p>Required minimum 2 worker nodes in cluster</p><p>Steps:</p><ol><li><p>In the Virtualization tab, Navigate to VirtualMachine.</p></li><li><p>Select a running virtual machine that required changes</p></li><li><p>Navigate to Configuration tab and Click Details.</p></li><li><p>Edit the CPU | Memory details</p></li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt27-CaUBDVbM.png" alt=""></p><p><strong>FIGURE 49.</strong> Paramter for hot plugging vCPU- 1</p><ol start="5"><li>Change the value of Virtual Sockets as required.</li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt28-DeefmyWS.png" alt=""></p><p><strong>FIGURE 50.</strong> Paramter for hot plugging vCPU- 2</p><ol start="6"><li>Click Save.</li></ol><p>Note: Hot Plugging of CPU and Memory is not possible when Virtual machines are created from the Instance type.</p><h4 id="hot-plugging-memory" tabindex="-1"><a class="header-anchor" href="#hot-plugging-memory"><span>Hot Plugging Memory</span></a></h4><p>You can hot plug virtual memory. Each time memory is hot plugged, it appears as a new memory device in the VM Devices tab in the details view of the virtual machine, up to a maximum of 16 available slots. When the virtual machine is restarted, these devices are cleared from the VM Devices tab without reducing the virtual machine’s memory, allowing you to hot plug more memory devices.</p><p>Prerequisites:</p><p>Required minimum 2 worker nodes in cluster</p><p>Steps:</p><ol><li><p>In the Virtualization tab, Navigate to VirtualMachine.</p></li><li><p>Select a running virtual machine that required changes</p></li><li><p>Navigate to Configuration tab and Click Details.</p></li><li><p>Edit the CPU | Memory details</p></li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt29-CZbvLljm.png" alt=""></p><p><strong>FIGURE 51.</strong> Paramter for hot plugging Memory</p><ol start="5"><li><p>Change the value of Virtual Sockets as required.</p></li><li><p>Click Save.</p></li></ol><p>Note: Hot Plugging of CPU and Memory is not possible when Virtual machines are created from the Instance type.</p><h4 id="hot-plugging-vm-disks" tabindex="-1"><a class="header-anchor" href="#hot-plugging-vm-disks"><span>Hot-plugging VM disks</span></a></h4><p>You can add or remove virtual disks without stopping your virtual machine (VM) or virtual machine instance (VMI). Only data volumes and persistent volume claims (PVCs) can be hot plugged and hot-unplugged. You cannot hot plug or hot-unplug container disks.</p><p>Prerequisites</p><p>You must have a data volume or persistent volume claim (PVC) available for hot plugging.</p><p>Steps:</p><ol><li><p>In the Virtualization tab, Navigate to VirtualMachines</p></li><li><p>Select a running virtual machine that required changes</p></li><li><p>On the VirtualMachine details page, click Configuration Storage</p></li><li><p>Add a hot plugged disk:</p></li></ol><p>i. Click Add disk.</p><p>ii. In the Add disk (hot plugged) window, select the disk from the Source list and click Save.</p><p>Note: Each VM must have Virtio-scsi Controller so that Hot Plug disk can use SCSI bus.</p><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt30-BgL0vJY0.png" alt=""></p><p><strong>FIGURE 52.</strong> Paramter for hot plugging VM disks</p><h4 id="hot-plugging-network-interface" tabindex="-1"><a class="header-anchor" href="#hot-plugging-network-interface"><span>Hot-plugging Network Interface</span></a></h4><p>You can add or remove network interfaces without stopping your virtual machine (VM). OpenShift Virtualization supports hot plugging for interfaces that use the VirtIO device driver.</p><p>Prerequisites</p><p>• A network attachment definition is configured in the same namespace as your VM.</p><p>• Required minimum 2 nodes in cluster</p><p>Steps:</p><ol><li><p>In the Virtualization tab, Navigate to VirtualMachines</p></li><li><p>Select a running virtual machine that required changes</p></li><li><p>On the VirtualMachine details page, click Configuration Network Add network interface</p></li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt31-CImxxFkC.png" alt=""></p><p><strong>FIGURE 53.</strong> Paramter for hot plugging Network Interface</p><ol start="4"><li><p>Add the respective Pod Networking (NAD) that needs to be added to network interface</p></li><li><p>Click Save the network setting.</p></li><li><p>Navigate to Actions  Click Migrate</p></li></ol><p>Once the VM is Successfully migrated to different node. The newly added network interface is available in the virtual machine.</p><h2 id="live-migration" tabindex="-1"><a class="header-anchor" href="#live-migration"><span>Live migration</span></a></h2><h4 id="introduction-1" tabindex="-1"><a class="header-anchor" href="#introduction-1"><span>Introduction</span></a></h4><p>Live migration is the process of moving a running virtual machine (VM) to another node in the cluster without interrupting the virtual workload. By default, live migration traffic is encrypted using Transport Layer Security (TLS).</p><p>An enhanced web console provides a graphical portal to manage these virtualized resources alongside the OpenShift Container Platform cluster containers and infrastructure.</p><h4 id="requirements-of-live-migration" tabindex="-1"><a class="header-anchor" href="#requirements-of-live-migration"><span>Requirements of Live migration</span></a></h4><ul><li><p>A dedicated Multus network for live migration is highly recommended.</p></li><li><p>Persistent Volume Claim (Storage) must have ReadWriteMany (RWX) access mode.</p></li><li><p>All CPU in cluster which hosts Virtual machines must support the host model.</p></li></ul><h4 id="configuring-live-migration" tabindex="-1"><a class="header-anchor" href="#configuring-live-migration"><span>Configuring live migration</span></a></h4><p>You can configure the following live migration settings to ensure the migration process do not saturate the cluster.</p><ul><li><p>Limits and timeouts</p></li><li><p>Maximum number of migrations per node or cluster</p></li></ul><p>Edit the HyperConverged CR and add the necessary live migration parameters:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">oc edit hyperconverged kubevirt-hyperconverged <span class="token parameter variable">-n</span> openshift-cnv</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>sample configuration parameters</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">apiVersion: hco.kubevirt.io/v1beta1</span>
<span class="line">kind: HyperConverged</span>
<span class="line">metadata:</span>
<span class="line">  name: kubevirt-hyperconverged</span>
<span class="line">  namespace: openshift-cnv</span>
<span class="line">spec:</span>
<span class="line">  liveMigrationConfig:</span>
<span class="line">    bandwidthPerMigration: 64Mi </span>
<span class="line">    completionTimeoutPerGiB: <span class="token number">800</span> </span>
<span class="line">    parallelMigrationsPerCluster: <span class="token number">5</span> </span>
<span class="line">    parallelOutboundMigrationsPerNode: <span class="token number">2</span> </span>
<span class="line">    progressTimeout: <span class="token number">150</span> </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="initiating-live-migration" tabindex="-1"><a class="header-anchor" href="#initiating-live-migration"><span>Initiating Live Migration</span></a></h4><p>Live migration of virtual machines can be done using web console or CLI. prerequisites must be met for the live migration of any virtual machines.</p><h4 id="initiating-live-migration-using-web-console" tabindex="-1"><a class="header-anchor" href="#initiating-live-migration-using-web-console"><span>Initiating Live Migration using web console</span></a></h4><ol><li><p>Navigate to Virtualization → VirtualMachines in the web console.</p></li><li><p>Select Migrate from the Options menu <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAATCAYAAACp65zuAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAAFiUAABYlAUlSJPAAAAE2SURBVDhPY/wPBAxEACYoTRCgmPj02XOG3Xv2M/Dy8TB4ubsycHJyQmWQFL55+5ahpb2b4ffvP2AJGWkphsqyIjAbBOBWv3jxCq4IBJ48fcbw798/KA9JoZKiAgMHBweUx8Cgqa7GwMSE8AKKG1+8fMmwfeceBn5+PrAbkTViBM/r128YuLi5GLi5uKAiEABXCHLPoiUrGE6fPQe2Mjw0iMHGygKsCATgjrh56zZYEQiANK1as54B2TK4Qi40q1hZWbErlJeTZbCGWgWyOjI8GLev8QEUhceOn2TYsn0nAx8vL0NURCiDnKwMVAbJ6oePHjMsXbGa4ePHTwyPnzxlmDxtJlQGAuAKv337BmVBwLdv3xn+/P0L5SEpBEWhsJAQlMfAYGpsxMDCzAzlkeAZhP/xAgYGABivf09+EIdPAAAAAElFTkSuQmCC" alt=""> beside a VM.</p></li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-18-Bb90rMOO.png" alt=""></p><p><strong>FIGURE 54.</strong> Live Migration between nodes</p><ol start="3"><li>Click Migrate.</li></ol><h4 id="initiating-live-migration-using-cli" tabindex="-1"><a class="header-anchor" href="#initiating-live-migration-using-cli"><span>Initiating Live Migration using CLI</span></a></h4><ol><li>Create and apply the VirtualMachineInstanceMigration manifest for the VM</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">apiVersion: kubevirt.io/v1</span>
<span class="line">kind: VirtualMachineInstanceMigration</span>
<span class="line">metadata:</span>
<span class="line">  name: <span class="token operator">&lt;</span> migration_name <span class="token operator">&gt;</span></span>
<span class="line">spec:</span>
<span class="line">  vmiName: <span class="token operator">&lt;</span> vm_name <span class="token operator">&gt;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="migration-toolkit-for-virtualization" tabindex="-1"><a class="header-anchor" href="#migration-toolkit-for-virtualization"><span>Migration Toolkit for Virtualization</span></a></h2><h4 id="introduction-2" tabindex="-1"><a class="header-anchor" href="#introduction-2"><span>Introduction</span></a></h4><p>The Migration Toolkit for Virtualization (MTV) enables you to migrate virtual machines from VMware vSphere, Red Hat Virtualization, or OpenStack to OpenShift Virtualization running on Red Hat OpenShift Virtualization platform.</p><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-19-CceIDhRn.png" alt=""><strong>FIGURE 55.</strong> Migration Toolkit for Virtualization supported providers</p><p>MTV simplifies the migration process, allowing you to seamlessly move VM workloads to OpenShift Virtualization</p><p>MTV supports Cold migration which is the default migration type. The source virtual machines are shutdown while the data is copied. Cold migration from</p><ul><li><p>VMware vSphere</p></li><li><p>Red Hat Virtualization (RHV)</p></li><li><p>OpenStack</p></li><li><p>Remote OpenShift Virtualization clusters</p></li></ul><p>MTV supports warm migration from VMware vSphere and from RHV. In warm migration most of the data is copied during the pre-copy stage while the source virtual machines (VMs) are running. Then the VMs are shut down and the remaining data is copied during the cutover stage</p><h4 id="installing-mtv-operator" tabindex="-1"><a class="header-anchor" href="#installing-mtv-operator"><span>Installing MTV Operator</span></a></h4><p>You can install MTV operator using web console and CLI</p><h4 id="installing-mtv-operator-using-web-console" tabindex="-1"><a class="header-anchor" href="#installing-mtv-operator-using-web-console"><span>Installing MTV Operator using web console</span></a></h4><ol><li>In the web console, navigate to Operators → OperatorHub.</li><li>Use the Filter by keyword field to search for mtv-operator.</li><li>Click the Migration Toolkit for Virtualization Operator tile and then click Install.</li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-21-BHiDfQnI.png" alt=""><strong>FIGURE 56.</strong> Migration Toolkit Operator deployment</p><ol start="4"><li>After the Migration Toolkit for Virtualization Operator is installed successfully create ForkliftController Instance.</li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-22-D_sOpcXC.png" alt=""><strong>FIGURE 57.</strong> ForliftController Instance creation</p><h4 id="installing-mtv-operator-using-cli" tabindex="-1"><a class="header-anchor" href="#installing-mtv-operator-using-cli"><span>Installing MTV Operator using CLI</span></a></h4><ol><li>Create the openshift-mtv project:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">$ <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> oc apply <span class="token parameter variable">-f</span> -</span></span>
<span class="line">apiVersion: project.openshift.io/v1</span>
<span class="line">kind: Project</span>
<span class="line">metadata:</span>
<span class="line">  name: openshift-mtv</span>
<span class="line">EOF</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>Create an OperatorGroup CR called migration:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">$ <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> oc apply <span class="token parameter variable">-f</span> -</span></span>
<span class="line">apiVersion: operators.coreos.com/v1</span>
<span class="line">kind: OperatorGroup</span>
<span class="line">metadata:</span>
<span class="line">  name: migration</span>
<span class="line">  namespace: openshift-mtv</span>
<span class="line">spec:</span>
<span class="line">  targetNamespaces:</span>
<span class="line">    - openshift-mtv</span>
<span class="line">EOF</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>Create a Subscription CR for the Operator:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">$ <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> oc apply <span class="token parameter variable">-f</span> -</span></span>
<span class="line">apiVersion: operators.coreos.com/v1alpha1</span>
<span class="line">kind: Subscription</span>
<span class="line">metadata:</span>
<span class="line">  name: mtv-operator</span>
<span class="line">  namespace: openshift-mtv</span>
<span class="line">spec:</span>
<span class="line">  channel: release-v2.6</span>
<span class="line">  installPlanApproval: Automatic</span>
<span class="line">  name: mtv-operator</span>
<span class="line">  source: redhat-operators</span>
<span class="line">  sourceNamespace: openshift-marketplace</span>
<span class="line">  startingCSV: &quot;mtv-operator.v2.6.1&quot;</span>
<span class="line">EOF</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>Create a ForkliftController CR:</li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">$ <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">|</span> oc apply <span class="token parameter variable">-f</span> -</span></span>
<span class="line">apiVersion: forklift.konveyor.io/v1beta1</span>
<span class="line">kind: ForkliftController</span>
<span class="line">metadata:</span>
<span class="line">  name: forklift-controller</span>
<span class="line">  namespace: openshift-mtv</span>
<span class="line">spec:</span>
<span class="line">  olm_managed: true</span>
<span class="line">EOF</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="migration-of-virtual-machines" tabindex="-1"><a class="header-anchor" href="#migration-of-virtual-machines"><span>Migration of Virtual Machines</span></a></h4><p>You can migrate virtual machines to OpenShift Virtualization by using the MTV web console from following providers:</p><ul><li>VMware vSphere</li><li>Red Hat Virtualization</li><li>OpenStack</li><li>Open Virtual Appliances (OVAs) that were created by VMware vSphere</li><li>OpenShift Virtualization</li></ul><h4 id="adding-providers" tabindex="-1"><a class="header-anchor" href="#adding-providers"><span>Adding providers</span></a></h4><ol><li><p>In web console, navigate to Migration → Providers of Migration → Create Provider</p></li><li><p>Select the virtual machine provider (in this example we will go with VMWare)</p></li><li><p>Specify the required provider details</p></li></ol><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-23-BeSCjpmw.png" alt=""><strong>FIGURE 58.</strong> Additon of VMWare vSphere</p><p>Note: Provider the VDDK init image to accelerate migrations.</p><ol start="4"><li><p>Choose one of the following options for validating CA certificates</p><ul><li>Custom CA certificate</li><li>System CA certificate</li><li>Skip certificate validation</li></ul></li><li><p>Click Create Provider</p></li></ol><h4 id="selecting-a-migration-network-for-a-vmware-source-provider" tabindex="-1"><a class="header-anchor" href="#selecting-a-migration-network-for-a-vmware-source-provider"><span>Selecting a migration network for a VMware source provider</span></a></h4><ol><li><p>In the web console, navigate to Migration → Providers for virtualization.</p></li><li><p>Click the host in the Hosts column beside a provider to view a list of hosts.</p></li><li><p>Select one or more hosts and click Select migration network.</p></li><li><p>Specify the following fields:</p><ul><li>Network: Network name</li><li>ESXi host admin username: For example, root</li><li>ESXi host admin password: Password</li><li>Click Save.</li></ul></li><li><p>Verify that the status of each host is Ready.</p></li></ol><h4 id="migration-plan-creation" tabindex="-1"><a class="header-anchor" href="#migration-plan-creation"><span>Migration plan creation</span></a></h4><h4 id="creating-and-running-a-migration-plan-starting-on-providers-for-virtualization" tabindex="-1"><a class="header-anchor" href="#creating-and-running-a-migration-plan-starting-on-providers-for-virtualization"><span>Creating and running a migration plan starting on Providers for virtualization</span></a></h4><ol><li><p>In the web console, navigate to Migration → Providers for virtualization.</p></li><li><p>In the row of the appropriate source provider. And navigate to Virtual Machines tab.</p></li><li><p>Select the VMs you want to migrate and click Create migration plan.</p></li><li><p>Create migration plan displays the source provider&#39;s name and suggestions for a target provider and namespace, a network map, and a storage map.</p></li><li><p>Provide the required details to the editable fields.</p></li><li><p>Add mapping to edit a suggested network mapping or a storage mapping, or to add one or more additional mappings.</p></li></ol><p>Mapped storage and network mapping can be viewed in Migration → StorageMaps for virtualization / Migration → NetworkMaps for virtualization</p><ol start="7"><li>Create migration plan.</li></ol><p>You can create the migration plan for the Source provider as well.</p><h4 id="running-a-migration-plan" tabindex="-1"><a class="header-anchor" href="#running-a-migration-plan"><span>Running a migration plan</span></a></h4><ol><li><p>In the web console, navigate to Migration → Plans for virtualization.</p></li><li><p>You can see the list of migration plans created for source and target providers, the number of virtual machines (VMs) being migrated, the status, and the description of each plan.</p></li><li><p>Click Start beside a migration plan to start the migration.</p></li><li><p>Click Start in the confirmation window that opens.</p></li></ol><p>The Migration details by VM screen opens, displaying the migration&#39;s progress Warm migration only: The pre-copy stage starts. Click Cutover to complete the migration.</p><ol start="5"><li><p>Click a migration&#39;s Status to view the details of the migration.</p></li><li><p>The Migration details by VM screen opens, displaying the start and end times of the migration, the amount of data copied for each VM being migrated.</p></li></ol><h4 id="warm-migration" tabindex="-1"><a class="header-anchor" href="#warm-migration"><span>Warm Migration</span></a></h4><p>Warm migration copies most of the data during the precopy stage. Then the VMs are shut down and the remaining data is copied during the cutover stage. Results of a sample ubuntu virtual machine migration with 10GB OS disk and 10GB data disk.</p><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-24-CpvtkEMn.png" alt=""><strong>FIGURE 59.</strong> Warm Migration output</p><h4 id="cold-migration" tabindex="-1"><a class="header-anchor" href="#cold-migration"><span>Cold Migration</span></a></h4><p>During Cold migration the Virtual Machines (VMs) are shut down while the data is copied. Results of a sample ubuntu virtual machine migration with 10GB OS disk and 10GB data disk.</p><p><img src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/figure-virt-25-C7xJwBqD.png" alt=""></p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/hpe-solutions-openshift/4.16-INTEL-LTI/assets/app-Do4L8dKy.js" defer></script>
  </body>
</html>
