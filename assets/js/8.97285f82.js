(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{261:function(e,t,s){e.exports=s.p+"assets/img/figure5.11040a94.png"},274:function(e,t,s){"use strict";s.r(t);var a=s(28),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"preparing-the-execution-environment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preparing-the-execution-environment"}},[e._v("#")]),e._v(" Preparing the execution environment")]),e._v(" "),a("p",[e._v("This section provides a detailed overview and steps to configure the components deployed for this solution.")]),e._v(" "),a("h2",{attrs:{id:"non-root-user-access"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#non-root-user-access"}},[e._v("#")]),e._v(" Non-root user access")]),e._v(" "),a("p",[e._v("The industry-wide security best practice to avoid the use of root user account for administration of Linux based servers. However, certain operations require root user privileges to perform tasks. In those cases, it is best to use the sudo command to obtain the necessary privilege escalation on a short-term basis. The sudo command allows programs and commands to be run with the security privileges of another user (Root is the default user) and can restrict the permissions to specific groups, users, and individual commands.")]),e._v(" "),a("p",[e._v("The root user is not active by default in RHCOS. Instead, log in as the core user.")]),e._v(" "),a("p",[e._v("Use the following steps to create a non-root user for the OpenShift installation process:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Login to the installer VM as root. Refer to the section [Installer machine] in this document for more details about the installer VM.")])]),e._v(" "),a("li",[a("p",[e._v("Execute the following command to create a new user.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" adduser openshift_admin\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Execute the following command to set password for the new user.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("passwd")]),e._v(" openshift_admin\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Edit the sudoers file and add the entry of new user in the sudoers file using the following command.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" visudo\n")])])]),a("p",[e._v("An example of sudoers file is as follows.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# Allow root to run any commands anywhere\nroot ALL=(ALL) ALL\nopenshift_admin ALL=(ALL) NOPASSWD:ALL\n\n# Allow members of group sudo to execute any command\n%sudo ALL=(ALL:ALL) NOPASSWD: Allow\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Execute the following command to change the user.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("su")]),e._v(" openshift_admin\n")])])])])]),e._v(" "),a("h2",{attrs:{id:"installer-machine"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#installer-machine"}},[e._v("#")]),e._v(" Installer machine")]),e._v(" "),a("p",[e._v("This document assumes that a server running Red Hat Enterprise Linux 7.6 exists within the deployment environment and is accessible to the installation user to be used as an installer machine. This server must have internet connectivity. In this solution, a virtual machine is used to act as an installer machine and the same host is utilized as an Ansible Engine host.")]),e._v(" "),a("p",[e._v("Log in to the installer VM as non-root user and perform the following steps:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Register the host and attach the host pool with Red Hat by executing the following command.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" subscription-manager register --username"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("username"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" --password"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("password"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" --auto-attach\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Disable all repositories and enable only the repositories required for the installer VM.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" yum-config-manager --disable "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("*\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" subscription-manager repos --disable"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"*"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n\n--enable"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"rhel-7-server-rpms"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n\n--enable"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"rhel-7-server-extras-rpms"')]),e._v("\n\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Execute the following commands to download the hpe-solutions-openshift repository.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /etc/ansible\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" clone "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<")]),e._v("https://github.com/HewlettPackard/hpe-solutions-openshift.git"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("\n\n")])])])]),e._v(" "),a("li",[a("p",[e._v("After the hpe-solutions-openshift repository is downloaded, navigate to the path "),a("em",[e._v("/etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/playbooks")]),e._v(". The scripts within this directory assists in configuring the prerequisites for the environment. The details of the scripts are as follows:")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("python_env.sh – this script installs Python 3.")])]),e._v(" "),a("li",[a("p",[e._v("ansible_env.sh – this script creates a Python 3 virtual environment and installs Ansible within the virtual environment.")])]),e._v(" "),a("li",[a("p",[e._v("download_oneview_packages.sh – this script installs the prerequisite modules such as HPE oneview-ansible, HPE oneview-python and VMware pyVmomi within the virtual environment.")])])])]),e._v(" "),a("li",[a("p",[e._v("Steps to configure the prerequisite environment are as follows:")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Change the directory to /etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/playbooks")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/playbooks\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Execute the following command to setup prerequisite Python environment.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sh")]),e._v(" python_env.sh\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Execute the following command to enable Python3.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" scl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("enable")]),e._v(" rh-python36 "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("bash")]),e._v("\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Execute the following command to configure the Ansible environment.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sh")]),e._v(" ansible_env.sh\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Execute the following command to download the HPE OneView packages.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sh")]),e._v(" download_oneview_packages.sh\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Enable the virtual environment with the following command.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("source")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("..")]),e._v("/ocp_venv/bin/activate\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Execute the following command to set the environment variables.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ANSIBLE_LIBRARY")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/library/oneview-ansible/library\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("ANSIBLE_MODULE_UTILS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/library/oneview-ansible/library/module_utils\n")])])])])])])]),e._v(" "),a("h3",{attrs:{id:"openshift-inventory-file"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#openshift-inventory-file"}},[e._v("#")]),e._v(" OpenShift inventory file")]),e._v(" "),a("p",[e._v("The files that are cloned from the GitHub site include a sample inventory file. The installation user should review this file (located on the installer VM at "),a("em",[e._v("/etc/ansible/hpe-solutions-openshift/synergy/scalable/infrastructure/hosts")]),e._v(") and ensure that the information within the file accurately reflects the information in their environment.")]),e._v(" "),a("p",[e._v("Use an editor such as vim or nano to edit the inventory file.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("vim")]),e._v(" /etc/ansible/hpe-solutions-openshift/synergy/scalable/infrastructure/hosts\n")])])]),a("p",[a("strong",[e._v("NOTE")])]),e._v(" "),a("p",[e._v("The values provided in the variable files, inventory files, figures, and tables in this document are intended to be used for reference purposes. It is expected that the installation user updates them to suit the local environment.")]),e._v(" "),a("h3",{attrs:{id:"ansible-vault"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ansible-vault"}},[e._v("#")]),e._v(" Ansible Vault")]),e._v(" "),a("p",[e._v("A preconfigured Ansible vault file ("),a("em",[e._v("secret.yml")]),e._v(") is provided as part of this solution which consists of sensitive information to support the host and virtual machine deployment.")]),e._v(" "),a("p",[e._v("Run the following command on the installer VM to edit the vault to match the installation environment.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" ansible-vault edit /etc/ansible/hpe-solutions-openshift/synergy/scalable/infrastructure/secret.yml\n")])])]),a("p",[a("strong",[e._v("NOTE")])]),e._v(" "),a("p",[e._v("The default password for the Ansible vault file is "),a("em",[e._v("changeme.")])]),e._v(" "),a("h2",{attrs:{id:"kubernetes-manifests-and-ignition-files"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-manifests-and-ignition-files"}},[e._v("#")]),e._v(" Kubernetes manifests and ignition files")]),e._v(" "),a("p",[e._v("Manifests and ignition files define the master node and worker node configurations and are key components of the Red Hat OpenShift Container Platform 4 installation.")]),e._v(" "),a("p",[e._v("Before creating the manifest files and ignition files, it is necessary to download the Red Hat OpenShift 4 packages. Execute the following command on the installer VM to download the required packages.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /etc/ansible/hpe-solutions-openshift/synergy/scalable/installer\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" ansible-playbook playbooks/download_ocp_package.yml\n")])])]),a("p",[e._v("The OpenShift packages downloaded after executing the "),a("em",[e._v("download_ocp_package.yml")]),e._v(" playbook can be found on the installer VM at "),a("em",[e._v("/etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/library/openshift_components")]),e._v(". To execute any OpenShift related adhoc commands, it is advised to execute them from within this folder.")]),e._v(" "),a("p",[e._v("To create the manifest files and the ignition files, edit the "),a("em",[e._v("install-config.yaml")]),e._v(" file provided in the directory "),a("em",[e._v("/etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/ignitions")]),e._v(" to include the following details:")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("baseDomain - Base domain of the DNS which hosts Red Hat OpenShift Container Platform.")])]),e._v(" "),a("li",[a("p",[e._v("name – Name for the OpenShift cluster. This is same as the new domain created in DNS.")])]),e._v(" "),a("li",[a("p",[e._v("replicas – Update this field to reflect the corresponding number of master or worker instances required for the OpenShift cluster as per the installation environment requirements. It is recommended to have a minimum of 3 master nodes and 2 worker nodes per OpenShift cluster.")])]),e._v(" "),a("li",[a("p",[e._v("clusterNetworks – This field is pre-populated by Red Hat. Update this field only if a custom cluster network is to be used.")])]),e._v(" "),a("li",[a("p",[e._v("pullSecret – Update this field with the pull secret for the Red Hat account. Login to Red Hat account "),a("a",{attrs:{href:"https://cloud.redhat.com/openshift/install/metal/user-provisioned",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://cloud.redhat.com/openshift/install/metal/user-provisioned"),a("OutboundLink")],1),e._v(" and retrieve the pull secret.")])]),e._v(" "),a("li",[a("p",[e._v("sshKey – Update this field with the sshKey of the installer VM. Generate the SSH key with following command.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" ssh-keygen\n")])])]),a("p",[e._v("An example "),a("em",[e._v("install-config.yaml")]),e._v(" file appears below. Update the fields to suit the installation environment.")]),e._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[e._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" v1\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("baseDomain")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[e._v("&lt")]),e._v(";name of the base domain"),a("span",{pre:!0,attrs:{class:"token important"}},[e._v("&gt")]),e._v(";\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("compute")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("hyperthreading")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" Enabled\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" worker\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("controlPlane")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("hyperthreading")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" Enabled\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" master\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token important"}},[e._v("&lt")]),e._v(";name of the cluster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" same as the new domain under the base domain created"),a("span",{pre:!0,attrs:{class:"token important"}},[e._v("&gt")]),e._v(";\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("networking")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("clusterNetworks")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("cidr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" 12.128.0.0/14\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("hostPrefix")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("23")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("networkType")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" OpenShiftSDN\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("serviceNetwork")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v(" 172.30.0.0/16\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("platform")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("none")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("pullSecret")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" ‘pull secret provided as per the Red Hat account’\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("sshKey")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" ‘ ssh key of the installer VM ’\n\n")])])]),a("p",[e._v("Execute the following command on the installer VM to create the manifest files and the ignition files required to install Red Hat OpenShift.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /etc/ansible/hpe-solutions-openshift/synergy/scalable/installer\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" ansible-playbook playbooks/create_manifest_ignitions.yml\n")])])])])]),e._v(" "),a("p",[e._v("The ignition files are generated on the installer VM within the folder "),a("em",[e._v("/etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/ignitions")]),e._v(".")]),e._v(" "),a("p",[a("strong",[e._v("NOTE")])]),e._v(" "),a("p",[e._v("The ignition files have a time-out period of 24 hours and it is critical that the clusters are created within 24 hours of generating the ignition files. If 24 hours is passed, then regenerate the ignition files again by clearing up the files from the directory where the ignition files were saved.")]),e._v(" "),a("h2",{attrs:{id:"pxe-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pxe-server"}},[e._v("#")]),e._v(" PXE Server")]),e._v(" "),a("p",[e._v("In this solution, a PXE Server is used for OS deployment and is configured on CentOS (version: CentOS Linux release 7.6.1810 (Core)). The PXE server uses the FTP service for file distribution but can be altered to support HTTP or NFS.")]),e._v(" "),a("p",[e._v("This section highlights the steps to configure a PXE server:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Login to the CentOS server to be configured as a PXE server as a user that can run commands as root via sudo.")])]),e._v(" "),a("li",[a("p",[e._v("Install packages such as DHCP, TFTP-server, vSFTPD (FTP server) and xinetd using the following command.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" dhcp tftp tftp-server syslinux vsftpd xinetd\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Update the DHCP configuration file at "),a("em",[e._v("/etc/dhcp/dhcpd.conf")]),e._v(" with the MAC addresses, IP addresses, DNS, and routing details of the installation environment. Domain search is optional. A sample DHCP configuration file is shown as follows.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('ddns-update-style interim;\nignore client-updates;\nauthoritative;\nallow booting;\nallow bootp;\n\n# internal subnet for my DHCP Server\nsubnet 20.0.x.x netmask 255.0.0.0 {\nrange 20.0.x.x 20.0.x.x;\ndeny unknown-clients;\noption domain-name-servers 20.x.x.x;\noption domain-name "twentynet.local";\noption routers 20.x.x.x;\noption broadcast-address 20.255.255.255;\ndefault-lease-time 600;\nmax-lease-time 7200;\nnext-server 20.x.x.x;\nfilename "pxelinux.0";\n}\n\n#######################################\nhost bootstrap {\nhardware ethernet 00:50:56:xx:98:df;\nfixed-address 20.0.x.x;\n}\nhost master01 {\nhardware ethernet 00:50:56:95:xx:82;\nfixed-address 20.0.x.x;\n}\nhost worker01 {\nhardware ethernet 00:50:56:xx:ab:82;\nfixed-address 20.0.x.x;\n}\n')])])])]),e._v(" "),a("li",[a("p",[e._v("Trivial File Transfer Protocol (TFTP) is used to transfer files from data server to clients without any kind of authentication. TFTP is used for ignition file loading in PXE based environments. To configure the TFTP server, edit the configuration file "),a("em",[e._v("/etc/xinetd.d/tftp")]),e._v(". Change the parameter ‘disable = yes’ to ‘disable = no’ and leave the other parameters as is. To edit the "),a("em",[e._v("/etc/xinetd.d/tftp")]),e._v(" file, execute the following command.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("vi")]),e._v("  /etc/xinetd.d/tftp\n")])])]),a("p",[e._v("The TFTP configuration file is shown below.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("service tftp\n   {\n\n        socket_type = dgram\n        protocol = udp\n        wait = yes\n        user = root\n        server = /usr/sbin/in.tftpd\n        server_args = -s /var/lib/tftpboot\n        disable = no\n        per_source = 11\n        cps = 100 2\n        flags = IPv4\n    }\n")])])]),a("p",[e._v("Network boot related files must be placed in the tftp root directory "),a("em",[e._v("/var/lib/tftpboot")]),e._v(". Run the following commands to copy the required network boot files to "),a("em",[e._v("/var/lib/tftpboot/")]),e._v(".")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" –v /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" –v /usr/share/syslinux/menu.c32 /var/lib/tftpboot\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" –v /usr/share/syslinux/memdisk /var/lib/tftpboot\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" –v /usr/share/syslinux/mboot.c32 /var/lib/tftpboot\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" –v /usr/share/syslinux/chain.c32 /var/lib/tftpboot\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" /var/lib/tftpboot/pxelinux.cfg\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" /var/lib/tftpboot/networkboot\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Copy the RHCOS 4 and RHEL 7.6 ISO files to the PXE server. Mount it to the "),a("em",[e._v("/mnt/")]),e._v(" directory and then copy the contents of the ISO to the local FTP server using the following commands.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("mount")]),e._v(" –o loop "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("lt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("OS "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("file")]),e._v(" name"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&")]),e._v("gt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" /mnt/\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /mnt/\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" –av * /var/ftp/pub/\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Copy the kernel file (vmlinuz) and initrd file from "),a("em",[e._v("/mnt")]),e._v(" to "),a("em",[e._v("/var/lib/tftpboot/networkboot/")]),e._v(" using the following commands.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" /mnt/images/pxeboot/vmlinuz /var/lib/tftpboot/networkboot/\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" /mnt/images/pxeboot/initrd.img /var/lib/tftpboot/networkboot\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Unmount the ISO files using the following command.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" unmount /mnt/\n")])])])]),e._v(" "),a("li",[a("p",[e._v("For RHEL nodes, create and utilize a new kickstart file under the folder "),a("em",[e._v("/var/ftp/pub")]),e._v(" with the name “"),a("em",[e._v("rhel7.cfg")]),e._v("” using the following command.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("vi")]),e._v(" /var/ftp/pub/rhel7.cfg\n")])])]),a("p",[e._v("An example kickstart file is shown below. The installation user should create a kickstart file to meet the requirements of their installation environment.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('firewall --disabled\n# Install OS instead of upgrade\ninstall\n# Use FTP installation media\nurl --url="ftp://&lt;FTP_server_IP_address&gt;/pub/rhel76/"\n# Root password\n# root password can be plaintext as shown below\n# rootpw –plaintext &lt;password&gt;\n# root password is encrypted using the command “openssl passwd -1 &lt;password&gt;” and resultant output is provided for rootpw as shown below\nrootpw --iscrypted $6$uiq8l/7xEWsYXhrvaEgan4N21yhLa8K.U7UA12Th3PD11GOXvEcI40gp\n# System authorization information\nauth useshadow passalgo=sha512\n# Use graphical install\ngraphical\nfirstboot disable\n# System keyboard, timezone, language\nkeyboard us\ntimezone Europe/Amsterdam\nlang en_US\n# SELinux configuration\nselinux disabled\n# Installation logging level\nlogging level=info\n# System bootloader configuration\nbootloader location=mbr\nclearpart --all --initlabel\npart swap --asprimary --fstype="swap" --size=1\npart /boot --fstype xfs --size=300\npart pv.01 --size=1 --grow\nvolgroup root_vg01 pv.01\nlogvol / --fstype xfs --name=lv_01 --vgname=root_vg01 --size=1 --grow\n%packages\n@^minimal\n@core\n%end\n%addon com_redhat_kdump --disable --reserve-mb=\'auto\'\n%end\n')])])])]),e._v(" "),a("li",[a("p",[e._v("Create a PXE menu:")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Create a PXE menu file at the location "),a("em",[e._v("/var/lib/tftpboot/pxelinux.cfg/default")]),e._v(" using the command.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("vi")]),e._v(" /var/lib/tftpboot/pxelinux.cfg/default\n")])])])]),e._v(" "),a("li",[a("p",[e._v("For each of the OS boot options, provide the following details:")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("MENU LABEL – Custom name of the respective menu label.")])]),e._v(" "),a("li",[a("p",[e._v("KERNEL – Kernel details of the operating system.")])]),e._v(" "),a("li",[a("p",[e._v("APPEND - Path of bootloader file along with path of cfg or ignition files (in case of RHCOS) or configuration file (in case of RHEL).")])])])])]),e._v(" "),a("p",[e._v("A sample PXE menu is shown below.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("default menu.c32\n\nprompt 0\n\ntimeout 30\n\nMENU TITLE LinuxTechi.com PXE Menu\n\nLABEL rhel76\n\nMENU LABEL RHEL76-Buedata\n\nKERNEL /rhel76/vmlinuz\n\nAPPEND initrd=/rhel76/initrd.img inst.repo=ftp://&lt;FTP_server_IP_address&gt;/pub/rhel76 ks=ftp://&lt;FTP_server_IP_address&gt;/pub/rhel76-hcp.cfg\n\nLABEL rhcos-bootstrap\n\nMENU LABEL Install RHCOS4.3 sec-Bootstrap\n\nKERNEL /networkboot/rhcos-4.3.0-x86_64-installer-kernel\n\nAPPEND ip=dhcp rd.neednet=1 initrd=/networkboot/rhcos-4.3.0-x86_64-installer-initramfs.img console=tty0 console=ttyS0 coreos.inst=yes coreos.inst.install_dev=sda coreos.inst.image_url= ftp://&lt;FTP_server_IP_address&gt;/pub/rhcos-4.3.0-x86_64-metal-bios.raw.gz coreos.inst.ignition_url= ftp://&lt;FTP_server_IP_address&gt;/pub/sec/bootstrap.ign\n\nLABEL rhcos-master\n\nMENU LABEL Install RHCOS4.2 sec-Master\n\nKERNEL /networkboot/rhcos-4.3.0-x86_64-installer-kernel\n\nAPPEND ip=dhcp rd.neednet=1 initrd=/networkboot/rhcos-4.3.0-x86_64-installer-initramfs.img console=tty0 console=ttyS0 coreos.inst=yes coreos.inst.install_dev=sda coreos.inst.image_url= ftp://&lt;FTP_server_IP_address&gt;/pub/rhcos-4.3.0-x86_64-metal-bios.raw.gz coreos.inst.ignition_url=ftp://&lt;FTP_server_IP_address&gt;/pub/sec/master.ign\n\nLABEL rhcos-worker\n\nMENU LABEL Install RHCOS4.2 sec-Worker\n\nKERNEL /networkboot/rhcos-4.3.0-x86_64-installer-kernel\n\nAPPEND ip=dhcp rd.neednet=1 initrd=/networkboot/rhcos-4.3.0-x86_64-installer-initramfs.img console=tty0 console=ttyS0 coreos.inst=yes coreos.inst.install_dev=sda coreos.inst.image_url= ftp://&lt;FTP_server_IP_address&gt;/pub/rhcos-4.3.0-x86_64-metal-bios.raw.gz coreos.inst.ignition_url=ftp://&lt;FTP_server_IP_address&gt;/pub/sec/worker.ign\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Start and enable xinetd, dhcpd and vsftpd using the following commands.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("    "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" systemctl start xinetd\n\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("enable")]),e._v(" xinetd\n\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" systemctl start dhcpd.service\n\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("enable")]),e._v(" dhcpd.service\n\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" systemctl start vsftpd\n\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("enable")]),e._v(" vsftpd\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Configure SELinux for FTP.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" setsebool –P allow_ftpd_full_access "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Open ports in the firewall using the following firewall-cmd commands.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" firewall-cmd --add-service-ftp --permanent\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("sudo firewall-cmd --add-service-dhcp --permanent\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("sudo firewall-cmd –reload\n")])])])])]),e._v(" "),a("p",[a("strong",[e._v("NOTE")])]),e._v(" "),a("p",[e._v("It is crucial to generate ignition files, copy them to the TFTP server, and update the path in the PXE default file. For more information about generating the ignition files, refer to the section [Kubernetes manifests and ignition files] in this document.")]),e._v(" "),a("h2",{attrs:{id:"load-balancer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#load-balancer"}},[e._v("#")]),e._v(" Load balancer")]),e._v(" "),a("p",[e._v("Red Hat OpenShift Container Platform 4 uses an external load balancer to communicate from outside the cluster with services running inside the cluster. This section assumes that there is a load balancer available within the deployment environment and is available for use. This solution was developed using "),a("strong",[e._v("HA Proxy")]),e._v(", an open source solution with one (1) virtual machine for load balancing functionality. This section covers its configuration. In a production environment, Hewlett Packard Enterprise recommends the use of enterprise load balancing such as F5 Networks Big-IP and its associated products.")]),e._v(" "),a("p",[e._v("The following entries are made in the haproxy.cfg file.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Sample haproxy.cfg file\n#---------------------------------------------------------------------\n# static backend for serving up images, stylesheets and such\n#---------------------------------------------------------------------\n#backend static\n# balance roundrobin\n# server static 127.0.0.1:4331 check\n#---------------------------------------------------------------------\n# round robin balancing between the various backends\n#---------------------------------------------------------------------\nbackend ocp4-kubernetes-api-server\n    mode tcp\n    balance source\n    server bootstrap bootstrap.ocp.pxelocal.local:6443 check\n    server master01 master01.ocp.pxelocal.local:6443 check\n    server master02 master02.ocp.pxelocal.local:6443 check\n    server master03 master03.ocp.pxelocal.local:6443 check\n\nbackend ocp4-machine-config-server\n    balance source\n    mode tcp\n    server bootstrap bootstrap.ocp.pxelocal.local:22623 check\n    server master01 master01.ocp.pxelocal.local:22623 check\n    server master02 master02.ocp.pxelocal.local:22623 check\n    server master03 master03.ocp.pxelocal.local:22623 check\n\nbackend ocp4-router-http\n    balance source\n    mode tcp\n    server worker03 worker03.ocp.pxelocal.local:80 check\n    server worker04 worker04.ocp.pxelocal.local:80 check\n    server worker01 worker01.ocp.pxelocal.local:80 check\n    server worker02 worker02.ocp.pxelocal.local:80 check\n\n# if creating a cluster with only master nodes to begin with and later adding the worker nodes, master nodes should be added in this section instead of worker nodes. Once all the worker nodes are added into the cluster, this configuration needs to be updated with the worker nodes.\n    # server master01 master01.ocp.pxelocal.local:80 check\n    # server master02 master02.ocp.pxelocal.local:80 check\n    # server master03 master03.ocp.pxelocal.local:80 check\n\n    backend ocp4-router-https\n        balance source\n        mode tcp\n        server worker03 worker03.ocp.pxelocal.local:443 check\n        server worker04 worker04.ocp.pxelocal.local:443 check\n        server worker01 worker01.ocp.pxelocal.local:443 check\n        server worker01 worker02.ocp.pxelocal.local:443 check\n\n# if creating a cluster with only master nodes to begin with and later adding the worker nodes, master nodes should be added in this section instead of worker nodes. Once all the worker nodes are added into the cluster, this configuration needs to be updated with the worker nodes.\n    # server master01 master01.ocp.pxelocal.local:443 check\n    # server master02 master02.ocp.pxelocal.local:443 check\n    # server master03 master03.ocp.pxelocal.local:443 check\n")])])]),a("p",[a("strong",[e._v("NOTE")])]),e._v(" "),a("p",[e._v("The load balancer configuration should contain values that are aligned to the installation environment.")]),e._v(" "),a("h2",{attrs:{id:"user-provisioned-dns-requirements"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#user-provisioned-dns-requirements"}},[e._v("#")]),e._v(" User-provisioned DNS requirements")]),e._v(" "),a("p",[e._v("This section covers the host entries that need to be made in the base domain to enable installation of Red Hat OpenShift Container Platform 4.")]),e._v(" "),a("p",[e._v("Red Hat OpenShift Container Platform 4 uses three types of DNS records (A, CNAME, and SRV). The host names and their types are described in Table 7.")]),e._v(" "),a("p",[a("strong",[e._v("Table 7.")]),e._v(" DNS entries for Red Hat OpenShift Container Platform")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Hosts")]),e._v(" "),a("th",[e._v("DNS Record Types")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("master_nodes")]),e._v(" "),a("td",[e._v("A")])]),e._v(" "),a("tr",[a("td",[e._v("worker_nodes")]),e._v(" "),a("td",[e._v("A")])]),e._v(" "),a("tr",[a("td",[e._v("bootstrap_nodes")]),e._v(" "),a("td",[e._v("A")])]),e._v(" "),a("tr",[a("td",[e._v("installer VM")]),e._v(" "),a("td",[e._v("A")])]),e._v(" "),a("tr",[a("td",[e._v("*, api, api-int, haproxy")]),e._v(" "),a("td",[e._v("A")])]),e._v(" "),a("tr",[a("td",[e._v("etcd")]),e._v(" "),a("td",[e._v("CNAME, SRV")])])])]),e._v(" "),a("p",[e._v("To add the appropriate records, follow these steps:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("‘A’ type resource record [ Host (A) ]. An A record specifies an IPv4 address. Example entries are shown in Table 8. Ensure that these entries are created for all the nodes in the installation environment.")]),e._v(" "),a("p",[a("strong",[e._v("Table 8.")]),e._v(" ‘A’ type DNS entry")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Host (A)")]),e._v(" "),a("th",[e._v("IP Address")]),e._v(" "),a("th",[e._v("Host name")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("master_nodes")]),e._v(" "),a("td",[e._v("master_ip")]),e._v(" "),a("td",[e._v("master_name.cluster_name.baseDomain")])]),e._v(" "),a("tr",[a("td",[e._v("worker_nodes")]),e._v(" "),a("td",[e._v("worker_ip")]),e._v(" "),a("td",[e._v("worker_name.cluster_name.baseDomain")])]),e._v(" "),a("tr",[a("td",[e._v("bootstrap_nodes")]),e._v(" "),a("td",[e._v("bootstrap_ip")]),e._v(" "),a("td",[e._v("bootstrap_name.cluster_name.baseDomain")])]),e._v(" "),a("tr",[a("td",[e._v("installer VM")]),e._v(" "),a("td",[e._v("installer_ip")]),e._v(" "),a("td",[e._v("installer_name.cluster_name.baseDomain")])]),e._v(" "),a("tr",[a("td",[e._v("*")]),e._v(" "),a("td",[e._v("haproxy_ip")]),e._v(" "),a("td",[e._v("*.apps.cluster_name.baseDomain")])]),e._v(" "),a("tr",[a("td",[e._v("api")]),e._v(" "),a("td",[e._v("haproxy_ip")]),e._v(" "),a("td",[e._v("api.cluster_name.baseDomain")])]),e._v(" "),a("tr",[a("td",[e._v("api-int")]),e._v(" "),a("td",[e._v("haproxy_ip")]),e._v(" "),a("td",[e._v("api-int.cluster_name.baseDomain")])]),e._v(" "),a("tr",[a("td",[e._v("haproxy")]),e._v(" "),a("td",[e._v("haproxy_ip")]),e._v(" "),a("td",[e._v("haproxy_name.cluster_name.baseDomain")])])])])]),e._v(" "),a("li",[a("p",[e._v("Create a CNAME resource record [ Alias (CNAME) ] in DNS. Example entries are shown in Table 9. Ensure that these entries are created for all of the master nodes.")]),e._v(" "),a("p",[a("strong",[e._v("Table 9.")]),e._v(" DNS entries for Red Hat OpenShift Container Platform")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Host (CNAME)")]),e._v(" "),a("th",[e._v("Target host name")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("etcd-0")]),e._v(" "),a("td",[e._v("*master01_name.cluster_name.baseDomain")])]),e._v(" "),a("tr",[a("td",[e._v("etcd-1")]),e._v(" "),a("td",[e._v("*master02_name.cluster_name.baseDomain")])]),e._v(" "),a("tr",[a("td",[e._v("etcd-2")]),e._v(" "),a("td",[e._v("*master03_name.cluster_name.baseDomain")])])])]),e._v(" "),a("p",[a("strong",[e._v("NOTE")])]),e._v(" "),a("p",[e._v("Replace the italicized components in the examples above with the actual values that align to the installation environment.")])]),e._v(" "),a("li",[a("p",[e._v("For each master node, Red Hat OpenShift Container Platform also requires a Service Location (SRV) DNS record for the etcd server on that machine with priority 0, weight 10, and port 2380. The SRV record is used to identify computers that host specific services. Figure 5 shows the creation of an SRV record.")]),e._v(" "),a("p",[a("img",{attrs:{src:s(261),alt:"Creating an SRV record"}})]),e._v(" "),a("p",[e._v("Figure 5. Creating an SRV record")])])]),e._v(" "),a("h2",{attrs:{id:"bootstrap-node"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bootstrap-node"}},[e._v("#")]),e._v(" Bootstrap node")]),e._v(" "),a("p",[e._v("A temporary bootstrap node is required for OpenShift cluster creation. This section assumes that a VMware vSphere host is present within the deployment environment and is associated with a VMware vCenter server. The host should be configured with appropriate storage and networking configurations.")]),e._v(" "),a("h3",{attrs:{id:"playbooks-for-creating-the-bootstrap-node"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#playbooks-for-creating-the-bootstrap-node"}},[e._v("#")]),e._v(" Playbooks for creating the bootstrap node")]),e._v(" "),a("ol",[a("li",[a("p",[a("strong",[e._v("inputs.yml")]),e._v(": This file contains input variables to create the bootstrap VM. Some of the variables pertaining to the VM configuration are provided with default values as per the Red Hat guidelines. It is expected that the installation user updates the values to suit their installation environment.")]),e._v(" "),a("ul",[a("li",[a("p",[a("strong",[e._v("datacenter_name")]),e._v(": name of the VMware data center.")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("cluster_name")]),e._v(": name of the VMware cluster.")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("datastore_name")]),e._v(": name of the VMware datastore.")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("network_name:")]),e._v(" name of the network associated with the vSphere host**.**")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("bootstrap_disk:")]),e._v(" disk size for the bootstrap node.")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("bootstrap_cpu:")]),e._v(" number of vCPUs for the bootstrap node.")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("bootstrap_name:")]),e._v(" custom name of the bootstrap node.")])])])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("secret.yml")]),e._v(": This is an Ansible vault file that contains sensitive information such as the VMware vCenter server IP address and credentials.")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("playbooks/deploy_vm.yml")]),e._v(": This playbook is used to create the bootstrap VM.")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("roles/deploy_vm.yml")]),e._v(": This is the Ansible role file that is required to create the bootstrap VM. Each role is associated with a set of tasks to accomplish the expected output and they are present in the tasks directory within the role.")])])]),e._v(" "),a("p",[e._v("Follow these steps to create the bootstrap node:")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Login to the installer VM.")])]),e._v(" "),a("li",[a("p",[e._v("Change the directory using the following command.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" /etc/ansible/hpe-solutions-openshift/synergy/scalable/infrastructure\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Update the "),a("em",[e._v("secret.yml")]),e._v(" to provide the details of the VMware vCenter server using the following command. A sample input is provided, and it is expected that the installation user updates the configuration to suit the deployment environment.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" ansible-vault edit secret.yml\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# vcenter hostname/ip address and credentials\nvcenter_hostname: <vcenter hostname>;\nvcenter_username: <vcenter username>;\nvcenter_password: <vcenter password>;\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Update the "),a("em",[e._v("input.yml")]),e._v(" file with the data center, cluster, and datastore information that will be used within the VMware vCenter server. This file provides default configuration information for the bootstrap node, if required. The configuration can be updated to suit the environment needs.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("# Variables for creating the bootstrap VM, as per the vSphere host configuration within the vCenter\ndatacenter_name: <name of data center within vcenter>;\ncluster_name: &lt;name of cluster within vcenter>;\ndatastore_name: &lt;name of datastore within vcenter>;\nnetwork_name: <name of the network within vcenter>;\n\n# Default values for creating the bootstrap VM\nbootstrap_disk: 150\nbootstrap_cpu: 4\nbootstrap_memory: 16400\nbootstrap_name: Bootstrap\n")])])])]),e._v(" "),a("li",[a("p",[e._v("After the "),a("em",[e._v("input.yml")]),e._v(" and "),a("em",[e._v("secret.yml")]),e._v(" files are updated with appropriate values, execute the playbook with the following command to create the bootstrap VM.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" ansible-playbook –i hosts playbooks/deploy_vm.yml –ask-vault-pass\n")])])])])]),e._v(" "),a("p",[a("strong",[e._v("NOTE")])]),e._v(" "),a("p",[e._v("It is essential that all the nodes within the deployment environment are synchronized for time using an NTP server. Failure to do so will result in an installation failure due to mismatches in certificates or other files with time dependencies.")])])}),[],!1,null,null,null);t.default=n.exports}}]);