(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{476:function(e,t,s){e.exports=s.p+"assets/img/Figure107.07420cfd.png"},477:function(e,t,s){e.exports=s.p+"assets/img/Figure108.3c19b7fb.png"},532:function(e,t,s){"use strict";s.r(t);var a=s(42),n=Object(a.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"securing-red-hat-openshift-container-platform-using-sysdig-secure-and-sysdig-monitor"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#securing-red-hat-openshift-container-platform-using-sysdig-secure-and-sysdig-monitor"}},[e._v("#")]),e._v(" Securing Red Hat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor")]),e._v(" "),a("h2",{attrs:{id:"description"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#description"}},[e._v("#")]),e._v(" Description")]),e._v(" "),a("p",[e._v("This section contains Ansible playbooks to automate the installation of\nsysdig agents over the Red Hat OpenShift 4.6 Cluster. The contents of\nthe repository includes the playbooks and input files as listed.")]),e._v(" "),a("ul",[a("li",[a("strong",[e._v("playbooks:")]),e._v(" This folder contains the playbook required for Sysdig\nagent installation over OCP 4.6.")]),e._v(" "),a("li",[a("strong",[e._v("roles:")]),e._v(' This folder contains a role called\n"sysdig-agent-deploy-ocp" which is responsible for performing the\nactions required for Sysdig agent integration.')]),e._v(" "),a("li",[a("strong",[e._v("hosts:")]),e._v(" This is the host file which will be used by Ansible\ninstaller machine to reference localhost during Sysdig agent\ndeployment.")]),e._v(" "),a("li",[a("strong",[e._v("secrets.yml:")]),e._v(" This file contains sensitive information about the\nSysdig SaaS platform access details and Red Hat OpenShift cluster\naccess details.")])]),e._v(" "),a("h3",{attrs:{id:"prerequisites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[e._v("#")]),e._v(" Prerequisites")]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Ansible engine with Ansible 2.9.x and Python 3.6.x.")])]),e._v(" "),a("li",[a("p",[e._v("Red Hat OpenShift 4.6 is up and running.")])]),e._v(" "),a("li",[a("p",[e._v("User has SaaS-based access to Sysdig Secure and Sysdig Monitor for\nthe purpose of container security.")])]),e._v(" "),a("li",[a("p",[e._v('User has "admin rights and privilege" for Sysdig Secure and Sysdig\nMonitor.')])]),e._v(" "),a("li",[a("p",[e._v("User has valid access token that is given by Sysdig and is specific\nto their credentials on Sysdig SaaS platform.")])]),e._v(" "),a("li",[a("p",[e._v("User has updated the kernel to ensure that all the nodes have same\nkernel version. Information regarding this can be found by logging\ninto Sysdig monitor account. Go to setting and under Agent\nInstallation, you will find instructions to install the kernel\nheaders.")])]),e._v(" "),a("li",[a("p",[e._v("Enable password-less ssh from OpenShift installer machine to itself\n(OpenShift installer machine or localhost).")]),e._v(" "),a("ul",[a("li",[e._v("Create password-less ssh to installer VM by generating the ssh\nkey.")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" ssh-keygen\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),a("p",[e._v("Press enter to overwrite the id_rsa.pub file and also press enter\nfor empty password.")])])]),e._v(" "),a("li",[a("p",[e._v("Copy the ssh key to ~/id_rsa.pub file using following command")])]),e._v(" "),a("li",[a("p",[e._v("$ ssh-copy-id -i ~/.ssh/id_rsa.pub nonrootusername@ansible_engine_machine_ip")])])]),e._v(" "),a("h3",{attrs:{id:"software-requirements"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#software-requirements"}},[e._v("#")]),e._v(" Software requirements")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Software")]),e._v(" "),a("th",[e._v("Version")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("HPE OneView")]),e._v(" "),a("td",[e._v("5")])]),e._v(" "),a("tr",[a("td",[e._v("Sysdig SaaS Agent")]),e._v(" "),a("td",[e._v("10.1.1")])])])]),e._v(" "),a("h3",{attrs:{id:"input-files"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#input-files"}},[e._v("#")]),e._v(" Input files")]),e._v(" "),a("ul",[a("li",[e._v("Playbook for Sysdig SaaS integration with RedHat OpenShift Container\nPlatform are available under $BASE_DIR/platform/security-sysdig/")])]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),a("p",[e._v("BASE_DIR is defined and set in "),a("RouterLink",{attrs:{to:"/Solution-Deployment/Preparing-execution-environment.html#installer-machine"}},[e._v("installer machine")]),e._v(" section in deployment guide.")],1)]),e._v(" "),a("ul",[a("li",[a("p",[e._v("It is mandatory to update all the input files (hosts, secrets.yml,\nsysdig-agent-configmap.yaml) with appropriate values before running\nthe playbook available in this repository.")])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("Input file name")]),e._v(" - hosts")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("This file is an inventory of host details.")])]),e._v(" "),a("li",[a("p",[e._v("This file is available under $BASE_DIR/platform/security-sysdig/.")])]),e._v(" "),a("li",[a("p",[e._v("Specify the Ansible engine machine IP as the value of the variable.")])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("[ocp_installer_machine_ip]\n")])])])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("Input file name")]),e._v(" - sysdig-agent-configmap.yaml")])])]),e._v(" "),a("ol",[a("li",[a("p",[e._v("This file is available under\n$BASE_DIR/platform/security-sysdig/roles/sysdig-agent-deploy-ocp/files/.")])]),e._v(" "),a("li",[a("p",[e._v("Provide the Sysdig SaaS Platform Address and Port Number along with\nRed Hat OpenShift cluster name to the variables as listed :")]),e._v(" "),a("ul",[a("li",[e._v("collector: <sysdig_saas_collector_address>")]),e._v(" "),a("li",[e._v("collector_port: <collector_port>")]),e._v(" "),a("li",[e._v("k8s_cluster_name:  <replace_with_ocp_cluster_name>")])])])]),e._v(" "),a("ul",[a("li",[a("p",[a("strong",[e._v("Input file name")]),e._v(" - secrets.yml")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("This file is available under\n$BASE_DIR/platform/security-sysdig/.")])]),e._v(" "),a("li",[a("p",[e._v("Provide value of project name for Sysdig integration with\nOpenShift Container Platform. This project will be created in\nOpenShift.")])]),e._v(" "),a("li",[a("p",[e._v("Provide the access key or token value. You must get this value\nfrom user setting by logging into either Sysdig Secure or Sysdig\nMonitor GUI.")])]),e._v(" "),a("li",[a("p",[e._v("Provide Red Hat OpenShift username and password to login.")]),e._v(" "),a("ul",[a("li",[e._v("projectname: <sysdig_project_name>")]),e._v(" "),a("li",[e._v("accesskeyval: <sysdig_saas_access_key>")]),e._v(" "),a("li",[e._v("ocpuser: <RedHat_OpenShift_User_Name>")]),e._v(" "),a("li",[e._v("ocppassword: <RedHat_OpenShift_User_Password>")])])])])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("Input file name")]),e._v(" - sysdig-agent-deployment.yaml")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("This file is available under\n$BASE_DIR/platform/security-sysdig/playbooks/")])]),e._v(" "),a("li",[a("p",[e._v("Update the KUBECONFIG and oc command path.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("-   KUBECONFIG: <replace_with_kubeconfig_path>\n-   PATH: <replace_with_ocp_installation_dir_path>:{{ ansible_env.PATH }}\n")])])])])])])]),e._v(" "),a("h3",{attrs:{id:"procedure-to-deploy-automated-sysdig-saas-agents-on-red-hat-openshift-container-platform-cluster"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#procedure-to-deploy-automated-sysdig-saas-agents-on-red-hat-openshift-container-platform-cluster"}},[e._v("#")]),e._v(" Procedure to deploy automated Sysdig SaaS agents on Red Hat OpenShift Container Platform cluster")]),e._v(" "),a("ul",[a("li",[e._v("Execute the following commands from the Ansible installer VM in the\npython virtual environment as a non-root user."),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$BASE_DIR")]),e._v("/platform/security-sysdig/\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" ansible-playbook -i hosts playbooks/sysdig-agent-deployment.yaml --ask-vault-pass\n")])])])])]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),a("p",[e._v("BASE_DIR is defined in "),a("RouterLink",{attrs:{to:"/Solution-Deployment/Preparing-execution-environment.html#installer-machine"}},[e._v("installer machine")]),e._v("\nsection in deployment guide.")],1)]),e._v(" "),a("ul",[a("li",[a("p",[e._v("Verification of Sysdig agent deployment on Red Hat OpenShift cluster\nnodes after successful execution of the playbook. Run the command\nlisted below to get the information on Sysdig pods..")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" oc get pods "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("grep")]),e._v(" sysdig-agent\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Output of the above command should show you all Sysdig pods in\nrunning state.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("sysdig-agent-2ljgw   1/1     Running   0          42m\nsysdig-agent-cdxtc   1/1     Running   0          42m\nsysdig-agent-frr7k   1/1     Running   0          42m\nsysdig-agent-gkcmk   1/1     Running   0          42m\nsysdig-agent-pzrvr   1/1     Running   2          42m\nsysdig-agent-qv6qh   1/1     Running   0          42m\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),a("p",[e._v("Number of sysdig pods should be equal to number of nodes that user\nsees after running the following command:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" oc get nodes\n")])])])])]),e._v(" "),a("li",[a("p",[e._v("Output of above command shows number of nodes in the Red Hat\nOpenShift cluster.")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("NAME                             STATUS   ROLES    AGE   VERSION\nmaster1.newocs.twentynet.local   Ready    master   64d   v1.17.1\nmaster2.newocs.twentynet.local   Ready    master   64d   v1.17.1\nmaster3.newocs.twentynet.local   Ready    master   64d   v1.17.1\nworker1.newocs.twentynet.local   Ready    worker   64d   v1.17.1\nworker2.newocs.twentynet.local   Ready    worker   64d   v1.17.1\nworker3.newocs.twentynet.local   Ready    worker   64d   v1.17.1\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("NOTE")]),e._v(" "),a("p",[e._v("If you see a pod in pending state, then there might be a possibility\nthat the underlying OpenShift Container Platform node is not\nfunctional.")])])]),e._v(" "),a("li",[a("p",[a("strong",[e._v("Verification using Sydig GUI")])]),e._v(" "),a("ul",[a("li",[e._v("Login to Sysdig Secure and under Policy Events --\x3e Hosts and\nContainers --\x3e user will find all the nodes that are part of\nyour Red Hat OpenShift infra and this shows Sysdig agents are\nsuccessfully installed and security checks are being run on all\nthose nodes.")])]),e._v(" "),a("p",[a("img",{attrs:{src:s(476),alt:""}})]),e._v(" "),a("p",[a("strong",[e._v("Figure 107")]),e._v(" - Securing Red Hat OpenShift cluster nodes using\nSysdig Monitor GUI")]),e._v(" "),a("ul",[a("li",[e._v("Login to Sysdig Monitor and under Explore --\x3e Hosts and\nContainers --\x3e user will find all the nodes that are part of\nyour RedHat OpenShift infra and this shows Sysdig agents are\nsuccessfully installed and monitoring on all those nodes.")])]),e._v(" "),a("p",[a("img",{attrs:{src:s(477),alt:""}})]),e._v(" "),a("p",[a("strong",[e._v("Figure 108")]),e._v(" - Monitoring Red Hat OpenShift cluster nodes using\nSysdig Monitor GUI")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);