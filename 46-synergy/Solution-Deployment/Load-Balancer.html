<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Load Balancer | OpenShift Container Platform 4.4 on Synergy</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Hewlett Packard Enterprise">
    
    <link rel="preload" href="/hpe-solutions-openshift/46-synergy/assets/css/0.styles.bfdf2f8a.css" as="style"><link rel="preload" href="/hpe-solutions-openshift/46-synergy/assets/js/app.8d09024b.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/46-synergy/assets/js/2.117ef8fd.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/46-synergy/assets/js/32.4d1ff1fb.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/10.f2647a7a.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/11.eb22f408.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/12.c2b1bda3.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/13.b2721807.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/14.fbb5bfdd.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/15.076cb55f.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/16.086f907f.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/17.5044d63c.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/18.0138d6da.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/19.577c768d.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/20.5dab068a.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/21.ea4d33a2.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/22.23d6a92d.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/23.329f64c2.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/24.bad0d82d.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/25.2a05a77a.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/26.05687ea8.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/27.5f97f9ba.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/28.9f8648b2.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/29.ffe26d0e.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/3.643f6564.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/30.b6d944bc.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/31.b0b75d1f.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/33.da67f8dd.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/34.78fab925.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/35.5e384204.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/36.53dec668.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/37.e773d372.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/4.7110e26d.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/5.8d6b47a1.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/6.b3a62cb0.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/7.a921eaba.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/8.8b92de32.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/9.7e00b22b.js">
    <link rel="stylesheet" href="/hpe-solutions-openshift/46-synergy/assets/css/0.styles.bfdf2f8a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-openshift/46-synergy/" class="home-link router-link-active"><!----> <span class="site-name">OpenShift Container Platform 4.4 on Synergy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-openshift/46-synergy/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-openshift/46-synergy/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Red Hat OpenShift Container Platform 4 on HPE Synergy</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Solution Deployment</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hpe-solutions-openshift/46-synergy/Solution-Deployment/Solution-Deployment-Flow.html" class="sidebar-link">Solution Deployment Flow</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Solution-Deployment/Preparing-execution-environment.html" class="sidebar-link">Preparing the execution environment</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Solution-Deployment/Server-Profiles.html" class="sidebar-link">Server Profiles</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Solution-Deployment/Operating-system-deployment.html" class="sidebar-link">Operating system deployment</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Solution-Deployment/User-provisioned-DNS-requirements.html" class="sidebar-link">User-provisioned DNS requirements</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Solution-Deployment/Load-Balancer.html" aria-current="page" class="active sidebar-link">Load Balancer</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/46-synergy/Solution-Deployment/Load-Balancer.html#install-and-configure-haproxy" class="sidebar-link">Install and Configure HAProxy</a></li></ul></li><li><a href="/hpe-solutions-openshift/46-synergy/Solution-Deployment/Bootstrap-node.html" class="sidebar-link">Bootstrap node</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Solution-Deployment/Physical-node-configuration.html" class="sidebar-link">Physical node configuration</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Solution-Deployment/Virtual-node-configuration.html" class="sidebar-link">Virtual node configuration</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Solution-Deployment/OCP-Cluster-deployment.html" class="sidebar-link">Red Hat OpenShift Container Platform Cluster deployment</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Solution-Deployment/worker-nodes.html" class="sidebar-link">Red Hat OCP worker nodes</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Solution-Deployment/Deploying-OCP-on-VMware-vSphere.html" class="sidebar-link">Deploying OpenShift Container Platform 4.6 on VMware vSphere</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Additional Features and Functionality</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Resosurces and Additional Links</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="load-balancer"><a href="#load-balancer" class="header-anchor">#</a> Load Balancer</h1> <p>Red Hat OpenShift Container Platform 4.6 uses an external load balancer to communicate from outside the cluster with services running inside the cluster. This section assumes that there is a load balancer available within the deployment environment and is available for use. This solution was developed using <strong>HA Proxy</strong>, an open source solution with one (1) virtual machine for load balancing functionality.</p> <p>This section covers its configuration. In a production environment, Hewlett Packard Enterprise recommends the use of enterprise load balancing such as F5 Networks Big-IP and its associated products.</p> <h2 id="install-and-configure-haproxy"><a href="#install-and-configure-haproxy" class="header-anchor">#</a> Install and Configure HAProxy</h2> <p>This section covers configuring HAProxy using ansible playbook.</p> <h3 id="procedure"><a href="#procedure" class="header-anchor">#</a> Procedure</h3> <ol><li><p>Copy the ssh keys from installer machine to HAProxy machine by running following command</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ssh-copy-id root@haproxy_machine_ip
</code></pre></div></li> <li><p>Navigate to <code>$BASE_DIR/haproxy</code></p></li> <li><p>Update hosts file with bootstrap, master and worker details.</p></li></ol> <div class="language-yaml extra-class"><pre class="language-yaml"><code>   <span class="token comment">#change your fqdn names as per your environment</span>
   <span class="token punctuation">[</span>lb<span class="token punctuation">]</span>
   lb01 ansible_host=20.x.x.x ansible_user=&lt;installermachine_username<span class="token punctuation">&gt;</span>
   
   <span class="token punctuation">[</span>boot<span class="token punctuation">]</span>
   ocpboot ansible_host=&lt;fqdn<span class="token punctuation">&gt;</span>
   <span class="token comment">#ex:- ocpboot.tennet.com</span>

   <span class="token punctuation">[</span>master<span class="token punctuation">]</span>
   ocpmaster1 ansible_host=&lt;fqdn<span class="token punctuation">&gt;</span>
   ocpmaster2 ansible_host=&lt;fqdn<span class="token punctuation">&gt;</span>
   ocpmaster3 ansible_host=&lt;fqdn<span class="token punctuation">&gt;</span>
   
   <span class="token comment">#ex:- ocpmaster.tennet.com</span>
   
   
   <span class="token punctuation">[</span>worker<span class="token punctuation">]</span>
   ocpworker1 ansible_host=&lt;fqdn<span class="token punctuation">&gt;</span>
   ocpworker2 ansible_host=&lt;fqdn<span class="token punctuation">&gt;</span>
   ocpworker3 ansible_host=&lt;fqdn<span class="token punctuation">&gt;</span>
  
   <span class="token comment">#ex:- ocpworker.tennet.com</span>

   <span class="token punctuation">[</span>cluster<span class="token punctuation">:</span>children<span class="token punctuation">]</span>
   lb
   boot
   master
   worker
</code></pre></div><ol start="4"><li>Execute the ansible playbook to configure HAProxy</li></ol> <div class="language- extra-class"><pre class="language-text"><code>&gt; ansible-playbook -i hosts haproxy.yaml
</code></pre></div><ol start="5"><li><p>The following entries are made in the haproxy.cfg file.</p> <p>Sample haproxy.cfg file</p></li></ol> <div class="language-yaml extra-class"><pre class="language-yaml"><code>    <span class="token comment">#---------------------------------------------------------------------</span>
    <span class="token comment"># static backend for serving up images, stylesheets and such</span>
    <span class="token comment">#---------------------------------------------------------------------</span>
    <span class="token comment">#backend static</span>
    <span class="token comment"># balance roundrobin</span>
    <span class="token comment"># server static 127.0.0.1:4331 check</span>
    <span class="token comment">#---------------------------------------------------------------------</span>
    <span class="token comment"># round robin balancing between the various backends</span>
    <span class="token comment">#---------------------------------------------------------------------</span>
    frontend ocp4<span class="token punctuation">-</span>kubernetes<span class="token punctuation">-</span>api<span class="token punctuation">-</span>server
        bind <span class="token important">*:</span><span class="token number">6443</span>
        default_backend ocp4<span class="token punctuation">-</span>kubernetes<span class="token punctuation">-</span>api<span class="token punctuation">-</span>server
        mode tcp
        option tcplog

    backend ocp4<span class="token punctuation">-</span>kubernetes<span class="token punctuation">-</span>api<span class="token punctuation">-</span>server
        mode tcp
        balance source
        server bootstrap bootstrap.ocp.pxelocal.local<span class="token punctuation">:</span>6443 check
        server master01 master01.ocp.pxelocal.local<span class="token punctuation">:</span>6443 check
        server master02 master02.ocp.pxelocal.local<span class="token punctuation">:</span>6443 check
        server master03 master03.ocp.pxelocal.local<span class="token punctuation">:</span>6443 check
    frontend ocp4<span class="token punctuation">-</span>machine<span class="token punctuation">-</span>config<span class="token punctuation">-</span>server68
        bind <span class="token important">*:</span><span class="token number">22623</span>
        default_backend ocp4<span class="token punctuation">-</span>machine<span class="token punctuation">-</span>config<span class="token punctuation">-</span>server
        mode tcp
        option tcplog

    backend ocp4<span class="token punctuation">-</span>machine<span class="token punctuation">-</span>config<span class="token punctuation">-</span>server
        balance source
        mode tcp
        server bootstrap bootstrap.ocp.pxelocal.local<span class="token punctuation">:</span>22623 check
        server master01 master01.ocp.pxelocal.local<span class="token punctuation">:</span>22623 check
        server master02 master02.ocp.pxelocal.local<span class="token punctuation">:</span>22623 check
        server master03 master03.ocp.pxelocal.local<span class="token punctuation">:</span>22623 check
    frontend ocp4<span class="token punctuation">-</span>router<span class="token punctuation">-</span>http
        bind <span class="token important">*:</span><span class="token number">80</span>
        default_backend ocp4<span class="token punctuation">-</span>router<span class="token punctuation">-</span>http
        mode tcp
        option tcplog

    backend ocp4<span class="token punctuation">-</span>router<span class="token punctuation">-</span>http
        balance source
        mode tcp
        server worker03 worker03.ocp.pxelocal.local<span class="token punctuation">:</span>80 check
        server worker04 worker04.ocp.pxelocal.local<span class="token punctuation">:</span>80 check
        server worker01 worker01.ocp.pxelocal.local<span class="token punctuation">:</span>80 check
        server worker02 worker02.ocp.pxelocal.local<span class="token punctuation">:</span>80 check

    <span class="token comment"># if creating a cluster with only master nodes to begin with and later adding the worker nodes, master nodes should be added in this section instead of worker nodes. Once all the worker nodes are added into the cluster, this configuration needs to be updated with the worker nodes.</span>
        <span class="token comment"># server master01 master01.ocp.pxelocal.local:80 check</span>
        <span class="token comment"># server master02 master02.ocp.pxelocal.local:80 check</span>
        <span class="token comment"># server master03 master03.ocp.pxelocal.local:80 check</span>
    frontend ocp4<span class="token punctuation">-</span>router<span class="token punctuation">-</span>https
        bind <span class="token important">*:</span><span class="token number">443</span>
        default_backend ocp4<span class="token punctuation">-</span>router<span class="token punctuation">-</span>https
        mode tcp
        option tcplog

        backend ocp4<span class="token punctuation">-</span>router<span class="token punctuation">-</span>https
            balance source
            mode tcp
            server worker03 worker03.ocp.pxelocal.local<span class="token punctuation">:</span>443 check
            server worker04 worker04.ocp.pxelocal.local<span class="token punctuation">:</span>443 check
            server worker01 worker01.ocp.pxelocal.local<span class="token punctuation">:</span>443 check
            server worker01 worker02.ocp.pxelocal.local<span class="token punctuation">:</span>443 check

    <span class="token comment"># if creating a cluster with only master nodes to begin with and later adding the worker nodes, master nodes should be added in this section instead of worker nodes. Once all the worker nodes are added into the cluster, this configuration needs to be updated with the worker nodes.</span>
        <span class="token comment"># server master01 master01.ocp.pxelocal.local:443 check</span>
        <span class="token comment"># server master02 master02.ocp.pxelocal.local:443 check</span>
        <span class="token comment"># server master03 master03.ocp.pxelocal.local:443 check</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>The load balancer configuration should contain values that are aligned
to the installation environment.</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-openshift/46-synergy/Solution-Deployment/User-provisioned-DNS-requirements.html" class="prev">
        User-provisioned DNS requirements
      </a></span> <span class="next"><a href="/hpe-solutions-openshift/46-synergy/Solution-Deployment/Bootstrap-node.html">
        Bootstrap node
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-openshift/46-synergy/assets/js/app.8d09024b.js" defer></script><script src="/hpe-solutions-openshift/46-synergy/assets/js/2.117ef8fd.js" defer></script><script src="/hpe-solutions-openshift/46-synergy/assets/js/32.4d1ff1fb.js" defer></script>
  </body>
</html>
