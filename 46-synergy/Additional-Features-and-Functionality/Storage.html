<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Storage Option | OpenShift Container Platform 4.6 on Synergy</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Hewlett Packard Enterprise">
    
    <link rel="preload" href="/hpe-solutions-openshift/46-synergy/assets/css/0.styles.55697aca.css" as="style"><link rel="preload" href="/hpe-solutions-openshift/46-synergy/assets/js/app.85d70ec5.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/46-synergy/assets/js/2.fa142977.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/46-synergy/assets/js/3.21f3bfd2.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/10.08281fa0.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/11.62169700.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/12.a384883b.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/13.14b1c483.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/14.e2ed2b94.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/15.6b7b2986.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/16.2812ef60.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/17.1e86af0b.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/18.1b39e9d9.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/19.73feff90.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/20.c807ba2f.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/21.ea4d33a2.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/22.be8f0d0d.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/23.7bab011f.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/24.c8c1d21d.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/25.60976ff9.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/26.31b8fa12.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/27.479e0913.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/28.9f8648b2.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/29.36b22707.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/30.b6d944bc.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/31.eac5b504.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/32.f5577221.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/33.b81dadd0.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/34.1418d906.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/35.df4061e1.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/36.ae0cc03f.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/37.29980f90.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/4.4a1835ae.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/5.5a3beac7.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/6.eee306da.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/7.2bd79bc4.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/8.49e62253.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/9.4b7c9b75.js">
    <link rel="stylesheet" href="/hpe-solutions-openshift/46-synergy/assets/css/0.styles.55697aca.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-openshift/46-synergy/" class="home-link router-link-active"><!----> <span class="site-name">OpenShift Container Platform 4.6 on Synergy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-openshift/46-synergy/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-openshift/46-synergy/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Red Hat OpenShift Container Platform 4.6 on HPE Synergy</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Deployment</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Additional Features and Functionality</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Storage.html" aria-current="page" class="active sidebar-link">Storage Option</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Storage.html#csi-driver-architecture" class="sidebar-link">CSI Driver Architecture</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Storage.html#configuring-csi-driver" class="sidebar-link">Configuring CSI Driver</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Storage.html#configuring-iscsi-interface-on-worker-nodes" class="sidebar-link">Configuring iSCSI interface on worker nodes</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Storage.html#installing-red-hat-hpe-csi-driver-operator-using-the-operator-hub" class="sidebar-link">Installing Red Hat HPE CSI Driver Operator using the Operator Hub</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Storage.html#deploying-openshift-container-storage" class="sidebar-link">Deploying Openshift Container Storage</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Storage.html#validating-ocs-with-deploying-wordpress-application" class="sidebar-link">Validating OCS with deploying WordPress application</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Storage.html#deploying-openshift-container-storage-with-vmware-vsphere" class="sidebar-link">Deploying OpenShift Container Storage with VMware vSphere</a></li></ul></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/IPI-Installation.html" class="sidebar-link">IPI deployment of OCP on Bare Metal</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Air-gap-Installation.html" class="sidebar-link">Red Hat OpenShift Container Platform installation in the restricted network environment</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/OpenShift-operators.html" class="sidebar-link">OpenShift operators</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Integration-with-Prometheus.html" class="sidebar-link">Integration of HPE OneView with Prometheus</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Sysdig-Secure.html" class="sidebar-link">Securing Red Hat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Physical-worker-node-labeling.html" class="sidebar-link">Physical worker node labeling in Red Hat OpenShift cluster</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Advanced-Cluster-Management.html" class="sidebar-link">Red Hat Advanced Cluster Management for Kubernetes</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Install-and-Configure-Velero.html" class="sidebar-link">Install and Configure Velero</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Ceph-Storage-Setup-ExternalMode.html" class="sidebar-link">Red Hat Ceph Storage 4 Setup in External mode with OCS Integration</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Openshift-Virtualization.html" class="sidebar-link">OpenShift Virtualization</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Validating-OCP-Deployment.html" class="sidebar-link">Validating OpenShift Container Platform deployment</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Resosurces and Additional Links</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="storage-option"><a href="#storage-option" class="header-anchor">#</a> Storage Option</h1> <h2 id="csi-driver-architecture"><a href="#csi-driver-architecture" class="header-anchor">#</a> CSI Driver Architecture</h2> <p>A diagrammatic representation of the CSI driver architecture is
illustrated in the figure 39.</p> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure39.19f92912.png" alt=""></p> <p><strong>Figure 39.</strong> CSI Driver Architecture</p> <p>The OpenShift Container Platform 4.6 cluster comprises the master and
worker nodes (physical and virtual) with CoreOS deployed as the
operating system. The iSCSI interface configured on the host nodes
establishes the connection with the HPE 3PAR array to the cluster. Upon
successful deployment of CSI Driver, the CSI controller, CSI Driver, and
3PAR CSP gets deployed which communicates with the HPE 3PAR array via
REST APIs. The associated features on Storage Class such as CSI
Provisioner, CSI Attacher, and others are configured on the Storage
Class.</p> <h2 id="configuring-csi-driver"><a href="#configuring-csi-driver" class="header-anchor">#</a> Configuring CSI Driver</h2> <p>Prior to configuring the HPE CSI driver, the following prerequisites
needs to be met.</p> <div class="custom-block warning"><p class="custom-block-title">PREREQUISITES</p> <ol><li>OpenShift Container Platform 4.6 must be successfully deployed and
console should be accessible.</li> <li>iSCSI interface should be configured for HPE 3PAR Storage on Host
server.</li> <li>Additional iSCSI network interfaces must be configured on worker
nodes (physical and virtual).</li> <li>Deploy scc.yaml file to enable Security Context Constraints (SCC).</li></ol></div> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>To get access to the host ports, host network, and to mount the
host path volume, the HPE CSI Driver needs to be run in privileged mode.
Prior to deployment of the CSI operator on OpenShift, createSCC to allow
CSI driver to run with these privileges. Download SCC yaml file from
GitHub
<a href="https://raw.githubusercontent.com/hpe-storage/co-deployments/master/operators/hpe-csi-operator/deploy/scc.yaml" target="_blank" rel="noopener noreferrer">https://raw.githubusercontent.com/hpe-storage/co-deployments/master/operators/hpe-csi-operator/deploy/scc.yaml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
and update relevant fields such as project or namespace before running
the yaml to deploy SCC.</p></div> <h2 id="configuring-iscsi-interface-on-worker-nodes"><a href="#configuring-iscsi-interface-on-worker-nodes" class="header-anchor">#</a> Configuring iSCSI interface on worker nodes</h2> <p>Additional iSCSI interface needs to be configured on all the worker
nodes (physical and virtual) for establishing the connection between the
OCP cluster and HPE 3PAR array. iSCSI_A and iSCSI_B interfaces needs to
be configured on the worker nodes for redundancy. Follow the steps as
listed to configure the additional interface.</p> <ol><li><p>Create interface configuration files (ifcfg files) on each of the
worker nodes by specifying the following parameters.</p> <p>HWADDR=52:4D:1F:20:01:94 (MAC address of the iSCSI connector)
TYPE=Ethernet
BOOTPROTO=none
IPADDR=40.0.17.221
PREFIX=16
DNS1= 20.1.1.254
ONBOOT=yes</p></li> <li><p>Reboot the worker nodes after configuring the ifcfg files. The 3PAR
Discovery IP should be pingable.</p></li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure40.12b16f4e.png" alt=""></p> <p>For virtual worker nodes, additional network adapters are added and the
corresponding network port groups are selected.</p> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure41.ecbe5310.png" alt=""></p> <h3 id="iscsi-interface-for-physical-worker-nodes"><a href="#iscsi-interface-for-physical-worker-nodes" class="header-anchor">#</a> iSCSI Interface for physical worker nodes</h3> <p>For physical worker nodes, the server profile is configured with iSCSI_A
connection for storage interface and additional iSCSI_B connection is
added to the server profile for redundancy.</p> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure42.bfd964a6.png" alt=""></p> <h3 id="steps-to-deploy-scc"><a href="#steps-to-deploy-scc" class="header-anchor">#</a> Steps to deploy SCC</h3> <p>The following figure shows the parameters that needs to be edited
(project name) where the CSI Operator is being deployed.</p> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure43.d8db9e10.png" alt=""></p> <ol><li>From the Installer vm, download the scc.yaml file from GitHub from
the following path.<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">curl</span> -sL https://raw.githubusercontent.com/hpe-storage/co-deployments/master/operators/hpe-csi-operator/deploy/scc.yaml <span class="token operator">&gt;</span> hpe-csi-scc.yaml
</code></pre></div></li> <li>Edit relevant parameters such as Project name and save the file.</li> <li>Deploy SCC and check the output<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc create -f hpe-csi-scc.yaml
</code></pre></div>Output:<div class="language- extra-class"><pre class="language-text"><code>securitycontextconstraints.security.openshift.io/hpe-csi-scc created
</code></pre></div></li></ol> <h3 id="installing-hpe-csi-driver-on-an-existing-red-hat-openshift-container-platform"><a href="#installing-hpe-csi-driver-on-an-existing-red-hat-openshift-container-platform" class="header-anchor">#</a> Installing HPE CSI Driver on an existing Red Hat OpenShift Container Platform</h3> <h3 id="creating-namespace"><a href="#creating-namespace" class="header-anchor">#</a> Creating Namespace</h3> <p>Before installing the CSI Driver from the OpenShift console, create a
namespace called HPE-CSI Driver. Perform the following steps to create a
Namespace.</p> <ol><li>Click Administration → Namespaces in the left pane of the
Console.</li> <li>Click Create Namespaces.</li> <li>In the Create Namespace dialog
box -&gt; enter HPE- CSI.</li> <li>Click Create.</li></ol> <h2 id="installing-red-hat-hpe-csi-driver-operator-using-the-operator-hub"><a href="#installing-red-hat-hpe-csi-driver-operator-using-the-operator-hub" class="header-anchor">#</a> Installing Red Hat HPE CSI Driver Operator using the Operator Hub</h2> <h3 id="installing-hpe-csi-driver-operator"><a href="#installing-hpe-csi-driver-operator" class="header-anchor">#</a> Installing HPE CSI Driver Operator</h3> <ol><li>Login to the Red Hat OpenShift Container Platform Web Console.</li> <li>Click Operators → Operator Hub.</li> <li>Search for HPE CSI Driver Operator from the list of operators and
click HPE CSI Driver operator.</li> <li>On the HPE-CSI Operator page, click Install.</li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure44.fc7954a8.png" alt=""></p> <ol start="5"><li>On the Create Operator Subscription page, the Installation Mode,
Update Channel and Approval Strategy options are available.</li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure45.c9ee1bd1.png" alt=""></p> <ol start="6"><li>Select an Approval Strategy. The available options are:</li> <li>Automatic: Specifies that the OpenShift Container Platform is
required to upgrade HPE CSI Storage automatically. Select the
Automatic option.</li> <li>Manual: Specifies that you need to upgrade to OpenShift Container
Platform manually.</li> <li>Click <strong>Subscribe</strong>.</li> <li>The Installed Operators page is displayed with the status of the
operator as shown.</li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure46.11599df9.png" alt=""></p> <h3 id="creating-hpe-csi-driver"><a href="#creating-hpe-csi-driver" class="header-anchor">#</a> Creating HPE CSI driver</h3> <p>The HPE CSI Driver allows any vendor or project to develop its own
Container Storage Provider by using the <a href="https://developer.hpe.com/api/hpe-nimble-csp/" target="_blank" rel="noopener noreferrer">CSP
specification<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. This
makes it very easy for third- parties to integrate their storage
solution into Kubernetes as all the intricacies are taken care of by the
HPE CSI Driver.</p> <p>To create HPE CSI driver, perform the following steps.</p> <ol><li><p>Click Operators → Installed Operators from the left pane of the
OpenShift Web Console to view the installed operators.</p></li> <li><p>On the Installed Operator page, select HPE CSI Driver from the
Project drop down list to switch to the HPE-CSI project</p></li> <li><p>Click HPE CSI Driver.</p></li> <li><p>On the HPE CSI Driver Operator page, scroll right and click the HPE
CSI Driver yaml file.</p></li> <li><p>Edit the HPE CSI Driver yaml file with required values like backend
(3PAR array IP), password and username as shown.</p></li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure47.7a078e15.png" alt=""></p> <ol start="6"><li>On the HPE CSI Driver Operator page, scroll right and click the
HPECSI Driver tab as shown.
<img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure48.56d835f4.png" alt=""></li></ol> <h3 id="verifying-creation-of-hpe-csi-driver"><a href="#verifying-creation-of-hpe-csi-driver" class="header-anchor">#</a> Verifying creation of HPE CSI Driver</h3> <p>After the HPECSI Driver is deployed, one can see the associated
deployment pods being created such as hpe-csi-controller,
hpe-csi-driver, and primera3par-csp.</p> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure49.152075a7.png" alt=""></p> <p>To verify the HPE CSI Node Info, perform the following steps.</p> <p>Run the following command from the Installer VM to check HPENodeinfo
and network status of worker nodes.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get HPENodeInfo
<span class="token operator">&gt;</span> oc get HPENodeInfo/<span class="token operator">&lt;</span>workernode fqdn <span class="token operator">&gt;</span> -o yaml
</code></pre></div><p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure50.5c578a51.png" alt=""></p> <h3 id="hpe-csi-driver-storage-installation"><a href="#hpe-csi-driver-storage-installation" class="header-anchor">#</a> HPE CSI Driver Storage installation</h3> <p>After installing HPE CSI Driver, Storage Class is created manually.</p> <ol><li>From the OpenShift console navigate to Storage -&gt; Storage Class</li> <li>Click Create Storage Class -&gt; Click Edit yaml -&gt; insert the parameters
for SC creation -&gt; Click Create.</li> <li>'hpe-standard' storage class is
created as shown.</li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure51.cfe6102e.png" alt=""></p> <p>Run the following command on the CLI to tag the storage class default-
storage class by :</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc annotate storageclass hpe-standard storageclass.kubernetes.io/is-default-class<span class="token operator">=</span>true
</code></pre></div><p>The create Storage Class yaml file parameters are as follows:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> storage.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> StorageClass
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> hpe<span class="token punctuation">-</span>standard
<span class="token key atrule">provisioner</span><span class="token punctuation">:</span> csi.hpe.com
<span class="token key atrule">parameters</span><span class="token punctuation">:</span>
  <span class="token key atrule">csi.storage.k8s.io/fstype</span><span class="token punctuation">:</span> ext4
  <span class="token key atrule">csi.storage.k8s.io/controller-expand-secret-name</span><span class="token punctuation">:</span> primera3par<span class="token punctuation">-</span>secret
  <span class="token key atrule">csi.storage.k8s.io/controller-expand-secret-namespace</span><span class="token punctuation">:</span> hpe<span class="token punctuation">-</span>csi
  <span class="token key atrule">csi.storage.k8s.io/controller-publish-secret-name</span><span class="token punctuation">:</span> primera3par<span class="token punctuation">-</span>secret
  <span class="token key atrule">csi.storage.k8s.io/controller-publish-secret-namespace</span><span class="token punctuation">:</span> hpe<span class="token punctuation">-</span>csi
  <span class="token key atrule">csi.storage.k8s.io/node-publish-secret-name</span><span class="token punctuation">:</span> primera3par<span class="token punctuation">-</span>secret
  <span class="token key atrule">csi.storage.k8s.io/node-publish-secret-namespace</span><span class="token punctuation">:</span> hpe<span class="token punctuation">-</span>csi
  <span class="token key atrule">csi.storage.k8s.io/node-stage-secret-name</span><span class="token punctuation">:</span> primera3par<span class="token punctuation">-</span>secret
  <span class="token key atrule">csi.storage.k8s.io/node-stage-secret-namespace</span><span class="token punctuation">:</span> hpe<span class="token punctuation">-</span>csi
  <span class="token key atrule">csi.storage.k8s.io/provisioner-secret-name</span><span class="token punctuation">:</span> primera3par<span class="token punctuation">-</span>secret
  <span class="token key atrule">csi.storage.k8s.io/provisioner-secret-namespace</span><span class="token punctuation">:</span> hpe<span class="token punctuation">-</span>csi
  <span class="token key atrule">cpg</span><span class="token punctuation">:</span> SSD_r6 
  <span class="token key atrule">provisioning_type</span><span class="token punctuation">:</span> tpvv
  <span class="token key atrule">accessProtocol</span><span class="token punctuation">:</span> iscsi
<span class="token key atrule">reclaimPolicy</span><span class="token punctuation">:</span> Delete
<span class="token key atrule">allowVolumeExpansion</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>From the worker node, ssh to the 3PAR array to check on the cpg
values for Storage Class creation as shown.</p> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure52.266439d0.png" alt=""></p></div> <h3 id="sample-application-deployment"><a href="#sample-application-deployment" class="header-anchor">#</a> Sample application deployment</h3> <p>A sample application deployed on the existing Red Hat OpenShift
Container Platform utilizes the volume from 3PAR array through HPE CSI
Driver. A sample application such as mongodb or mariadb is deployed and
scheduled on the worker nodes. Follow the steps to deploy a sample
application.</p> <ol><li>Run the following command to deploy a sample application.<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc new-app mongodb-persistent
</code></pre></div></li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure53.f73b8bff.png" alt=""></p> <ol start="2"><li>Check the status of PVC and Pod.</li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure54.a4f3c538.png" alt=""></p> <p>List of pods created on the cluster along with the one for sample
application deployed is shown.</p> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure55.834a5095.png" alt=""></p> <p>PVC for the sample application deployed is created and bound. This can
be verified in the OpenShift Console by navigating to Storage -&gt;
Persistent Volume Claim section.</p> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure56.0907656c.png" alt=""></p> <h3 id="verification-of-persistent-volume-claim-on-3par-array"><a href="#verification-of-persistent-volume-claim-on-3par-array" class="header-anchor">#</a> Verification of Persistent Volume Claim on 3PAR array</h3> <p>The PVC created for the sample application deployed (mongodb) can be
verified on the 3PAR array by searching for the PVC id seen on the
console or on the CLI.</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>The PVC ID is not completely seen on 3PAR console as it gets
truncated beyond 30 characters.</p></div> <p>Steps to verify the PVC on 3PAR array:</p> <ol><li>Login to the 3PAR SSMC URL at
https://10.0.20.19:8443/#/login with appropriate credentials.</li> <li>Navigate from the drop- down menu option on 3PAR StoreServ -&gt; Virtual
volumes</li> <li>The volume for the PVC created can be seen under the list of
virtual volume as shown.</li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure57.a50d99fc.png" alt=""></p> <h3 id="openshift-persistent-volume-expansion"><a href="#openshift-persistent-volume-expansion" class="header-anchor">#</a> OpenShift Persistent Volume Expansion</h3> <p>The volume of the sample application deployed can be expanded by
specifying the volume size on the OpenShift console. The steps for PVC
expansion are as follows.</p> <ol><li>On the OpenShift web console navigate to Storage -&gt; Persistent
Volume Claims -&gt; select a specific pod -&gt; click on the dots seen
towards the right side -&gt; select 'Expand PVC'</li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure58.1d48a62e.png" alt=""></p> <ol start="2"><li>Change the volume size from 1Gi to 3Gi and click Expand button as
shown.</li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure59.8a0ee51b.png" alt=""></p> <ol start="3"><li>Now, you can see PVC and PV has been resized to 3 GB.</li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure60.d5eafcde.png" alt=""></p> <h3 id="csi-driver"><a href="#csi-driver" class="header-anchor">#</a> CSI Driver</h3> <p>CSI was developed as a standard for exposing block and file storage
systems to containerized workloads on Container Orchestrator Systems
(COS) like Kubernetes. Container Storage Interface (CSI) is an
initiative to unify the storage interface of COS combined with storage
vendors. This means, implementing a single CSI for a storage vendor is
guaranteed to work with all COS. With the introduction of CSI, there is
a clear benefit for the COS and storage vendors. Due to its well-defined
interfaces, it also helps developers and future COS to easily implement
and test CSI. Volume plugins served the storage needs for container
workloads in case of Kubernetes, before CSI existed. The HPE CSI Driver
is a multi-vendor and multi-backend driver where each implementation has
a Container Storage Provider (CSP). The HPE CSI Driver for Kubernetes
uses CSP to perform data management operations on storage resources such
as searching for a logical unit number (lun) and so on. Using the CSP
specification, the HPE CSI Driver allows any vendor or project to
develop its own CSP, which makes it very easy for third- parties to
integrate their storage solution into Kubernetes as all the intricacies
are taken care of by the HPE CSI Driver.</p> <p>This document contains details on how to configure a HPE CSI Driver
storage for 3PAR on an existing Red Hat OpenShift Container Platform
4.6.</p> <h3 id="deploying-hpe-csi-driver-nimble-storage-on-ocp-4-6"><a href="#deploying-hpe-csi-driver-nimble-storage-on-ocp-4-6" class="header-anchor">#</a> Deploying HPE CSI Driver Nimble Storage on OCP 4.6</h3> <h3 id="configuring-iscsi-interface-on-worker-nodes-2"><a href="#configuring-iscsi-interface-on-worker-nodes-2" class="header-anchor">#</a> Configuring iSCSI interface on worker nodes</h3> <p>Additional iSCSI interface needs to be configured on all the worker
nodes (physical and virtual) for establishing the connection between the
OCP cluster and HPE Nimble array. iSCSI_A and iSCSI_B interfaces needs
to be configured on the worker nodes for redundancy. Follow the steps
as- listed to configure the additional interface. 1. Create interface
configuration files (ifcfg files) on each of the worker nodes by
specifying the following parameters.</p> <div class="language- extra-class"><pre class="language-text"><code>HWADDR=52:4D:1F:20:01:94 (MAC address of the iSCSI connector)
TYPE=Ethernet
BOOTPROTO=none
IPADDR=40.0.17.221 
PREFIX=16
DNS1= 20.1.1.254
ONBOOT=yes
</code></pre></div><ol><li>Reboot the worker nodes after configuring the ifcfg files. The
Nimble Discovery IP should be pingable.</li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure61.b466b145.png" alt=""></p> <p>For virtual worker nodes, additional Network adapters are added and the
corresponding network port groups are selected.</p> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure62.2b2b417c.png" alt=""></p> <h3 id="iscsi-interface-for-physical-worker-nodes-2"><a href="#iscsi-interface-for-physical-worker-nodes-2" class="header-anchor">#</a> iSCSI Interface for Physical worker nodes</h3> <p>For Physical worker nodes, the server profile is configured with iSCSI_A
connection for storage interface and additional iSCSI_B connection is
added to the server profile for redundancy.</p> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure63.3a6e6b9e.png" alt=""></p> <h3 id="openshift-persistent-volume-expansion-2"><a href="#openshift-persistent-volume-expansion-2" class="header-anchor">#</a> OpenShift Persistent Volume Expansion</h3> <p>The volume of the sample application deployed can be expanded by
specifying the volume size on the OpenShift console. The steps for PVC
expansion is listed as follows.</p> <ol><li>On the OpenShift web console navigate to Storage -&gt; Persistent
Volume Claims -&gt; select a specific pod -&gt; click on the dots seen
towards the right side -&gt; select 'Expand PVC'</li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure64.1d48a62e.png" alt=""></p> <ol start="2"><li>Change the volume size from 1Gi to 3Gi and click Expand button.</li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure65.8a0ee51b.png" alt=""></p> <ol start="3"><li>Now you can see PVC and PV has been resized to 3 GB.</li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure66.d5eafcde.png" alt=""></p> <h2 id="deploying-openshift-container-storage"><a href="#deploying-openshift-container-storage" class="header-anchor">#</a> Deploying Openshift Container Storage</h2> <p>This section covers deploying OpenShift Container Storage 4.5 on
existing Red Hat OpenShift Container Platform 4.6 worker nodes.</p> <p>The OpenShift Container Storage operator installation will be using
Local Storage operator which will use file system storage of 10GB for
monitoring purpose and block storage of 500GB/2TB for OSD (Object
Storage Daemon) volumes. These OSD are useful for configuring any
application on top of OCP cluster using OCS configuration.</p> <p>The below operators are required to create OCS cluster and deployed
through automation fashion.</p> <ul><li><p>Local Storage Operator</p></li> <li><p>OpenShift Container Storage Operator</p></li></ul> <h3 id="flow-diagram"><a href="#flow-diagram" class="header-anchor">#</a> Flow Diagram</h3> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure67.81798d1f.png" alt=""></p> <p><strong>Figure 67.</strong> Openshift Container Storage Solution Flow Diagram</p> <h3 id="configuration-requirements"><a href="#configuration-requirements" class="header-anchor">#</a> Configuration requirements</h3> <p>The below table shows about all required worker node configuration.</p> <table><thead><tr><th><strong>Server Role</strong></th> <th><strong>CPU</strong></th> <th><strong>RAM</strong></th> <th><strong>HardDisk1</strong></th> <th><strong>HardDiak2</strong></th> <th><strong>HardDisk3</strong></th></tr></thead> <tbody><tr><td>Worker</td> <td>16</td> <td>64</td> <td>120 GB</td> <td>10 GB</td> <td>500 GB/2 TB</td></tr></tbody></table> <div class="custom-block warning"><p class="custom-block-title">PREREQUISITES</p> <ol><li><p>Red Hat OpenShift Container Platform 4.6 cluster console is required
with the login credentials.</p></li> <li><p>Availability of any local storage from any storage (i.e Nimble,3PAR,
Local Storage) in OpenShift Container Platform.</p></li> <li><p>OCS installation on OCP 4.6 cluster requires a minimum of 3 worker
nodes but OCS should have exact 3 worker nodes which use two more
hard disks with 10GB for mon POD (3 in total using always a PVC) +
500GB (or more than 500GB) volume (a PVC using the default
&quot;<strong>thin</strong>&quot; storage class) for the OSD volumes. It also requires 16
CPUs and 64GB RAM for each node and worker node hard disk
configuration as shown in above figure.</p></li></ol></div> <h3 id="scripts-for-deploying-ocs-cluster"><a href="#scripts-for-deploying-ocs-cluster" class="header-anchor">#</a> Scripts for deploying OCS cluster</h3> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>BASE_DIR - is a base directory path for all automated scripts
directories are in place and path is
/opt/hpe/solutions/ocp/hpe-solutions-openshift/synergy/scalable</p></div> <p>This section provides details on the scripts developed to automate the
installation of OCS operator on the OCP cluster. The scripts used to
deploy OCS can be found in the installer VM at
<em>$BASE_DIR/ocs_installation</em>.</p> <ol><li><p><strong>install_ocs_operator.py</strong> - main python script which installs
Local Storage operator, OpenShift Container Storage operators,
creates file system &amp; block storage and also creates SCs, PVs, PVCs.</p></li> <li><p><strong>config.py</strong> - This python script is used to convert user input
values into program variables for usage by the
install_ocs_operator.py script.</p></li> <li><p><strong>userinput.json</strong> - The userinput.json file needs to be modified as
per user configuration and requirements for installing and scaling
OCS cluster.</p></li> <li><p><strong>config_secrets.json</strong> -- This encrypted file has OCP cluster login
credentials and user needs to provide credentials to this file using
'ansible-vault' command.</p></li> <li><p><strong>create_local_storage_operator.yaml</strong> -- Creates Local Storage
operator's Namespace, installs Local Storage operator.</p></li> <li><p><strong>local_storage_fs.yaml</strong> -- Creates file system storage for
monitoring OCS cluster.</p></li> <li><p><strong>local_storage_block.yaml</strong> -- Creates block storage for claiming
OSD persistent volumes.</p></li> <li><p><strong>ocs_operator.yaml</strong> -- This playbook creates OpenShift Container
Storage Namespace, block storage for bounding PVC to Storage Class.</p></li> <li><p><strong>storage_ocs.yaml</strong> -- This playbook creates storage classes, PVCs,
pods to bring up the OCS cluster.</p></li> <li><p><strong>scaling_ocs_operator.py -</strong> This python script is used to scale
OCS cluster by expanding OCS storage with 3 more worker nodes.</p></li></ol> <h3 id="installing-openshift-container-storage-on-openshift-container-platform"><a href="#installing-openshift-container-storage-on-openshift-container-platform" class="header-anchor">#</a> Installing OpenShift Container Storage on OpenShift Container Platform</h3> <ol><li><p>Login to the installer machine as non-root user and browse to python
virtual environment as per DG.</p></li> <li><p>Update the <em>config_secrets.json</em> file found at
<em>$BASE_DIR/ocs_installation</em> using 'ansible-vault' command as
shown below:</p> <p>The below command is used to open encrypted file config_secrets.json</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ansible-vault edit config_secrets.json
</code></pre></div><div class="language-json extra-class"><pre class="language-json"><code># OPENSHIFT_USERNAME<span class="token operator">:</span> &lt;OpenShift Container Platform cluster
username&gt;
# OPENSHIFT_PASSWORD<span class="token operator">:</span> &lt;OpenShift Container Platform cluster
password&gt;
</code></pre></div></li> <li><p>Update the <em>userinput.json</em> file is found at
<em>$BASE_DIR/ocs_installation</em> with the following setup configuration
details:</p> <div class="language-json extra-class"><pre class="language-json"><code># <span class="token property">&quot;OPENSHIFT_DOMAIN&quot;</span><span class="token operator">:</span> &quot;&lt;OpenShift Server sub domain fqdn
(api.domain.base_domain)&gt;&quot;<span class="token punctuation">,</span>

# <span class="token property">&quot;OPENSHIFT_PORT&quot;</span><span class="token operator">:</span> &quot;&lt;OpenShift Server port number (OpenShift
Container Platform runs on port <span class="token number">6443</span> by default)&gt;&quot;<span class="token punctuation">,</span>

# <span class="token property">&quot;LOCAL_STORAGE_NAMESPACE&quot;</span><span class="token operator">:</span> &quot;&lt;Local Storage Operator Namespace
(local-storage)&gt;&quot;<span class="token punctuation">,</span>

# <span class="token property">&quot;OPENSHIFT_CONTAINER_STORAGE_NAMESPACE&quot;</span><span class="token operator">:</span> &quot;&lt;OpenShift Container
Storage Operator Namespace (openshift-storage)&gt;&quot;<span class="token punctuation">,</span>

# <span class="token property">&quot;OPENSHIFT_CONTAINER_STORAGE_LOCAL_STORAGE_VERSION&quot;</span><span class="token operator">:</span>
<span class="token string">&quot;&lt;OCP_cluster_version&gt;&quot;</span><span class="token punctuation">,</span>

# <span class="token property">&quot;OPENSHIFT_CONTAINER_STORAGE_FILESYSTEM_STORAGE&quot;</span><span class="token operator">:</span> &quot;&lt;Provide 10GiB
worker node's drive for file system storage (Ex<span class="token operator">:</span> /dev/sdb)&gt;&quot; <span class="token punctuation">,</span>

# <span class="token property">&quot;OPENSHIFT_CONTAINER_STORAGE_BLOCK_STORAGE&quot;</span><span class="token operator">:</span> &quot;&lt;Provide 500Gi worker
node's drive for block storage (Ex<span class="token operator">:</span> /dev/sdc)&gt;&quot;<span class="token punctuation">,</span>

# <span class="token property">&quot;OPENSHIFT_CLIENT_PATH&quot;</span><span class="token operator">:</span> &quot;&lt;Provide oc absolute path ending with /
OR leave empty in case oc is available under /usr/local/bin&gt;&quot;<span class="token punctuation">,</span>

# <span class="token property">&quot;OPENSHIFT_CONTAINER_PLATFORM_WORKER_NODES&quot;</span><span class="token operator">:</span> &lt;Provide OCP worker
nodes fqdn list <span class="token punctuation">[</span><span class="token string">&quot;sworker1.fqdn&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sworker2.fqdn&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;worker3.fqdn&quot;</span><span class="token punctuation">]</span>&gt;<span class="token punctuation">,</span>

# <span class="token property">&quot;OPENSHIFT_CONTAINER_STORAGE_SCALING_WORKER_NODES&quot;</span><span class="token operator">:</span> &lt;Provide OCS
worker nodes fqdn list <span class="token punctuation">[</span><span class="token string">&quot;sworker4.fqdn&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;sworker5.fqdn&quot;</span><span class="token punctuation">,</span>
<span class="token string">&quot;sworker6.fqdn&quot;</span><span class="token punctuation">]</span>&gt;<span class="token punctuation">,</span>

# <span class="token property">&quot;OPENSHIFT_CONTAINER_STORAGE_BLOCK_VOLUME&quot;</span><span class="token operator">:</span> &quot;&lt;Provide
base/scale OCS worker node block storage<span class="token punctuation">,</span> should be in Gi/Ti (example
- 500Gi or 2Ti)&gt;&quot;
</code></pre></div></li> <li><p>Execute the following command to deploy OCS cluster.</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> <span class="token variable">$BASE_DIR</span>/ocs_installation
<span class="token operator">&gt;</span> python -W ignore install_ocs_operator.py
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>The output of the above command as shown below:
$ python -W ignore install_ocs_operator.py
Enter key for encrypted variables:
Logging into your OpenShift Cluster
Successfully logged into the OpenShift Cluster
Waiting for 1 minutes to 'Local Storage' operator to be available on
OCP web console..!!
'Local Storage' operator is created..!!
Waiting for 2 minutes to OCS operator to be available on OCP web
console..!!
'OpenShift Container Storage' operator is created..!!
INFO:
1) Run the below command to list all PODs and PVCs of OCS cluster.
'oc get pod,pvc -n openshift-storage'
2) Wait for 'pod/ocs-operator-xxxx' pod to be up and running.
3) Log into OCP web GUI and check Persistant Stoarge in dashboard.
$
</code></pre></div><h3 id="validation-of-the-openshift-container-storage-cluster"><a href="#validation-of-the-openshift-container-storage-cluster" class="header-anchor">#</a> Validation of the OpenShift Container Storage cluster</h3> <p>The required operators will be created after the execution of the script
and they will be reflected in the OpenShift console. This section
outlines the steps to verify the operators created through script and
are reflected in the GUI:</p> <ol><li><p>Login to the <strong>OpenShift Container Platform</strong> web console as the
user with administrative privileges.</p></li> <li><p>Navigate to <strong>Operators -&gt; Project (local-storage)</strong> -&gt;
<strong>Installed</strong> <strong>Operators</strong> select your project name.</p></li> <li><p>The Local Storage operator will be available in the OpenShift web
console as shown in below Figure.</p></li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure68.827a994b.png" alt=""></p> <ol start="4"><li><p>Navigate to <strong>Operators</strong> -&gt; <strong>Installed</strong> <strong>Operators</strong> select
your project name openshift-storage for OpenShift Container Storage
operator.</p></li> <li><p>The OpenShift Container Storage operator will be available on the
OpenShift Container Platformm web console as shown in below Figure.</p></li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure69.7aeb04d3.png" alt=""></p> <ol start="4"><li>SCs of OpenShift Container Storage operator on CLI as shown in
below.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get sc
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code> NAME PROVISIONER RECLAIMPOLICY VOLUMEBINDINGMODE ALLOWVOLUMEEXPANSION
 AGE

 local-sc kubernetes.io/no-provisioner Delete WaitForFirstConsumer
 false 45h

 localblock-sc kubernetes.io/no-provisioner Delete WaitForFirstConsumer
 false 45h

 ocs-storagecluster-ceph-rbd openshift-storage.rbd.csi.ceph.com Delete
 Immediate false 45h

 ocs-storagecluster-cephfs openshift-storage.cephfs.csi.ceph.com Delete
 Immediate false 45h

 openshift-storage.noobaa.io openshift-storage.noobaa.io/obc Delete
 Immediate false 45h
</code></pre></div><ol start="5"><li>PVs of OpenShift Container Storage operator on CLI as shown in
below.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get <span class="token function">pv</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code> NAME CAPACITY ACCESS MODES RECLAIM POLICY STATUS CLAIM STORAGECLASS
 REASON AGE

 local-pv-2febb788 500Gi RWO Delete Bound
 openshift-storage/ocs-deviceset-1-0-lhtvh localblock-sc 45h

 local-pv-5f19c0e5 10Gi RWO Delete Bound
 openshift-storage/rook-ceph-mon-b local-sc 45h

 local-pv-b73b1cd5 500Gi RWO Delete Bound
 openshift-storage/ocs-deviceset-2-0-jmmck localblock-sc 45h

 local-pv-b8ba8c38 10Gi RWO Delete Bound
 openshift-storage/rook-ceph-mon-a local-sc 45h

 local-pv-c3a372f6 10Gi RWO Delete Bound
 openshift-storage/rook-ceph-mon-c local-sc 45h

 local-pv-e5e3d596 500Gi RWO Delete Bound
 openshift-storage/ocs-deviceset-0-0-5jxg7 localblock-sc 45h

 pvc-8f3e3d8b-6be7-4ba8-8968-69cbc866c89f 50Gi RWO Delete Bound
 openshift-storage/db-noobaa-db-0 ocs-storagecluster-ceph-rbd 45h

</code></pre></div><ol start="6"><li>PVCs of OpenShift Container Storage operator on CLI as shown in
below.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get pvc -n openshift-storage
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code> NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE

 db-noobaa-db-0 Bound pvc-8f3e3d8b-6be7-4ba8-8968-69cbc866c89f 50Gi RWO
 ocs-storagecluster-ceph-rbd 45h

 ocs-deviceset-0-0-5jxg7 Bound local-pv-e5e3d596 500Gi RWO
 localblock-sc 45h

 ocs-deviceset-1-0-lhtvh Bound local-pv-2febb788 500Gi RWO
 localblock-sc 45h

 ocs-deviceset-2-0-jmmck Bound local-pv-b73b1cd5 500Gi RWO
 localblock-sc 45h

 rook-ceph-mon-a Bound local-pv-b8ba8c38 10Gi RWO local-sc 45h

 rook-ceph-mon-b Bound local-pv-5f19c0e5 10Gi RWO local-sc 45h

 rook-ceph-mon-c Bound local-pv-c3a372f6 10Gi RWO local-sc 45h

</code></pre></div><ol start="7"><li>PODs of OpenShift Container Storage operator on CLI as shown in
below.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get pod -n openshift-storage
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code> NAME READY STATUS RESTARTS AGE

 csi-cephfsplugin-6xpsk 3/3 Running 0 45h

 csi-cephfsplugin-7khm6 3/3 Running 0 17m

 csi-cephfsplugin-bb48n 3/3 Running 0 45h

 csi-cephfsplugin-cfzx6 3/3 Running 0 15m

 csi-cephfsplugin-provisioner-79587c64f9-2dpm6 5/5 Running 0 45h

 csi-cephfsplugin-provisioner-79587c64f9-hf46x 5/5 Running 0 45h

 csi-cephfsplugin-w6p6v 3/3 Running 0 45h

 csi-rbdplugin-2z686 3/3 Running 0 45h

 csi-rbdplugin-6tv5m 3/3 Running 0 45h

 csi-rbdplugin-jgf5z 3/3 Running 0 17m

 csi-rbdplugin-provisioner-5f495c4566-76rqm 5/5 Running 0 45h

 csi-rbdplugin-provisioner-5f495c4566-pzvww 5/5 Running 0 45h

 csi-rbdplugin-v7lfx 3/3 Running 0 45h

 csi-rbdplugin-ztdjs 3/3 Running 0 15m

 noobaa-core-0 1/1 Running 0 45h

 noobaa-db-0 1/1 Running 0 45h

 noobaa-endpoint-6458fc874f-vpznd 1/1 Running 0 45h

 noobaa-operator-7f4495fc6-lmk9k 1/1 Running 0 45h

 ocs-operator-5d664769f-59v8j 1/1 Running 0 45h

 rook-ceph-crashcollector-sworker1.socp.twentynet.local-84dddddb 1/1
 Running 0 45h

 rook-ceph-crashcollector-sworker2.socp.twentynet.local-8b5qzzsz 1/1
 Running 0 45h

 rook-ceph-crashcollector-sworker3.socp.twentynet.local-699n9kzp 1/1
 Running 0 45h

 rook-ceph-drain-canary-sworker1.socp.twentynet.local-85bffzm66m 1/1
 Running 0 45h

 rook-ceph-drain-canary-sworker2.socp.twentynet.local-66bcfjjfkr 1/1
 Running 0 45h

 rook-ceph-drain-canary-sworker3.socp.twentynet.local-5f6b57c9nt 1/1
 Running 0 45h

 rook-ceph-mds-ocs-storagecluster-cephfilesystem-a-67fbb67dkb4kz 1/1
 Running 0 45h

 rook-ceph-mds-ocs-storagecluster-cephfilesystem-b-db66df7dtqkmx 1/1
 Running 0 45h

 rook-ceph-mgr-a-6f5f7b58dc-fjvjc 1/1 Running 0 45h

 rook-ceph-mon-a-76cc49c944-5pcgf 1/1 Running 0 45h

 rook-ceph-mon-b-b9449cdd7-s6mct 1/1 Running 0 45h

 rook-ceph-mon-c-59d854cd8-gn6sd 1/1 Running 0 45h

 rook-ceph-operator-775cd6cd66-sdfph 1/1 Running 0 45h

 rook-ceph-osd-0-7644557bfb-9l7ns 1/1 Running 0 45h

 rook-ceph-osd-1-7694c74948-lc9sf 1/1 Running 0 45h

 rook-ceph-osd-2-794547558-wjcpz 1/1 Running 0 45h

 rook-ceph-osd-prepare-ocs-deviceset-0-0-5jxg7-t89zh 0/1 Completed 0
 45h

 rook-ceph-osd-prepare-ocs-deviceset-1-0-lhtvh-f2znl 0/1 Completed 0
 45h

 rook-ceph-osd-prepare-ocs-deviceset-2-0-jmmck-wsrb2 0/1 Completed 0
 45h

 rook-ceph-rgw-ocs-storagecluster-cephobjectstore-a-67b7865qx276 1/1
 Running 0 45h

</code></pre></div><ol start="8"><li>Storage capacity of OCS cluster with 3 worker nodes (3x500Gi) on OCP
web cluster as shown below figure.</li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure70.b8666296.png" alt=""></p> <h2 id="validating-ocs-with-deploying-wordpress-application"><a href="#validating-ocs-with-deploying-wordpress-application" class="header-anchor">#</a> Validating OCS with deploying WordPress application</h2> <p>This section covers the steps to validate the OpenShift Container
Storage deployment (OCS) by deploying 2-tier application along with
MySQL database.</p> <div class="custom-block warning"><p class="custom-block-title">PREREQUISITES</p> <ul><li><p>OCP 4.6 cluster must be installed.</p></li> <li><p>OCS to claim persistent volume (PV).</p></li></ul></div> <h3 id="deploying-wordpress-application"><a href="#deploying-wordpress-application" class="header-anchor">#</a> Deploying WordPress application</h3> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>BASE_DIR - is a base directory path for all automated scripts
directories are in place and path is
/opt/hpe/solutions/ocp/hpe-solutions-openshift/synergy/scalable</p></div> <ol><li><p>Login to the installer machine as a non-root user.</p></li> <li><p>From within the repository, navigate to the WordPress script folder</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> <span class="token variable">$BASE_DIR</span>/ocs_installation/wordpress
</code></pre></div><ol start="3"><li>Run below script to deploy Wordpress application along with MySQL</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ./deploy_wordpress.sh
</code></pre></div><p>The deploy_wordpress.sh scripts does the following activities.</p> <ul><li><p>Creates project</p></li> <li><p>Sets default storage class</p></li> <li><p>Deploys Wordpress and MySQL app</p></li> <li><p>Create routes</p></li></ul> <ol start="4"><li>Below is the output of the scripts</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ./deploy_wordpress.sh
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code> Already on project &quot;wordpress&quot; on server
 &quot;https://api.socp.twentynet.local:6443&quot;.

 You can add applications to this project with the 'new-app' command.
 For example, try:

 oc new-app ruby~https://github.com/sclorg/ruby-ex.git

 to build a new example application in Ruby. Or use kubectl to deploy a
 simple Kubernetes application:

 kubectl create deployment hello-node
 --image=gcr.io/hello-minikube-zero-install/hello-node

 Already on project &quot;wordpress&quot; on server
 &quot;https://api.socp.twentynet.local:6443&quot;.

 clusterrole.rbac.authorization.k8s.io/system:openshift:scc:anyuid
 added: &quot;default&quot;error: --overwrite is false but found the following
 declared annotation(s):
 'storageclass.kubernetes.io/is-default-class' already has a value
 (true)

 service/wordpress-http created

 service/wordpress-mysql created

 persistentvolumeclaim/mysql-pv-claim created

 persistentvolumeclaim/wp-pv-claim created

 secret/mysql-pass created

 deployment.apps/wordpress-mysql created

 deployment.apps/wordpress created

 route.route.openshift.io/wordpress-http created

 URL to access application

 wordpress-http-wordpress.apps.socp.twentynet.local

</code></pre></div><h3 id="verifying-the-wordpress-deployment"><a href="#verifying-the-wordpress-deployment" class="header-anchor">#</a> Verifying the WordPress deployment</h3> <ol><li>Execute the following command to verify the persistent volume
associated with WordPress application and MySQL database.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get pods,pvc,route -n wordpress
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code> NAME READY STATUS RESTARTS AGE

 pod/wordpress-6f69797b8f-hqpss 1/1 Running 0 5m52s

 pod/wordpress-mysql-8f4b599b5-cd2s2 1/1 Running 0 5m52s

 NAME STATUS VOLUME CAPACITY ACCESS MODES STORAGECLASS AGE

 persistentvolumeclaim/mysql-pv-claim Bound
 pvc-ccf2a578-9ba3-4577-8115-7c80ac200a9c 5Gi RWO
 ocs-storagecluster-ceph-rbd 5m50s

 persistentvolumeclaim/wp-pv-claim Bound
 pvc-3acec0a0-943d-4138-bda9-5b57f8c35c5d 5Gi RWO
 ocs-storagecluster-ceph-rbd 5m50s

 NAME HOST/PORT PATH SERVICES PORT TERMINATION WILDCARD

 route.route.openshift.io/wordpress-http
 wordpress-http-wordpress.apps.socp.twentynet.local wordpress-http
 80-tcp None

</code></pre></div><ol start="2"><li>Access the route url in browser to access the WordPress application
as shown below.</li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure71.1da62899.png" alt=""></p> <h2 id="deploying-openshift-container-storage-with-vmware-vsphere"><a href="#deploying-openshift-container-storage-with-vmware-vsphere" class="header-anchor">#</a> Deploying OpenShift Container Storage with VMware vSphere</h2> <p>OpenShift 4.6 provides software-defined storage that is optimized for
container environment. OpenShift Container Storage (OCS) can either be
deployed on vSphere or AWS Azure.</p> <p>For more information on planning your infrastructure requirements for
OCS, see
<a href="https://access.redhat.com/documentation/en-us/red_hat_openshift_container_storage/4.5/pdf/planning_your_deployment/Red_Hat_OpenShift_Container_Storage-4.5-Planning_your_deployment-en-US.pdf" target="_blank" rel="noopener noreferrer">https://access.redhat.com/documentation/en-us/red_hat_openshift_container_storage/4.5/pdf/planning_your_deployment/Red_Hat_OpenShift_Container_Storage-4.5-Planning_your_deployment-en-US.pdf<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>Use the Red Hat®OpenShift®Container Platform operator hub to install
OCS on vSphere Platform. For more information on how to install OCS on
vSphere using Red Hat OpenShift Container Platform, see
<a href="https://access.redhat.com/documentation/en-us/red_hat_openshift_container_storage/4.5/html/deploying_openshift_container_storage/index" target="_blank" rel="noopener noreferrer">https://access.redhat.com/documentation/en-us/red_hat_openshift_container_storage/4.5/html/deploying_openshift_container_storage/index<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="csi-driver-prior-to-container-storage-integration-csi"><a href="#csi-driver-prior-to-container-storage-integration-csi" class="header-anchor">#</a> CSI Driver Prior to Container Storage Integration (CSI)</h3> <p>Kubernetes provided in-tree plugins to support volume. This posed a problem as
storage vendors had to align to the Kubernetes release process to fix a
bug or to release new features. This also means every storage vendor had
their own process to present volume to Kubernetes.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-openshift/46-synergy/Solution-Deployment/Deploying-OCP-on-VMware-vSphere.html" class="prev">
        Deploying OpenShift Container Platform 4.6 on VMware vSphere
      </a></span> <span class="next"><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/IPI-Installation.html">
        IPI deployment of OCP on Bare Metal
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-openshift/46-synergy/assets/js/app.85d70ec5.js" defer></script><script src="/hpe-solutions-openshift/46-synergy/assets/js/2.fa142977.js" defer></script><script src="/hpe-solutions-openshift/46-synergy/assets/js/3.21f3bfd2.js" defer></script>
  </body>
</html>
