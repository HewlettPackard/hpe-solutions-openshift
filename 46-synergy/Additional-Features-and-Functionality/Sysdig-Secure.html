<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Securing Red Hat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor | OpenShift Container Platform 4.4 on Synergy</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Hewlett Packard Enterprise">
    
    <link rel="preload" href="/hpe-solutions-openshift/46-synergy/assets/css/0.styles.bfdf2f8a.css" as="style"><link rel="preload" href="/hpe-solutions-openshift/46-synergy/assets/js/app.8d09024b.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/46-synergy/assets/js/2.117ef8fd.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/46-synergy/assets/js/20.5dab068a.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/10.f2647a7a.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/11.eb22f408.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/12.c2b1bda3.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/13.b2721807.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/14.fbb5bfdd.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/15.076cb55f.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/16.086f907f.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/17.5044d63c.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/18.0138d6da.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/19.577c768d.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/21.ea4d33a2.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/22.23d6a92d.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/23.329f64c2.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/24.bad0d82d.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/25.2a05a77a.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/26.05687ea8.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/27.5f97f9ba.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/28.9f8648b2.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/29.ffe26d0e.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/3.643f6564.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/30.b6d944bc.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/31.b0b75d1f.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/32.4d1ff1fb.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/33.da67f8dd.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/34.78fab925.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/35.5e384204.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/36.53dec668.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/37.e773d372.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/4.7110e26d.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/5.8d6b47a1.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/6.b3a62cb0.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/7.a921eaba.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/8.8b92de32.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/9.7e00b22b.js">
    <link rel="stylesheet" href="/hpe-solutions-openshift/46-synergy/assets/css/0.styles.bfdf2f8a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-openshift/46-synergy/" class="home-link router-link-active"><!----> <span class="site-name">OpenShift Container Platform 4.4 on Synergy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-openshift/46-synergy/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-openshift/46-synergy/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Red Hat OpenShift Container Platform 4 on HPE Synergy</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Deployment</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Additional Features and Functionality</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Storage.html" class="sidebar-link">Storage</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/IPI-Installation.html" class="sidebar-link">IPI deployment of OCP on Bare Metal</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Air-gap-Installation.html" class="sidebar-link">Red Hat OpenShift Container Platform installation in the restricted network environment</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/OpenShift-operators.html" class="sidebar-link">OpenShift operators</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Integration-with-Prometheus.html" class="sidebar-link">Integration of HPE OneView with Prometheus</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Sysdig-Secure.html" aria-current="page" class="active sidebar-link">Securing Red Hat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Sysdig-Secure.html#description" class="sidebar-link">Description</a></li></ul></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Physical-worker-node-labeling.html" class="sidebar-link">Physical worker node labeling in Red Hat OpenShift cluster</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Advanced-Cluster-Management.html" class="sidebar-link">Red Hat Advanced Cluster Management for Kubernetes</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Install-and-Configure-Velero.html" class="sidebar-link">Install and Configure Velero</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Ceph-Storage-Setup-ExternalMode.html" class="sidebar-link">Red Hat Ceph Storage 4 Setup in External mode with OCS Integration</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Openshift-Virtualization.html" class="sidebar-link">OpenShift Virtualization</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Validating-OCP-Deployment.html" class="sidebar-link">Validating OpenShift Container Platform deployment</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Resosurces and Additional Links</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="securing-red-hat-openshift-container-platform-using-sysdig-secure-and-sysdig-monitor"><a href="#securing-red-hat-openshift-container-platform-using-sysdig-secure-and-sysdig-monitor" class="header-anchor">#</a> Securing Red Hat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor</h1> <h2 id="description"><a href="#description" class="header-anchor">#</a> Description</h2> <p>This section contains Ansible playbooks to automate the installation of
sysdig agents over the Red Hat OpenShift 4.6 Cluster. The contents of
the repository includes the playbooks and input files as listed.</p> <ul><li><strong>playbooks:</strong> This folder contains the playbook required for Sysdig
agent installation over OCP 4.6.</li> <li><strong>roles:</strong> This folder contains a role called
&quot;sysdig-agent-deploy-ocp&quot; which is responsible for performing the
actions required for Sysdig agent integration.</li> <li><strong>hosts:</strong> This is the host file which will be used by Ansible
installer machine to reference localhost during Sysdig agent
deployment.</li> <li><strong>secrets.yml:</strong> This file contains sensitive information about the
Sysdig SaaS platform access details and Red Hat OpenShift cluster
access details.</li></ul> <h3 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h3> <ul><li><p>Ansible engine with Ansible 2.9.x and Python 3.6.x.</p></li> <li><p>Red Hat OpenShift 4.6 is up and running.</p></li> <li><p>User has SaaS-based access to Sysdig Secure and Sysdig Monitor for
the purpose of container security.</p></li> <li><p>User has &quot;admin rights and privilege&quot; for Sysdig Secure and Sysdig
Monitor.</p></li> <li><p>User has valid access token that is given by Sysdig and is specific
to their credentials on Sysdig SaaS platform.</p></li> <li><p>User has updated the kernel to ensure that all the nodes have same
kernel version. Information regarding this can be found by logging
into Sysdig monitor account. Go to setting and under Agent
Installation, you will find instructions to install the kernel
headers.</p></li> <li><p>Enable password-less ssh from OpenShift installer machine to itself
(OpenShift installer machine or localhost).</p> <ul><li>Create password-less ssh to installer VM by generating the ssh
key.</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ssh-keygen
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Press enter to overwrite the id_rsa.pub file and also press enter
for empty password.</p></div></li> <li><p>Copy the ssh key to ~/id_rsa.pub file using following command</p></li> <li><p>$ ssh-copy-id -i ~/.ssh/id_rsa.pub nonrootusername@ansible_engine_machine_ip</p></li></ul> <h3 id="software-requirements"><a href="#software-requirements" class="header-anchor">#</a> Software requirements</h3> <table><thead><tr><th>Software</th> <th>Version</th></tr></thead> <tbody><tr><td>HPE OneView</td> <td>5</td></tr> <tr><td>Sysdig SaaS Agent</td> <td>10.1.1</td></tr></tbody></table> <h3 id="input-files"><a href="#input-files" class="header-anchor">#</a> Input files</h3> <ul><li>Playbook for Sysdig SaaS integration with RedHat OpenShift Container
Platform are available under $BASE_DIR/platform/security-sysdig/</li></ul> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>BASE_DIR is defined and set in <a href="/hpe-solutions-openshift/46-synergy/Solution-Deployment/Preparing-execution-environment.html#installer-machine">installer machine</a> section in deployment guide.</p></div> <ul><li><p>It is mandatory to update all the input files (hosts, secrets.yml,
sysdig-agent-configmap.yaml) with appropriate values before running
the playbook available in this repository.</p></li> <li><p><strong>Input file name</strong> - hosts</p> <ol><li><p>This file is an inventory of host details.</p></li> <li><p>This file is available under $BASE_DIR/platform/security-sysdig/.</p></li> <li><p>Specify the Ansible engine machine IP as the value of the variable.</p></li></ol> <div class="language- extra-class"><pre class="language-text"><code>[ocp_installer_machine_ip]
</code></pre></div></li> <li><p><strong>Input file name</strong> - sysdig-agent-configmap.yaml</p></li></ul> <ol><li><p>This file is available under
$BASE_DIR/platform/security-sysdig/roles/sysdig-agent-deploy-ocp/files/.</p></li> <li><p>Provide the Sysdig SaaS Platform Address and Port Number along with
Red Hat OpenShift cluster name to the variables as listed :</p> <ul><li>collector: &lt;sysdig_saas_collector_address&gt;</li> <li>collector_port: &lt;collector_port&gt;</li> <li>k8s_cluster_name:  &lt;replace_with_ocp_cluster_name&gt;</li></ul></li></ol> <ul><li><p><strong>Input file name</strong> - secrets.yml</p> <ol><li><p>This file is available under
$BASE_DIR/platform/security-sysdig/.</p></li> <li><p>Provide value of project name for Sysdig integration with
OpenShift Container Platform. This project will be created in
OpenShift.</p></li> <li><p>Provide the access key or token value. You must get this value
from user setting by logging into either Sysdig Secure or Sysdig
Monitor GUI.</p></li> <li><p>Provide Red Hat OpenShift username and password to login.</p> <ul><li>projectname: &lt;sysdig_project_name&gt;</li> <li>accesskeyval: &lt;sysdig_saas_access_key&gt;</li> <li>ocpuser: &lt;RedHat_OpenShift_User_Name&gt;</li> <li>ocppassword: &lt;RedHat_OpenShift_User_Password&gt;</li></ul></li></ol></li> <li><p><strong>Input file name</strong> - sysdig-agent-deployment.yaml</p> <ol><li><p>This file is available under
$BASE_DIR/platform/security-sysdig/playbooks/</p></li> <li><p>Update the KUBECONFIG and oc command path.</p> <div class="language- extra-class"><pre class="language-text"><code>-   KUBECONFIG: &lt;replace_with_kubeconfig_path&gt;
-   PATH: &lt;replace_with_ocp_installation_dir_path&gt;:{{ ansible_env.PATH }}
</code></pre></div></li></ol></li></ul> <h3 id="procedure-to-deploy-automated-sysdig-saas-agents-on-red-hat-openshift-container-platform-cluster"><a href="#procedure-to-deploy-automated-sysdig-saas-agents-on-red-hat-openshift-container-platform-cluster" class="header-anchor">#</a> Procedure to deploy automated Sysdig SaaS agents on Red Hat OpenShift Container Platform cluster</h3> <ul><li>Execute the following commands from the Ansible installer VM in the
python virtual environment as a non-root user.<div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> <span class="token variable">$BASE_DIR</span>/platform/security-sysdig/
<span class="token operator">&gt;</span> ansible-playbook -i hosts playbooks/sysdig-agent-deployment.yaml --ask-vault-pass
</code></pre></div></li></ul> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>BASE_DIR is defined in <a href="/hpe-solutions-openshift/46-synergy/Solution-Deployment/Preparing-execution-environment.html#installer-machine">installer machine</a>
section in deployment guide.</p></div> <ul><li><p>Verification of Sysdig agent deployment on Red Hat OpenShift cluster
nodes after successful execution of the playbook. Run the command
listed below to get the information on Sysdig pods..</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get pods <span class="token operator">|</span> <span class="token function">grep</span> sysdig-agent
</code></pre></div></li> <li><p>Output of the above command should show you all Sysdig pods in
running state.</p> <div class="language- extra-class"><pre class="language-text"><code>sysdig-agent-2ljgw   1/1     Running   0          42m
sysdig-agent-cdxtc   1/1     Running   0          42m
sysdig-agent-frr7k   1/1     Running   0          42m
sysdig-agent-gkcmk   1/1     Running   0          42m
sysdig-agent-pzrvr   1/1     Running   2          42m
sysdig-agent-qv6qh   1/1     Running   0          42m
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Number of sysdig pods should be equal to number of nodes that user
sees after running the following command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> oc get nodes
</code></pre></div></div></li> <li><p>Output of above command shows number of nodes in the Red Hat
OpenShift cluster.</p> <div class="language- extra-class"><pre class="language-text"><code>NAME                             STATUS   ROLES    AGE   VERSION
master1.newocs.twentynet.local   Ready    master   64d   v1.17.1
master2.newocs.twentynet.local   Ready    master   64d   v1.17.1
master3.newocs.twentynet.local   Ready    master   64d   v1.17.1
worker1.newocs.twentynet.local   Ready    worker   64d   v1.17.1
worker2.newocs.twentynet.local   Ready    worker   64d   v1.17.1
worker3.newocs.twentynet.local   Ready    worker   64d   v1.17.1
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>If you see a pod in pending state, then there might be a possibility
that the underlying OpenShift Container Platform node is not
functional.</p></div></li> <li><p><strong>Verification using Sydig GUI</strong></p> <ul><li>Login to Sysdig Secure and under Policy Events --&gt; Hosts and
Containers --&gt; user will find all the nodes that are part of
your Red Hat OpenShift infra and this shows Sysdig agents are
successfully installed and security checks are being run on all
those nodes.</li></ul> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure107.07420cfd.png" alt=""></p> <p><strong>Figure 107</strong> - Securing Red Hat OpenShift cluster nodes using
Sysdig Monitor GUI</p> <ul><li>Login to Sysdig Monitor and under Explore --&gt; Hosts and
Containers --&gt; user will find all the nodes that are part of
your RedHat OpenShift infra and this shows Sysdig agents are
successfully installed and monitoring on all those nodes.</li></ul> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure108.3c19b7fb.png" alt=""></p> <p><strong>Figure 108</strong> - Monitoring Red Hat OpenShift cluster nodes using
Sysdig Monitor GUI</p></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Integration-with-Prometheus.html" class="prev">
        Integration of HPE OneView with Prometheus
      </a></span> <span class="next"><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Physical-worker-node-labeling.html">
        Physical worker node labeling in Red Hat OpenShift cluster
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-openshift/46-synergy/assets/js/app.8d09024b.js" defer></script><script src="/hpe-solutions-openshift/46-synergy/assets/js/2.117ef8fd.js" defer></script><script src="/hpe-solutions-openshift/46-synergy/assets/js/20.5dab068a.js" defer></script>
  </body>
</html>
