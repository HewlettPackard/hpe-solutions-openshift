<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Red Hat Ceph Storage 4 Setup in External mode with OCS Integration | OpenShift Container Platform 4.6 on Synergy</title>
    <meta name="generator" content="VuePress 1.7.1">
    
    <meta name="description" content="Hewlett Packard Enterprise">
    
    <link rel="preload" href="/hpe-solutions-openshift/46-synergy/assets/css/0.styles.55697aca.css" as="style"><link rel="preload" href="/hpe-solutions-openshift/46-synergy/assets/js/app.85d70ec5.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/46-synergy/assets/js/2.fa142977.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/46-synergy/assets/js/4.4a1835ae.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/10.08281fa0.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/11.62169700.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/12.a384883b.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/13.14b1c483.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/14.e2ed2b94.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/15.6b7b2986.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/16.2812ef60.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/17.1e86af0b.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/18.1b39e9d9.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/19.73feff90.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/20.c807ba2f.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/21.ea4d33a2.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/22.be8f0d0d.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/23.7bab011f.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/24.c8c1d21d.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/25.60976ff9.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/26.31b8fa12.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/27.479e0913.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/28.9f8648b2.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/29.36b22707.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/3.21f3bfd2.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/30.b6d944bc.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/31.eac5b504.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/32.f5577221.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/33.b81dadd0.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/34.1418d906.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/35.df4061e1.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/36.ae0cc03f.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/37.29980f90.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/5.5a3beac7.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/6.eee306da.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/7.2bd79bc4.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/8.49e62253.js"><link rel="prefetch" href="/hpe-solutions-openshift/46-synergy/assets/js/9.4b7c9b75.js">
    <link rel="stylesheet" href="/hpe-solutions-openshift/46-synergy/assets/css/0.styles.55697aca.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-openshift/46-synergy/" class="home-link router-link-active"><!----> <span class="site-name">OpenShift Container Platform 4.6 on Synergy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-openshift/46-synergy/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-openshift/46-synergy/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Red Hat OpenShift Container Platform 4.6 on HPE Synergy</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Deployment</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Additional Features and Functionality</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Storage.html" class="sidebar-link">Storage Option</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/IPI-Installation.html" class="sidebar-link">IPI deployment of OCP on Bare Metal</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Air-gap-Installation.html" class="sidebar-link">Red Hat OpenShift Container Platform installation in the restricted network environment</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/OpenShift-operators.html" class="sidebar-link">OpenShift operators</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Integration-with-Prometheus.html" class="sidebar-link">Integration of HPE OneView with Prometheus</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Sysdig-Secure.html" class="sidebar-link">Securing Red Hat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Physical-worker-node-labeling.html" class="sidebar-link">Physical worker node labeling in Red Hat OpenShift cluster</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Advanced-Cluster-Management.html" class="sidebar-link">Red Hat Advanced Cluster Management for Kubernetes</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Install-and-Configure-Velero.html" class="sidebar-link">Install and Configure Velero</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Ceph-Storage-Setup-ExternalMode.html" aria-current="page" class="active sidebar-link">Red Hat Ceph Storage 4 Setup in External mode with OCS Integration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Ceph-Storage-Setup-ExternalMode.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Ceph-Storage-Setup-ExternalMode.html#logical-diagram" class="sidebar-link">Logical Diagram</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Ceph-Storage-Setup-ExternalMode.html#hardware-requirement" class="sidebar-link">Hardware Requirement</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Ceph-Storage-Setup-ExternalMode.html#installation-process" class="sidebar-link">Installation Process</a></li></ul></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Openshift-Virtualization.html" class="sidebar-link">OpenShift Virtualization</a></li><li><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Validating-OCP-Deployment.html" class="sidebar-link">Validating OpenShift Container Platform deployment</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Resosurces and Additional Links</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="red-hat-ceph-storage-4-setup-in-external-mode-with-ocs-integration"><a href="#red-hat-ceph-storage-4-setup-in-external-mode-with-ocs-integration" class="header-anchor">#</a> Red Hat Ceph Storage 4 Setup in External mode with OCS Integration</h1> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>Red Hat OpenShift Container Storage can use an externally hosted Red Hat Ceph Storage cluster as the storage provider. Red Hat Ceph Storage is designed for cloud infrastructure and web-scale object storage. Red Hat Ceph Storage is a scalable, open, software-defined storage platform that combines an enterprise-hardened version of the Ceph storage system with a Ceph management platform, deployment utilities, and support services.</p> <p>Setting up the Red Hat OpenShift Container Storage in external mode allows an enterprise to disintegrate container setup platform from container compute platform. The disintegration allows on-demand independent growth of storage and compute clusters. Prior to configuring the Red Hat OpenShift Container Storage in external mode the Red hat Ceph Storage pool must be setup and configured appropriately.</p> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure136.d5153167.png" alt=""></p> <p><strong>Figure 136.</strong> Red Hat Ceph Storage 4 Setup Solution Layout</p> <h2 id="logical-diagram"><a href="#logical-diagram" class="header-anchor">#</a> Logical Diagram</h2> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure137.86067227.png" alt=""></p> <p><strong>Figure 137.</strong> Red Hat Ceph Storage 4 Solution Flow Diagram</p> <h2 id="hardware-requirement"><a href="#hardware-requirement" class="header-anchor">#</a> Hardware Requirement</h2> <table><thead><tr><th>NODE ROLE</th> <th>QUANTITY</th> <th>PLATFORM</th> <th>OS</th> <th>HARD DISK</th> <th>CPU</th> <th>MEM</th></tr></thead> <tbody><tr><td>MON</td> <td>3</td> <td>Synergy</td> <td>RHEL 7.7</td> <td>/dev/sdb – mon</td> <td>4</td> <td>16</td></tr> <tr><td>OSD</td> <td>3</td> <td>Synergy</td> <td>RHEL 7.7</td> <td>/dev/sdc – osd</td> <td>4</td> <td>16</td></tr> <tr><td>ADMIN</td> <td>1</td> <td>VM</td> <td>RHEL 7.7</td> <td>/dev/sda – os volume</td> <td>4</td> <td>16</td></tr></tbody></table> <p><strong>MON, OSD, MSD &amp; MGR daemons are running on the MON/OSD node.</strong></p> <h2 id="installation-process"><a href="#installation-process" class="header-anchor">#</a> Installation Process</h2> <ul><li>Enable subscriptions on the following nodes.</li></ul> <p><strong>ADMIN node:</strong></p> <div class="language- extra-class"><pre class="language-text"><code># subscription-manager register
# subscription-manager refresh
# subscription-manager list --available --all
--matches=&quot;*Ceph*&quot;
# subscription-manager attach --pool=&lt;POOL_ID&gt;

# subscription-manager repos --disable=*
# subscription-manager repos --enable=rhel-7-server-rpms
# subscription-manager repos --enable=rhel-7-server-extras-rpms
# subscription-manager repos
--enable=rhel-7-server-rhceph-4-tools-rpms
--enable=rhel-7-server-ansible-2.8-rpms

# yum --y update
# yum install yum-utils vim -y
# yum-config-manager --disable epel
</code></pre></div><p><strong>MON/OSD nodes:</strong></p> <div class="language- extra-class"><pre class="language-text"><code># subscription-manager register
# subscription-manager refresh
# subscription-manager list --available --all
--matches=&quot;*Ceph*&quot;
# subscription-manager attach --pool=&lt;POOL_ID&gt;

# subscription-manager repos --disable=*
# subscription-manager repos --enable=rhel-7-server-rpms
# subscription-manager repos --enable=rhel-7-server-extras-rpms

#subscription-manager repos
--enable=rhel-7-server-rhceph-4-osd-rpms
#subscription-manager repos
--enable=rhel-7-server-rhceph-4-mon-rpms
# subscription-manager repos
--enable=rhel-7-server-rhceph-4-tools-rpms

# yum --y update
# yum install yum-utils vim -y
# yum-config-manager --disable epel
</code></pre></div><ul><li>Execute the following steps on <strong>Admin Node</strong></li></ul> <ol><li>Install ceph-ansible package</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> yum <span class="token function">install</span> -y ceph-ansible

<span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> /usr/share/ceph-ansible
</code></pre></div><ol start="2"><li>Create ansible host inventory file for MON, OSD &amp; GRAFANA as shown
below</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">touch</span> hosts
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>[mons]
&lt;mon-1.fqdn&gt;
&lt;mon-2.fqdn&gt;
&lt;mon-3.fqdn&gt;

[osds]
&lt;osd-1.fqdn&gt;
&lt;osd-2.fqdn&gt;
&lt;osd-3.fqdn&gt;

[grafana-server]
&lt;grafana_server.fqdn&gt;
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> /usr/share/ceph-ansible
<span class="token operator">&gt;</span> <span class="token function">cp</span> group_vars/all.yml.sample group_vars/all.yml
<span class="token operator">&gt;</span> <span class="token function">cp</span> group_vars/osds.yml.sample group_vars/osds.yml
<span class="token operator">&gt;</span> <span class="token function">cp</span> site.yml.sample site.yml
</code></pre></div><ol start="3"><li>Create Red Hat Ceph Docker Registry username and password using the
below information.</li></ol> <p>If you do not have a Red Hat Registry Service Account, create one
using the <a href="https://access.redhat.com/login?redirectTo=https://access.redhat.com/terms-based-registry" target="_blank" rel="noopener noreferrer">Registry Service Account
webpage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.
See the <a href="https://access.redhat.com/RegistryAuthentication" target="_blank" rel="noopener noreferrer">Red Hat Container Registry
Authentication<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
Knowledgebase article for details on how to create and manage tokens.</p> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure139.a71c9c5c.png" alt=""></p> <ol start="4"><li>Edit group_vars/all.yml as shown below:</li></ol> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">fetch_directory</span><span class="token punctuation">:</span> ~/ceph<span class="token punctuation">-</span>ansible<span class="token punctuation">-</span>keys

<span class="token key atrule">ceph_origin</span><span class="token punctuation">:</span> repository

<span class="token key atrule">ceph_repository</span><span class="token punctuation">:</span> rhcs

<span class="token key atrule">ceph_repository_type</span><span class="token punctuation">:</span> cdn

<span class="token key atrule">ceph_rhcs_version</span><span class="token punctuation">:</span> <span class="token number">4</span>

<span class="token key atrule">monitor_interface</span><span class="token punctuation">:</span> eno3 <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span> Port interface where IP is configured

<span class="token key atrule">public_network</span><span class="token punctuation">:</span> 10.0.18.0/16 <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span> IP address range starting from 1st
node

<span class="token key atrule">ceph_docker_registry</span><span class="token punctuation">:</span> registry.redhat.io

<span class="token key atrule">ceph_docker_registry_auth</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

<span class="token key atrule">ceph_docker_registry_username</span><span class="token punctuation">:</span> SERVICE_ACCOUNT_USER_NAME

<span class="token key atrule">ceph_docker_registry_password</span><span class="token punctuation">:</span> TOKEN

<span class="token key atrule">dashboard_admin_user</span><span class="token punctuation">:</span> &lt;customised username<span class="token punctuation">&gt;</span>

<span class="token key atrule">dashboard_admin_password</span><span class="token punctuation">:</span> &lt;customised password<span class="token punctuation">&gt;</span>

<span class="token key atrule">node_exporter_container_image</span><span class="token punctuation">:</span> registry.redhat.io/openshift4/ose<span class="token punctuation">-</span>prometheus<span class="token punctuation">-</span>node<span class="token punctuation">-</span>exporter<span class="token punctuation">:</span>v4.1

<span class="token key atrule">grafana_server_group_name</span><span class="token punctuation">:</span> grafana<span class="token punctuation">-</span>server

<span class="token key atrule">grafana_admin_user</span><span class="token punctuation">:</span>

<span class="token key atrule">grafana_admin_password</span><span class="token punctuation">:</span>

<span class="token key atrule">mon_group_name</span><span class="token punctuation">:</span> mons

<span class="token key atrule">osd_group_name</span><span class="token punctuation">:</span> osds

<span class="token key atrule">grafana_container_image</span><span class="token punctuation">:</span> registry.redhat.io/rhceph/rhceph<span class="token punctuation">-</span>4<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>rhel8<span class="token punctuation">:</span><span class="token number">4</span>

<span class="token key atrule">prometheus_container_image</span><span class="token punctuation">:</span> registry.redhat.io/openshift4/ose<span class="token punctuation">-</span>prometheus<span class="token punctuation">:</span><span class="token number">4.1</span>

<span class="token key atrule">alertmanager_container_image</span><span class="token punctuation">:</span> registry.redhat.io/openshift4/ose<span class="token punctuation">-</span>prometheus<span class="token punctuation">-</span>alertmanager<span class="token punctuation">:</span><span class="token number">4.1</span>

<span class="token key atrule">configure_firewall</span><span class="token punctuation">:</span> <span class="token boolean important">True</span>
</code></pre></div><ol start="5"><li>Edit group_vars/osds.yml as shown below:</li></ol> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">osd_auto_discovery</span><span class="token punctuation">:</span> False*
devices<span class="token punctuation">:</span>*
  <span class="token punctuation">-</span> /dev/sdb*
  <span class="token punctuation">-</span> /dev/sdc*
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>If <strong>osd_auto_discovery</strong> is set to True, all the empty
disks will be used by the system to create OSD.</p></div> <ol start="6"><li>Create an ansible user with sudo access on all nodes.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> adduser ansible-user
<span class="token operator">&gt;</span> <span class="token function">passwd</span> ansible-user
<span class="token operator">&gt;</span> <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> EOF <span class="token operator">&gt;</span>/etc/sudoers.d/ansible-user
 ansible-user ALL <span class="token operator">=</span> <span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD:ALL
 EOF

<span class="token operator">&gt;</span> <span class="token function">chmod</span> 0440 /etc/sudoers.d/ansible-user
</code></pre></div><ol start="7"><li>Generate SSH keys as the ansible user and copy the key to MON &amp; OSD
nodes.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ssh-keygen

<span class="token operator">&gt;</span> ssh-copy-id ansible-user@<span class="token operator">&lt;</span>mon-osd-ip<span class="token operator">&gt;</span>
</code></pre></div><ol start="8"><li>Create ~/.ssh/config file and set values for the Hostname and User
options for each node in the storage cluster</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">touch</span> ~/.ssh/config
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>Host node1
  Hostname &lt;mon-1.fqdn&gt;
  User ansible-user*
...
...
Host node4
  Hostname &lt;osd-1.fqdn&gt;
  User ansible-user*
</code></pre></div><ol start="9"><li>Run the Ansible playbook for creating Ceph storage and Ceph cluster.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ansible-playbook site.yml -i hosts
</code></pre></div><p>Created Ceph storage on any one of OSD nodes.</p> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure140.4af77b35.png" alt=""></p> <ol start="10"><li>Run Ansible playbook for creating Ceph cluster dashboard.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ansible-playbook dashboard.yml -i hosts
</code></pre></div><p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure141.d487aa5a.png" alt=""></p> <ul><li>Open Ceph cluster web UI and enter credentials to login</li></ul> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure142.31b26988.png" alt=""></p> <ol start="11"><li><strong>Ceph Dash board:</strong> Cretae rdb pool in Ceph cluster.</li></ol> <ul><li><p>Ceph pool on Ceph cluster dash board: Dash board -&gt; Pools -&gt; Create
Pool</p></li> <li><p>Created Ceph pool on Dash board.</p></li></ul> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure143.d55fb6d4.png" alt=""></p> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure144.363704c4.png" alt=""></p> <ol start="12"><li>Create openshift-storage namespace. (Dashboard -&gt; Administration -&gt;
Namespace -&gt; Create Namespace).</li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure145.1075c5b4.png" alt=""></p> <ol start="13"><li>Create OpenShift Container Storage 4.5 operator. (Dashboard -&gt;
Operators -&gt; OperatorHub -&gt; openshift-storage (namespace) -&gt; search for
(OpenShift Container Storage) -&gt; Install).</li></ol> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Select the below options to create OpenShift Container
Storage operator</p></div> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure146.fa68ba6d.png" alt=""></p> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure147.620ef719.png" alt=""></p> <ul><li><p>Update Channel as stable-4.5</p></li> <li><p>Installation Mode as A specific namespace on the cluster</p></li> <li><p>Installed Namespace as Operator recommended namespace PR
openshift-storage. If Namespace openshift-storage does not exist, it
will be created during the operator installation.</p></li> <li><p>Enable operator recommended cluster monitoring on this namespace
checkbox is selected. This is required for cluster monitoring.</p></li> <li><p>Approval Strategy as Automatic</p></li></ul> <ol start="14"><li>Create Overview -&gt; openshift-storage (namespace) -&gt; Operator Hub -&gt;
Installed Operators -&gt; OpenShift Container Storage (operator) -&gt;
&quot;Storage Cluster&quot; -&gt; &quot;Create OCS Cluster Service&quot;</li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure148.776cb331.png" alt=""></p> <ol start="15"><li>Select &quot;External&quot; storage mode to integrate external ceph storage
for creating ocs cluster by default it shows internal</li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure149.820dad61.png" alt=""></p> <ol start="16"><li>Download &quot;ceph-external-cluster-details-exporter.py&quot; file and place
on any one of OSD nodes.</li></ol> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Python version should be &quot;python 3.x&quot;.</p></div> <ol start="17"><li><p>Check the python script</p> <p><strong>ceph-external-cluster-details-exporter.py</strong> arguments.</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> python3 ceph-external-cluster-details-exporter.py --help
</code></pre></div><ol start="18"><li>Execute the below script for integrating Ceph cluster rbd pool into
OCP cluster for creating OCS cluster.</li></ol> <div class="language- extra-class"><pre class="language-text"><code>&gt; python3 ceph-external-cluster-details-exporter.py --rbd-pool-name &lt;rbd_pool_name_created_on_ceph_cluster&gt;
</code></pre></div><p>Script output as shown below in JSON format.</p> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure150.da0ac770.png" alt=""></p> <ol start="19"><li><p>Save the above command output in a json file.</p></li> <li><p>Click <strong>External cluster metadata -&gt; Browse</strong> to select and upload
the json file.</p></li> <li><p>Click on <strong>Create</strong> for integrating external Ceph storage for
creating OCS cluster.</p></li></ol> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure151.1acaa0e0.png" alt=""></p> <ol start="22"><li>Validating OCS cluster by deploying two-tier application WordPress.</li></ol> <ul><li><p>Create wordpress namespace.</p></li> <li><p>Deploy WordPress application under wordpress namespace.</p></li></ul> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure152.e7335ece.png" alt=""></p> <ol start="23"><li>Check all OCS cluster and WordPress application's pods, pv, pvc and
sc.</li></ol> <ul><li>Check sc,pv &amp;pvc of openshift-storage namespace.</li></ul> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure153.6e3114aa.png" alt=""></p> <ul><li>Check pods of openshift-storage namespace.</li></ul> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure154.ee463715.png" alt=""></p> <ul><li>Check pvc and pods of wordpess namespace.</li></ul> <p><img src="/hpe-solutions-openshift/46-synergy/assets/img/Figure155.6c45a503.png" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Install-and-Configure-Velero.html" class="prev">
        Install and Configure Velero
      </a></span> <span class="next"><a href="/hpe-solutions-openshift/46-synergy/Additional-Features-and-Functionality/Openshift-Virtualization.html">
        OpenShift Virtualization
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-openshift/46-synergy/assets/js/app.85d70ec5.js" defer></script><script src="/hpe-solutions-openshift/46-synergy/assets/js/2.fa142977.js" defer></script><script src="/hpe-solutions-openshift/46-synergy/assets/js/4.4a1835ae.js" defer></script>
  </body>
</html>
