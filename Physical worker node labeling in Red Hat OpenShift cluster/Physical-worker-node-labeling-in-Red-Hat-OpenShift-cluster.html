<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Physical worker node labeling in Red Hat OpenShift cluster | RED HAT OPENSHIFT CONTAINER PLATFORM 4 ON HPE SYNERGY</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/hpe-solutions-openshift/assets/css/0.styles.03110986.css" as="style"><link rel="preload" href="/hpe-solutions-openshift/assets/js/app.97ab5217.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/assets/js/2.7869ffdd.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/assets/js/19.790531fa.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/10.eaca1b1f.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/11.e4a910b4.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/12.23c485d1.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/13.1dfc2227.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/14.6cfe7b83.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/15.396fb9b8.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/16.a35ed86c.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/17.821cf572.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/18.861062ec.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/20.77410566.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/21.64fb4b9d.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/22.d1f7b188.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/23.47b1fcea.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/24.5e6bc1df.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/25.739eaeab.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/26.c868f3e2.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/3.df4c1f1d.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/4.4ba88d9e.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/5.bae94e2f.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/6.29d6f4db.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/7.1836f0b8.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/8.7912b669.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/9.9e7c1a91.js">
    <link rel="stylesheet" href="/hpe-solutions-openshift/assets/css/0.styles.03110986.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-openshift/" class="home-link router-link-active"><!----> <span class="site-name">RED HAT OPENSHIFT CONTAINER PLATFORM 4 ON HPE SYNERGY</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-openshift/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-openshift/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/hpe-solutions-openshift/Introduction/Introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/hpe-solutions-openshift/Solution overview/Solution-overview.html" class="sidebar-link">Solution overview</a></li><li><a href="/hpe-solutions-openshift/Solution components/Solution-components.html" class="sidebar-link">Solution components</a></li><li><a href="/hpe-solutions-openshift/Preparing the execution environment/Preparing-the-execution-environment.html" class="sidebar-link">Preparing the execution environment</a></li><li><a href="/hpe-solutions-openshift/Physical environment configuration/Physical-environment-configuration.html" class="sidebar-link">Physical environment configuration</a></li><li><a href="/hpe-solutions-openshift/Physical node configuration/Physical-node-configuration.html" class="sidebar-link">Physical node configuration</a></li><li><a href="/hpe-solutions-openshift/Virtual node configuration/Virtual-node-configuration.html" class="sidebar-link">Virtual node configuration</a></li><li><a href="/hpe-solutions-openshift/vSphere Provisioner/vSphere-Provisioner.html" class="sidebar-link">vSphere Provisioner</a></li><li><a href="/hpe-solutions-openshift/Operating system deployment/Operating-system-deployment.html" class="sidebar-link">Operating system deployment</a></li><li><a href="/hpe-solutions-openshift/Red Hat OpenShift Container Platform deployment/Red-Hat-OpenShift-Container-Platform-deployment.html" class="sidebar-link">Red Hat OpenShift Container Platform deployment</a></li><li><a href="/hpe-solutions-openshift/Red Hat Local Storage Operator/Red-Hat-Local-Storage-Operator.html" class="sidebar-link">Red Hat Local Storage Operator</a></li><li><a href="/hpe-solutions-openshift/Integration of HPE OneView with Prometheus/Integration-of-HPE-OneView-with-Prometheus.html" class="sidebar-link">Integration of HPE OneView with Prometheus</a></li><li><a href="/hpe-solutions-openshift/Storage/Storage.html" class="sidebar-link">Storage</a></li><li><a href="/hpe-solutions-openshift/HPE CSI drivers/HPE-CSI-drivers.html" class="sidebar-link">HPE CSI drivers</a></li><li><a href="/hpe-solutions-openshift/Securing Red Hat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor/Securing-Red-Hat-OpenShift-Container-Platform-using-Sysdig-Secure-and-Sysdig-Monitor.html" class="sidebar-link">Securing Red Hat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor</a></li><li><a href="/hpe-solutions-openshift/Physical worker node labeling in Red Hat OpenShift cluster/Physical-worker-node-labeling-in-Red-Hat-OpenShift-cluster.html" class="active sidebar-link">Physical worker node labeling in Red Hat OpenShift cluster</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/hpe-solutions-openshift/OpenShift Operators/OpenShift-Operators.html" class="sidebar-link">OpenShift Operators</a></li><li><a href="/hpe-solutions-openshift/Validating OpenShift Container Platform deployment/Validating-OpenShift-Container-Platform-deployment.html" class="sidebar-link">Validating OpenShift Container Platform deployment</a></li><li><a href="/hpe-solutions-openshift/Resources and additional links/Resources-and-additional-links.html" class="sidebar-link">Resources and additional links</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="physical-worker-node-labeling-in-red-hat-openshift-cluster"><a href="#physical-worker-node-labeling-in-red-hat-openshift-cluster" class="header-anchor">#</a> Physical worker node labeling in Red Hat OpenShift cluster</h1> <p>This section describes the scripts to automate the process of retrieving the hardware properties from physical worker nodes of the Red Hat OpenShift cluster and using the Red Hat OpenShift Node Labeling capability to label the physical worker node with the retrieved properties. These node labels along with Red Hat OpenShift node selector capability can be used by the user for defining the pod deployment configuration in order to ensure pod is running on the physical node with desired hardware properties.</p> <p>Nodes can be labelled for the following properties:</p> <ol><li><strong>Overall Health Status of the node</strong> : If current status health status of following components  &quot;BIOS, Fans, Temperature Sensors, Battery, Processor, Memory, Network and Storage&quot; of the HPE Synergy compute is ok, physical node health status is considered &quot;Ok&quot; else &quot;Degraded&quot;</li> <li><strong>Overall Security Status of the node</strong> : If the current status of the following BIOS security configuration (which are important for the compute security) is as listed &quot;secure boot status: enabled, asset tag: locked, UEFI Shell Script Verification: enabled, UEFI Shell Startup: disabled, Processor AES: enabled&quot; then the overall security status of the physical node is considered &quot;Ok&quot; else &quot;degraded&quot;.</li> <li><strong>Custom labeling</strong> : User defined labels (key, value) is assigned to desired physical worker node.</li></ol> <div class="custom-block warning"><p class="custom-block-title">Prerequisites</p> <ul><li><p>Ansible engine with Ansible 2.9.x and Python 3.6.x</p></li> <li><p>Red Hat OpenShift 4.x is up and running.</p></li> <li><p>The RedHat OpenShift cluster must have physical worker node to use the &quot;Node labeling&quot; functionality.</p></li> <li><p>The playbook under this repository needs to be run from Ansible Installer Machine with the Python virtual environment as non-root user.</p></li> <li><p>Python module &quot;proliantutils&quot; is installed on the OpenShift Installer Machine.</p> <ul><li><p>&quot;proliantutils&quot; is a set of utility libraries for interfacing and managing various components (like iLO) for HPE ProLiant Servers.</p> <ul><li><p>Use the following command to install proliantutils.</p> <div class="language- extra-class"><pre class="language-text"><code>$ pip install ansible==2.9.0
</code></pre></div></li></ul></li> <li><p>Verify the version of proliantutils.</p> <div class="language- extra-class"><pre class="language-text"><code>$ pip freeze | grep proliantutils
</code></pre></div></li> <li><p>Output</p> <div class="language- extra-class"><pre class="language-text"><code>$ proliantutils==2.9.2
</code></pre></div></li></ul></li> <li><p>Install the &quot;sushy&quot; python library. In case &quot;sushy&quot; module is already installed, please ensure its version is 3.0.0.</p> <ul><li><p>Use the following command to install sushy module.</p> <div class="language- extra-class"><pre class="language-text"><code>$ pip install sushy==3.0.0
</code></pre></div></li> <li><p>Verify the version of proliantutils.</p> <div class="language- extra-class"><pre class="language-text"><code>$ pip freeze | grep sushy
</code></pre></div></li> <li><p>Output:</p> <div class="language- extra-class"><pre class="language-text"><code>$ sushy==3.0.0
</code></pre></div></li></ul></li></ul></div> <div class="custom-block tip"><p class="custom-block-title">Note</p> <p>Refer to <a href="/hpe-solutions-openshift/Preparing the execution environment/Preparing-the-execution-environment.html#non-root-user-access">Non-root user access</a> section to know more about the non-root user details.</p></div> <h3 id="software-requirements"><a href="#software-requirements" class="header-anchor">#</a> Software requirements</h3> <table><thead><tr><th>Software</th> <th>Version</th></tr></thead> <tbody><tr><td>HPE OneView</td> <td>5</td></tr></tbody></table> <h4 id="input-files"><a href="#input-files" class="header-anchor">#</a> Input files</h4> <ul><li>Playbook for RedHat OpenShift Container Platform Physical Worker Node labeling are available under $BASE_DIR/platform/physical-physical-workerlabeling/</li></ul> <div class="custom-block tip"><p class="custom-block-title">Note</p> <p>BASE_DIR is defined and set in <a href="/hpe-solutions-openshift/Preparing the execution environment/Preparing-the-execution-environment.html#installer-machine">Installer machine</a> section in deployment guide.</p></div> <ul><li><p>It is mandatory to update all the input files (hosts, secrets.yml, sysdig-agent-configmap.yaml) with appropriate values before running the playbook available in this repository.</p> <ul><li><p><strong>Input file name</strong>: hosts.json</p> <ol><li>This file is an inventory of host details.</li> <li>This file contains sensitive information like iLO IP and credentials, Worker IP and labels. So, data inside this file is encrypted.</li> <li>To edit this vault file, use the following command and provide the default &quot;ansible vault&quot; password.</li></ol> <div class="language- extra-class"><pre class="language-text"><code>$ ansible-vault edit hosts.json
</code></pre></div><ol start="4"><li>For each of the physical worker node that is part of RedHat OpenShift cluster, the user needs to provide the following information:</li></ol> <div class="language- extra-class"><pre class="language-text"><code>&quot;host_fqdn&quot;: &quot;replace_with_physical_worker_node1_fqdn&quot;,
&quot;ilo_ip&quot;: &quot;replace_with_ilo_ip_of_physical_worker_node1&quot;,
&quot;username&quot;: &quot;replace_with_ilo_username&quot;,
&quot;password&quot;: &quot;replace_with_ilo_password&quot;,
&quot;custom_label_required&quot;: &quot;replace_with_No_or_Yes&quot;,
&quot;label_name&quot;: &quot;replace_with_desired_label_key&quot;,
&quot;label_val&quot;: &quot;replace_with_desired_label_value&quot;
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Note</p> <p>Information inside hosts.json is available in a nested JSON format, which means user can add any number of physical worker node by creating the sections as &quot;server 1, server 2, server 3, ...server N&quot; and can also add any number of &quot;custom labels&quot; as &quot;label 1, label 2, label 3 to label N&quot;. Refer to &quot;hosts.json&quot; to understand this nested JSON structure. &quot;N&quot; represent the Nth number server.</p></div></li> <li><p><strong>Input file name</strong>: config.json</p> <ol><li><p>Provide the path information about &quot;kubeconfig&quot; and &quot;oc&quot; command.</p> <ul><li><strong>kubeconfig_path:</strong> The value of this key is the path of kubeconfig and this path is used by &quot;oc&quot; command at runtime.</li> <li><strong>oc_command_path:</strong> The value of this key is the oc command path and this path is used to run the &quot;oc&quot; command.</li></ul> <div class="language- extra-class"><pre class="language-text"><code>&quot;kubeconfig_path&quot;: &quot;replace_with_path_of_ocp_kubeconfig&quot;,
&quot;oc_command_path&quot;: &quot;replace_with_path_of_ocp_installation_dir&quot;
</code></pre></div></li></ol></li></ul> <h4 id="steps-to-run-the-node-labeling-automation-scripts"><a href="#steps-to-run-the-node-labeling-automation-scripts" class="header-anchor">#</a> Steps to run the Node Labeling automation scripts</h4> <ul><li><p>Execute the following commands from the Ansible installer VM in the python virtual environment as a non-root user. The python virtual environment is defined and set in the <a href="/hpe-solutions-openshift/Preparing the execution environment/Preparing-the-execution-environment.html#installer-machine">Installer machine</a> section.</p> <div class="language- extra-class"><pre class="language-text"><code>$ cd $BASE_DIR/platform/physical-workerlabelling/
$ python physical_node_labeling.py
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Note</p> <p>BASE_DIR is defined and set in <a href="/hpe-solutions-openshift/Preparing the execution environment/Preparing-the-execution-environment.html#installer-machine">Installer machine</a> section.</p></div></li> <li><p>Next, the user will be prompted to enter the Ansible vault password or key. This credential is the default &quot;Ansible vault&quot; password.</p> <div class="language- extra-class"><pre class="language-text"><code>$ Enter key for encrypted variables:
</code></pre></div></li></ul> <div class="custom-block tip"><p class="custom-block-title">Note</p> <p>Default key value for Ansible vault is <em>&quot;changeme&quot;</em>.</p></div> <ul><li><p>Output of the command will prompt following options.</p> <div class="language- extra-class"><pre class="language-text"><code>$ 1: Get the physical worker node details that user wishes to configure.

$ 2: Get current health status of the physical worker node

$ 3: Get security parameters of the physical worker node

$ 4: Label the physical worker with health status

$ 5: Label the physical worker with security status

$ 6: Custom labels

$ 7: Display current labels on the node

$ 8: Quit

$ Enter the choice number:
​
</code></pre></div></li> <li><p>Next, the user will be prompted to enter the Ansible vault password or key. This credential is the default &quot;Ansible vault&quot; password.</p> <div class="language- extra-class"><pre class="language-text"><code>$ Enter key for encrypted variables:
</code></pre></div></li> <li><p>If user selects option 1, then they will see all the information available within the hosts.json file</p></li> <li><p>If user selects option 2, then aggregated health status of the physical worker nodes will be shown to the user as:</p> <div class="language- extra-class"><pre><code>$ {'worker1.newocs.twentynet.local': 'OK', 'worker2.newocs.twentynet.local': 'OK'}
</code></pre></div></li> <li><p>If user selects option 3, then this playbook will show the aggregated security status of the physical worker node as:</p> <div class="language- extra-class"><pre><code> $ {'worker1.newocs.twentynet.local': 'OK', 'worker2.newocs.twentynet.local': 'Degraded'}
</code></pre></div></li> <li><p>If user selects option 4, then the physical worker node will be labelled with its respective &quot;aggregated health status&quot; as given by option 2:</p> <div class="language- extra-class"><pre><code>$ worker1.newocs.twentynet.local
  NAME                             STATUS   ROLES    AGE   VERSION   LABELS
  worker1.newocs.twentynet.local   Ready    worker   64d   v1.17.1   app=sysdig-agent,beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,health=OK,kubernetes.io/arch=amd64,kubernetes.io/hostname=worker1.newocs.twentynet.local,kubernetes.io/os=linux,node-role.kubernetes.io/worker=,node.openshift.io/os_id=rhcos
 Verified - Label  health=OK is added to the node worker1.newocs.twentynet.local
 
 worker2.newocs.twentynet.local
 NAME                             STATUS   ROLES    AGE   VERSION   LABELS
 worker2.newocs.twentynet.local   Ready    worker   64d   v1.17.1   app=sysdig-agent,beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,health=OK,kubernetes.io/arch=amd64,kubernetes.io/hostname=worker2.newocs.twentynet.local,kubernetes.io/os=linux,node-role.kubernetes.io/worker=,node.openshift.io/os_id=rhcos,replace_with_desired_label_key=replace_with_desired_label_value,security=Degraded
 Verified - Label  health=OK is added to the node worker2.newocs.twentynet.local
</code></pre></div></li> <li><p>If user selects option 5, then the physical worker node will be labelled with its respective &quot;aggregated security status&quot; as given by option 3:</p> <div class="language- extra-class"><pre class="language-text"><code>$ NAME                             STATUS   ROLES    AGE   VERSION   LABELS
worker1.newocs.twentynet.local   Ready    worker   64d   v1.17.1   app=sysdig-agent,beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,health=OK,kubernetes.io/arch=amd64,kubernetes.io/hostname=worker1.newocs.twentynet.local,kubernetes.io/os=linux,node-role.kubernetes.io/worker=,node.openshift.io/os_id=rhcos,security=OK
Verified - Label  security=OK is added to the node worker1.newocs.twentynet.local

NAME                             STATUS   ROLES    AGE   VERSION   LABELS
worker2.newocs.twentynet.local   Ready    worker   64d   v1.17.1   app=sysdig-agent,beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,health=OK,kubernetes.io/arch=amd64,kubernetes.io/hostname=worker2.newocs.twentynet.local,kubernetes.io/os=linux,node-role.kubernetes.io/worker=,node.openshift.io/os_id=rhcos,replace_with_desired_label_key=replace_with_desired_label_value,security=Degraded
Verified - Label  security=Degraded is added to the node    worker2.newocs.twentynet.local
</code></pre></div></li> <li><p>If user selects option 6, then the physical worker node will be labelled with the custom labels defined by user in the hosts.json file</p> <div class="custom-block tip"><p class="custom-block-title">Note</p> <p>Custom labels will be applied on if user has selected &quot;yes&quot; or &quot;no&quot; in the json file for &quot;custom_labels.</p></div></li> <li><p>&quot;If user selects option 7, then all the labels like security, health and custom labels along with default labels for each of the physical worker node will be shown.</p></li> <li><p>If user selects option 8, Node labeling utility will exit.</p></li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-openshift/Securing Red Hat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor/Securing-Red-Hat-OpenShift-Container-Platform-using-Sysdig-Secure-and-Sysdig-Monitor.html" class="prev">
        Securing Red Hat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor
      </a></span> <span class="next"><a href="/hpe-solutions-openshift/OpenShift Operators/OpenShift-Operators.html">
        OpenShift Operators
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-openshift/assets/js/app.97ab5217.js" defer></script><script src="/hpe-solutions-openshift/assets/js/2.7869ffdd.js" defer></script><script src="/hpe-solutions-openshift/assets/js/19.790531fa.js" defer></script>
  </body>
</html>
