<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Load Balancer | OpenShift Container Platform 4.9 on HPE DL380 and DL360 Gen10 Servers</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Hewlett Packard Enterprise">
    
    <link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/css/0.styles.b9906ffc.css" as="style"><link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/js/app.3ab76ca9.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/js/2.692be357.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/js/28.3a70d9c4.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/10.d80efe23.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/11.34937674.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/12.cb2fa787.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/13.de116ec1.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/14.61bf774b.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/15.4c949536.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/16.e90f0158.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/17.1d47a547.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/18.23a9e026.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/19.a8595bd6.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/20.4e8d28b5.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/21.ee6fa1e2.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/22.d72bcd0d.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/23.b06cbde8.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/24.d16dfbc6.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/25.865e626b.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/26.61c365e8.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/27.b22ca90b.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/29.c47171c1.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/3.aac6da1f.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/30.437b3702.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/31.efe2a4fb.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/32.1ad54211.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/33.35dc4767.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/34.feb50123.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/35.851c39b1.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/4.08272df7.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/5.018be1c0.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/6.3bf3aab7.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/7.e24d64b3.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/8.2d9d3197.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/9.e5eeb283.js">
    <link rel="stylesheet" href="/hpe-solutions-openshift/49-dl/assets/css/0.styles.b9906ffc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-openshift/49-dl/" class="home-link router-link-active"><!----> <span class="site-name">OpenShift Container Platform 4.9 on HPE DL380 and DL360 Gen10 Servers</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-openshift/49-dl/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-openshift/49-dl/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Red Hat OpenShift Container Platform 4.9 on DL Servers</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Solution Deployment</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Solution-deployment-flow.html" class="sidebar-link">Solution Deployment Flow</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Preparing-execution-environment.html" class="sidebar-link">Preparing the execution environment</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Operating-system-deployment.html" class="sidebar-link">Operating system deployment</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/User-provisioned-DNS-requirements.html" class="sidebar-link">User-provisioned DNS requirements</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Load-Balancer.html" aria-current="page" class="active sidebar-link">Load Balancer</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Bootstrap-node.html" class="sidebar-link">Bootstrap node</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Physical-node-configuration.html" class="sidebar-link">Physical node configuration</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Virtual-node-configuration.html" class="sidebar-link">Virtual node configuration</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/OCP-Cluster-deployment.html" class="sidebar-link">Red Hat OpenShift Container Platform Cluster deployment</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/OCP-worker-nodes.html" class="sidebar-link">Red Hat OCP worker nodes</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Deploying-OCP-on-VMware-vSphere.html" class="sidebar-link">Deploying OpenShift Container Platform 4.9 on VMware vSphere</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Additional Features and Functionality</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Resosurces and Additional Links</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="load-balancer"><a href="#load-balancer" class="header-anchor">#</a> Load Balancer</h1> <p>Red Hat OpenShift Container Platform 4.9 uses an external load balancer to communicate from outside the cluster with services running inside the cluster. This section assumes that there is a load balancer available within the deployment environment and is available for use. This solution was developed using <strong>HA Proxy</strong>, an open source solution with one (1) virtual machine for load balancing functionality.</p> <p>This section covers its configuration. In a production environment, Hewlett Packard Enterprise recommends the use of enterprise load balancing such as F5 Networks Big-IP and its associated products.</p> <h4 id="install-and-configure-haproxy"><a href="#install-and-configure-haproxy" class="header-anchor">#</a> Install and Configure HAProxy</h4> <p>Run below command for installing haproxy</p> <p>$ yum -y install haproxy</p> <p>The following entries are made in the haproxy.cfg file.</p> <p>Sample haproxy.cfg file</p> <p>#---------------------------------------------------------------------
# static backend for serving up images, stylesheets and such
#---------------------------------------------------------------------
#backend static
# balance roundrobin
# server static 127.0.0.1:4331 check
#---------------------------------------------------------------------
# round robin balancing between the various backends
#---------------------------------------------------------------------</p> <p>frontend ocp4-kubernetes-api-server</p> <p><code></code>bind *:6443</p> <p><code></code>default_backend ocp4-kubernetes-api-server</p> <p><code></code>mode tcp</p> <p><code></code>option tcplog</p> <p>backend ocp4-kubernetes-api-server
<code></code>mode tcp
<code></code>balance source
<code></code>server bootstrap bootstrap.ocp.pxelocal.local:6443 check
<code></code>server master01 master01.ocp.pxelocal.local:6443 check
<code></code>server master02 master02.ocp.pxelocal.local:6443 check
<code></code>server master03 master03.ocp.pxelocal.local:6443 check</p> <p>frontend ocp4-machine-config-server68</p> <p><code></code>bind *:22623</p> <p><code></code>default_backend ocp4-machine-config-server</p> <p><code></code>mode tcp</p> <p><code></code>option tcplog</p> <p>backend ocp4-machine-config-server
<code></code>balance source
<code></code>mode tcp
<code></code>server bootstrap bootstrap.ocp.pxelocal.local:22623 check
<code></code>server master01 master01.ocp.pxelocal.local:22623 check
<code></code>server master02 master02.ocp.pxelocal.local:22623 check
<code></code>server master03 master03.ocp.pxelocal.local:22623 check</p> <p>frontend ocp4-router-http</p> <p><code></code>bind *:80</p> <p><code></code>default_backend ocp4-router-http</p> <p><code></code>mode tcp</p> <p><code></code>option tcplog</p> <p>backend ocp4-router-http
<code></code>balance source
<code></code>mode tcp
<code></code>server worker03 worker03.ocp.pxelocal.local:80 check
<code></code>server worker04 worker04.ocp.pxelocal.local:80 check
<code></code>server worker01 worker01.ocp.pxelocal.local:80 check
<code></code>server worker02 worker02.ocp.pxelocal.local:80 check</p> <p># if creating a cluster with only master nodes to begin with and later adding the worker nodes, master nodes should be added in this section instead of worker nodes. Once all the worker nodes are added into the cluster, this configuration needs to be updated with the worker nodes.
<code></code># server master01 master01.ocp.pxelocal.local:80 check
<code></code># server master02 master02.ocp.pxelocal.local:80 check
<code></code># server master03 master03.ocp.pxelocal.local:80 check</p> <p>frontend ocp4-router-https</p> <p><code></code>bind *:443</p> <p><code></code>default_backend ocp4-router-https</p> <p><code></code>mode tcp</p> <p><code></code>option tcplog</p> <p><code></code>backend ocp4-router-https
<code></code>balance source
<code></code>mode tcp
<code></code>server worker03 worker03.ocp.pxelocal.local:443 check
<code></code>server worker04 worker04.ocp.pxelocal.local:443 check
<code></code>server worker01 worker01.ocp.pxelocal.local:443 check
<code></code>server worker01 worker02.ocp.pxelocal.local:443 check</p> <p># if creating a cluster with only master nodes to begin with and later adding the worker nodes, master nodes should be added in this section instead of worker nodes. Once all the worker nodes are added into the cluster, this configuration needs to be updated with the worker nodes.
<code></code># server master01 master01.ocp.pxelocal.local:443 check
<code></code># server master02 master02.ocp.pxelocal.local:443 check
<code></code># server master03 master03.ocp.pxelocal.local:443 check</p> <p><strong>NOTE</strong></p> <p>The load balancer configuration should contain values that are aligned to the installation environment.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/User-provisioned-DNS-requirements.html" class="prev">
        User-provisioned DNS requirements
      </a></span> <span class="next"><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Bootstrap-node.html">
        Bootstrap node
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-openshift/49-dl/assets/js/app.3ab76ca9.js" defer></script><script src="/hpe-solutions-openshift/49-dl/assets/js/2.692be357.js" defer></script><script src="/hpe-solutions-openshift/49-dl/assets/js/28.3a70d9c4.js" defer></script>
  </body>
</html>
