<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Operating system deployment | OpenShift Container Platform 4.9 on HPE DL380 and DL360 Gen10 Servers</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Hewlett Packard Enterprise">
    
    <link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/css/0.styles.b9906ffc.css" as="style"><link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/js/app.3ab76ca9.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/js/2.692be357.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/js/30.437b3702.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/10.d80efe23.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/11.34937674.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/12.cb2fa787.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/13.de116ec1.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/14.61bf774b.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/15.4c949536.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/16.e90f0158.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/17.1d47a547.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/18.23a9e026.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/19.a8595bd6.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/20.4e8d28b5.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/21.ee6fa1e2.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/22.d72bcd0d.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/23.b06cbde8.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/24.d16dfbc6.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/25.865e626b.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/26.61c365e8.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/27.b22ca90b.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/28.3a70d9c4.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/29.c47171c1.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/3.aac6da1f.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/31.efe2a4fb.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/32.1ad54211.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/33.35dc4767.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/34.feb50123.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/35.851c39b1.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/4.08272df7.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/5.018be1c0.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/6.3bf3aab7.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/7.e24d64b3.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/8.2d9d3197.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/9.e5eeb283.js">
    <link rel="stylesheet" href="/hpe-solutions-openshift/49-dl/assets/css/0.styles.b9906ffc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-openshift/49-dl/" class="home-link router-link-active"><!----> <span class="site-name">OpenShift Container Platform 4.9 on HPE DL380 and DL360 Gen10 Servers</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-openshift/49-dl/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-openshift/49-dl/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Red Hat OpenShift Container Platform 4.9 on DL Servers</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Solution Deployment</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Solution-deployment-flow.html" class="sidebar-link">Solution Deployment Flow</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Preparing-execution-environment.html" class="sidebar-link">Preparing the execution environment</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Operating-system-deployment.html" aria-current="page" class="active sidebar-link">Operating system deployment</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/User-provisioned-DNS-requirements.html" class="sidebar-link">User-provisioned DNS requirements</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Load-Balancer.html" class="sidebar-link">Load Balancer</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Bootstrap-node.html" class="sidebar-link">Bootstrap node</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Physical-node-configuration.html" class="sidebar-link">Physical node configuration</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Virtual-node-configuration.html" class="sidebar-link">Virtual node configuration</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/OCP-Cluster-deployment.html" class="sidebar-link">Red Hat OpenShift Container Platform Cluster deployment</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/OCP-worker-nodes.html" class="sidebar-link">Red Hat OCP worker nodes</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Deploying-OCP-on-VMware-vSphere.html" class="sidebar-link">Deploying OpenShift Container Platform 4.9 on VMware vSphere</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Additional Features and Functionality</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Resosurces and Additional Links</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="operating-system-deployment"><a href="#operating-system-deployment" class="header-anchor">#</a> Operating system deployment</h1> <p>This section includes,</p> <ul><li>Deploying ESXI on multiple machines in an automated fashion</li> <li>Deploying Red Hat CoreOS using iPXE server</li> <li>Deploying RHEL using PXE server</li></ul> <p>What is PXE boot?</p> <p>Preboot Execution Environment (PXE) is a client-server interface that allows computers in a network to be booted from the server before deploying the obtained OS image in local and remote offices, for PXE enabled clients. PXE network boot is performed using client-server protocols like DHCP (Dynamic Host Configuration Protocol) and TFTP (Trivial File Transfer Protocol).</p> <h1 id="esxi-deployment"><a href="#esxi-deployment" class="header-anchor">#</a> ESXi deployment</h1> <p>This section outlines the steps to programmatically deploy ESXi on all the bare-metal nodes.</p> <h4 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h4> <ol><li>ESXi ISO image is present in the HTTP file path within the installer machine.</li> <li>iLO account with administrative privileges required on servers for configuring ESXi via automation.</li></ol> <h4 id="installation"><a href="#installation" class="header-anchor">#</a> Installation</h4> <ol><li>Enable Python 3 and Ansible environment as mentioned in [installer machine] section of deployment guide.</li> <li>Execute the following command on the installer VM to point to the ESXi deployment directory.</li></ol> <blockquote><p>cd $BASE_DIR/os_deployment/deploy_esxi</p></blockquote> <p><strong>NOTE</strong></p> <p>BASE_DIR is defined in [installer machine] section in deployment guide.</p> <ol><li>Installing requirements</li></ol> <blockquote><p>sudo sh setup.sh</p></blockquote> <ol><li>Update the input_files/config.yml file with web server details for ESXi installation.</li> <li>Use the following command to edit input files/config.yml file.</li></ol> <blockquote><p>sudo ansible-vault edit input_files/config.yml</p></blockquote> <ol><li>Example values for the input configuration is as follows:</li></ol> <p>config:</p> <p>HTTP_server_base_url: http://10.0.x.x/</p> <p>HTTP_file_path: /usr/share/nginx/html/</p> <p>OS_type: esxi67</p> <p>OS_image_name: &lt;ISO_image_name&gt;.iso</p> <p>base_kickstart_filepath: kickstart_files/ks_esxi67.cfg</p> <p><strong>NOTE</strong></p> <p>The default password for the Ansible vault file is changeme.</p> <p>Acceptable values for “OS_type” variable is “esxi67” for ESXi 6.7.</p> <ol><li>Update the input_files/server_details.yml file with server details for ESXi installation.</li> <li>Use the following command to edit input files/server_details.yml file.</li></ol> <blockquote><p>sudo ansible-vault edit input_files/server_details.yml</p></blockquote> <ol><li>Example values for the input configuration for deploying ESXi 6.7 is as follows:</li></ol> <p>servers:</p> <ul><li><p>Server_serial_number: MXxxxxxDP</p> <p>ILO_Address: 10.0.x.x</p> <p>ILO_Username: username</p> <p>ILO_Password: password</p> <p>Hostname: vsphere01.twentynet.local</p> <p>Host_IP: 20.x.x.x</p> <p>Host_Username: root</p> <p>Host_Password: Password</p> <p>Host_Netmask: 255.x.x.x</p> <p>Host_Gateway: 20.x.x.x</p> <p>Host_DNS: 20.x.x.x</p></li> <li><p>Server_serial_number: MXxxxxxDQ</p> <p>ILO_Address: 10.0.x.x</p> <p>ILO_Username: username</p> <p>ILO_Password: password</p> <p>Hostname: vsphere02.twentynet.local</p> <p>Host_IP: 20.0.x.x</p> <p>Host_Username: root</p> <p>Host_Password: Password</p> <p>Host_Netmask: 255.x.x.x</p> <p>Host_Gateway: 20.x.x.x</p> <p>Host_DNS: 20.x.x.x
<strong>NOTE</strong></p></li></ul> <p>The default password for the Ansible vault file is changeme.</p> <p>It is recommended to provide a complex password for the “Host_Password” variable.</p> <p>Provide administrative privileged iLO account username and password.</p> <ol><li>Run playbook to deploy ESXi.</li></ol> <blockquote><p>ansible-playbook deploy.yml --ask-vault-pass</p></blockquote> <p><strong>NOTE</strong></p> <p>In the process of ESXi deployment, ISO image contents will be forcefully moved to BASE_DIR/os_deployment/deploy_esxi/files folder and it needs to be deleted in case of space issues.</p> <p>BASE_DIR is defined in [installer machine](C:\Users\ramanl\Documents\OCP PI 6 deployment guide\Preparing the execution environment\Preparing the execution environment.md#installer-machine) section in deployment guide.</p> <p><strong>NOTE</strong></p> <p>Generic settings done as part of kickstart file for ESXi are as follows. It is recommended that the user reviews and modifies the kickstart file (kickstart_files/ks_esxi67.cfg) to suit their requirements.</p> <p>* Accept End User License Agreement (EULA).</p> <p>* clearpart –alldrives –overwritevmfs</p> <p>* install –firstdisk –overwritevmfs</p> <p>* %firstboot –interpreter=busybox</p> <p>* One standard switch vswitch0 is created with uplinks vmnic0 and vmnic1. it is assigned with the Host_IP defined in the input_files/server_details.yml input file.</p> <p>* NIC teaming is performed with vmnic0 being the active uplink and vmnic1 being the standby uplink.</p> <p>* NIC failover policy is set to –failback yes –failure-detection link –load-balancing mac –notify-switches yes.</p> <h1 id="red-hat-coreos-deployment-using-ipxe-server"><a href="#red-hat-coreos-deployment-using-ipxe-server" class="header-anchor">#</a> Red Hat CoreOS deployment using iPXE server</h1> <p>In this solution, an iPXE Server setup is used for Red Hat Enterprise Linux CoreOS (RHCOS) deployment. This section explains in detail the playbooks required to configure iPXE server on an RHEL 7.6 VM to perform an unattended installation of Red Hat Enterprise Linux CoreOS (RHCOS) for non-ESXi VMs and bare metal servers.</p> <h4 id="prerequisites-2"><a href="#prerequisites-2" class="header-anchor">#</a> Prerequisites</h4> <ol><li>RHEL Ansible engine VM with Ansible 2.9.x and Python 3.6.x.</li> <li><strong>NOTE</strong> Ansible Engine is configured as mentioned in the [installer machine](C:\Users\ramanl\Documents\OCP PI 6 deployment guide\Preparing the execution environment\Preparing the execution environment.md#installer-machine) section of this deployment guide.</li> <li>If the user wishes to setup the iPXE server on a separate RHEL 7.6 VM (other than the Ansible engine VM) preferably or could be bare metal server, they need to have the following minimum configuration:</li></ol> <p>At least 200 GB disk space</p> <p>Two (2) CPU cores</p> <p>8 GB RAM</p> <p>/var has at least 15 GB disk space allocated while partitioning</p> <p>Static IP on the same network as the RHCOS server
Internet access</p> <ol><li>​ Disable Selinux using following steps:
<ol><li>Check the status of SELINUX using command /etc/selinux/config</li> <li>​$ getenforce ​</li> <li>Disable SELINUX</li> <li>​$ sudo sed -i 's/permissive/disabled/g' /etc/selinux/config /etc/selinux/config ​</li></ol></li></ol> <p><strong>NOTE</strong></p> <p>If the current state of “selinux” is “enforcing,” replace the keyword “permissive” in the above command with “enforcing” and then run it.</p> <ol><li>Reboot the RHEL machine.</li> <li>Check the status of SELINUX using command /etc/selinux/config</li></ol> <p><code></code>$ getenforce ​</p> <h4 id="automated-installation-and-configuration-of-ipxe-server"><a href="#automated-installation-and-configuration-of-ipxe-server" class="header-anchor">#</a> Automated Installation and Configuration of iPXE Server</h4> <p>Perform the steps listed below to execute the playbooks for installing and configuring iPXE server</p> <ol><li>Browse to the following directory on the Ansible engine.</li></ol> <p>$ cd $BASE_DIR/os_deployment/deploy_rhcos/  ​</p> <p><strong>NOTE</strong></p> <p>Refer to [installer machine](C:\Users\ramanl\Documents\OCP PI 6 deployment guide\Preparing the execution environment\Preparing the execution environment.md#installer-machine) section of this deployment guide to know the “BASE_DIR” path.</p> <ol><li>Copy Red Hat OpenShift 4.x above install files to directory, preferably under /tmp/ Example: /tmp/image/</li> <li>Update the inventory file “hosts” with the RHEL machine IP on which the user is trying to setup the iPXE server.</li></ol> <p>[ansible_host]
20.x.x.x</p> <ol><li>Update the secrets.yml file located in BASE_DIR/os_deployment/deploy_rhcos/secrets.yml.</li> <li>Use the following command to edit secrets.yml file.</li></ol> <p>$ sudo ansible-vault edit $BASE_DIR/os_deployment/deploy_rhcos/secrets.yml ​</p> <p><strong>NOTE</strong></p> <p>Refer to [installer machine] section of this deployment guide to know the “BASE_DIR” .</p> <p>The default password for the Ansible vault file is <em>changeme.</em></p> <ol><li><p><em>#####################################################################</em> <em># Details of Ansible User Credentials required to set-up the iPXE</em></p> <p><em>###Common Networking</em></p> <p><em># Interface Name Example: interface_name: enp0s10f0</em>
interface_name: &lt;interface_name&gt;</p> <p><em># Ansible Host IP Example: ansible_engine_ip: 20.0.15.115</em></p> <p>ansible_engine_ip: &lt;ansible_engine_ip&gt;</p> <p><em># base DNS domain, Example: base_domain: ocp42.local</em></p> <p>base_domain: &lt;base_domain&gt;</p> <p><em># Openshift sub domain, Example:app_domain: apps.ocp42.local</em></p> <p>app_domain: &lt;app_domain&gt;</p> <p><em># Network router IP Example: gateway: 192.168.42.254</em></p> <p>gateway: gateway</p> <p><em># Network DNS server Example: dns_server: 192.168.42.252</em></p> <p>dns_server: &lt;dns_server&gt;</p> <p><em># DHCP range that is used for OCP nodes Example: dhcp_range: 192.168.42.204,192.168.42.210,24h</em></p> <p>dhcp_range: &lt;dhcp_range&gt;</p> <p><em># Subnet Mask Example: net_mask: 255.255.240.0</em></p> <p>net_mask: &lt;net_mask&gt;</p> <p><em>## OpenShift node network</em></p> <p><em># mac address of master node 1 Example: master1_mac: 08:00:27:36:0A:01</em></p> <p>master1_mac: &lt;master1_mac&gt;</p> <p><em># master node 1 IP address Example: master1_ip: 192.168.42.204</em></p> <p>master1_ip: &lt;master1_ip&gt;</p> <p><em># master node 2 mac address Example: master2_mac: 08:00:27:36:0A:02</em></p> <p>master2_mac: &lt;master2_mac&gt;</p> <p><em># master node 2 IP address Example: master2_ip: 192.168.42.205</em></p> <p>master2_ip: &lt;master2_ip&gt;</p> <p><em># master node 3 mac address Example: master3_mac: 08:00:27:36:0A:03</em></p> <p>master3_mac: &lt;master3_mac&gt;</p> <p><em># master node 3 IP address Example: master3_ip: 192.168.42.206</em></p> <p>master3_ip: &lt;master3_ip&gt;</p> <p><em># bootstrap mac address Example: bootstrap_mac: 08:00:27:36:0A:08</em></p> <p>bootstrap_mac: &lt;bootstrap_mac&gt;</p> <p><em># bootstrap IP address Example: bootstrap_ip: 192.168.42.210</em></p> <p>bootstrap_ip: &lt;bootstrap_ip&gt;</p> <p><em># install media details Example: image_location: &quot;/tmp/image/&quot;</em></p> <p>image_location: &lt;image_location&gt;</p> <p>*# Example: <a href="https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.9/latest/rhcos-4.9.0-x86_64-live-initramfs.x86_64.img" target="_blank" rel="noopener noreferrer">rhcos-4.9.0-x86_64-live-initramfs.x86_64.img*
<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>*live_initramfs_name: &lt;live_initramfs_name&gt;</p> <p>*# Example: <a href="https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.9/latest/rhcos-4.9.0-x86_64-live-kernel-x86_64" target="_blank" rel="noopener noreferrer">rhcos-4.9.0-x86_64-live-kernel-x86_64*
<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>*live_kernel_name:&lt;live_kernel_name&gt;</p> <p>*# Example: <a href="https://mirror.openshift.com/pub/openshift-v4/dependencies/rhcos/4.9/latest/rhcos-4.9.0-x86_64-live-rootfs.x86_64.img" target="_blank" rel="noopener noreferrer">rhcos-4.9.0-x86_64-live-rootfs.x86_64.img*
<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>*live_rootfs_name: &lt;live_rootfs_name&gt;</p></li> <li><p>Run the following Ansible playbook to configure the iPXE server.</p></li></ol> <p>$ ansible-playbook -i hosts master.yml --ask-vault-pass ​</p> <ol><li>Test the setup with MAC address by running the following command</li></ol> <p>$ curl http://localhost:8080/ipxe?mac=08:00:27:36:0A:xx ​</p> <ol><li>Copy the ignition files in &quot; /var/lib/matchbox/ignition &quot; and verify the status of ignition file by using MAC address of all nodes.</li></ol> <p>$ curl http://192.168.42.200:8080/ignition?mac=08:00:27:36:0A:xx ​</p> <ol><li>Boot the VM/Bare Metal using iPXE..</li></ol> <h1 id="rhel-deployment-using-pxe-server"><a href="#rhel-deployment-using-pxe-server" class="header-anchor">#</a> RHEL deployment using PXE Server</h1> <p>In this solution, a PXE Server is used for RHEL 7.x OS deployment and is configured on CentOS (version: CentOS Linux release 7.6.1810 (Core)). The PXE server uses the FTP service for file distribution but can be altered to support HTTP or NFS. This section highlights the steps to configure a PXE server.</p> <h4 id="procedure-for-setting-up-pxe-server-and-deploying-rhel-os"><a href="#procedure-for-setting-up-pxe-server-and-deploying-rhel-os" class="header-anchor">#</a> Procedure for setting up PXE server and deploying RHEL OS</h4> <ol><li><p>Login to the CentOS server to be configured as a PXE server as a user that can run commands as root via sudo.</p></li> <li><p>Install packages such as DHCP, TFTP-server, vSFTPD (FTP server), and xinetd using the following command.</p> <blockquote><p>sudo yum install dhcp tftp tftp-server syslinux vsftpd xinetd</p></blockquote></li> <li><p>Update the DHCP configuration file at <em>/etc/dhcp/dhcpd.conf</em> with the MAC addresses, IP addresses, DNS, and routing details of the installation environment. Domain search is optional. A sample DHCP configuration file is shown as follows.</p> <p>dns-update-style interim;</p> <p>ignore client-updates;</p> <p>authoritative;</p> <p>allow booting;</p> <p>allow bootp;</p> <h1 id="internal-subnet-for-my-dhcp-server"><a href="#internal-subnet-for-my-dhcp-server" class="header-anchor">#</a> internal subnet for my DHCP Server</h1> <p>subnet 20.0.x.x netmask 255.0.0.0 {</p> <p>range 20.0.x.x 20.0.x.x;</p> <p>deny unknown-clients;</p> <p>option domain-name-servers 20.x.x.x;</p> <p>option domain-name &quot;twentynet.local&quot;;</p> <p>option routers 20.x.x.x;</p> <p>option broadcast-address 20.255.255.255;</p> <p>default-lease-time 600;</p> <p>max-lease-time 7200;</p> <p>next-server 20.x.x.x;</p> <p>filename &quot;pxelinux.0&quot;;</p> <p>}</p> <p>#######################################</p> <p>host bootstrap {</p> <p>hardware ethernet 00:50:56:xx:98:df;</p> <p>fixed-address 20.0.x.x;</p> <p>}</p> <p>host master01 {</p> <p>hardware ethernet 00:50:56:95:xx:82;</p> <p>fixed-address 20.0.x.x;</p> <p>}</p> <p>host worker01 {</p> <p>hardware ethernet 00:50:56:xx🆎82;</p> <p>fixed-address 20.0.x.x;</p> <p>}</p></li> <li><p>Trivial File Transfer Protocol (TFTP) is used to transfer files from data server to clients without any kind of authentication. TFTP is used for ignition file loading in PXE-based environment. To configure the TFTP server, edit the configuration file <em>/etc/xinetd.d/tftp</em>. Change the parameter ‘disable = yes’ to ‘disable = no’ and leave the other parameters as is. To edit the <em>/etc/xinetd.d/tftp</em> file, execute the following command.</p> <blockquote><p>sudo vi  /etc/xinetd.d/tftp</p></blockquote> <p>The TFTP configuration file is shown below.</p> <p>service tftp
{</p> <div class="language- extra-class"><pre><code>    socket_type = dgram
    protocol = udp
    wait = yes
    user = root
    server = /usr/sbin/in.tftpd
    server_args = -s /var/lib/tftpboot
    disable = no
    per_source = 11
    cps = 100 2
    flags = IPv4
}
</code></pre></div><p>Network boot related files must be placed in the tftp root directory <em>/var/lib/tftpboot</em>. Run the following commands to copy the required network boot files to <em>/var/lib/tftpboot/</em>.</p> <blockquote><p>sudo cp –v /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot</p></blockquote> <blockquote><p>sudo cp –v /usr/share/syslinux/menu.c32 /var/lib/tftpboot</p></blockquote> <blockquote><p>sudo cp –v /usr/share/syslinux/memdisk /var/lib/tftpboot</p></blockquote> <blockquote><p>sudo cp –v /usr/share/syslinux/mboot.c32 /var/lib/tftpboot</p></blockquote> <blockquote><p>sudo cp –v /usr/share/syslinux/chain.c32 /var/lib/tftpboot</p></blockquote> <blockquote><p>sudo mkdir /var/lib/tftpboot/pxelinux.cfg</p></blockquote> <blockquote><p>sudo mkdir /var/lib/tftpboot/networkboot</p></blockquote></li> <li><p>Copy the RHEL 7.6  (or above) ISO files to the PXE server. Mount it to the <em>/mnt/</em> directory and then copy the contents of the ISO to the local FTP server using the following commands.</p> <blockquote><p>sudo mount –o loop OS file name /mnt/</p></blockquote> <blockquote><p>cd /mnt/</p></blockquote> <blockquote><p>sudo cp –av * /var/ftp/pub/</p></blockquote></li> <li><p>Copy the kernel file (vmlinuz) and initrd file from <em>/mnt</em> to <em>/var/lib/tftpboot/networkboot/</em> using the following commands.</p> <blockquote><p>sudo cp /mnt/images/pxeboot/vmlinuz /var/lib/tftpboot/networkboot/</p></blockquote> <blockquote><p>sudo cp /mnt/images/pxeboot/initrd.img /var/lib/tftpboot/networkboot</p></blockquote></li> <li><p>Unmount the ISO files using the following command.</p> <blockquote><p>sudo unmount /mnt/</p></blockquote></li> <li><p>For RHEL nodes, create and utilize a new kickstart file under the folder <em>/var/ftp/pub</em> with the name “<em>rhel7.cfg</em>” using the following command.</p> <blockquote><p>sudo vi /var/ftp/pub/rhel7.cfg</p></blockquote> <p>A sample kickstart file is shown as follows. The installation user should create a kickstart file to meet the requirements of their installation environment.</p> <p>firewall --disabled</p> <h1 id="install-os-instead-of-upgrade"><a href="#install-os-instead-of-upgrade" class="header-anchor">#</a> Install OS instead of upgrade</h1> <p>install</p> <h1 id="use-ftp-installation-media"><a href="#use-ftp-installation-media" class="header-anchor">#</a> Use FTP installation media</h1> <p>url --url=&quot;ftp://&lt;FTP_server_IP_address&gt;/pub/rhel76/&quot;</p> <h1 id="root-password"><a href="#root-password" class="header-anchor">#</a> Root password</h1> <h1 id="root-password-can-be-plaintext-as-shown-below"><a href="#root-password-can-be-plaintext-as-shown-below" class="header-anchor">#</a> root password can be plaintext as shown below</h1> <p>rootpw –plaintext password;</p> <h1 id="root-password-is-encrypted-using-the-command-openssl-passwd-1-password-and-resultant-output-is-provided-for-rootpw-as-shown-below"><a href="#root-password-is-encrypted-using-the-command-openssl-passwd-1-password-and-resultant-output-is-provided-for-rootpw-as-shown-below" class="header-anchor">#</a> root password is encrypted using the command “openssl passwd -1 password” and resultant output is provided for rootpw as shown below</h1> <p>rootpw --iscrypted $6$uiq8l/7xEWsYXhrvaEgan4N21yhLa8K.U7UA12Th3PD11GOXvEcI40gp</p> <h1 id="system-authorization-information"><a href="#system-authorization-information" class="header-anchor">#</a> System authorization information</h1> <p>auth useshadow passalgo=sha512</p> <h1 id="use-graphical-install"><a href="#use-graphical-install" class="header-anchor">#</a> Use graphical install</h1> <p>graphical</p> <p>firstboot disable</p> <h1 id="system-keyboard-timezone-language"><a href="#system-keyboard-timezone-language" class="header-anchor">#</a> System keyboard, timezone, language</h1> <p>keyboard us</p> <p>timezone Europe/Amsterdam</p> <p>lang en_US</p> <h1 id="selinux-configuration"><a href="#selinux-configuration" class="header-anchor">#</a> SELinux configuration</h1> <p>selinux disabled</p> <h1 id="installation-logging-level"><a href="#installation-logging-level" class="header-anchor">#</a> Installation logging level</h1> <p>logging level=info</p> <h1 id="system-bootloader-configuration"><a href="#system-bootloader-configuration" class="header-anchor">#</a> System bootloader configuration</h1> <p>bootloader location=mbr</p> <p>clearpart --all --initlabel</p> <p>part swap --asprimary --fstype=&quot;swap&quot; --size=1</p> <p>part /boot --fstype xfs --size=300</p> <p>part pv.01 --size=1 --grow</p> <p>volgroup root_vg01 pv.01</p> <p>logvol / --fstype xfs --name=lv_01 --vgname=root_vg01 --size=1 --grow</p> <p>%packages</p> <p>@^minimal</p> <p>@core</p> <p>%end</p> <p>%addon com_redhat_kdump --disable --reserve-mb='auto'</p> <p>%end</p></li> <li><p>Create a PXE menu:</p> <ul><li><p>Create a PXE menu file at the location <em>/var/lib/tftpboot/pxelinux.cfg/default</em> using the command.</p> <blockquote><p>sudo vi /var/lib/tftpboot/pxelinux.cfg/default</p></blockquote></li> <li><p>For each of the OS boot options, provide the following details:</p> <ul><li>MENU LABEL – Custom name of the respective menu label.</li> <li>KERNEL – Kernel details of the operating system.</li> <li>APPEND - Path of bootloader file along with path of cfg or configuration file (in case of RHEL).</li></ul></li></ul> <p>A sample PXE menu is shown as follows.</p> <p>default menu.c32</p> <p>prompt 0</p> <p>timeout 30</p> <p>MENU TITLE LinuxTechi.com PXE Menu</p> <p>LABEL rhel76</p> <p>MENU LABEL RHEL76-Buedata</p> <p>KERNEL /rhel76/vmlinuz</p> <p>APPEND initrd=/rhel76/initrd.img inst.repo=ftp://&lt;FTP_server_IP_address&gt;/pub/rhel76 ks=ftp://&lt;FTP_server_IP_address&gt;/pub/rhel76-hcp.cfg</p> <p>LABEL rhcos-bootstrap</p> <p>MENU LABEL Install RHCOS4.3 sec-Bootstrap</p> <p>KERNEL /networkboot/rhcos-4.3.0-x86_64-installer-kernel</p> <p>APPEND ip=dhcp rd.neednet=1 initrd=/networkboot/rhcos-4.3.0-x86_64-installer-initramfs.img console=tty0 console=ttyS0 coreos.inst=yes coreos.inst.install_dev=sda coreos.inst.image_url= ftp://&lt;FTP_server_IP_address&gt;/pub/rhcos-4.3.0-x86_64-metal-bios.raw.gz coreos.inst.ignition_url= ftp://&lt;FTP_server_IP_address&gt;/pub/sec/bootstrap.ign</p> <p>LABEL rhcos-master</p> <p>MENU LABEL Install RHCOS4.2 sec-Master</p> <p>KERNEL /networkboot/rhcos-4.3.0-x86_64-installer-kernel</p> <p>APPEND ip=dhcp rd.neednet=1 initrd=/networkboot/rhcos-4.3.0-x86_64-installer-initramfs.img console=tty0 console=ttyS0 coreos.inst=yes coreos.inst.install_dev=sda coreos.inst.image_url= ftp://&lt;FTP_server_IP_address&gt;/pub/rhcos-4.3.0-x86_64-metal-bios.raw.gz coreos.inst.ignition_url=ftp://&lt;FTP_server_IP_address&gt;/pub/sec/master.ign</p> <p>LABEL rhcos-worker</p> <p>MENU LABEL Install RHCOS4.2 sec-Worker</p> <p>KERNEL /networkboot/rhcos-4.3.0-x86_64-installer-kernel</p> <p>APPEND ip=dhcp rd.neednet=1 initrd=/networkboot/rhcos-4.3.0-x86_64-installer-initramfs.img console=tty0 console=ttyS0 coreos.inst=yes coreos.inst.install_dev=sda coreos.inst.image_url= ftp://&lt;FTP_server_IP_address&gt;/pub/rhcos-4.3.0-x86_64-metal-bios.raw.gz coreos.inst.ignition_url=ftp://&lt;FTP_server_IP_address&gt;/pub/sec/worker.ign</p></li> <li><p>Start and enable xinetd, dhcpd and vsftpd using the following commands.</p> <div class="language- extra-class"><pre><code>&gt; sudo systemctl start xinetd

&gt; sudo systemctl enable xinetd

&gt; sudo systemctl start dhcpd.service

&gt; sudo systemctl enable dhcpd.service

&gt; sudo systemctl start vsftpd

&gt; sudo systemctl enable vsftpd
</code></pre></div></li> <li><p>Configure SELinux for FTP.</p></li></ol> <blockquote><p>sudo setsebool –P allow_ftpd_full_access 1</p></blockquote> <ol><li>Open ports in the firewall using the following firewall-cmd commands.</li></ol> <blockquote><p>sudo firewall-cmd --add-service-ftp --permanent</p></blockquote> <blockquote><p>sudo firewall-cmd --add-service-dhcp --permanent</p></blockquote> <blockquote><p>sudo firewall-cmd –reload</p></blockquote> <p><strong>NOTE</strong></p> <p>It is crucial to generate ignition files, copy them to the TFTP server, and update the path in the PXE default file. For more information about generating the ignition files, refer to the section Kubernetes manifests and ignition files in this document.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Preparing-execution-environment.html" class="prev">
        Preparing the execution environment
      </a></span> <span class="next"><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/User-provisioned-DNS-requirements.html">
        User-provisioned DNS requirements
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-openshift/49-dl/assets/js/app.3ab76ca9.js" defer></script><script src="/hpe-solutions-openshift/49-dl/assets/js/2.692be357.js" defer></script><script src="/hpe-solutions-openshift/49-dl/assets/js/30.437b3702.js" defer></script>
  </body>
</html>
