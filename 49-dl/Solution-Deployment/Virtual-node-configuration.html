<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Virtual node configuration | OpenShift Container Platform 4.9 on HPE DL380 and DL360 Gen10 Servers</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Hewlett Packard Enterprise">
    
    <link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/css/0.styles.b9906ffc.css" as="style"><link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/js/app.345a4747.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/js/2.1d456c38.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/js/37.cd07fe81.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/10.62dc0480.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/11.78501e35.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/12.0783e09f.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/13.40a6ad43.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/14.07d5945d.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/15.fde92b29.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/16.7e8e420a.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/17.2802885f.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/18.58526e52.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/19.630bf207.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/20.8dfb5f36.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/21.5e97d87e.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/22.f6a9ca7b.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/23.ba950326.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/24.2d1cd189.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/25.6d1197f3.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/26.3ca42f32.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/27.673f44ad.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/28.74f882ee.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/29.511a40f2.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/3.5ee6a39f.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/30.22bb1d64.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/31.8ebf7398.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/32.a8634f30.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/33.932878b6.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/34.fa2e8c6a.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/35.895ef63f.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/36.82290211.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/4.680b6d9a.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/5.47be59b9.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/6.595aa434.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/7.0773207d.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/8.f5a054d7.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/9.8c6e963a.js">
    <link rel="stylesheet" href="/hpe-solutions-openshift/49-dl/assets/css/0.styles.b9906ffc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-openshift/49-dl/" class="home-link router-link-active"><!----> <span class="site-name">OpenShift Container Platform 4.9 on HPE DL380 and DL360 Gen10 Servers</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-openshift/49-dl/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-openshift/49-dl/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Red Hat OpenShift Container Platform 4.9 on DL Servers</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Solution Deployment</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Solution-deployment-flow.html" class="sidebar-link">Solution Deployment Flow</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Preparing-execution-environment.html" class="sidebar-link">Preparing the execution environment</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Operating-system-deployment.html" class="sidebar-link">Operating system deployment</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/User-provisioned-DNS-requirements.html" class="sidebar-link">User-provisioned DNS requirements</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Load-Balancer.html" class="sidebar-link">Load Balancer</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Bootstrap-node.html" class="sidebar-link">Bootstrap node</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Physical-node-configuration.html" class="sidebar-link">Physical node configuration</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Virtual-node-configuration.html" aria-current="page" class="active sidebar-link">Virtual node configuration</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/OCP-Cluster-deployment.html" class="sidebar-link">Red Hat OpenShift Container Platform Cluster deployment</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/OCP-worker-nodes.html" class="sidebar-link">Red Hat OCP worker nodes</a></li><li><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Deploying-OCP-on-VMware-vSphere.html" class="sidebar-link">Deploying OpenShift Container Platform 4.9 on VMware vSphere</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Additional Features and Functionality</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Resosurces and Additional Links</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="virtual-node-configuration"><a href="#virtual-node-configuration" class="header-anchor">#</a> Virtual node configuration</h1> <p>This section describes the process to deploy virtualization hosts for OpenShift. This section outlines the steps required to configure virtual machine master and worker nodes. At a high level, these steps are as follows:</p> <ul><li><p>Deploying the vSphere hosts</p></li> <li><p>Creating the data center, cluster, and adding hosts into the cluster</p></li> <li><p>Creating a datastore in vCenter</p></li> <li><p>Create virtual master nodes</p></li> <li><p>Deploying virtual worker nodes</p></li></ul> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Hewlett Packard Enterprise utilized a consistent method for deployment that would allow for mixed deployments of virtual and physical master and worker nodes and built this solution on bare metal using the Red Hat OpenShift Container Platform user-provisioned infrastructure. For more details on the bare metal provisioner, refer to <a href="https://cloud.redhat.com/openshift/install/metal/user-provisioned" target="_blank" rel="noopener noreferrer">https://cloud.redhat.com/openshift/install/metal/user-provisioned<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. If the intent is to have an overall virtual environment, it is recommended the installation user utilizes Red Hat's virtual provisioning methods found at <a href="https://docs.openshift.com/container-platform/4.9/installing/installing_vsphere/installing-vsphere.html#installing-vsphere" target="_blank" rel="noopener noreferrer">https://docs.openshift.com/container-platform/4.9/installing/installing_vsphere/installing-vsphere.html#installing-vsphere.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h3 id="deploying-vsphere-hosts"><a href="#deploying-vsphere-hosts" class="header-anchor">#</a> Deploying vSphere hosts</h3> <p>The following steps describes the process to install the hypervisor:</p> <ol><li><p>From the HPE iLO interface, navigate to Remote Session and launch Console.</p></li> <li><p>From the Remote Console window, choose <strong>Virtual Drives -&gt; Image File CD-ROM/DVD</strong> from the <strong>iLO options</strong> menu bar.</p></li> <li><p>Navigate to the VMware ESXi 6.7 ISO file located on the installation system. Select the ISO file and click <strong>Open</strong>.</p></li> <li><p>If the server is in the powered off state, power switch on the server by selecting <strong>Power Switch -&gt; Momentary Press.</strong></p></li> <li><p>During boot, press <strong>F11</strong> Boot Menu and select iLO Virtual USB 3: iLO Virtual CD-ROM.</p></li> <li><p>When the VMware ESXi installation media has finished loading, proceed through the VMware user prompts. For storage device, select the 40 GiB OS volume and <strong>set the root password.</strong></p></li> <li><p>Wait until the vSphere installation is complete.</p></li> <li><p>After the installation is complete, press <strong>F2</strong> to enter the vSphere host configuration page and update the IP address, gateway, DNS, hostname of the host and enable SSH.</p></li> <li><p>After the host is reachable, proceed with the next section.</p></li></ol> <h3 id="creating-the-data-center-cluster-and-adding-hosts-in-vmware-vcenter"><a href="#creating-the-data-center-cluster-and-adding-hosts-in-vmware-vcenter" class="header-anchor">#</a> Creating the Data center, Cluster and adding Hosts in VMware vCenter</h3> <p>This section assumes a VMware vCenter server is available within the installation environment. A data center is a structure in VMware vCenter which contains clusters, hosts, and datastore. To begin with, a data center needs to be created, followed by the clusters and adding hosts into the clusters.</p> <p>To create a data center, a cluster enabled with vSAN and DRS and adding hosts, the installation user will need to edit the vault file and the variables YAML file. Using an editor, open the file /opt/hpe/solutions/ocp/hpe-solutions-openshift/DL/scalable/vsphere/vcenter/roles/prepare_vcenter/vars/main.yml to provide the names for data center, clusters and vSphere hostnames. A sample input file is listed and as follows. Installation user should modify this file to suit the environment.</p> <p>In the Ansible vault file (<em>secret.yml</em>) found at /opt/hpe/solutions/ocp/<em>hpe-solutions-openshift/DL/scalable/vsphere/vcenter</em>, provide the vCenter and the vSphere host credentials.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code>
<span class="token comment"># vsphere hosts credentials</span>

<span class="token key atrule">vsphere_username</span><span class="token punctuation">:</span> &lt;username<span class="token punctuation">&gt;</span>

<span class="token key atrule">vsphere_password</span><span class="token punctuation">:</span> &lt;password<span class="token punctuation">&gt;</span>

<span class="token comment"># vcenter hostname/ip address and credentials</span>

<span class="token key atrule">vcenter_hostname</span><span class="token punctuation">:</span> x.x.x.x

<span class="token key atrule">vcenter_username</span><span class="token punctuation">:</span> &lt;username<span class="token punctuation">&gt;</span>

<span class="token key atrule">vcenter_password</span><span class="token punctuation">:</span> &lt;password<span class="token punctuation">&gt;</span>

</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>This section assumes all the virtualization hosts have a common username and password. If it does not have a common username and password, it is up to the installation user to add the virtualization hosts within the appropriate cluster.</p></div> <p>Variables for running the playbook can be found at /opt/hpe/solutions/ocp/hpe-solutions-openshift/DL/scalable/vsphere/vcenter/roles/prepare_vcenter/vars/main.yml.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code>
<span class="token comment"># custom name for data center to be created.</span>

<span class="token key atrule">datacenter_name</span><span class="token punctuation">:</span> datacenter

<span class="token comment"># custom name of the compute clusters with the ESXi hosts for Management VMs.</span>

<span class="token key atrule">management_cluster_name</span><span class="token punctuation">:</span> management<span class="token punctuation">-</span>cluster

<span class="token comment"># hostname or IP address of the vsphere hosts utilized for the management nodes.</span>

<span class="token key atrule">vsphere_host_01</span><span class="token punctuation">:</span> 10.0.x.x

<span class="token key atrule">vsphere_host_02</span><span class="token punctuation">:</span> 10.0.x.x

<span class="token key atrule">vsphere_host_03</span><span class="token punctuation">:</span> 10.0.x.x
</code></pre></div><p>After the variable files are updated with the appropriate values, execute the following command within the installer VM to create the data center, clusters, and add hosts into respective clusters.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> /opt/hpe/solutions/ocp/hpe-solutions-openshift/DL/scalable/vsphere/vcenter/
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ansible-playbook playbooks/prepare_vcenter.yml –ask-vault-pass
</code></pre></div><h3 id="creating-a-datastore-in-vcenter"><a href="#creating-a-datastore-in-vcenter" class="header-anchor">#</a> Creating a Datastore in vCenter</h3> <p>A datastore needs to be created in VMware vCenter from the volume carved out of HPE Storage SANs to store the VMs. The following are the steps to create a datastore in vCenter:</p> <ol><li><p>From the vSphere Web Client navigator, right-click the cluster, select <strong>Storage</strong> from the menu, and then select the <strong>New Datastore</strong>.</p></li> <li><p>From the Type page, select <strong>VMFS</strong> as the Datastore type and click <strong>Next</strong>.</p></li> <li><p>Enter the datastore name and if necessary, select the placement location for the datastore and click <strong>Next</strong>.</p></li> <li><p>Select the device to use for the datastore and click <strong>Next</strong>.</p></li> <li><p>From VMFS version page, select <strong>VMFS 6</strong> and click <strong>Next</strong>.</p></li> <li><p>Define the following configuration requirements for the datastore as per the installation environment and click <strong>Next</strong>.</p> <p>a.  Specify partition configuration</p> <p>b.  Datastore Size</p> <p>c.  Block Size</p> <p>d.  Space Reclamation Granularity</p> <p>e.  Space Reclamation Priority</p></li> <li><p>On the Ready to complete page, review the Datastore configuration and click <strong>Finish</strong>.</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>If you utilize virtual worker nodes, repeat this section to create a Datastore to store the worker virtual machines.</p></div></li></ol> <h3 id="red-hat-openshift-container-platform-sizing"><a href="#red-hat-openshift-container-platform-sizing" class="header-anchor">#</a> Red Hat OpenShift Container Platform sizing</h3> <p>Red Hat OpenShift Container Platform sizing varies depending on the requirements of the organization and type of deployment. This section highlights the host sizing details recommended by Red Hat.</p> <table><thead><tr><th>Resource</th> <th>Bootstrap node</th> <th>Master node</th> <th>Worker node</th></tr></thead> <tbody><tr><td>CPU</td> <td>4</td> <td>4</td> <td>4</td></tr> <tr><td>Memory</td> <td>16GB</td> <td>16GB</td> <td>16GB</td></tr> <tr><td>Disk storage</td> <td>120GB</td> <td>120GB</td> <td>120GB</td></tr> <tr><td>Disk storage</td> <td>120GB</td> <td>120GB</td> <td>120GB</td></tr></tbody></table> <p>Disk partitions on each of the nodes are as follows.</p> <ul><li><p>/var -- 40GB</p></li> <li><p>/usr/local/bin -- 1GB</p></li> <li><p>Temporary directory -- 1GB</p></li></ul> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Sizing for worker nodes is ultimately dependent on the container workloads and their CPU, memory, and disk requirements.</p> <p>For more information about Red Hat OpenShift Container Platform sizing, refer to the Red Hat OpenShift Container Platform 4.9 product documentation at <a href="https://access.redhat.com/documentation/en-us/openshift_container_platform/4.9/html/scalability_and_performance/index" target="_blank" rel="noopener noreferrer">https://access.redhat.com/documentation/en-us/openshift_container_platform/4.9/html/scalability_and_performance/index.<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <h3 id="deploying-virtual-master-nodes"><a href="#deploying-virtual-master-nodes" class="header-anchor">#</a> Deploying virtual master nodes</h3> <p>This section outlines the steps to create the virtual machines used as the master nodes.</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>This section utilized vSphere rules such as affinity and anti-affinity rules to ensure no two master nodes are present on the same vSphere host, hence it is essential to enable vMotion in all the vSphere hosts. If not enabled, select the vSphere host in the VMware vCenter server user interface, <strong>click -&gt; Configure -&gt; Networking -&gt; VMkernel adapters -&gt; Management Network -&gt; Edit</strong> and select the checkbox against vMotion to enable vMotion.</p></div> <p>To create the virtual machines for the OpenShift master nodes, edit the variables file. Use an editor such as Vim or Nano, open the file /opt/hpe/solutions/ocp/<em>hpe-solutions-openshift/DL/scalable/vsphere/virtual_nodes /roles/deploy_vm/vars/main.yml.</em> The variable file contains information about the VMs, vCenter, hostnames, IP addresses, memory, and CPU. A sample variable file is provided and as follows. The installation user should modify the file to make it suitable for the target environment.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code>
<span class="token comment"># Name of the Data center</span>

<span class="token key atrule">datacenter_name</span><span class="token punctuation">:</span> &lt;datacentername<span class="token punctuation">&gt;</span>

<span class="token comment"># Name of the compute clusters with the ESXi hosts for Management VMs</span>

<span class="token key atrule">management_cluster_name</span><span class="token punctuation">:</span> &lt;data_cluster_name<span class="token punctuation">&gt;</span>

<span class="token comment"># Name of the Datastore to store the VMs</span>

<span class="token key atrule">management_datastore_name</span><span class="token punctuation">:</span> &lt;datastore_name<span class="token punctuation">&gt;</span>

<span class="token comment"># Name of the coreOS guest image</span>

<span class="token key atrule">guest_template</span><span class="token punctuation">:</span> coreos64Guest

<span class="token comment"># Disk size in GB/GiB</span>

<span class="token key atrule">bootstrap_disk</span><span class="token punctuation">:</span> <span class="token number">120</span>

<span class="token key atrule">master_disk</span><span class="token punctuation">:</span> <span class="token number">120</span>

<span class="token key atrule">lb_disk</span><span class="token punctuation">:</span> <span class="token number">50</span>

<span class="token comment"># number of CPUs</span>

<span class="token key atrule">bootstrap_cpu</span><span class="token punctuation">:</span> <span class="token number">4</span>

<span class="token key atrule">master_cpu</span><span class="token punctuation">:</span> <span class="token number">4</span>

<span class="token key atrule">lb_cpu</span><span class="token punctuation">:</span> <span class="token number">4</span>

<span class="token comment"># Memory size in MB/MiB</span>

<span class="token key atrule">bootstrap_memory</span><span class="token punctuation">:</span> <span class="token number">16400</span>

<span class="token key atrule">master_memory</span><span class="token punctuation">:</span> <span class="token number">16400</span>

<span class="token key atrule">lb_memory</span><span class="token punctuation">:</span> <span class="token number">16400</span>

<span class="token key atrule">gateway</span><span class="token punctuation">:</span> &lt;replace_with_gateway_ip<span class="token punctuation">&gt;</span>

<span class="token key atrule">dns_server</span><span class="token punctuation">:</span> &lt;replace_with_dns_server_ip<span class="token punctuation">&gt;</span>

<span class="token key atrule">domain</span><span class="token punctuation">:</span> &lt;replace_with_domain_ip<span class="token punctuation">&gt;</span>

<span class="token comment"># name of the master, bootstrap and lb nodes &lt; short names, not the FQDN &gt;</span>

<span class="token key atrule">bootstrap01_name</span><span class="token punctuation">:</span> &lt;bootstrap01_host_name<span class="token punctuation">&gt;</span>

<span class="token key atrule">master01_name</span><span class="token punctuation">:</span> &lt;master01_host_name<span class="token punctuation">&gt;</span>

<span class="token key atrule">master02_name</span><span class="token punctuation">:</span> &lt;master02_host_name<span class="token punctuation">&gt;</span>

<span class="token key atrule">master03_name</span><span class="token punctuation">:</span> &lt;master03_host_name<span class="token punctuation">&gt;</span>

<span class="token key atrule">lb01_name</span><span class="token punctuation">:</span> &lt;lb01_host_name<span class="token punctuation">&gt;</span>

<span class="token key atrule">domain_name</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;sub_domain&gt;&quot;</span>

<span class="token comment"># Network names for the management network</span>

<span class="token key atrule">datacenter_network_name</span><span class="token punctuation">:</span> <span class="token string">&quot;&lt;network_name&gt;&quot;</span>

<span class="token comment"># vSphere affinity &amp; anti-affinity rules</span>

<span class="token key atrule">affinity_rule_name</span><span class="token punctuation">:</span> <span class="token string">&quot;vsphere-anti-affinty-rule&quot;</span>

<span class="token key atrule">anti_affinity_rule_name</span><span class="token punctuation">:</span> <span class="token string">&quot;vsphere-affinty-rule&quot;</span>
</code></pre></div><p>After the variable file is updated, execute the following command from the installer machine to deploy the specified VMs.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> /opt/hpe/solutions/ocp/hpe-solutions-openshift/DL/scalable/vsphere/virtual_nodes
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ansible-playbook playbooks/deploy_vm.yml –ask-vault-pass
</code></pre></div><p><em>deploy_vm.yml</em> playbooks create 3x VMs to be used as master nodes, 1x VM to be used as load balancer node and 1x VM to be used as a bootstrap node. All the master VMs will be deployed on different hosts whereas bootstrap &amp; haproxy VMs will be deployed on any single host.</p> <p>Wait for some time for vSphere rules to be applicable on VMs. vSphere rules can be viewed at <strong>vCenter server -&gt; Datacenter -&gt; Cluster -&gt; Configure -&gt; VM/Host Rules</strong>.The 3 master nodes are part of the <em>vsphere-anti-affinity-rule</em> and each master VM will reside on a different vSphere host. The bootstrap and load balancer VMs are part of the <em>vsphere-affinity-rule</em> and they are co-resident on one of 3 vSphere hosts.</p> <p>It is recommended to ensure the <em>Boot Delay</em> is long enough to enable OS installation via PXE server.</p> <p>After the virtual machines are successfully created, refer to the following steps to install the operating system on the bootstrap node and the master nodes:</p> <ol><li><p>Ensure that the location of ignition files of the corresponding nodes is updated in the PXE configuration files.</p></li> <li><p>Ensure the MAC address of the network adapter in VM is updated with the corresponding IP address in the DHCP configuration file.</p></li> <li><p>Ensure that the load balancer server is up and running.</p></li> <li><p>From the VMware vCenter Server, select the VM, and launch the VM Remote console.</p></li> <li><p>From the Remote Console window, power on the VM.</p></li> <li><p>While booting, select the appropriate OS label.</p></li> <li><p>Wait until the OS installation is complete.</p></li> <li><p>Verify the installation by logging on to the node from the installer VM using the following command.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">ssh</span> core@<span class="token operator">&lt;</span> replace_with_node_fqdn_or_ip <span class="token operator">&gt;</span>
</code></pre></div></li></ol> <p>After the RHCOS master nodes are ready, refer to the section <a href="../solution-deployment/ocp-cluster-deployment#red-hat-openShift-container-platform-cluster-deployment">Red Hat OpenShift Container Platform Cluster deployment</a> in this document to create the OpenShift 4 cluster.</p> <h3 id="deploying-virtual-worker-nodes"><a href="#deploying-virtual-worker-nodes" class="header-anchor">#</a> Deploying virtual worker nodes</h3> <p>This section outlines the steps to create virtual machines and configure them to be used as worker nodes.</p> <h3 id="creating-virtual-machines"><a href="#creating-virtual-machines" class="header-anchor">#</a> Creating virtual machines</h3> <p>This section outlines the steps to create virtual machines.</p> <ol><li><p>Login to vCenter using the Web Client and select an ESXi Host. Right-click the host and then click <strong>New Virtual Machine</strong> to open a <em>New Virtual Machine Wizard</em>.</p></li> <li><p>From <em>Select a creation type</em>, select <strong>Create a new virtual machine</strong> and click <strong>Next</strong>.</p></li> <li><p>Enter a unique <em>Name</em> for the VM and select the <strong>Datacenter</strong>. Click <strong>Next</strong>.</p></li> <li><p>Select the <strong>Cluster</strong> on which the VM can be deployed. Click <strong>Next</strong>.</p></li> <li><p>Select the <strong>Datastore</strong> on which the VM can be stored and click <strong>Next</strong>.</p></li> <li><p>On the Select compatibility page, choose <strong>ESXI 6.7 and later</strong> and click <strong>Next</strong>.</p></li> <li><p>On the Select a guest OS page, choose the Guest OS family as <strong>Linux</strong> and Guest OS Version as <strong>Red Hat Enterprise Linux 7 (64 bit)</strong> (in case of RHEL worker) and <strong>Red Hat CoreOS</strong> (in case of Red Hat CoreOS worker) and select <strong>Next</strong>.</p></li> <li><p>In the Customize hardware page, configure the Virtual Hardware with <strong>4 CPU</strong>, <strong>16 GB</strong> Memory, <strong>150 GB</strong> <strong>dual Hard Disk</strong> as per requirement and attach the Operating System from the datastore.
Select the Connect at <strong>Power on</strong> option and click <strong>Next</strong>.</p></li> <li><p>Review the virtual machine configuration before deploying the virtual machine and click <strong>Finish</strong> to complete the New Virtual Machine wizard.</p></li></ol> <h3 id="red-hat-coreos-worker-nodes"><a href="#red-hat-coreos-worker-nodes" class="header-anchor">#</a> Red Hat CoreOS worker nodes</h3> <p>Refer to the section <a href="#virtual-node-configuration">Creating virtual machines</a> in the document to create virtual machines. After the virtual machines are successfully created, refer to the following steps to install the
operating system on the worker nodes:</p> <ol><li><p>Ensure that the location of ignition files of the corresponding nodes is updated in the PXE configuration files.</p></li> <li><p>Ensure the MAC address of the network adapter in VM is updated with the corresponding IP address in the DHCP configuration file.</p></li> <li><p>Ensure that the load balancer server is up and running.</p></li> <li><p>From the VMware vCenter Server, select the VM and launch the VM Remote console.</p></li> <li><p>From the Remote Console window, power on the VM.</p></li> <li><p>While booting, select the appropriate OS label.</p></li> <li><p>Wait until the OS installation is complete.</p></li> <li><p>Verify the installation by logging on to the node from the installer VM using the following command.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">ssh</span> core@<span class="token operator">&lt;</span> replace_with_node_fqdn_or_ip <span class="token operator">&gt;</span>
</code></pre></div></li></ol> <p>After the RHCOS worker nodes are up and running, refer to the section <a href="../solution-deployment/ocp-worker-nodes#adding-rhel-7.6-worker-nodes">Adding RHEL 7.6 worker nodes</a> in the document to add them to OpenShift 4 cluster.</p> <h3 id="rhel-7-6-worker-nodes"><a href="#rhel-7-6-worker-nodes" class="header-anchor">#</a> RHEL 7.6 worker nodes</h3> <p>Refer to the section <a href="#creating-virtual-machines">Creating virtual machines</a> in this document to create virtual machines. After the virtual machines are successfully created, follow these steps to install the operating system on the worker nodes:</p> <ol><li><p>Ensure that the location of ignition files of the corresponding nodes is updated in the PXE configuration files.</p></li> <li><p>Ensure the MAC address of the network adapter in VM is updated with the corresponding IP address in the DHCP configuration file.</p></li> <li><p>Ensure that the load balancer server is up and running.</p></li> <li><p>From the VMware vCenter Server, select the VM, and launch the VM Remote console.</p></li> <li><p>From the Remote Console window, power on the VM.</p></li> <li><p>While booting, select the appropriate OS label.</p></li> <li><p>Wait until the OS installation is complete.</p></li> <li><p>Verify the installation by logging on to the node from the installer VM using the following command.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">ssh</span> root@<span class="token operator">&lt;</span> node_fqdn or node_ip_address<span class="token operator">&gt;</span>
</code></pre></div></li></ol> <p>Once the RHEL 7.6 nodes are reachable, refer to the section <a href="../solution-deployment/physical-node-configuration#preparing-worker-nodes-with-rhel">RHEL 7.6 worker nodes</a> in the document to prepare the RHEL worker nodes. After preparing the worker nodes, refer to the section <a href="../solution-deployment/ocp-worker-nodes##adding-rhel-7.6-worker-nodes">Adding RHEL 7.6 worker nodes</a> in the document to add them to the OpenShift 4 cluster.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/Physical-node-configuration.html" class="prev">
        Physical node configuration
      </a></span> <span class="next"><a href="/hpe-solutions-openshift/49-dl/Solution-Deployment/OCP-Cluster-deployment.html">
        Red Hat OpenShift Container Platform Cluster deployment
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-openshift/49-dl/assets/js/app.345a4747.js" defer></script><script src="/hpe-solutions-openshift/49-dl/assets/js/2.1d456c38.js" defer></script><script src="/hpe-solutions-openshift/49-dl/assets/js/37.cd07fe81.js" defer></script>
  </body>
</html>
