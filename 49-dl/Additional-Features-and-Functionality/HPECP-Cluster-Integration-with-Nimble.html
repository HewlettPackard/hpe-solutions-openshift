<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>HPECP Cluster Integration with Nimble | OpenShift Container Platform 4.9 on HPE DL380 and DL360 Gen10 Servers</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Hewlett Packard Enterprise">
    
    <link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/css/0.styles.b9906ffc.css" as="style"><link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/js/app.3ab76ca9.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/js/2.692be357.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/js/12.cb2fa787.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/10.d80efe23.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/11.34937674.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/13.de116ec1.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/14.61bf774b.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/15.4c949536.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/16.e90f0158.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/17.1d47a547.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/18.23a9e026.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/19.a8595bd6.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/20.4e8d28b5.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/21.ee6fa1e2.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/22.d72bcd0d.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/23.b06cbde8.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/24.d16dfbc6.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/25.865e626b.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/26.61c365e8.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/27.b22ca90b.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/28.3a70d9c4.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/29.c47171c1.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/3.aac6da1f.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/30.437b3702.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/31.efe2a4fb.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/32.1ad54211.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/33.35dc4767.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/34.feb50123.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/35.851c39b1.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/4.08272df7.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/5.018be1c0.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/6.3bf3aab7.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/7.e24d64b3.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/8.2d9d3197.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/9.e5eeb283.js">
    <link rel="stylesheet" href="/hpe-solutions-openshift/49-dl/assets/css/0.styles.b9906ffc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-openshift/49-dl/" class="home-link router-link-active"><!----> <span class="site-name">OpenShift Container Platform 4.9 on HPE DL380 and DL360 Gen10 Servers</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-openshift/49-dl/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-openshift/49-dl/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Red Hat OpenShift Container Platform 4.9 on DL Servers</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Deployment</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Additional Features and Functionality</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/Storage.html" class="sidebar-link">Storage</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/IPI-Installation.html" class="sidebar-link">IPI deployment of OCP on Bare Metal</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/air-gap-installation.html" class="sidebar-link">Red Hat OpenShift Container Platform installation in the restricted network environment</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/OpenShift-operators.html" class="sidebar-link">OpenShift operators</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/Advanced-Cluster-Management.html" class="sidebar-link">Red Hat Advanced Cluster Management for Kubernetes</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/Install-and-Configure-Velero.html" class="sidebar-link">Install and Configure Velero</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/Ceph-Storage-Setup-External-mode.html" class="sidebar-link">Red Hat Ceph Storage 4 Setup in External mode with ODF Integration</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/OpenShift-Virtualization.html" class="sidebar-link">OpenShift Virtualization</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/OpenShift-Container-Platform-at-the-edge.html" class="sidebar-link">OpenShift Container Platform at the edge</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/Securing-OpenShift-Container-Platform-using-Sysdig.html" class="sidebar-link">Securing Red Hat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/HPECP-Cluster-Integration-with-Nimble.html" aria-current="page" class="active sidebar-link">HPECP Cluster Integration with Nimble</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Resosurces and Additional Links</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="hpecp-cluster-integration-with-nimble"><a href="#hpecp-cluster-integration-with-nimble" class="header-anchor">#</a> HPECP Cluster Integration with Nimble</h1> <p>The HPE CSI(Container Storage Interface) Driver for Kubernetes allows user to use a <a href="https://scod.hpedev.io/container_storage_provider/index.html" target="_blank" rel="noopener noreferrer">Container Storage Provider<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (CSP) to perform data management operations on storage resources. We will be using Nimbule as a backend storage to perform the data Management Operation for the individual Kubernets cluster.</p> <p><strong>Installing the CSI Drivers</strong></p> <p>These object configuration files are common for version of Kubernetes.</p> <ul><li>Worker node IO settings.</li></ul> <p>kubectl create -f <a href="https://raw.githubusercontent.com/hpe-storage/co-deployments/master/yaml/csi-driver/v1.3.0/hpe-linux-config.yaml" target="_blank" rel="noopener noreferrer">https://raw.githubusercontent.com/hpe-storage/co-deployments/master/yaml/csi-driver/v1.3.0/hpe-linux-config.yaml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>Container Storage Provider:</li></ul> <p>kubectl create -f <a href="https://raw.githubusercontent.com/hpe-storage/co-deployments/master/yaml/csi-driver/v1.3.0/nimble-csp.yaml" target="_blank" rel="noopener noreferrer">https://raw.githubusercontent.com/hpe-storage/co-deployments/master/yaml/csi-driver/v1.3.0/nimble-csp.yaml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>Kubernetes 1.18</li></ul> <p>kubectl create -f <a href="https://raw.githubusercontent.com/hpe-storage/co-deployments/master/yaml/csi-driver/v1.3.0/hpe-csi-k8s-1.18.yaml" target="_blank" rel="noopener noreferrer">https://raw.githubusercontent.com/hpe-storage/co-deployments/master/yaml/csi-driver/v1.3.0/hpe-csi-k8s-1.18.yaml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><strong>Adding HPE Storage Backend</strong></p> <p>Once the CSI driver is deployed, two additional objects needs to be created to get started with dynamic provisioning of persistent storage, a Secret and a StorageClass.</p> <p><strong>Secret parameters</strong></p> <p>All parameters are mandatory and described below.</p> <table><thead><tr><th style="text-align:center;"><strong>Parameter</strong></th> <th style="text-align:center;"><strong>Description</strong></th></tr></thead> <tbody><tr><td style="text-align:center;">serviceName</td> <td style="text-align:center;">This hostname or IP address where the Container Storage Provider (CSP) is running, usually a Kubernetes Service, such as &quot;nimble-csp-svc&quot; or &quot;primera3par-csp-svc&quot;</td></tr> <tr><td style="text-align:center;">servicePort</td> <td style="text-align:center;">This is port the serviceName is listening to.</td></tr> <tr><td style="text-align:center;">Backend</td> <td style="text-align:center;">This is the management hostname or IP address of the actual backend storage system, such as a Nimble or 3PAR array.</td></tr> <tr><td style="text-align:center;">username</td> <td style="text-align:center;">Backend storage system username with the correct privileges to perform storage management.</td></tr> <tr><td style="text-align:center;">password</td> <td style="text-align:center;">Backend storage system password.</td></tr></tbody></table> <p>1.Create the secret</p> <p><strong>custom-secret.yaml</strong></p> <p>apiVersion: v1</p> <p>kind: Secret</p> <p>metadata:</p> <p><code></code>name: custom-secret</p> <p><code></code>namespace: kube-system</p> <p>stringData:</p> <p><code></code>serviceName: nimble-csp-svc</p> <p><code></code>servicePort: &quot;8080&quot;</p> <p><code></code>backend: 10.0.2.100</p> <p><code></code>username: admin</p> <p><code></code>password: admin</p> <p>\2. Execute below command to create custom secret file</p> <p><code></code>kubectl create -f custom-secret.yaml</p> <p>\3. We can see the secret in the “kube-system” Namespace
<img src="/hpe-solutions-openshift/49-dl/assets/img/figure122.4b20b089.png" alt=""></p> <p>\4. Create the StorageClass with the custome Secret</p> <p>To use the new Secret &quot;custom-secret&quot;, create a new StorageClass using the Secret and the necessary StorageClass parameters.</p> <p>\5. Sample StorageClass.yaml file</p> <p>apiVersion: storage.k8s.io/v1</p> <p>kind: StorageClass</p> <p>metadata:</p> <p><code></code>name: hpe-custom</p> <p>provisioner: csi.hpe.com</p> <p>parameters:</p> <p><code></code>csi.storage.k8s.io/fstype: xfs</p> <p><code></code>csi.storage.k8s.io/controller-expand-secret-name: custom-secret</p> <p><code></code>csi.storage.k8s.io/controller-expand-secret-namespace: kube-system</p> <p><code></code>csi.storage.k8s.io/controller-publish-secret-name: custom-secret</p> <p><code></code>csi.storage.k8s.io/controller-publish-secret-namespace: kube-system</p> <p><code></code>csi.storage.k8s.io/node-publish-secret-name: custom-secret</p> <p><code></code>csi.storage.k8s.io/node-publish-secret-namespace: kube-system</p> <p><code></code>csi.storage.k8s.io/node-stage-secret-name: custom-secret</p> <p><code></code>csi.storage.k8s.io/node-stage-secret-namespace: kube-system</p> <p><code></code>csi.storage.k8s.io/provisioner-secret-name: custom-secret</p> <p><code></code>csi.storage.k8s.io/provisioner-secret-namespace: kube-system</p> <p><code></code>description: &quot;Volume created by using a custom Secret with the HPE CSI Driver for Kubernetes&quot;</p> <p>reclaimPolicy: Delete</p> <p>allowVolumeExpansion: true</p> <p>\6. Run below command to create storage class.</p> <p><code></code>kubectl create -f  StorageClass.yaml
<img src="/hpe-solutions-openshift/49-dl/assets/img/figure123.333bfc20.png" alt=""></p> <p>\7. Create the PersistentVolumeClaim</p> <p>Create a PersistentVolumeClaim. This object declaration ensures a PersistentVolume is created and provisioned.</p> <p><strong>PersistentVolumeClaim.yaml</strong></p> <p>apiVersion: v1</p> <p>kind: PersistentVolumeClaim</p> <p>metadata:</p> <p><code></code>name: my-first-pvc</p> <p>spec:</p> <p><code></code>accessModes:</p> <p><code></code>- ReadWriteOnce</p> <p><code></code>resources:</p> <p><code></code>requests:</p> <p><code></code>storage: 32Gi</p> <p><code></code>storageClassName: hpe-custom</p> <p>kubectl create -f <strong>PersistentVolumeClaim.yaml</strong> <img src="/hpe-solutions-openshift/49-dl/assets/img/figure124.69ea05e2.png" alt=""></p> <p>\8. Create the Pods</p> <p>kind: Pod</p> <p>apiVersion: v1</p> <p>metadata:</p> <p><code></code>name: my-pod</p> <p>spec:</p> <p><code></code>containers:</p> <p><code></code>- name: pod-datelog-1</p> <p><code></code>image: nginx</p> <p><code></code>command: [&quot;bin/sh&quot;]</p> <p><code></code>args: [&quot;-c&quot;, &quot;while true; do date &gt;&gt; /data/mydata.txt; sleep 1; done&quot;]</p> <p><code></code>volumeMounts:</p> <p><code></code>- name: export1</p> <p><code></code>mountPath: /data</p> <p><code></code>- name: pod-datelog-2</p> <p><code></code>image: debian</p> <p><code></code>command: [&quot;bin/sh&quot;]</p> <p><code></code>args: [&quot;-c&quot;, &quot;while true; do date &gt;&gt; /data/mydata.txt; sleep 1; done&quot;]</p> <p><code></code>volumeMounts:</p> <p><code></code>- name: export1</p> <p><code></code>mountPath: /data</p> <p><code></code>volumes:</p> <p><code></code>- name: export1</p> <p><code></code>persistentVolumeClaim:</p> <p><code></code>claimName: my-first-pvc</p> <p>\9. Once the pods are deployment we can list the running pods.</p> <p><code></code>kubectl get pods</p> <p><code></code>These pods will be using the above created pv’s for their data storage which reside on HPE Nimble Storage in the backend.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/Securing-OpenShift-Container-Platform-using-Sysdig.html" class="prev">
        Securing Red Hat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor
      </a></span> <span class="next"><a href="/hpe-solutions-openshift/49-dl/Resosurces-and-additional-links/Resources.html">
        Resosurces and additional links
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-openshift/49-dl/assets/js/app.3ab76ca9.js" defer></script><script src="/hpe-solutions-openshift/49-dl/assets/js/2.692be357.js" defer></script><script src="/hpe-solutions-openshift/49-dl/assets/js/12.cb2fa787.js" defer></script>
  </body>
</html>
