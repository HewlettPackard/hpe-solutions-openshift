<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Red Hat Ceph Storage 4 Setup in External mode with ODF Integration | OpenShift Container Platform 4.9 on HPE DL380 and DL360 Gen10 Servers</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Hewlett Packard Enterprise">
    
    <link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/css/0.styles.3827aa80.css" as="style"><link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/js/app.65506071.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/js/2.e879b8fa.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/49-dl/assets/js/4.c67828c9.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/10.5854a83c.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/11.fc821945.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/12.ec991927.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/13.d142f89a.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/14.0b64e724.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/15.ca42f8e6.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/16.692600bb.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/17.fdc7a9b9.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/18.e449097c.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/19.f9c1fd27.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/20.b69ac315.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/21.49e11e43.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/22.06860bf2.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/23.6ba9d520.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/24.d2b67452.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/25.ac81adf1.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/26.4fc3c440.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/27.92339859.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/28.774ab819.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/29.1468c777.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/3.ab6705d6.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/30.008fcf1a.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/31.bb02926c.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/32.ae7c066f.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/33.70628313.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/34.4f428d8f.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/35.d29b06f9.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/36.a49434e8.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/37.98be781f.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/5.5a851143.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/6.8fe34dd9.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/7.d5398460.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/8.d2bcb4a2.js"><link rel="prefetch" href="/hpe-solutions-openshift/49-dl/assets/js/9.df613af5.js">
    <link rel="stylesheet" href="/hpe-solutions-openshift/49-dl/assets/css/0.styles.3827aa80.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-openshift/49-dl/" class="home-link router-link-active"><!----> <span class="site-name">OpenShift Container Platform 4.9 on HPE DL380 and DL360 Gen10 Servers</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-openshift/49-dl/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-openshift/49-dl/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Red Hat OpenShift Container Platform 4.9 on DL Servers</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Deployment</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Additional Features and Functionality</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/Storage.html" class="sidebar-link">Storage</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/IPI-Installation.html" class="sidebar-link">IPI deployment of OCP on Bare Metal</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/air-gap-installation.html" class="sidebar-link">Red Hat OpenShift Container Platform installation in the restricted network environment</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/OpenShift-operators.html" class="sidebar-link">OpenShift operators</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/Advanced-Cluster-Management.html" class="sidebar-link">Red Hat Advanced Cluster Management for Kubernetes</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/Install-and-Configure-Velero.html" class="sidebar-link">Install and Configure Velero</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/Ceph-Storage-Setup-External-mode.html" aria-current="page" class="active sidebar-link">Red Hat Ceph Storage 4 Setup in External mode with ODF Integration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/Ceph-Storage-Setup-External-mode.html#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/Ceph-Storage-Setup-External-mode.html#logical-diagram" class="sidebar-link">Logical Diagram</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/Ceph-Storage-Setup-External-mode.html#hardware-requirement" class="sidebar-link">Hardware Requirement</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/Ceph-Storage-Setup-External-mode.html#installation-process" class="sidebar-link">Installation Process</a></li></ul></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/OpenShift-Virtualization.html" class="sidebar-link">OpenShift Virtualization</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/OpenShift-Container-Platform-at-the-edge.html" class="sidebar-link">OpenShift Container Platform at the edge</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/Securing-OpenShift-Container-Platform-using-Sysdig.html" class="sidebar-link">Securing Red Hat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor</a></li><li><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/HPECP-Cluster-Integration-with-Nimble.html" class="sidebar-link">HPECP Cluster Integration with Nimble</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Resosurces and Additional Links</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="red-hat-ceph-storage-4-setup-in-external-mode-with-odf-integration"><a href="#red-hat-ceph-storage-4-setup-in-external-mode-with-odf-integration" class="header-anchor">#</a> Red Hat Ceph Storage 4 Setup in External mode with ODF Integration</h1> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>Ceph is a Software Defined Storage (SDS) Solution. It is distributed storage Solution. It is a free and open source. It provides unified storage i.e. a single Ceph cluster can provide Object / Block / File storage options.</p> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure92.2c30b651.png" alt=""></p> <h2 id="logical-diagram"><a href="#logical-diagram" class="header-anchor">#</a> Logical Diagram</h2> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure93.69fa2670.png" alt=""></p> <p><strong>Figure 27</strong>. Red Hat Ceph Storage Setup in External Mode Solution Flow Diagram</p> <h2 id="hardware-requirement"><a href="#hardware-requirement" class="header-anchor">#</a> Hardware Requirement</h2> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure132.b96511c9.png" alt=""></p> <p>MON, OSD, MSD &amp; MGR daemons are running on the MON/OSD node.</p> <h2 id="installation-process"><a href="#installation-process" class="header-anchor">#</a> Installation Process</h2> <ol><li><p>Enable subscriptions on the following nodes.</p> <p>ADMIN node:</p> <div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> subscription-manager register
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> subscription-manager refresh
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> subscription-manager list --available --all --matches<span class="token operator">=</span><span class="token string">&quot;*Ceph*&quot;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> subscription-manager attach --pool<span class="token operator">=</span><span class="token operator">&lt;</span>POOL_ID<span class="token operator">&gt;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> subscription-manager repos --disable<span class="token operator">=</span>*
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> subscription-manager repos --enable<span class="token operator">=</span>rhel-7-server-rpms
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> subscription-manager repos --enable<span class="token operator">=</span>rhel-7-server-extras-rpms
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> subscription-manager repos --enable<span class="token operator">=</span>rhel-7-server-rhceph-4-tools-rpms --enable<span class="token operator">=</span>rhel-7-server-ansible-2.8-rpms
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> yum --y update
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> yum <span class="token function">install</span> yum-utils <span class="token function">vim</span> -y
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> yum-config-manager --disable epel
</code></pre></div><p>MON/OSD nodes:</p> <div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> subscription-manager register
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> subscription-manager refresh
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> subscription-manager list --available --all --matches<span class="token operator">=</span><span class="token string">&quot;*Ceph*&quot;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> subscription-manager attach --pool<span class="token operator">=</span><span class="token operator">&lt;</span>POOL_ID<span class="token operator">&gt;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> subscription-manager repos --disable<span class="token operator">=</span>*
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> subscription-manager repos --enable<span class="token operator">=</span>rhel-7-server-rpms
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> subscription-manager repos --enable<span class="token operator">=</span>rhel-7-server-extras-rpms
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> subscription-manager repos --enable<span class="token operator">=</span>rhel-7-server-rhceph-4-osd-rpms
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> subscription-manager repos --enable<span class="token operator">=</span>rhel-7-server-rhceph-4-mon-rpms
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> subscription-manager repos --enable<span class="token operator">=</span>rhel-7-server-rhceph-4-tools-rpms
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> yum --y update
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> yum <span class="token function">install</span> yum-utils <span class="token function">vim</span> -y
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code> <span class="token operator">&gt;</span> yum-config-manager --disable epel
</code></pre></div></li> <li><p>Execute the following steps on <strong>Admin Node</strong></p> <ul><li><p>Install ceph-ansible package</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> yum <span class="token function">install</span> -y ceph-ansible
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> /usr/share/ceph-ansible
</code></pre></div></li> <li><p>Create ansible host inventory file for MON, OSD &amp; GRAFANA as shown below</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">touch</span> hosts
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>mons<span class="token punctuation">]</span>
 
<span class="token operator">&lt;</span>mon-1.fqdn<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>mon-2.fqdn<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>mon-3.fqdn<span class="token operator">&gt;</span>

<span class="token punctuation">[</span>osds<span class="token punctuation">]</span>

<span class="token operator">&lt;</span>osd-1.fqdn<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>osd-2.fqdn<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>osd-3.fqdn<span class="token operator">&gt;</span>

<span class="token punctuation">[</span>grafana-server<span class="token punctuation">]</span>

<span class="token operator">&lt;</span>grafana_server.fqdn<span class="token operator">&gt;</span>
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> /usr/share/ceph-ansible
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">cp</span> group_vars/all.yml.sample group_vars/all.yml
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">cp</span> group_vars/osds.yml.sample group_vars/osds.yml
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">cp</span> site.yml.sample site.yml
</code></pre></div></li> <li><p>Create Red Hat Ceph Docker Registry username and password using the below information.</p> <p>If you do not have a Red Hat Registry Service Account, create one using the <a href="https://access.redhat.com/login?redirectTo=https://access.redhat.com/terms-based-registry" target="_blank" rel="noopener noreferrer">Registry Service Account webpage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. See the <a href="https://access.redhat.com/RegistryAuthentication" target="_blank" rel="noopener noreferrer">Red Hat Container Registry Authentication<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Knowledgebase article for details on how to create and manage tokens.</p> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure94.25ca7bbf.png" alt=""></p></li></ul></li> <li><p>Edit group_vars/all.yml as shown below:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code> <span class="token key atrule">fetch_directory</span><span class="token punctuation">:</span> ~/ceph<span class="token punctuation">-</span>ansible<span class="token punctuation">-</span>keys

 <span class="token key atrule">ceph_origin</span><span class="token punctuation">:</span> repository

 <span class="token key atrule">ceph_repository</span><span class="token punctuation">:</span> rhcs

 <span class="token key atrule">ceph_repository_type</span><span class="token punctuation">:</span> cdn

 <span class="token key atrule">ceph_rhcs_version</span><span class="token punctuation">:</span> <span class="token number">4</span>

 <span class="token key atrule">monitor_interface</span><span class="token punctuation">:</span> eno3 <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span> Port interface where IP is configured

 <span class="token key atrule">public_network</span><span class="token punctuation">:</span> 10.0.18.0/16 <span class="token punctuation">-</span><span class="token punctuation">-</span><span class="token punctuation">&gt;</span> IP address range starting from 1st node

 <span class="token key atrule">ceph_docker_registry</span><span class="token punctuation">:</span> registry.redhat.io

 <span class="token key atrule">ceph_docker_registry_auth</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>

 <span class="token key atrule">ceph_docker_registry_username</span><span class="token punctuation">:</span> SERVICE_ACCOUNT_USER_NAME

 <span class="token key atrule">ceph_docker_registry_password</span><span class="token punctuation">:</span> TOKEN

 <span class="token key atrule">dashboard_admin_user</span><span class="token punctuation">:</span> &lt;customised username<span class="token punctuation">&gt;</span>

 <span class="token key atrule">dashboard_admin_password</span><span class="token punctuation">:</span> &lt;customised password<span class="token punctuation">&gt;</span>

 <span class="token key atrule">node_exporter_container_image</span><span class="token punctuation">:</span> registry.redhat.io/openshift4/ose<span class="token punctuation">-</span>prometheus<span class="token punctuation">-</span>node<span class="token punctuation">-</span>exporter<span class="token punctuation">:</span>v4.1

 <span class="token key atrule">grafana_server_group_name</span><span class="token punctuation">:</span> grafana<span class="token punctuation">-</span>server

 <span class="token key atrule">grafana_admin_user</span><span class="token punctuation">:</span>

 <span class="token key atrule">grafana_admin_password</span><span class="token punctuation">:</span>

 <span class="token key atrule">mon_group_name</span><span class="token punctuation">:</span> mons

 <span class="token key atrule">osd_group_name</span><span class="token punctuation">:</span> osds

 <span class="token key atrule">grafana_container_image</span><span class="token punctuation">:</span> registry.redhat.io/rhceph/rhceph<span class="token punctuation">-</span>4<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>rhel8<span class="token punctuation">:</span><span class="token number">4</span>

 <span class="token key atrule">prometheus_container_image</span><span class="token punctuation">:</span> registry.redhat.io/openshift4/ose<span class="token punctuation">-</span>prometheus<span class="token punctuation">:</span><span class="token number">4.1</span>

 <span class="token key atrule">alertmanager_container_image</span><span class="token punctuation">:</span> registry.redhat.io/openshift4/ose<span class="token punctuation">-</span>prometheus<span class="token punctuation">-</span>alertmanager<span class="token punctuation">:</span><span class="token number">4.1</span>

 <span class="token key atrule">configure_firewall</span><span class="token punctuation">:</span> <span class="token boolean important">True</span>
</code></pre></div></li> <li><p>Edit group_vars/osds.yml as shown below:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code> <span class="token key atrule">osd_auto_discovery</span><span class="token punctuation">:</span> <span class="token boolean important">False</span>

 <span class="token key atrule">devices</span><span class="token punctuation">:</span>

 <span class="token punctuation">-</span> /dev/sdb

 <span class="token punctuation">-</span> /dev/sdc
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>If <strong>osd_auto_discovery</strong> is set to True, all the empty disks will be used by the system to create OSD.</p></div></li> <li><p>Create an ansible user with sudo access on all nodes.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> adduser ansible-user
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">passwd</span> ansible-user
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> EOF <span class="token operator">&gt;</span>/etc/sudoers.d/ansible-user

  <span class="token variable">$ansible</span>-user ALL <span class="token operator">=</span> <span class="token punctuation">(</span>root<span class="token punctuation">)</span> NOPASSWD:ALL

  EOF
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">chmod</span> 0440 /etc/sudoers.d/ansible-user
</code></pre></div></li> <li><p>Generate SSH keys as the ansible user and copy the key to MON &amp; OSD nodes.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ssh-keygen
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ssh-copy-id ansible-user@<span class="token operator">&lt;</span>mon-osd-ip<span class="token operator">&gt;</span>
</code></pre></div></li> <li><p>Create ~/.ssh/config file and set values for the Hostname and User options for each node in the storage cluster</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">touch</span> ~/.ssh/config
</code></pre></div><div class="language-bash extra-class"><pre class="language-bash"><code>Host node1

Hostname <span class="token operator">&lt;</span>mon-1.fqdn<span class="token operator">&gt;</span>

User ansible-user

<span class="token punctuation">..</span>.

<span class="token punctuation">..</span>.

Host node4

Hostname <span class="token operator">&lt;</span>osd-1.fqdn<span class="token operator">&gt;</span>

User ansible-user
</code></pre></div></li> <li><p>Run the Ansible playbook for creating Ceph storage and Ceph cluster.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ansible-playbook site.yml -i hosts
</code></pre></div><p>Created Ceph storage on any one of OSD nodes.</p> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure95.1add2680.png" alt=""></p></li> <li><p>Run Ansible playbook for creating Ceph cluster dashboard.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ansible-playbook dashboard.yml -i hosts
</code></pre></div><p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure96.41df7b57.png" alt=""></p> <p>Open Ceph cluster web UI and enter credentials to login</p> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure97.008588f1.png" alt=""></p></li> <li><p><strong>Ceph Dash board:</strong> Cretae rdb pool in Ceph cluster.</p> <ul><li><p>Ceph pool on Ceph cluster dash board: Dashboard -&gt; Pools -&gt; Create Pool</p></li> <li><p>Created Ceph pool on Dashboard.</p></li></ul> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure98.99af703a.png" alt=""></p> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure99.8db4d89f.png" alt=""></p></li> <li><p>Create openshift-storage namespace. (Dashboard -&gt; Administration -&gt; Namespace -&gt; Create Namespace).</p> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure100.8b0d730f.png" alt=""></p></li> <li><p>Create OpenShift Container Storage 4.8 operator. (Dashboard -&gt; Operators -&gt; OperatorHub -&gt; openshift-stoage (namespace) -&gt; search for (OpenShift Container Storage) -&gt; Install).Select the below options to create OpenShift Container Storage operator</p> <ul><li><p>Update Channel as stable-4.8</p></li> <li><p>Installation Mode as A specific namespace on the cluster</p></li> <li><p>Installed Namespace as Operator recommended namespace PR openshift-storage. If Namespace openshift-storage does not exist, it will be created during the operator installation.</p></li> <li><p>Enable operator recommended cluster monitoring on this namespace checkbox is selected. This is required for cluster monitoring.</p></li> <li><p>Approval Strategy as Automatic</p></li></ul> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure101.b1117c97.png" alt=""></p> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure102.01092ffc.png" alt=""></p></li> <li><p>Create Overview -&gt; openshift-storage (namespace) -&gt; Operator Hub -&gt; Installed Operators -&gt; OpenShift Container Storage (operator) -&gt; &quot;Storage Cluster&quot; -&gt; &quot;Create OCS Cluster Service&quot;</p> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure103.7f16d01c.png" alt=""></p></li> <li><p>Select &quot;External&quot; storage mode to integrate external ceph storage for creating ODF cluster by default it shows internal</p> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure104.0ccd11b0.png" alt=""></p></li> <li><p>Download &quot;ceph-external-cluster-details-exporter.py&quot; file and place on any one of OSD nodes.</p> <div class="custom-block tip"><p class="custom-block-title">NOTE</p> <p>Python version should be &quot;python 3.x&quot;.</p></div></li> <li><p>Check the python script <strong>ceph-external-cluster-details-exporter.py</strong> arguments.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> python3 ceph-external-cluster-details-exporter.py --help
</code></pre></div></li> <li><p>Execute the below script for integrating Ceph cluster rbd pool into OCP cluster for creating OCS cluster.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> python3 ceph-external-cluster-details-exporter.py --rbd-pool-name <span class="token operator">&lt;</span>rbd_pool_name_created_on_ceph_cluster<span class="token operator">&gt;</span>
</code></pre></div><p>Script output as shown below in JSON format.</p> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure105.f4f3f8df.png" alt=""></p></li> <li><p>Save the above command output in a json file.</p></li> <li><p>Click <strong>External cluster metadata -&gt; Browse</strong> to select and upload the json file.</p></li> <li><p>Click on <strong>Create</strong> for integrating external Ceph storage for creating OCS cluster.</p> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure106.0f6cf71b.png" alt=""></p></li> <li><p>Validating ODF cluster by deploying two-tier application WordPress.</p> <ul><li><p>Create wordpress namespace.</p></li> <li><p>Deploy WordPress application under wordpress namespace.</p> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure107.64b03f3d.png" alt=""></p></li></ul></li> <li><p>Check all ODF cluster and WordPress application's pods, pv, pvc and sc.</p> <ul><li><p>Check sc,pv &amp;pvc of openshift-storage namespace.</p> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure108.c39cd194.png" alt=""></p></li> <li><p>Check pods of openshift-storage namespace.</p> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure109.be3d618e.png" alt=""></p></li> <li><p>Check pvc and pods of wordpess namespace.</p> <p><img src="/hpe-solutions-openshift/49-dl/assets/img/figure110.a7e423e6.png" alt=""></p></li></ul></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/Install-and-Configure-Velero.html" class="prev">
        Install and Configure Velero
      </a></span> <span class="next"><a href="/hpe-solutions-openshift/49-dl/Additional-Features-and-Functionality/OpenShift-Virtualization.html">
        OpenShift Virtualization
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-openshift/49-dl/assets/js/app.65506071.js" defer></script><script src="/hpe-solutions-openshift/49-dl/assets/js/2.e879b8fa.js" defer></script><script src="/hpe-solutions-openshift/49-dl/assets/js/4.c67828c9.js" defer></script>
  </body>
</html>
