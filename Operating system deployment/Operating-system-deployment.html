<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Operating system deployment | RED HAT OPENSHIFT CONTAINER PLATFORM 4 ON HPE SYNERGY</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.4.0">
    
    
    <link rel="preload" href="/hpe-solutions-openshift/assets/css/0.styles.03110986.css" as="style"><link rel="preload" href="/hpe-solutions-openshift/assets/js/app.97ab5217.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/assets/js/2.7869ffdd.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/assets/js/12.23c485d1.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/10.eaca1b1f.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/11.e4a910b4.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/13.1dfc2227.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/14.6cfe7b83.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/15.396fb9b8.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/16.a35ed86c.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/17.821cf572.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/18.861062ec.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/19.790531fa.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/20.77410566.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/21.64fb4b9d.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/22.d1f7b188.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/23.47b1fcea.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/24.5e6bc1df.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/25.739eaeab.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/26.c868f3e2.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/3.df4c1f1d.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/4.4ba88d9e.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/5.bae94e2f.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/6.29d6f4db.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/7.1836f0b8.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/8.7912b669.js"><link rel="prefetch" href="/hpe-solutions-openshift/assets/js/9.9e7c1a91.js">
    <link rel="stylesheet" href="/hpe-solutions-openshift/assets/css/0.styles.03110986.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-openshift/" class="home-link router-link-active"><!----> <span class="site-name">RED HAT OPENSHIFT CONTAINER PLATFORM 4 ON HPE SYNERGY</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-openshift/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-openshift/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/hpe-solutions-openshift/Introduction/Introduction.html" class="sidebar-link">Introduction</a></li><li><a href="/hpe-solutions-openshift/Solution overview/Solution-overview.html" class="sidebar-link">Solution overview</a></li><li><a href="/hpe-solutions-openshift/Solution components/Solution-components.html" class="sidebar-link">Solution components</a></li><li><a href="/hpe-solutions-openshift/Preparing the execution environment/Preparing-the-execution-environment.html" class="sidebar-link">Preparing the execution environment</a></li><li><a href="/hpe-solutions-openshift/Physical environment configuration/Physical-environment-configuration.html" class="sidebar-link">Physical environment configuration</a></li><li><a href="/hpe-solutions-openshift/Physical node configuration/Physical-node-configuration.html" class="sidebar-link">Physical node configuration</a></li><li><a href="/hpe-solutions-openshift/Virtual node configuration/Virtual-node-configuration.html" class="sidebar-link">Virtual node configuration</a></li><li><a href="/hpe-solutions-openshift/vSphere Provisioner/vSphere-Provisioner.html" class="sidebar-link">vSphere Provisioner</a></li><li><a href="/hpe-solutions-openshift/Operating system deployment/Operating-system-deployment.html" class="active sidebar-link">Operating system deployment</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/Operating system deployment/Operating-system-deployment.html#rhel-deployment-using-pxe-server" class="sidebar-link">RHEL deployment using PXE server</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/Operating system deployment/Operating-system-deployment.html#red-hat-coreos-deployment-using-ipxe-server" class="sidebar-link">Red Hat CoreOS deployment using iPXE server</a></li></ul></li><li><a href="/hpe-solutions-openshift/Red Hat OpenShift Container Platform deployment/Red-Hat-OpenShift-Container-Platform-deployment.html" class="sidebar-link">Red Hat OpenShift Container Platform deployment</a></li><li><a href="/hpe-solutions-openshift/Red Hat Local Storage Operator/Red-Hat-Local-Storage-Operator.html" class="sidebar-link">Red Hat Local Storage Operator</a></li><li><a href="/hpe-solutions-openshift/Integration of HPE OneView with Prometheus/Integration-of-HPE-OneView-with-Prometheus.html" class="sidebar-link">Integration of HPE OneView with Prometheus</a></li><li><a href="/hpe-solutions-openshift/Storage/Storage.html" class="sidebar-link">Storage</a></li><li><a href="/hpe-solutions-openshift/HPE CSI drivers/HPE-CSI-drivers.html" class="sidebar-link">HPE CSI drivers</a></li><li><a href="/hpe-solutions-openshift/Securing Red Hat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor/Securing-Red-Hat-OpenShift-Container-Platform-using-Sysdig-Secure-and-Sysdig-Monitor.html" class="sidebar-link">Securing Red Hat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor</a></li><li><a href="/hpe-solutions-openshift/Physical worker node labeling in Red Hat OpenShift cluster/Physical-worker-node-labeling-in-Red-Hat-OpenShift-cluster.html" class="sidebar-link">Physical worker node labeling in Red Hat OpenShift cluster</a></li><li><a href="/hpe-solutions-openshift/OpenShift Operators/OpenShift-Operators.html" class="sidebar-link">OpenShift Operators</a></li><li><a href="/hpe-solutions-openshift/Validating OpenShift Container Platform deployment/Validating-OpenShift-Container-Platform-deployment.html" class="sidebar-link">Validating OpenShift Container Platform deployment</a></li><li><a href="/hpe-solutions-openshift/Resources and additional links/Resources-and-additional-links.html" class="sidebar-link">Resources and additional links</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="operating-system-deployment"><a href="#operating-system-deployment" class="header-anchor">#</a> Operating system deployment</h1> <h2 id="rhel-deployment-using-pxe-server"><a href="#rhel-deployment-using-pxe-server" class="header-anchor">#</a> RHEL deployment using PXE server</h2> <p>In this solution, a PXE server is used for RHEL 7.x OS deployment and is configured on CentOS (version: CentOS Linux release 7.6.1810 (Core)). The PXE server uses the FTP service for file distribution, but can be altered to support HTTP or NFS. This section highlights the steps to configure a PXE server.</p> <h3 id="procedure-for-setting-up-pxe-server-and-deploying-rhel-os"><a href="#procedure-for-setting-up-pxe-server-and-deploying-rhel-os" class="header-anchor">#</a> Procedure for setting up PXE server and deploying RHEL OS</h3> <ol><li><p>Login to the CentOS server to be configured as a PXE server as a user that can run commands as root via sudo.</p></li> <li><p>Use the following command to install packages such as DHCP, TFTP-server, vSFTPD (FTP server), and xinetd.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">sudo</span> yum <span class="token function">install</span> dhcp tftp tftp-server syslinux vsftpd xinetd
</code></pre></div></li> <li><p>Update the DHCP configuration file at <em>/etc/dhcp/dhcpd.conf</em> with the MAC addresses, IP addresses, DNS, and routing details of the installation environment. Domain search is optional. A sample DHCP configuration file is shown as follows.</p> <div class="language- extra-class"><pre class="language-text"><code>ddns-update-style interim;
ignore client-updates;
authoritative;
allow booting;
allow bootp;

# internal subnet for my DHCP Server
subnet 20.0.x.x netmask 255.0.0.0 {
range 20.0.x.x 20.0.x.x;
deny unknown-clients;
option domain-name-servers 20.x.x.x;
option domain-name &quot;twentynet.local&quot;;
option routers 20.x.x.x;
option broadcast-address 20.255.255.255;
default-lease-time 600;
max-lease-time 7200;
next-server 20.x.x.x;
filename &quot;pxelinux.0&quot;;
}

#######################################
host bootstrap {
hardware ethernet 00:50:56:xx:98:df;
fixed-address 20.0.x.x;
}
host master01 {
hardware ethernet 00:50:56:95:xx:82;
fixed-address 20.0.x.x;
}
host worker01 {
hardware ethernet 00:50:56:xx:ab:82;
fixed-address 20.0.x.x;
}
</code></pre></div></li> <li><p>Trivial File Transfer Protocol (TFTP) is used to transfer files from data server to clients without any kind of authentication. TFTP is used for ignition file loading in PXE-based environment. To configure the TFTP server, edit the configuration file <em>/etc/xinetd.d/tftp</em>. Change the parameter ‘disable = yes’ to ‘disable = no’ and leave the other parameters as is. To edit the <em>/etc/xinetd.d/tftp</em> file, execute the following command.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">sudo</span> <span class="token function">vi</span>  /etc/xinetd.d/tftp
</code></pre></div><p>The TFTP configuration file is as follows.</p> <div class="language- extra-class"><pre class="language-text"><code>service tftp
   {

        socket_type = dgram
        protocol = udp
        wait = yes
        user = root
        server = /usr/sbin/in.tftpd
        server_args = -s /var/lib/tftpboot
        disable = no
        per_source = 11
        cps = 100 2
        flags = IPv4
    }
</code></pre></div><p>Network boot related files must be placed in the tftp root directory <em>/var/lib/tftpboot</em>. Run the following commands to copy the required network boot files to <em>/var/lib/tftpboot/</em>.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">sudo</span> <span class="token function">cp</span> –v /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot

<span class="token operator">&gt;</span> <span class="token function">sudo</span> <span class="token function">cp</span> –v /usr/share/syslinux/menu.c32 /var/lib/tftpboot

<span class="token operator">&gt;</span> <span class="token function">sudo</span> <span class="token function">cp</span> –v /usr/share/syslinux/memdisk /var/lib/tftpboot

<span class="token operator">&gt;</span> <span class="token function">sudo</span> <span class="token function">cp</span> –v /usr/share/syslinux/mboot.c32 /var/lib/tftpboot

<span class="token operator">&gt;</span> <span class="token function">sudo</span> <span class="token function">cp</span> –v /usr/share/syslinux/chain.c32 /var/lib/tftpboot

<span class="token operator">&gt;</span> <span class="token function">sudo</span> <span class="token function">mkdir</span> /var/lib/tftpboot/pxelinux.cfg

<span class="token operator">&gt;</span> <span class="token function">sudo</span> <span class="token function">mkdir</span> /var/lib/tftpboot/networkboot
</code></pre></div></li> <li><p>Copy the RHEL 7.6 (or higher version) ISO files to the PXE server. Mount it to the <em>/mnt/</em> directory and then copy the contents of the ISO to the local FTP server using the following commands.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">sudo</span> <span class="token function">mount</span> –o loop <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>OS <span class="token function">file</span> name<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> /mnt/

<span class="token operator">&gt;</span> <span class="token builtin class-name">cd</span> /mnt/

<span class="token operator">&gt;</span> <span class="token function">sudo</span> <span class="token function">cp</span> –av * /var/ftp/pub/
</code></pre></div></li> <li><p>Copy the kernel file (vmlinuz) and initrd file from <em>/mnt</em> to <em>/var/lib/tftpboot/networkboot/</em> using the following commands.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">sudo</span> <span class="token function">cp</span> /mnt/images/pxeboot/vmlinuz /var/lib/tftpboot/networkboot/

<span class="token operator">&gt;</span> <span class="token function">sudo</span> <span class="token function">cp</span> /mnt/images/pxeboot/initrd.img /var/lib/tftpboot/networkboot
</code></pre></div></li> <li><p>Use the following command to unmount the ISO files.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">sudo</span> unmount /mnt/
</code></pre></div></li> <li><p>For RHEL nodes, create and utilize a new kickstart file under the folder <em>/var/ftp/pub</em> with the name “<em>rhel7.cfg</em>” using the following command.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">sudo</span> <span class="token function">vi</span> /var/ftp/pub/rhel7.cfg
</code></pre></div><p>A sample kickstart file is shown as follows. The installation user should create a kickstart file to meet the requirements of their installation environment.</p> <div class="language- extra-class"><pre class="language-text"><code>firewall --disabled
# Install OS instead of upgrade
install
# Use FTP installation media
url --url=&quot;ftp://&amp;lt;FTP_server_IP_address&amp;gt;/pub/rhel76/&quot;
# Root password
# root password can be plaintext as shown below
# rootpw –plaintext &amp;lt;password&amp;gt;
# root password is encrypted using the command “openssl passwd -1 &amp;lt;password&amp;gt;” and resultant output is provided for rootpw as shown below
rootpw --iscrypted $6$uiq8l/7xEWsYXhrvaEgan4N21yhLa8K.U7UA12Th3PD11GOXvEcI40gp
# System authorization information
auth useshadow passalgo=sha512
# Use graphical install
graphical
firstboot disable
# System keyboard, timezone, language
keyboard us
timezone Europe/Amsterdam
lang en_US
# SELinux configuration
selinux disabled
# Installation logging level
logging level=info
# System bootloader configuration
bootloader location=mbr
clearpart --all --initlabel
part swap --asprimary --fstype=&quot;swap&quot; --size=1
part /boot --fstype xfs --size=300
part pv.01 --size=1 --grow
volgroup root_vg01 pv.01
logvol / --fstype xfs --name=lv_01 --vgname=root_vg01 --size=1 --grow
%packages
@^minimal
@core
%end
%addon com_redhat_kdump --disable --reserve-mb='auto'
%end
</code></pre></div></li> <li><p>Create a PXE menu. Use the following command to create a PXE menu file at the location <em>/var/lib/tftpboot/pxelinux.cfg/default</em></p> <div class="language-bash extra-class"><pre class="language-bash"><code>  <span class="token operator">&gt;</span> <span class="token function">sudo</span> <span class="token function">vi</span> /var/lib/tftpboot/pxelinux.cfg/default
</code></pre></div><p>For each of the OS boot options, provide the following details:</p> <div class="language- extra-class"><pre><code>- MENU LABEL : Custom name of the respective menu label.
- KERNEL : Kernel details of the operating system.
- APPEND : Path of bootloader file along with path of cfg or configuration file (in case of RHEL).
</code></pre></div><p>A sample PXE menu is as follows.</p> <div class="language- extra-class"><pre class="language-text"><code>default menu.c32

prompt 0

timeout 30

MENU TITLE LinuxTechi.com PXE Menu

LABEL rhel76

MENU LABEL RHEL76-Buedata

KERNEL /rhel76/vmlinuz

APPEND initrd=/rhel76/initrd.img inst.repo=ftp://&amp;lt;FTP_server_IP_address&amp;gt;/pub/rhel76 ks=ftp://&amp;lt;FTP_server_IP_address&amp;gt;/pub/rhel76-hcp.cfg

LABEL rhcos-bootstrap

MENU LABEL Install RHCOS4.3 sec-Bootstrap

KERNEL /networkboot/rhcos-4.3.0-x86_64-installer-kernel

APPEND ip=dhcp rd.neednet=1 initrd=/networkboot/rhcos-4.3.0-x86_64-installer-initramfs.img console=tty0 console=ttyS0 coreos.inst=yes coreos.inst.install_dev=sda coreos.inst.image_url= ftp://&amp;lt;FTP_server_IP_address&amp;gt;/pub/rhcos-4.3.0-x86_64-metal-bios.raw.gz coreos.inst.ignition_url= ftp://&amp;lt;FTP_server_IP_address&amp;gt;/pub/sec/bootstrap.ign

LABEL rhcos-master

MENU LABEL Install RHCOS4.2 sec-Master

KERNEL /networkboot/rhcos-4.3.0-x86_64-installer-kernel

APPEND ip=dhcp rd.neednet=1 initrd=/networkboot/rhcos-4.3.0-x86_64-installer-initramfs.img console=tty0 console=ttyS0 coreos.inst=yes coreos.inst.install_dev=sda coreos.inst.image_url= ftp://&amp;lt;FTP_server_IP_address&amp;gt;/pub/rhcos-4.3.0-x86_64-metal-bios.raw.gz coreos.inst.ignition_url=ftp://&amp;lt;FTP_server_IP_address&amp;gt;/pub/sec/master.ign

LABEL rhcos-worker

MENU LABEL Install RHCOS4.2 sec-Worker

KERNEL /networkboot/rhcos-4.3.0-x86_64-installer-kernel

APPEND ip=dhcp rd.neednet=1 initrd=/networkboot/rhcos-4.3.0-x86_64-installer-initramfs.img console=tty0 console=ttyS0 coreos.inst=yes coreos.inst.install_dev=sda coreos.inst.image_url= ftp://&amp;lt;FTP_server_IP_address&amp;gt;/pub/rhcos-4.3.0-x86_64-metal-bios.raw.gz coreos.inst.ignition_url=ftp://&amp;lt;FTP_server_IP_address&amp;gt;/pub/sec/worker.ign
</code></pre></div></li> <li><p>Use the following command to start and enable xinetd, dhcpd, and vsftpd.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>    <span class="token operator">&gt;</span> <span class="token function">sudo</span> systemctl start xinetd

    <span class="token operator">&gt;</span> <span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> xinetd

    <span class="token operator">&gt;</span> <span class="token function">sudo</span> systemctl start dhcpd.service

    <span class="token operator">&gt;</span> <span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> dhcpd.service

    <span class="token operator">&gt;</span> <span class="token function">sudo</span> systemctl start vsftpd

    <span class="token operator">&gt;</span> <span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> vsftpd
</code></pre></div></li> <li><p>Configure SELinux for FTP.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">sudo</span> setsebool –P allow_ftpd_full_access <span class="token number">1</span>
</code></pre></div></li> <li><p>Open ports in the firewall using the following firewall-cmd commands.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> <span class="token function">sudo</span> firewall-cmd --add-service-ftp --permanent

<span class="token operator">&gt;</span>sudo firewall-cmd --add-service-dhcp --permanent

<span class="token operator">&gt;</span>sudo firewall-cmd –reload
</code></pre></div></li></ol> <div class="custom-block tip"><p class="custom-block-title">Note</p> <p>It is crucial to generate ignition files, copy them to the TFTP server, and update the path in the PXE default file. For more information about generating the ignition files, refer to the <a href="/hpe-solutions-openshift/Preparing the execution environment/Preparing-the-execution-environment.html#kubernetes-manifests-and-ignition-files">Kubernetes manifests and ignition files</a> section in this document.</p></div> <h2 id="red-hat-coreos-deployment-using-ipxe-server"><a href="#red-hat-coreos-deployment-using-ipxe-server" class="header-anchor">#</a> Red Hat CoreOS deployment using iPXE server</h2> <p>In this solution, an iPXE Server setup is used for Red Hat Enterprise Linux CoreOS (RHCOS) deployment. This section explains in detail the playbooks required to configure iPXE server on an RHEL 7.6 VM  to perform an unattended installation of Red Hat Enterprise Linux CoreOS (RHCOS) for non-ESXi VMs and bare metal servers.</p> <h3 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h3> <ol><li>RHEL Ansible engine VM with Ansible 2.9.x and Python 3.6.x.</li></ol> <div class="custom-block tip"><p class="custom-block-title">Note</p> <p>Ansible Engine is configured as mentioned in the <a href="/hpe-solutions-openshift/Preparing the execution environment/Preparing-the-execution-environment.html#installer-machine">Installer machine</a> section.</p></div> <ol start="2"><li><p>If the user wishes to setup the iPXE server on a separate RHEL 7.6 VM (other than the Ansible engine VM) preferably or could be bare metal server, they need to have the following minimum configuration:</p> <ul><li>At least 200 GB disk space</li> <li>Two (2) CPU cores</li> <li>8 GB RAM</li> <li>/var has at least 15 GB disk space allocated while partitioning</li> <li>Static IP on the same network as the RHCOS server</li> <li>Internet access</li></ul></li> <li><p>​	Disable Selinux using following steps:</p> <ol><li><p>Check the status of SELINUX using the command /etc/selinux/config</p></li> <li><p>Disable SELINUX.</p> <div class="language- extra-class"><pre class="language-text"><code>$ sudo sed -i 's/permissive/disabled/g' /etc/selinux/config 
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Note</p> <p>If the current state of &quot;selinux&quot; is &quot;enforcing,&quot; replace the keyword &quot;permissive&quot; in the above command with &quot;enforcing&quot; and then run it.</p></div></li> <li><p>Reboot the RHEL machine.</p></li> <li><p>Use /etc/selinux/config  command to check the status of SELINUX.</p></li></ol></li></ol> <h3 id="automated-installation-and-configuration-of-ipxe-server"><a href="#automated-installation-and-configuration-of-ipxe-server" class="header-anchor">#</a> Automated Installation and Configuration of iPXE server</h3> <p>Perform the steps listed to execute the playbooks for installing and configuring iPXE server.</p> <ol><li><p>Browse to the following directory on the Ansible engine.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> BASE_DIR/os_deployment/deploy_rhcos/
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Note</p> <p>Refer to <a href="/hpe-solutions-openshift/Preparing the execution environment/Preparing-the-execution-environment.html#installer-machine">Installer machine</a> section to know the &quot;BASE_DIR&quot; path.</p></div></li> <li><p>Copy Red Hat OpenShift 4.x above install files to directory, preferably under /tmp/ Example: /tmp/image/</p></li> <li><p>Update the inventory file &quot;hosts&quot; with the RHEL machine IP on which the user is trying to setup the iPXE server.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token punctuation">[</span>ansible_host<span class="token punctuation">]</span>
<span class="token number">20</span>.x.x.x
</code></pre></div></li> <li><p>Update the <em>secrets.yml</em> file located in BASE_DIR/os_deployment/deploy_rhcos/secrets.yml. Use the following command to edit secrets.yml file.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> ansible-vault edit <span class="token variable">$BASE_DIR</span>/os_deployment/deploy_rhcos/secrets.yml
</code></pre></div></li></ol> <div class="custom-block tip"><p class="custom-block-title">Note</p> <ul><li>Refer to <a href="/hpe-solutions-openshift/Preparing the execution environment/Preparing-the-execution-environment.html#installer-machine">Installer machine</a> section to know the &quot;BASE_DIR&quot; .</li> <li>The default password for the Ansible vault file is <em>changeme.</em></li></ul></div> <div class="language- extra-class"><pre class="language-text"><code> #####################################################################
 # Details of Ansible User Credentials required to set up the iPXE
  ###Common Networking
  # Interface Name Example: interface_name: enp0s10f0
  interface_name: &lt;interface_name&gt;
  
  # Ansible Host IP Example: ansible_engine_ip: 20.0.15.115
  ansible_engine_ip: &lt;ansible_engine_ip&gt;

  # base DNS domain, Example: base_domain: ocp42.local
  base_domain: &lt;base_domain&gt;

  # Openshift sub domain, Example:app_domain: apps.ocp42.local
  app_domain: &lt;app_domain&gt;

  # Network router IP Example: gateway: 192.168.42.254
  gateway: &lt;gateway&gt;

  # Network DNS server Example: dns_server: 192.168.42.252
  dns_server: &lt;dns_server&gt;

  # DHCP range that is used for OCP nodes Example: dhcp_range: 192.168.42.204,192.168.42.210,24h
  dhcp_range: &lt;dhcp_range&gt;
    
  # Subnet Mask Example: net_mask: 255.255.240.0
  net_mask: &lt;net_mask&gt;
    
  ## OpenShift node network
  # mac address of master node 1 Example: master1_mac: 08:00:27:36:0A:01
  master1_mac: &lt;master1_mac&gt;
    
  # master node 1 IP address Example: master1_ip: 192.168.42.204
  master1_ip: &lt;master1_ip&gt;
    
  # master node 2 mac address Example: master2_mac: 08:00:27:36:0A:02
  master2_mac: &lt;master2_mac&gt;

  # master node 2 IP address Example: master2_ip: 192.168.42.205
  master2_ip: &lt;master2_ip&gt;

  # master node 3 mac address Example: master3_mac: 08:00:27:36:0A:03
  master3_mac: &lt;master3_mac&gt;

  # master node 3 IP address Example: master3_ip: 192.168.42.206
  master3_ip: &lt;master3_ip&gt;

  # worker node 1 mac address Example: worker1_mac: 08:00:27:36:0A:04
  worker1_mac: &lt;worker1_mac&gt;

  # worker node 1 IP address Example: worker1_ip: 192.168.42.207
  worker1_ip: &lt;worker1_ip&gt;

  # worker node 2 mac address Example: worker2_mac: 08:00:27:36:0A:05
  worker2_mac: &lt;worker2_mac&gt;

  # worker node 2 IP address Example: worker2_ip: 192.168.42.208
  worker2_ip: &lt;worker2_ip&gt;

  # worker node 3 mac address Example: worker3_mac: 08:00:27:36:0A:06
  worker3_mac: &lt;worker3_mac&gt;
    
  # worker node 3 IP address Example: worker3_ip: 192.168.42.209
  worker3_ip: &lt;worker3_ip&gt;
    
  # bootstrap mac address Example: bootstrap_mac: 08:00:27:36:0A:08
  bootstrap_mac: &lt;bootstrap_mac&gt;
    
  # bootstrap IP address Example: bootstrap_ip: 192.168.42.210
  bootstrap_ip: &lt;bootstrap_ip&gt;
    
  # install media details Example: image_location: &quot;/tmp/image/&quot;
  image_location: &lt;image_location&gt;
    
  # Example: initramfs_name: rhcos-4.2.0-x86_64-installer-initramfs.img
  initramfs_name: &lt;initramfs_name&gt;
    
  # Example: kernel_name: rhcos-4.2.0-x86_64-installer-kernel
  kernel_name:&lt;kernel_name&gt;
    
  # Example: bios_uefi_name: rhcos-4.2.0-x86_64-metal-bios.raw.gz
  bios_uefi_name: &lt;bios_uefi_name&gt;
</code></pre></div><ol start="5"><li><p>Run the following Ansible playbook to configure the iPXE server.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ ansible-playbook -i hosts master.yml --ask-vault-pass
</code></pre></div></li> <li><p>Figure 23 shows the status of after running the Ansible playbook to configure the iPXE server.</p> <p><img src="/hpe-solutions-openshift/assets/img/figure23.8b69992d.jpg" alt=""></p> <p><strong>Figure 14</strong>. Status of matchbox,TFTP,Xinetd and dnsmasq Services</p></li> <li><p>Run the following command to test the setup with MAC address.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> http://localhost:8080/ipxe?mac<span class="token operator">=</span>08:00:27:36:0A:xx
</code></pre></div></li> <li><p>Copy the ignition files in &quot; /var/lib/matchbox/ignition &quot; and verify the status of ignition file by using MAC address of all nodes.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> http://192.168.42.200:8080/ignition?mac<span class="token operator">=</span>08:00:27:36:0A:xx
</code></pre></div></li> <li><p>Boot the VM or bare metal using iPXE.</p></li></ol></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-openshift/vSphere Provisioner/vSphere-Provisioner.html" class="prev">
        vSphere Provisioner
      </a></span> <span class="next"><a href="/hpe-solutions-openshift/Red Hat OpenShift Container Platform deployment/Red-Hat-OpenShift-Container-Platform-deployment.html">
        Red Hat OpenShift Container Platform deployment
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-openshift/assets/js/app.97ab5217.js" defer></script><script src="/hpe-solutions-openshift/assets/js/2.7869ffdd.js" defer></script><script src="/hpe-solutions-openshift/assets/js/12.23c485d1.js" defer></script>
  </body>
</html>
