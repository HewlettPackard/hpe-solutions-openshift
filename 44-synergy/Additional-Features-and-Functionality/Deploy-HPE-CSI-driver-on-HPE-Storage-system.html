<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>CSI Driver | OpenShift Container Platform 4.4 on Synergy</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="Hewlett Packard Enterprise">
    
    <link rel="preload" href="/hpe-solutions-openshift/44-synergy/assets/css/0.styles.848b002a.css" as="style"><link rel="preload" href="/hpe-solutions-openshift/44-synergy/assets/js/app.84b9672e.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/44-synergy/assets/js/2.d6fcc4df.js" as="script"><link rel="preload" href="/hpe-solutions-openshift/44-synergy/assets/js/3.a78e42b0.js" as="script"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/10.f785cdcb.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/11.5df395ef.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/12.36a26b0c.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/13.42d926c9.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/14.d7e47945.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/15.8b7fdf38.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/16.ff701634.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/17.de74fef4.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/18.35c5f375.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/19.0d580fd7.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/20.1bbdea0b.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/21.9690fb37.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/22.c8934c89.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/23.35084974.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/24.3ee611d1.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/25.f2df1c9b.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/26.fb060f22.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/27.3fac409f.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/28.a76a7ac1.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/29.e80c6a85.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/4.08161444.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/5.05b28079.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/6.a0d3fa7b.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/7.72ac9725.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/8.f8891241.js"><link rel="prefetch" href="/hpe-solutions-openshift/44-synergy/assets/js/9.2843fa69.js">
    <link rel="stylesheet" href="/hpe-solutions-openshift/44-synergy/assets/css/0.styles.848b002a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/hpe-solutions-openshift/44-synergy/" class="home-link router-link-active"><!----> <span class="site-name">OpenShift Container Platform 4.4 on Synergy</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/hpe-solutions-openshift/44-synergy/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/hpe-solutions-openshift/44-synergy/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="http://www.hpe.com/info/ra" target="_blank" rel="noopener noreferrer" class="nav-link external">
  RA Library
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Red Hat OpenShift Container Platform 4 on HPE Synergy</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Overview</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Solution Deployment</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Additional Features and Functionality</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/hpe-solutions-openshift/44-synergy/Additional-Features-and-Functionality/Deploy-HPE-CSI-driver-on-HPE-Storage-system.html" aria-current="page" class="active sidebar-link">CSI Driver</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/44-synergy/Additional-Features-and-Functionality/Deploy-HPE-CSI-driver-on-HPE-Storage-system.html#csi-driver-architecture" class="sidebar-link">CSI Driver Architecture</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/44-synergy/Additional-Features-and-Functionality/Deploy-HPE-CSI-driver-on-HPE-Storage-system.html#hpe-csi-driver-storage-installation-2" class="sidebar-link">HPE CSI Driver storage installation</a></li><li class="sidebar-sub-header"><a href="/hpe-solutions-openshift/44-synergy/Additional-Features-and-Functionality/Deploy-HPE-CSI-driver-on-HPE-Storage-system.html#configuring-iscsi-interface-on-worker-nodes-2" class="sidebar-link">Configuring iSCSI interface on worker nodes</a></li></ul></li><li><a href="/hpe-solutions-openshift/44-synergy/Additional-Features-and-Functionality/Red-Hat-Local-Storage-Operator.html" class="sidebar-link">Red Hat Local Storage operator</a></li><li><a href="/hpe-solutions-openshift/44-synergy/Additional-Features-and-Functionality/OpenShift-operators.html" class="sidebar-link">OpenShift operators</a></li><li><a href="/hpe-solutions-openshift/44-synergy/Additional-Features-and-Functionality/Physical-worker-node-labeling.html" class="sidebar-link">Physical worker node labeling in Red Hat OpenShift cluster</a></li><li><a href="/hpe-solutions-openshift/44-synergy/Additional-Features-and-Functionality/Integration-HPE-OneView-with-Prome.html" class="sidebar-link">Integration of HPE OneView with Prometheus</a></li><li><a href="/hpe-solutions-openshift/44-synergy/Additional-Features-and-Functionality/Sysdig-Secure.html" class="sidebar-link">Securing Red Hat OpenShift Container Platform using Sysdig Secure and Sysdig Monitor</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Resosurces and Additional Links</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="csi-driver"><a href="#csi-driver" class="header-anchor">#</a> CSI Driver</h1> <p>Prior to Container Storage Integration (CSI), Kubernetes provided in-tree plugins to support volume. This posed a problem as storage vendors had to align to the Kubernetes release process to fix a bug or to release new features. This also means every storage vendor had their own process to present volume to Kubernetes.</p> <p>CSI was developed as a standard for exposing block and file storage systems to containerized workloads on Container Orchestrator Systems (COS) like Kubernetes.  Container Storage Interface (CSI) is an initiative to unify the storage interface of COS combined with storage vendors. This means, implementing a single CSI for a storage vendor is guaranteed to work with all COS. With the introduction of CSI, there is a clear benefit for the COS and storage vendors. Due to its well-defined interfaces, it also helps developers and future COS to easily implement and test CSI. Volume plugins served the storage needs for container workloads in case of Kubernetes, before CSI existed.
The HPE CSI Driver is a multi-vendor and multi-backend driver where each implementation has a Container Storage Provider (CSP). The HPE CSI Driver for Kubernetes uses  CSP to perform data management operations on storage resources such as searching for a logical unit number (lun) and so on. Using the CSP specification, the HPE CSI Driver allows any vendor or project to develop its own CSP, which makes it very easy for third- parties to integrate their storage solution into Kubernetes as all the intricacies are taken care of by the HPE CSI Driver.</p> <p>This document contains details on how to configure a HPE CSI Driver storage for 3PAR on an existing Red Hat OpenShift Container Platform 4.</p> <h2 id="csi-driver-architecture"><a href="#csi-driver-architecture" class="header-anchor">#</a> CSI Driver Architecture</h2> <p>A diagrammatic representation of the CSI driver architecture is illustrated. **Figure 424 shows the CSI architecture.</p> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure48.37700461.png" alt=""></p> <p><strong>Figure 24.</strong> CSI architecture</p> <p>The OpenShift Container Platform 4 cluster comprises the master and worker nodes (physical and virtual) with CoreOS deployed as the operating system. The iSCSI interface configured on the host nodes establishes the connection with the HPE 3PAR array to the cluster. Upon successful deployment of CSI Driver, the CSI controller, CSI Driver, and 3PAR CSP gets deployed which communicates with the HPE 3PAR or Nimble array via REST APIs. The associated features on Storage Class such as CSI Provisioner, CSI Attacher, and others are configured on the Storage Class.</p> <h3 id="configuring-csi-driver"><a href="#configuring-csi-driver" class="header-anchor">#</a> Configuring CSI Driver</h3> <p>Prior to configuring the HPE CSI driver, the following prerequisites needs to be met.</p> <h4 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h4> <ol><li>OpenShift Container Platform 4.x must be successfully deployed and console should be accessible.</li> <li>iSCSI interface should be configured for HPE 3PAR Storage and Nimble storage on Host server.</li> <li>Additional iSCSI network interfaces must be configured on worker nodes (physical and virtual).</li> <li>Deploy scc.yaml file to enable Security Context Constraints (SCC).</li></ol> <div class="custom-block tip"><p class="custom-block-title">Note</p> <p>To get access to the host ports, host network, and to mount the host path volume, the HPE CSI Driver needs to be run in privileged mode.  Prior to deployment of the CSI operator on OpenShift, createSCC to allow CSI driver to run with these privileges. Download SCC yaml file from GitHub <a href="https://raw.githubusercontent.com/hpe-storage/co-deployments/master/operators/hpe-csi-operator/deploy/scc.yaml" target="_blank" rel="noopener noreferrer">https://raw.githubusercontent.com/hpe-storage/co-deployments/master/operators/hpe-csi-operator/deploy/scc.yaml<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and update relevant fields such as project or namespace before running the yaml to deploy SCC.</p></div> <h4 id="configuring-iscsi-interface-on-worker-nodes"><a href="#configuring-iscsi-interface-on-worker-nodes" class="header-anchor">#</a> Configuring iSCSI interface on worker nodes</h4> <p>Additional iSCSI interface needs to be configured on all the worker nodes (physical and virtual) for establishing the connection between the OCP cluster and HPE 3PAR array, HPE Nimble array. iSCSI_A and iSCSI_B interfaces needs to be configured on the worker nodes for redundancy. Follow the steps as listed to configure the additional interface.</p> <ol><li>Create interface configuration files (ifcfg files) on each of the worker nodes by specifying the following parameters.</li></ol> <div class="language- extra-class"><pre class="language-text"><code>HWADDR=52:4D:1F:20:01:94 (MAC address of the iSCSI connector)
TYPE=Ethernet
BOOTPROTO=none
IPADDR=40.0.17.221 
PREFIX=16
DNS1= 20.1.1.254
ONBOOT=yes
</code></pre></div><ol start="2"><li>Reboot the worker nodes after configuring the ifcfg files. The 3PAR or Nimble Discovery IP should be pingable.</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure49.02c5881d.png" alt=""></p> <p>For virtual worker nodes, additional network adapters are added and the corresponding network port groups are selected.</p> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure50.8687950c.png" alt=""></p> <h5 id="iscsi-interface-for-physical-worker-nodes"><a href="#iscsi-interface-for-physical-worker-nodes" class="header-anchor">#</a> iSCSI Interface for physical worker nodes</h5> <p>For physical worker nodes, the server profile is configured with iSCSI_A connection for storage interface and additional iSCSI_B connection is added to the server profile for redundancy.</p> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure51.869d5680.png" alt=""></p> <h4 id="steps-to-deploy-scc"><a href="#steps-to-deploy-scc" class="header-anchor">#</a> Steps to deploy SCC</h4> <p>The following figure shows the parameters that needs to be edited (project name) where the CSI Operator is being deployed.</p> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure52.f45ff5d6.png" alt=""></p> <ol><li>From the Installer vm, download the scc.yaml file from GitHub from the following path.
curl -sL &lt;https://raw.githubusercontent.com/hpe-storage/co-deployments/master/operators/hpe-csi-operator/deploy/scc.yaml &gt; hpe-csi-scc.yaml</li> <li>Edit relevant parameters such as Project name and save the file.</li> <li>Deploy SCC and check the output</li></ol> <div class="language- extra-class"><pre class="language-text"><code>oc create -f hpe-csi-scc.yaml
</code></pre></div><p>Output:</p> <div class="language- extra-class"><pre class="language-text"><code>securitycontextconstraints.security.openshift.io/hpe-csi-scc created
</code></pre></div><h3 id="csi-driver-installation-on-3par"><a href="#csi-driver-installation-on-3par" class="header-anchor">#</a> CSI driver installation on 3PAR</h3> <h4 id="creating-namespace"><a href="#creating-namespace" class="header-anchor">#</a> Creating Namespace</h4> <p>Before installing the CSI Driver from the OpenShift console, create a namespace called HPE-CSI Driver. Perform the following steps to create a Namespace.</p> <ol><li>Click Administration → Namespaces in the left pane of the Console.</li> <li>Click Create Namespaces.</li> <li>In the Create Namespace dialog box -&gt; enter HPE- CSI.</li> <li>Click Create.</li></ol> <h3 id="installing-red-hat-hpe-csi-driver-operator-using-the-operator-hub"><a href="#installing-red-hat-hpe-csi-driver-operator-using-the-operator-hub" class="header-anchor">#</a> Installing Red Hat HPE CSI Driver Operator using the Operator Hub</h3> <h4 id="installing-hpe-csi-driver-operator"><a href="#installing-hpe-csi-driver-operator" class="header-anchor">#</a> Installing HPE CSI Driver Operator</h4> <ol><li>Login to the Red Hat OpenShift Container Platform Web Console.</li> <li>Click Operators → Operator Hub.</li> <li>Search for HPE CSI Driver Operator from the list of operators and click HPE CSI Driver operator.</li> <li>On the HPE-CSI Operator page, click Install.</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure53.0673e4a6.png" alt=""></p> <ol start="5"><li>On the Create Operator Subscription page, the Installation Mode, Update Channel and Approval Strategy options are available.</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure54.4a137a14.png" alt=""></p> <ol start="6"><li>Select an Approval Strategy. The available options are:</li></ol> <ul><li>Automatic: Specifies that the OpenShift Container Platform is required to upgrade HPE CSI Storage automatically. Select the Automatic option.</li> <li>Manual: Specifies that you need to upgrade to OpenShift Container Platform manually.</li></ul> <ol start="7"><li>Click <strong>Subscribe</strong>.</li> <li>The Installed Operators page is displayed with the status of the operator as shown.</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure55.5f3c9359.png" alt=""></p> <h3 id="creating-hpe-csi-driver"><a href="#creating-hpe-csi-driver" class="header-anchor">#</a> Creating HPE CSI driver</h3> <p>The HPE CSI Driver allows any vendor or project to develop its own Container Storage Provider by using the <a href="https://developer.hpe.com/api/hpe-nimble-csp/" target="_blank" rel="noopener noreferrer">CSP specification<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. This makes it very easy for third- parties to integrate their storage solution into Kubernetes as all the intricacies are taken care of by the HPE CSI Driver.</p> <p>To create HPE CSI driver, perform the following steps.</p> <ol><li>Click Operators → Installed Operators from the left pane of the OpenShift Web Console to view the installed operators.</li> <li>On the Installed Operator page, select HPE CSI Driver from the Project drop down list to switch to the HPE-CSI project</li> <li>Click HPE CSI Driver.</li> <li>On the HPE CSI Driver Operator page, scroll right and click the HPE CSI Driver yaml file.</li> <li>Edit the HPE CSI Driver yaml file with required values like backend (3PAR array IP), password and username as shown.</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure56.97c463de.png" alt=""></p> <ol start="6"><li>On the HPE CSI Driver Operator page, scroll right and click the HPECSI Driver tab as shown.</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure57.ee9dc550.png" alt=""></p> <h4 id="verifying-creation-of-hpe-csi-driver"><a href="#verifying-creation-of-hpe-csi-driver" class="header-anchor">#</a> Verifying creation of HPE CSI Driver</h4> <p>After the HPECSI Driver is deployed, one can see the associated deployment pods being created such as hpe-csi-controller, hpe-csi-driver, and primera3par-csp.</p> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure58.ac5c9eb6.png" alt=""></p> <p>To verify the HPE CSI Node Info, perform the following steps.</p> <ol><li>Run the following command from the Installer VM to check HPENodeinfo and network status of worker nodes.</li></ol> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># oc get HPENodeInfo</span>
<span class="token comment"># oc get HPENodeInfo/&lt;workernode fqdn&gt; -o yaml</span>
</code></pre></div><p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure59.9144ba44.png" alt=""></p> <h4 id="hpe-csi-driver-storage-installation"><a href="#hpe-csi-driver-storage-installation" class="header-anchor">#</a> HPE CSI Driver Storage installation</h4> <p>After installing HPE CSI Driver, Storage Class is created manually.</p> <ol><li>From the OpenShift console navigate to Storage -&gt; Storage Class</li> <li>Click Create Storage Class -&gt; Click Edit yaml -&gt; insert the parameters for SC creation -&gt; Click Create.</li> <li>‘hpe-standard’ storage class is created as shown.</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure60.2f2db35e.png" alt=""></p> <p>Run the following command on the CLI  to tag the storage class default- storage class by :</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># oc annotate storageclass hpe-standard storageclass.kubernetes.io/is-default-class=true</span>
</code></pre></div><p>The create Storage Class yaml file parameters are as follows:</p> <div class="language- extra-class"><pre class="language-text"><code>apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: hpe-standard
provisioner: csi.hpe.com
parameters:
  csi.storage.k8s.io/fstype: ext4
  csi.storage.k8s.io/controller-expand-secret-name: primera3par-secret
  csi.storage.k8s.io/controller-expand-secret-namespace: hpe-csi
  csi.storage.k8s.io/controller-publish-secret-name: primera3par-secret
  csi.storage.k8s.io/controller-publish-secret-namespace: hpe-csi
  csi.storage.k8s.io/node-publish-secret-name: primera3par-secret
  csi.storage.k8s.io/node-publish-secret-namespace: hpe-csi
  csi.storage.k8s.io/node-stage-secret-name: primera3par-secret
  csi.storage.k8s.io/node-stage-secret-namespace: hpe-csi
  csi.storage.k8s.io/provisioner-secret-name: primera3par-secret
  csi.storage.k8s.io/provisioner-secret-namespace: hpe-csi
  cpg: SSD_r6 
  provisioning_type: tpvv
  accessProtocol: iscsi
reclaimPolicy: Delete
allowVolumeExpansion: true
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Note</p> <p>From the worker node, ssh to the 3PAR array to check on the cpg values for Storage Class creation as shown.</p></div> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure61.4a641c3e.png" alt=""></p> <h4 id="sample-application-deployment"><a href="#sample-application-deployment" class="header-anchor">#</a> Sample application deployment</h4> <p>A sample application deployed on the existing Red Hat OpenShift Container Platform utilizes the volume from 3PAR array through HPE CSI Driver. A sample application such as mongodb or mariadb is deployed and scheduled on the worker nodes. Follow the steps to deploy a sample application.</p> <ol><li>Run the following command to deploy a sample application.</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># oc new-app mongodb-persistent</span>
</code></pre></div><p>Output:
<img src="/hpe-solutions-openshift/44-synergy/assets/img/figure62.da6b554d.png" alt=""></p> <ol start="2"><li>Check the status of PVC and Pod.</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure63.de819541.png" alt=""></p> <p>List of pods created on the cluster along with the one for sample application deployed is shown.</p> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure64.1c565354.png" alt=""></p> <p>PVC for the sample application deployed is created and bound. This can be verified in the OpenShift Console by navigating to Storage -&gt; Persistent Volume Claim section.</p> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure65.493690e9.png" alt=""></p> <h4 id="verification-of-persistent-volume-claim-on-3par-array"><a href="#verification-of-persistent-volume-claim-on-3par-array" class="header-anchor">#</a> Verification of Persistent Volume Claim on 3PAR array</h4> <p>The PVC created for the sample application deployed (mongodb) can be verified on the 3PAR array by searching for the PVC id seen on the console or on the CLI.</p> <div class="custom-block tip"><p class="custom-block-title">Note</p> <p>The PVC ID is not completely seen on 3PAR console as it gets truncated beyond 30 characters.</p></div> <p>Steps to verify the PVC on 3PAR array:</p> <ol><li>Login to the 3PAR SSMC URL at https://10.0.20.19:8443/#/login with appropriate credentials.</li> <li>Navigate from the drop- down menu option on 3PAR StoreServ -&gt; Virtual volumes</li> <li>The volume for the PVC created can be seen under the list of virtual volume as shown.</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure66.de09f86d.png" alt=""></p> <h4 id="openshift-persistent-volume-expansion"><a href="#openshift-persistent-volume-expansion" class="header-anchor">#</a> OpenShift Persistent Volume Expansion</h4> <p>The volume of the sample application deployed can be expanded by specifying the volume size on the OpenShift console. The steps for PVC expansion is as follows.</p> <ol><li>On the OpenShift web console navigate to Storage -&gt; Persistent Volume Claims -&gt; select a specific pod -&gt; click on the dots seen towards the right side -&gt; select ‘Expand PVC’</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure67.93759b94.png" alt=""></p> <ol start="2"><li>Change the volume size from 1Gi to 3Gi and click Expand button as shown.</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure68.ead1f83f.png" alt=""></p> <ol start="3"><li>Now, you can see PVC and PV has been resized to 3 GB.</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure69.9ea7487b.png" alt=""></p> <h1 id="deploying-hpe-3par-fc-storage-on-ocp-4"><a href="#deploying-hpe-3par-fc-storage-on-ocp-4" class="header-anchor">#</a> Deploying HPE 3PAR FC Storage on OCP 4</h1> <p>From the CSI driver section till verifying creation of CSI driver, there is no change in the procedure. Follow the steps as listed in the previous section.</p> <h2 id="hpe-csi-driver-storage-installation-2"><a href="#hpe-csi-driver-storage-installation-2" class="header-anchor">#</a> HPE CSI Driver storage installation</h2> <p>After installing HPE CSI Driver, Storage Class is created manually.</p> <ol><li>From the OpenShift console navigate to Storage -&gt; Storage Class</li> <li>Click Create Storage Class -&gt; Click Edit yaml -&gt; insert the parameters for SC creation -&gt; Click Create.</li> <li>‘hpe-standard’ storage class is created as shown.
<img src="/hpe-solutions-openshift/44-synergy/assets/img/figure79.28101f54.png" alt=""></li></ol> <p>Run the following command on the CLI  to tag the storage class default- storage class.</p> <div class="language- extra-class"><pre class="language-text"><code># oc annotate storageclass hpe-standard storageclass.kubernetes.io/is-default-class=true
The create Storage Class yaml file parameters are as follows: 
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: hpe-standard
provisioner: csi.hpe.com
parameters:
  csi.storage.k8s.io/fstype: ext4
  csi.storage.k8s.io/controller-expand-secret-name: primera3par-secret
  csi.storage.k8s.io/controller-expand-secret-namespace: hpe-csi
  csi.storage.k8s.io/controller-publish-secret-name: primera3par-secret
  csi.storage.k8s.io/controller-publish-secret-namespace: hpe-csi
  csi.storage.k8s.io/node-publish-secret-name: primera3par-secret
  csi.storage.k8s.io/node-publish-secret-namespace: hpe-csi
  csi.storage.k8s.io/node-stage-secret-name: primera3par-secret
  csi.storage.k8s.io/node-stage-secret-namespace: hpe-csi
  csi.storage.k8s.io/provisioner-secret-name: primera3par-secret
  csi.storage.k8s.io/provisioner-secret-namespace: hpe-csi
  cpg: SSD_r6 
  provisioning_type: tpvv
  accessProtocol: FC
reclaimPolicy: Delete
allowVolumeExpansion: true
</code></pre></div><h3 id="sample-application-deployment-2"><a href="#sample-application-deployment-2" class="header-anchor">#</a> Sample application deployment</h3> <p>A sample application deployed on the existing Red Hat OpenShift Container Platform utilizes the volume from 3PAR array through HPE CSI Driver. A sample application such as mongodb or mariadb is deployed and scheduled on the worker nodes. Follow the steps to deploy a sample application.
Steps:</p> <ol><li>Run the following command to deploy a sample application.</li></ol> <div class="language- extra-class"><pre class="language-text"><code># oc new-app mongodb-persistent
</code></pre></div><p>Output:
<img src="/hpe-solutions-openshift/44-synergy/assets/img/figure81.f42ac782.png" alt=""></p> <ol start="2"><li>Check the status of PV and PVC.
<img src="/hpe-solutions-openshift/44-synergy/assets/img/figure82.f42ac782.png" alt=""></li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure83.ee67cf57.png" alt=""></p> <p>List of pods created on the cluster along with the one for sample application deployed is shown.</p> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure84.1c6bffd3.png" alt=""></p> <h3 id="openshift-persistent-volume-expansion-2"><a href="#openshift-persistent-volume-expansion-2" class="header-anchor">#</a> OpenShift Persistent Volume Expansion</h3> <p>The volume of the sample application deployed can be expanded by specifying the volume size on the OpenShift console. The steps for PVC expansion is as follows.</p> <ol><li>On the OpenShift web console navigate to Storage -&gt; Persistent Volume Claims -&gt; select a specific pod -&gt; click on the dots seen towards the right side -&gt; select ‘Expand PVC’</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure85.5e2edf7f.png" alt=""></p> <ol start="2"><li>Change the volume size from 1Gi to 5Gi and click Expand button as shown.</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure86.7c0a1b9e.png" alt=""></p> <ol start="3"><li>Now, you can see PVC and PV has been resized to 5 GB.</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure87.b38001aa.png" alt=""></p> <h1 id="deploying-hpe-csi-driver-nimble-storage-on-ocp-4"><a href="#deploying-hpe-csi-driver-nimble-storage-on-ocp-4" class="header-anchor">#</a> Deploying HPE CSI Driver Nimble Storage on OCP 4</h1> <p>The sections CSI driver architecture, SCC and HPE CSI driver storage installation are the same as listed.</p> <h2 id="configuring-iscsi-interface-on-worker-nodes-2"><a href="#configuring-iscsi-interface-on-worker-nodes-2" class="header-anchor">#</a> Configuring iSCSI interface on worker nodes</h2> <p>Additional iSCSI interface needs to be configured on all the worker nodes (physical and virtual) for establishing the connection between the OCP cluster and HPE Nimble array. iSCSI_A and iSCSI_B interfaces needs to be configured on the worker nodes for redundancy. Follow the steps as- listed to configure the additional interface.</p> <ol><li>Create interface configuration files (ifcfg files) on each of the worker nodes by specifying the following parameters.</li></ol> <div class="language- extra-class"><pre class="language-text"><code>HWADDR=52:4D:1F:20:01:94 (MAC address of the iSCSI connector)
TYPE=Ethernet
BOOTPROTO=none
IPADDR=40.0.17.221 
PREFIX=16
DNS1= 20.1.1.254
ONBOOT=yes
</code></pre></div><ol start="2"><li>Reboot the worker nodes after configuring the ifcfg files. The Nimble Discovery IP should be pingable.</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure70.f9648fc8.png" alt=""></p> <p>For virtual worker nodes, additional Network adapters are added and the corresponding network port groups are selected.</p> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure71.58c48213.png" alt=""></p> <h3 id="iscsi-interface-for-physical-worker-nodes-2"><a href="#iscsi-interface-for-physical-worker-nodes-2" class="header-anchor">#</a> iSCSI Interface for Physical worker nodes</h3> <p>For Physical worker nodes, the server profile is configured with iSCSI_A connection for storage interface and additional iSCSI_B connection is added to the server profile for redundancy.</p> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure72.6b07dde4.png" alt=""></p> <h3 id="sample-application-deployment-3"><a href="#sample-application-deployment-3" class="header-anchor">#</a> Sample application deployment</h3> <p>A sample application deployed on the existing RedHat OpenShift Container Platform utilizes the volume from Nimble array through HPE CSI Driver. A sample application such as mongodb or mariadb is deployed and scheduled on the worker nodes.</p> <ol><li>Use the following command to deploy a sample application.</li></ol> <div class="language- extra-class"><pre class="language-text"><code># oc new-app mongodb-persistent
</code></pre></div><p>The output is as follows.
<img src="/hpe-solutions-openshift/44-synergy/assets/img/figure76.d26321cd.png" alt=""></p> <ol start="2"><li>Check the status of PVC and pod.
<img src="/hpe-solutions-openshift/44-synergy/assets/img/figure77.fbd5d1f9.png" alt=""></li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure78.493690e9.png" alt=""></p> <h3 id="openshift-persistent-volume-expansion-3"><a href="#openshift-persistent-volume-expansion-3" class="header-anchor">#</a> OpenShift Persistent Volume Expansion</h3> <p>The volume of the sample application deployed can be expanded by specifying the volume size on the OpenShift console. The steps for PVC expansion is listed as follows.</p> <ol><li>On the OpenShift web console navigate to Storage -&gt; Persistent Volume Claims -&gt; select a specific pod -&gt; click on the dots seen towards the right side -&gt; select ‘Expand PVC’</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure73.93759b94.png" alt=""></p> <ol start="2"><li>Change the volume size from 1Gi to 3Gi and click Expand button.</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure74.ead1f83f.png" alt=""></p> <ol start="3"><li>Now you can see PVC and PV has been resized to 3 GB.</li></ol> <p><img src="/hpe-solutions-openshift/44-synergy/assets/img/figure75.9ea7487b.png" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/hpe-solutions-openshift/44-synergy/Solution-Deployment/Deploying-OCP-on-VMware-vSphere.html" class="prev">
        Deploying OpenShift Container Platform 4.4 on VMware vSphere
      </a></span> <span class="next"><a href="/hpe-solutions-openshift/44-synergy/Additional-Features-and-Functionality/Red-Hat-Local-Storage-Operator.html">
        Red Hat Local Storage operator
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/hpe-solutions-openshift/44-synergy/assets/js/app.84b9672e.js" defer></script><script src="/hpe-solutions-openshift/44-synergy/assets/js/2.d6fcc4df.js" defer></script><script src="/hpe-solutions-openshift/44-synergy/assets/js/3.a78e42b0.js" defer></script>
  </body>
</html>
