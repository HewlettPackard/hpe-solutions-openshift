(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{497:function(t,e,s){"use strict";s.r(e);var a=s(42),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"preparing-the-execution-environment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#preparing-the-execution-environment"}},[t._v("#")]),t._v(" Preparing the execution environment")]),t._v(" "),s("p",[t._v("This section provides a detailed overview and steps to configure the components deployed for this solution.")]),t._v(" "),s("h2",{attrs:{id:"installer-machine"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#installer-machine"}},[t._v("#")]),t._v(" Installer machine")]),t._v(" "),s("p",[t._v("This document assumes that a server running Red Hat Enterprise Linux (RHEL) 7.6 exists within the deployment environment and is accessible to the installation user to be used as an installer machine. This server must have internet connectivity. In this solution, a virtual machine is used to act as an installer machine and the same host is utilized as an Ansible Engine host.")]),t._v(" "),s("h2",{attrs:{id:"non-root-user-access"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#non-root-user-access"}},[t._v("#")]),t._v(" Non-root user access")]),t._v(" "),s("p",[t._v("The industry-wide security best practice is to avoid the use of root user account for administration of Linux-based servers. However, certain operations require root user privileges to perform tasks. In those cases, it is best to use the sudo command to obtain the necessary privilege escalation on a short-term basis. The sudo command allows programs and commands to be run with the security privileges of another user (Root is the default user) and can restrict the permission to specific groups, users, and individual commands.")]),t._v(" "),s("p",[t._v("The root user is not active by default in RHCOS. Instead, log in as the core user.")]),t._v(" "),s("p",[t._v("Use the following steps to create a non-root user for the OpenShift installation process:")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Login to the installer VM as root. Refer to the "),s("a",{attrs:{href:"#installer-machine"}},[t._v("Installer machine")]),t._v(" section  in this document for more details about the installer VM.")])]),t._v(" "),s("li",[s("p",[t._v("Execute the following command to create a non-root user.")])])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" adduser openshift_admin\n")])])]),s("ol",{attrs:{start:"3"}},[s("li",[t._v("Execute the following command to set password for the non-root user.")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("passwd")]),t._v(" openshift_admin\n")])])]),s("ol",{attrs:{start:"4"}},[s("li",[t._v("Add non-root user's group in sudoers file and use the following command to find non-root user's group.")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("> id -Gn openshift_admin\nopenshift_admin\n")])])]),s("ol",{attrs:{start:"5"}},[s("li",[t._v("Edit the sudoers file and use the following command to add the entry of non-root user's group in the sudoers file.")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" visudo\n")])])]),s("p",[t._v("Add a non-root user's group entry in sudoers file as follows. Allow the following commands to run anywhere in non-root user environment")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("openshift_admin\t"),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ALL")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ALL"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" /usr/bin/chmod, /bin/yum, /usr/bin/yum-config-manager, /sbin/subscription-manager, /usr/bin/git, /bin/"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v("vi, /bin/vim, /bin/mkdir, /usr/bin/cat, /usr/bin/echo, /usr/bin/python, /usr/bin/sed, /usr/bin/chown, /bin/sh, /bin/cp, /bin/ansible-vault, /usr/bin/scp, /usr/bin/rpm, /usr/sbin/chkconfig, /usr/bin/systemctl, /usr/bin/journalctl, /usr/bin/curl, /usr/bin/tar,  /usr/bin/genisoimage, /usr/bin/mount , /usr/bin/umount, /usr/bin/rsync, /usr/bin/find, /usr/bin/mv, /usr/bin/nano, /usr/sbin/dnsmasq, /usr/sbin/setsebool\n")])])]),s("ol",{attrs:{start:"6"}},[s("li",[t._v("Execute the following command to change the user (non-root user).")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("su")]),t._v(" openshift_admin\n")])])]),s("ol",{attrs:{start:"7"}},[s("li",[t._v("Register the host and execute the following command to attach the host pool with Red Hat.")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum -y "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" subscription-manager\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" subscription-manager register --username"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("username"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" --password"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("password"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" --auto-attach\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" subscription-manager attach --pool"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("pool_id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),s("ol",{attrs:{start:"8"}},[s("li",[t._v("Disable all repositories and enable only the repositories required for the installer VM.")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum -y "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" yum-utils\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum-config-manager --disable *\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" subscription-manager repos --disable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"*"')]),t._v(" \n  --enable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rhel-7-server-rpms"')]),t._v(" \n  --enable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rhel-7-server-extras-rpms"')]),t._v(" \n  --enable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rhel-7-server-optional-rpms"')]),t._v(" \n  --enable"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--enable rhel-server-rhscl-7-rpms"')]),t._v("\n")])])]),s("ol",{attrs:{start:"9"}},[s("li",[t._v("Use the following command to install Ansible.")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum -y "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" ansible\n")])])]),s("ol",{attrs:{start:"10"}},[s("li",[t._v("Install Git package on installer VM for performing Git- related operations.")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum -y "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v("\n")])])]),s("ol",{attrs:{start:"11"}},[s("li",[t._v("Execute the following commands to download the hpe-solutions-openshift repository.")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /opt/hpe/solutions/ocp\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /opt/hpe/solutions/ocp\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("https://github.com/HewlettPackard/hpe-solutions-openshift.git"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chown")]),t._v(" -R openshift_admin:openshift_admin /opt/hpe/solutions/ocp\n")])])]),s("ol",{attrs:{start:"12"}},[s("li",[t._v("Create an environment variable BASE_DIR and point it to the following path.")])]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("BASE_DIR")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/opt/hpe/hpe-solutions-openshift/synergy/scalable\n")])])]),s("ol",{attrs:{start:"13"}},[s("li",[t._v("After the hpe-solutions-openshift repository is downloaded, navigate to the path "),s("em",[t._v("/etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/playbooks")]),t._v(". The scripts within this directory assists in configuring the prerequisites for the environment. The details of the scripts are as follows:")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[t._v("-   python_env.sh : This script installs Python 3.\n\n-   ansible_env.sh : This script creates a Python 3 virtual environment and installs Ansible within the virtual environment.\n\n-   download_oneview_packages.sh : This script installs the prerequisite modules such as HPE oneview-ansible, HPE oneview-python and VMware pyVmomi within the virtual environment.\n")])])]),s("ol",{attrs:{start:"14"}},[s("li",[t._v("Steps to configure the prerequisite environment are as follows:")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",[s("code",[t._v("-   Change the directory to /etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/playbooks\n\n    ```bash\n    $ cd $BASE_DIR/installer/playbooks\n    ```\n\n-   Execute the following command to setup prerequisite Python environment.\n\n    ```bash\n    $ yum -y install @development\n    $ sudo sh python_env.sh\n    ```\n\n-   Execute the following command to enable Python 3.\n\n    ```bash\n    $ scl enable rh-python36 bash\n    ```\n\n-   Execute the following command to configure the Ansible environment.\n\n    ```bash\n    $ sudo sh ansible_env.sh\n    ```\n\n-   Execute the following command to download the HPE OneView packages.\n\n    ```bash\n    $ sudo sh download_oneview_packages.sh\n    ```\n\n-   Enable the virtual environment with the following command.\n\n    ```bash\n    $ source ../ocp_venv/bin/activate\n    ```\n\n-   Execute the following command to set the environment variables.\n\n    ```bash\n    $ export ANSIBLE_LIBRARY=$BASE_DIR/installer/library/oneview-ansible/library\n\n    $ export ANSIBLE_MODULE_UTILS=$BASE_DIR/installer/library/oneview-ansible/library/module_utils\n    ```\n")])])]),s("h2",{attrs:{id:"kubernetes-manifests-and-ignition-files"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-manifests-and-ignition-files"}},[t._v("#")]),t._v(" Kubernetes manifests and ignition files")]),t._v(" "),s("p",[t._v("Manifests and ignition files define the master node and worker node configuration and are key components of the Red Hat OpenShift Container Platform 4 installation.")]),t._v(" "),s("p",[t._v("Before creating the manifest files and ignition files, it is necessary to download the Red Hat OpenShift 4 packages. Execute the following command on the installer VM to download the required packages.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BASE_DIR")]),t._v("/installer\n\n$ ansible-playbook playbooks/download_ocp_package.yml\n")])])]),s("p",[t._v("The OpenShift packages downloaded after executing the "),s("em",[t._v("download_ocp_package.yml")]),t._v(" playbook can be found on the installer VM at "),s("em",[t._v("/etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/library/openshift_components")]),t._v(". To execute any OpenShift related adhoc commands, it is advised to execute them from within this folder.")]),t._v(" "),s("p",[t._v("To create the manifest files and the ignition files, edit the "),s("em",[t._v("install-config.yaml")]),t._v(" file provided in the directory "),s("em",[t._v("/etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/ignitions")]),t._v(" to include the following details:")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("baseDomain : Base domain of the DNS which hosts Red Hat OpenShift Container Platform.")])]),t._v(" "),s("li",[s("p",[t._v("name : Name of the OpenShift cluster. This is same as the new domain created in DNS.")])]),t._v(" "),s("li",[s("p",[t._v("replicas : Update this field to reflect the corresponding number of master or worker instances required for the OpenShift cluster as per the installation environment requirements. It is recommended to have a minimum of 3 master nodes and 2 worker nodes per OpenShift cluster.")])]),t._v(" "),s("li",[s("p",[t._v("clusterNetworks : This field is pre-populated by Red Hat. Update this field only if a custom cluster network is to be used.")])]),t._v(" "),s("li",[s("p",[t._v("pullSecret : Update this field with the pull secret for the Red Hat account. Login to Red Hat account "),s("a",{attrs:{href:"https://cloud.redhat.com/openshift/install/metal/user-provisioned",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://cloud.redhat.com/openshift/install/metal/user-provisioned"),s("OutboundLink")],1),t._v(" and retrieve the pull secret.")])]),t._v(" "),s("li",[s("p",[t._v("sshKey : Update this field with the sshKey of the installer VM and copy the SSH key in install-config.yaml file. Generate the SSH key with following command.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ ssh-keygen\n")])])]),s("p",[t._v("A sample "),s("em",[t._v("install-config.yaml")]),t._v(" file appears as follows. Update the fields to suit the installation environment.")]),t._v(" "),s("div",{staticClass:"language-yaml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("baseDomain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("&lt;name")]),t._v(" of the base domain"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("&gt;")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("compute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hyperthreading")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Enabled\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" worker\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("controlPlane")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hyperthreading")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Enabled\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" master\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("&lt;name")]),t._v(" of the cluster"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" same as the new domain under the base domain created"),s("span",{pre:!0,attrs:{class:"token important"}},[t._v("&gt;")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networking")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("clusterNetworks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("cidr")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 12.128.0.0/14\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostPrefix")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("23")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networkType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" OpenShiftSDN\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceNetwork")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 172.30.0.0/16\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("platform")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("none")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("pullSecret")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ‘pull secret provided as per the Red Hat account’\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("sshKey")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ‘ ssh key of the installer VM ’\n\n")])])]),s("p",[t._v("Execute the following command on the installer VM to create the manifest files and the ignition files required to install Red Hat OpenShift.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$BASE_DIR")]),t._v("/installer\n$ ansible-playbook playbooks/create_manifest_ignitions.yml\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chmod")]),t._v(" +r installer/ignitions/*.ign\n")])])])])]),t._v(" "),s("p",[t._v("The ignition files are generated on the installer VM within the folder "),s("em",[t._v("/etc/ansible/hpe-solutions-openshift/synergy/scalable/installer/ignitions")]),t._v(".")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),s("p",[t._v("The ignition files have a time-out period of 24 hours and it is critical that the clusters are created within 24 hours of generating the ignition files. If it crosses 24 hours, then regenerate the ignition files again by clearing up the files from the directory where the ignition files were saved.")])]),t._v(" "),s("h2",{attrs:{id:"os-deployment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#os-deployment"}},[t._v("#")]),t._v(" OS deployment")]),t._v(" "),s("h3",{attrs:{id:"pxe-server"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#pxe-server"}},[t._v("#")]),t._v(" PXE server")]),t._v(" "),s("p",[t._v("In this solution, a PXE server is used for OS deployment and is configured on CentOS (version: CentOS Linux release 7.6.1810 (Core)). The PXE server uses the FTP service for file distribution but can be altered to support HTTP or NFS.")]),t._v(" "),s("p",[t._v("This section highlights the steps to configure a PXE server:")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Login to the CentOS server to be configured as a PXE server as a user that can run commands as root via sudo.")])]),t._v(" "),s("li",[s("p",[t._v("Install packages such as DHCP, TFTP server, vSFTPD (FTP server) and xinetd using the following command.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" yum "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" dhcp tftp tftp-server syslinux vsftpd xinetd\n")])])])]),t._v(" "),s("li",[s("p",[t._v("Update the DHCP configuration file at "),s("em",[t._v("/etc/dhcp/dhcpd.conf")]),t._v(" with the MAC addresses, IP addresses, DNS, and routing details of the installation environment. Domain search is optional. A sample DHCP configuration file is shown as follows.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('ddns-update-style interim;\nignore client-updates;\nauthoritative;\nallow booting;\nallow bootp;\n\n# internal subnet for my DHCP Server\nsubnet 20.0.x.x netmask 255.0.0.0 {\nrange 20.0.x.x 20.0.x.x;\ndeny unknown-clients;\noption domain-name-servers 20.x.x.x;\noption domain-name "twentynet.local";\noption routers 20.x.x.x;\noption broadcast-address 20.255.255.255;\ndefault-lease-time 600;\nmax-lease-time 7200;\nnext-server 20.x.x.x;\nfilename "pxelinux.0";\n}\n\n#######################################\nhost bootstrap {\nhardware ethernet 00:50:56:xx:98:df;\nfixed-address 20.0.x.x;\n}\nhost master01 {\nhardware ethernet 00:50:56:95:xx:82;\nfixed-address 20.0.x.x;\n}\nhost worker01 {\nhardware ethernet 00:50:56:xx:ab:82;\nfixed-address 20.0.x.x;\n}\n')])])])]),t._v(" "),s("li",[s("p",[t._v("Trivial File Transfer Protocol (TFTP) is used to transfer files from data server to clients without any kind of authentication. TFTP is used for ignition file loading in PXE based environments. To configure the TFTP server, edit the configuration file "),s("em",[t._v("/etc/xinetd.d/tftp")]),t._v(". Change the parameter ‘disable = yes’ to ‘disable = no’ and leave the other parameters as is. To edit the "),s("em",[t._v("/etc/xinetd.d/tftp")]),t._v(" file, execute the following command.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v("  /etc/xinetd.d/tftp\n")])])]),s("p",[t._v("The TFTP configuration file is shown below.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("service tftp\n   {\n\n        socket_type = dgram\n        protocol = udp\n        wait = yes\n        user = root\n        server = /usr/sbin/in.tftpd\n        server_args = -s /var/lib/tftpboot\n        disable = no\n        per_source = 11\n        cps = 100 2\n        flags = IPv4\n    }\n")])])]),s("p",[t._v("Network boot related files must be placed in the tftp root directory "),s("em",[t._v("/var/lib/tftpboot")]),t._v(". Run the following commands to copy the required network boot files to "),s("em",[t._v("/var/lib/tftpboot/")]),t._v(".")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" –v /usr/share/syslinux/pxelinux.0 /var/lib/tftpboot\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" –v /usr/share/syslinux/menu.c32 /var/lib/tftpboot\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" –v /usr/share/syslinux/memdisk /var/lib/tftpboot\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" –v /usr/share/syslinux/mboot.c32 /var/lib/tftpboot\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" –v /usr/share/syslinux/chain.c32 /var/lib/tftpboot\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" /var/lib/tftpboot/pxelinux.cfg\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" /var/lib/tftpboot/networkboot\n")])])])]),t._v(" "),s("li",[s("p",[t._v("Copy the RHCOS 4 and RHEL 7.6 ISO files to the PXE server. Mount it to the "),s("em",[t._v("/mnt/")]),t._v(" directory and then copy the contents of the ISO to the local FTP server using the following commands.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" –o loop "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("lt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("OS "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("file")]),t._v(" name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gt"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" /mnt/\n\n$ "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" /mnt/\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" –av * /var/ftp/pub/\n")])])])]),t._v(" "),s("li",[s("p",[t._v("Copy the kernel file (vmlinuz) and initrd file from "),s("em",[t._v("/mnt")]),t._v(" to "),s("em",[t._v("/var/lib/tftpboot/networkboot/")]),t._v(" using the following commands.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /mnt/images/pxeboot/vmlinuz /var/lib/tftpboot/networkboot/\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cp")]),t._v(" /mnt/images/pxeboot/initrd.img /var/lib/tftpboot/networkboot\n")])])])]),t._v(" "),s("li",[s("p",[t._v("Unmount the ISO files using the following command.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" unmount /mnt/\n")])])])]),t._v(" "),s("li",[s("p",[t._v("For RHEL nodes, create and utilize a new kickstart file under the folder "),s("em",[t._v("/var/ftp/pub")]),t._v(" with the name “"),s("em",[t._v("rhel7.cfg")]),t._v("” using the following command.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /var/ftp/pub/rhel7.cfg\n")])])]),s("p",[t._v("An example kickstart file is shown as follows. The installation user should create a kickstart file to meet the requirements of their installation environment.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('firewall --disabled\n# Install OS instead of upgrade\ninstall\n# Use FTP installation media\nurl --url="ftp://&lt;FTP_server_IP_address&gt;/pub/rhel76/"\n# Root password\n# root password can be plaintext as shown below\n# rootpw –plaintext &lt;password&gt;\n# root password is encrypted using the command “openssl passwd -1 &lt;password&gt;” and resultant output is provided for rootpw as shown below\nrootpw --iscrypted $6$uiq8l/7xEWsYXhrvaEgan4N21yhLa8K.U7UA12Th3PD11GOXvEcI40gp\n# System authorization information\nauth useshadow passalgo=sha512\n# Use graphical install\ngraphical\nfirstboot disable\n# System keyboard, timezone, language\nkeyboard us\ntimezone Europe/Amsterdam\nlang en_US\n# SELinux configuration\nselinux disabled\n# Installation logging level\nlogging level=info\n# System bootloader configuration\nbootloader location=mbr\nclearpart --all --initlabel\npart swap --asprimary --fstype="swap" --size=1\npart /boot --fstype xfs --size=300\npart pv.01 --size=1 --grow\nvolgroup root_vg01 pv.01\nlogvol / --fstype xfs --name=lv_01 --vgname=root_vg01 --size=1 --grow\n%packages\n@^minimal\n@core\n%end\n%addon com_redhat_kdump --disable --reserve-mb=\'auto\'\n%end\n')])])])]),t._v(" "),s("li",[s("p",[t._v("Create a PXE menu.")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("Create a PXE menu file at the location "),s("em",[t._v("/var/lib/tftpboot/pxelinux.cfg/default")]),t._v(" using the command.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" /var/lib/tftpboot/pxelinux.cfg/default\n")])])])]),t._v(" "),s("li",[s("p",[t._v("For each of the OS boot options, provide the following details:")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("MENU LABEL : Custom name of the respective menu label.")])]),t._v(" "),s("li",[s("p",[t._v("KERNEL : Kernel details of the operating system.")])]),t._v(" "),s("li",[s("p",[t._v("APPEND : Path of bootloader file along with path of cfg or ignition files (in case of RHCOS) or configuration file (in case of RHEL).")])])])])]),t._v(" "),s("p",[t._v("A sample PXE menu is as follows.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("default menu.c32\n\nprompt 0\n\ntimeout 30\n\nMENU TITLE LinuxTechi.com PXE Menu\n\nLABEL rhel76\n\nMENU LABEL RHEL76-Buedata\n\nKERNEL /rhel76/vmlinuz\n\nAPPEND initrd=/rhel76/initrd.img inst.repo=ftp://&lt;FTP_server_IP_address&gt;/pub/rhel76 ks=ftp://&lt;FTP_server_IP_address&gt;/pub/rhel76-hcp.cfg\n\nLABEL rhcos-bootstrap\n\nMENU LABEL Install RHCOS4.3 sec-Bootstrap\n\nKERNEL /networkboot/rhcos-4.3.0-x86_64-installer-kernel\n\nAPPEND ip=dhcp rd.neednet=1 initrd=/networkboot/rhcos-4.3.0-x86_64-installer-initramfs.img console=tty0 console=ttyS0 coreos.inst=yes coreos.inst.install_dev=sda coreos.inst.image_url= ftp://&lt;FTP_server_IP_address&gt;/pub/rhcos-4.3.0-x86_64-metal-bios.raw.gz coreos.inst.ignition_url= ftp://&lt;FTP_server_IP_address&gt;/pub/sec/bootstrap.ign\n\nLABEL rhcos-master\n\nMENU LABEL Install RHCOS4.2 sec-Master\n\nKERNEL /networkboot/rhcos-4.3.0-x86_64-installer-kernel\n\nAPPEND ip=dhcp rd.neednet=1 initrd=/networkboot/rhcos-4.3.0-x86_64-installer-initramfs.img console=tty0 console=ttyS0 coreos.inst=yes coreos.inst.install_dev=sda coreos.inst.image_url= ftp://&lt;FTP_server_IP_address&gt;/pub/rhcos-4.3.0-x86_64-metal-bios.raw.gz coreos.inst.ignition_url=ftp://&lt;FTP_server_IP_address&gt;/pub/sec/master.ign\n\nLABEL rhcos-worker\n\nMENU LABEL Install RHCOS4.2 sec-Worker\n\nKERNEL /networkboot/rhcos-4.3.0-x86_64-installer-kernel\n\nAPPEND ip=dhcp rd.neednet=1 initrd=/networkboot/rhcos-4.3.0-x86_64-installer-initramfs.img console=tty0 console=ttyS0 coreos.inst=yes coreos.inst.install_dev=sda coreos.inst.image_url= ftp://&lt;FTP_server_IP_address&gt;/pub/rhcos-4.3.0-x86_64-metal-bios.raw.gz coreos.inst.ignition_url=ftp://&lt;FTP_server_IP_address&gt;/pub/sec/worker.ign\n")])])])]),t._v(" "),s("li",[s("p",[t._v("Start and enable xinetd, dhcpd and vsftpd using the following commands.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("    $ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl start xinetd\n\n    $ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" xinetd\n\n    $ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl start dhcpd.service\n\n    $ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" dhcpd.service\n\n    $ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl start vsftpd\n\n    $ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" systemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" vsftpd\n")])])])]),t._v(" "),s("li",[s("p",[t._v("Configure SELinux for FTP.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" setsebool –P allow_ftpd_full_access "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n")])])])]),t._v(" "),s("li",[s("p",[t._v("Open ports in the firewall using the following firewall-cmd commands.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" firewall-cmd --add-service-ftp --permanent\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" firewall-cmd --add-service-dhcp --permanent\n\n$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" firewall-cmd –reload\n")])])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),s("p",[t._v("It is crucial to generate ignition files, copy them to the TFTP server, and update the path in the PXE default file. For more information about generating the ignition files, refer to the "),s("a",{attrs:{href:"#Kubernetes-manifests-and-ignition-files"}},[t._v("Kubernetes manifests and ignition files")]),t._v(" section in this document.")])]),t._v(" "),s("h3",{attrs:{id:"ipxe"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ipxe"}},[t._v("#")]),t._v(" iPXE")]),t._v(" "),s("p",[t._v("This folder consists of scripts to deploy operating system over servers using virtual media.")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("Prerequisites")]),t._v(" "),s("p",[t._v("Installer machine with the following:")]),t._v(" "),s("ol",[s("li",[t._v("Web server (preferably Nginx) is configured.")])])]),t._v(" "),s("h2",{attrs:{id:"installation"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#installation"}},[t._v("#")]),t._v(" Installation")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("Install the prerequisites.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("$ cd $BASE_DIR/os_deployment\n$ pip3 install requirements.txt\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),s("p",[s("code",[t._v("BASE_DIR")]),t._v(' is defined in "'),s("a",{attrs:{href:"#installer-machine"}},[t._v("Installer machine")]),t._v(" section.")])])]),t._v(" "),s("li",[s("p",[t._v("Update the servers dictionary in deploy_os.py script with the server details on which the operating system is to be installed.")]),t._v(" "),s("p",[t._v("Example value is as follows:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v(' server = [{\n     "Server_serial_number"  : "MXQ920023X",\n     "ILO_Address"           : "10.0.x.x",\n     "ILO_Username"          : "admin",\n     "ILO_Password"          : "password",\n     "Hostname"              : "master.tennet.local",\n     "Host_IP"               : "x.x.x.x",\n     "Host_Username"         : "root",\n     "Host_Password"         : "Password",\n     "Host_Netmask"          : "255.255.0.0",\n     "Host_Gateway"          : "10.0.x.x",\n     "Host_DNS"              : "10.0.x.x",\n     "OS_image_name"         : "rhel-server-7.6-x86_64-dvd.iso",\n     "Web_server_address"    : "10.0.x.x"\n },\n {\n     "Server_serial_number"  : "MXQ93906KB",\n     "ILO_Address"           : "10.0.x.x",\n     "ILO_Username"          : "admin",\n     "ILO_Password"          : "password",\n     "Hostname"              : "worker.tennet.local",\n     "Host_IP"               : "10.0.x.x",\n     "Host_Username"         : "root",\n     "Host_Password"         : "Password",\n     "Host_Netmask"          : "255.255.0.0",\n     "Host_Gateway"          : "10.0.x.x",\n     "Host_DNS"              : "10.0.x.x",\n     "OS_image_name"         : "rhel-server-7.6-x86_64-dvd.iso",\n     "Web_server_address"    : "10.0.x.x"\n }]\n')])])])]),t._v(" "),s("li",[s("p",[t._v("Execute the script to deploy operating system.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("$ python3 deploy_os.py\n")])])])])]),t._v(" "),s("h2",{attrs:{id:"esxi-deployment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#esxi-deployment"}},[t._v("#")]),t._v(" ESXi deployment")]),t._v(" "),s("p",[t._v("This section outlines the steps to programmatically deploy ESXi on all the bare metal nodes.")]),t._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[t._v("Prequisites")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("RHEL 7.6 Installer machine with the following configuration is essential to initiate the OS deployment process.")])]),t._v(" "),s("li",[s("p",[t._v("ESXi ISO image is present in the HTTP file path within the installer machine.")])])])]),t._v(" "),s("h2",{attrs:{id:"installation-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#installation-2"}},[t._v("#")]),t._v(" Installation")]),t._v(" "),s("ol",[s("li",[s("p",[t._v('Enable Python 3 and Ansible environment as mentioned in "installer machine" section of deployment guide.')])]),t._v(" "),s("li",[s("p",[t._v("Execute the following command on the installer VM to point to the esxi deployment directory.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("$ cd $BASE_DIR/os_deployment/deploy_esxi\n")])])])]),t._v(" "),s("li",[s("p",[t._v("Use the following command to install requirements.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("$ sudo sh setup.sh \n")])])])]),t._v(" "),s("li",[s("p",[t._v("Edit input files using the following command.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("$ sudo ansible-vault edit input_files/config.yml\n$ Enter the password\n")])])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),s("p",[t._v("The default password for the Ansible vault file is "),s("code",[t._v("changeme")])])]),t._v(" "),s("ol",{attrs:{start:"5"}},[s("li",[s("p",[t._v("Update the input_files/config.yml file with the details of web server and operating system to be installed.")]),t._v(" "),s("p",[t._v("Example values for the input configuration is as follows:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("config:\n  HTTP_server_base_url: http://10.0.x.x/\n  HTTP_file_path: /usr/share/nginx/html/\n  OS_type: esxi67\n  OS_image_name: <ISO_image_name>.iso\n  base_kickstart_filepath: kickstart_files/ks_esxi67.cfg\n\n")])])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),s("p",[t._v('Acceptable values for "OS_type" variable is "esxi67" for ESXi 6.7.')])]),t._v(" "),s("ol",{attrs:{start:"6"}},[s("li",[s("p",[t._v("Update the input_files or server_details.yml file with the details of servers on which ESXi is to be installed.")]),t._v(" "),s("p",[t._v("Example values for the input configuration for deploying ESXi 6.7 is as follows:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("servers:\n   -  Server_serial_number: MXxxxxxDP\n      ILO_Address: 10.0.x.x\n      ILO_Username: username\n      ILO_Password: password\n      Hostname: vsphere01.twentynet.local\n      Host_IP: 20.x.x.x\n      Host_Username: root\n      Host_Password: Password\n      Host_Netmask: 255.x.x.x\n      Host_Gateway: 20.x.x.x\n      Host_DNS: 20.x.x.x\n   - Server_serial_number: MXxxxxxDQ\n      ILO_Address: 10.0.x.x\n      ILO_Username: username\n      ILO_Password: password\n      Hostname: vsphere02.twentynet.local\n      Host_IP: 20.0.x.x\n      Host_Username: root\n      Host_Password: Password\n      Host_Netmask: 255.x.x.x\n      Host_Gateway: 20.x.x.x\n      Host_DNS: 20.x.x.x\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),s("ul",[s("li",[t._v('It is recommended to provide a complex password for the "Host_Password" variable.')]),t._v(" "),s("li",[t._v("Provide administrative priviliged iLO account username and password.")])])])])]),t._v(" "),s("p",[t._v(":::\n7. Running playbook to deploy ESXi.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("$ ansible-playbook deploy.yml --ask-vault-pass\n")])])]),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("In the process of ESXi deployment, ISO image contents will be forcefully moved to inside "),s("code",[t._v("$BASE_DIR/deploy_esxi/files")]),t._v(" folder and it needs to be deleted in case of space issues.")])]),t._v(" "),s("li",[s("p",[s("code",[t._v("BASE_DIR")]),t._v(" is defined in "),s("a",{attrs:{href:"#installer-machine"}},[t._v("Installer machine")]),t._v(" section.")])])])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("Note")]),t._v(" "),s("ol",[s("li",[t._v("Generic settings done as part of kickstart file for ESXi are as follows. It is recommended that the user reviews and modifies the kickstart file (kickstart_files/ks_esxi67.cfg) to suit their requirements.\n"),s("ul",[s("li",[t._v("Accept End User License Agreement (EULA)")]),t._v(" "),s("li",[t._v("clearpart --alldrives --overwritevmfs")]),t._v(" "),s("li",[t._v("install --firstdisk --overwritevmfs")]),t._v(" "),s("li",[t._v("%firstboot --interpreter=busybox")]),t._v(" "),s("li",[t._v("One standard switch vswitch0 is created with uplinks vmnic0 and vmnic1. it is assigned with the Host_IP defined in the input_files/server_details.yml input file.")]),t._v(" "),s("li",[t._v("NIC teaming is performed with vmnic0 being the active uplink and vmnic1 being the standby uplink.")]),t._v(" "),s("li",[t._v("NIC failover policy is set to --failback yes --failure-detection link --load-balancing mac --notify-switches yes.")])])])])])])}),[],!1,null,null,null);e.default=n.exports}}]);