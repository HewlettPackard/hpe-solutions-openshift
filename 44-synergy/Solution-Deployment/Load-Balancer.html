<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Load Balancer</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/assets/css/0.styles.3c72cb3e.css" as="style"><link rel="preload" href="/assets/js/app.6c1bb9d7.js" as="script"><link rel="preload" href="/assets/js/2.41475481.js" as="script"><link rel="preload" href="/assets/js/30.36cb63bf.js" as="script"><link rel="prefetch" href="/assets/js/10.60e6f26c.js"><link rel="prefetch" href="/assets/js/11.e2568a46.js"><link rel="prefetch" href="/assets/js/12.e8a20512.js"><link rel="prefetch" href="/assets/js/13.24fe0aaa.js"><link rel="prefetch" href="/assets/js/14.a6af149a.js"><link rel="prefetch" href="/assets/js/15.561f307f.js"><link rel="prefetch" href="/assets/js/16.1b58705c.js"><link rel="prefetch" href="/assets/js/17.d99cf671.js"><link rel="prefetch" href="/assets/js/18.7d38c742.js"><link rel="prefetch" href="/assets/js/19.aaf54330.js"><link rel="prefetch" href="/assets/js/20.f13070be.js"><link rel="prefetch" href="/assets/js/21.9653edeb.js"><link rel="prefetch" href="/assets/js/22.1485b3f6.js"><link rel="prefetch" href="/assets/js/23.1db2bb05.js"><link rel="prefetch" href="/assets/js/24.98a40dda.js"><link rel="prefetch" href="/assets/js/25.fed3b70c.js"><link rel="prefetch" href="/assets/js/26.9fa44e0a.js"><link rel="prefetch" href="/assets/js/27.3b728ad7.js"><link rel="prefetch" href="/assets/js/28.39a8466c.js"><link rel="prefetch" href="/assets/js/29.56669789.js"><link rel="prefetch" href="/assets/js/3.356a20e7.js"><link rel="prefetch" href="/assets/js/31.1b814f7d.js"><link rel="prefetch" href="/assets/js/32.5cc2658a.js"><link rel="prefetch" href="/assets/js/33.9b22325c.js"><link rel="prefetch" href="/assets/js/4.fadf857d.js"><link rel="prefetch" href="/assets/js/5.a355315e.js"><link rel="prefetch" href="/assets/js/6.b9418f75.js"><link rel="prefetch" href="/assets/js/7.b5fd1524.js"><link rel="prefetch" href="/assets/js/8.a6a83d33.js"><link rel="prefetch" href="/assets/js/9.22c6a3f6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3c72cb3e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="load-balancer"><a href="#load-balancer" class="header-anchor">#</a> Load Balancer</h1> <p>Red Hat OpenShift Container Platform 4.4 uses an external load balancer to communicate from outside the cluster with services running inside the cluster. This section assumes that there is a load balancer available within the deployment environment and is available for use. This solution was developed using <strong>HA Proxy</strong>, an open source solution with one (1) virtual machine for load balancing functionality.</p> <p>This section covers its configuration. In a production environment, Hewlett Packard Enterprise recommends the use of enterprise load balancing such as F5 Networks Big-IP and its associated products.</p> <h2 id="install-and-configure-haproxy"><a href="#install-and-configure-haproxy" class="header-anchor">#</a> Install and Configure HAProxy</h2> <p>This section covers configuring HAProxy using ansible playbook.</p> <h3 id="procedure"><a href="#procedure" class="header-anchor">#</a> Procedure</h3> <ol><li><p>Copy the ssh keys from installer machine to HAProxy machine by running following command</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token operator">&gt;</span> ssh-copy-id root@haproxy_machine_ip
</code></pre></div></li> <li><p>Navigate to <code>$BASE_DIR/haproxy</code></p></li> <li><p>Update hosts file with bootstrap, master and worker details.</p></li></ol> <div class="language-yaml extra-class"><pre class="language-yaml"><code>   <span class="token comment">#change your fqdn names as per your environment</span>
   <span class="token punctuation">[</span>lb<span class="token punctuation">]</span>
   lb01 ansible_host=20.x.x.x ansible_user=&lt;installermachine_username<span class="token punctuation">&gt;</span>
   
   <span class="token punctuation">[</span>boot<span class="token punctuation">]</span>
   ocpboot ansible_host=&lt;fqdn<span class="token punctuation">&gt;</span>
   <span class="token comment">#ex:- ocpboot.tennet.com</span>

   <span class="token punctuation">[</span>master<span class="token punctuation">]</span>
   ocpmaster1 ansible_host=&lt;fqdn<span class="token punctuation">&gt;</span>
   ocpmaster2 ansible_host=&lt;fqdn<span class="token punctuation">&gt;</span>
   ocpmaster3 ansible_host=&lt;fqdn<span class="token punctuation">&gt;</span>
   
   <span class="token comment">#ex:- ocpmaster.tennet.com</span>
   
   <span class="token punctuation">[</span>worker<span class="token punctuation">]</span>
   ocpworker1 ansible_host=&lt;fqdn<span class="token punctuation">&gt;</span>
   ocpworker2 ansible_host=&lt;fqdn<span class="token punctuation">&gt;</span>
   ocpworker3 ansible_host=&lt;fqdn<span class="token punctuation">&gt;</span>
  
   <span class="token comment">#ex:- ocpworker.tennet.com</span>

   <span class="token punctuation">[</span>cluster<span class="token punctuation">:</span>children<span class="token punctuation">]</span>
   lb
   boot
   master
   worker
</code></pre></div><ol start="4"><li>Execute the ansible playbook to configure HAProxy</li></ol> <div class="language- extra-class"><pre class="language-text"><code>&gt; ansible-playbook -i hosts haproxy.yaml
</code></pre></div><ol start="5"><li><p>The following entries are made in the haproxy.cfg file.</p> <p>Sample haproxy.cfg file</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>    <span class="token comment">#---------------------------------------------------------------------</span>
    <span class="token comment"># static backend for serving up images, stylesheets and such</span>
    <span class="token comment">#---------------------------------------------------------------------</span>
    <span class="token comment">#backend static</span>
    <span class="token comment"># balance roundrobin</span>
    <span class="token comment"># server static 127.0.0.1:4331 check</span>
    <span class="token comment">#---------------------------------------------------------------------</span>
    <span class="token comment"># round robin balancing between the various backends</span>
    <span class="token comment">#---------------------------------------------------------------------</span>
    frontend ocp4-kubernetes-api-server
        <span class="token builtin class-name">bind</span> *:6443
        default_backend ocp4-kubernetes-api-server
        mode tcp
        option tcplog

    backend ocp4-kubernetes-api-server
        mode tcp
        balance <span class="token builtin class-name">source</span>
        server bootstrap bootstrap.ocp.pxelocal.local:6443 check
        server master01 master01.ocp.pxelocal.local:6443 check
        server master02 master02.ocp.pxelocal.local:6443 check
        server master03 master03.ocp.pxelocal.local:6443 check
    frontend ocp4-machine-config-server68
        <span class="token builtin class-name">bind</span> *:22623
        default_backend ocp4-machine-config-server
        mode tcp
        option tcplog

    backend ocp4-machine-config-server
        balance <span class="token builtin class-name">source</span>
        mode tcp
        server bootstrap bootstrap.ocp.pxelocal.local:22623 check
        server master01 master01.ocp.pxelocal.local:22623 check
        server master02 master02.ocp.pxelocal.local:22623 check
        server master03 master03.ocp.pxelocal.local:22623 check
    frontend ocp4-router-http
        <span class="token builtin class-name">bind</span> *:80
        default_backend ocp4-router-http
        mode tcp
        option tcplog

    backend ocp4-router-http
        balance <span class="token builtin class-name">source</span>
        mode tcp
        server worker03 worker03.ocp.pxelocal.local:80 check
        server worker04 worker04.ocp.pxelocal.local:80 check
        server worker01 worker01.ocp.pxelocal.local:80 check
        server worker02 worker02.ocp.pxelocal.local:80 check

    <span class="token comment"># if creating a cluster with only master nodes to begin with and later adding the worker nodes, master nodes should be added in this section instead of worker nodes. Once all the worker nodes are added into the cluster, this configuration needs to be updated with the worker nodes.</span>
        <span class="token comment"># server master01 master01.ocp.pxelocal.local:80 check</span>
        <span class="token comment"># server master02 master02.ocp.pxelocal.local:80 check</span>
        <span class="token comment"># server master03 master03.ocp.pxelocal.local:80 check</span>
    frontend ocp4-router-https
        <span class="token builtin class-name">bind</span> *:443
        default_backend ocp4-router-https
        mode tcp
        option tcplog

        backend ocp4-router-https
            balance <span class="token builtin class-name">source</span>
            mode tcp
            server worker03 worker03.ocp.pxelocal.local:443 check
            server worker04 worker04.ocp.pxelocal.local:443 check
            server worker01 worker01.ocp.pxelocal.local:443 check
            server worker01 worker02.ocp.pxelocal.local:443 check

    <span class="token comment"># if creating a cluster with only master nodes to begin with and later adding the worker nodes, master nodes should be added in this section instead of worker nodes. Once all the worker nodes are added into the cluster, this configuration needs to be updated with the worker nodes.</span>
        <span class="token comment"># server master01 master01.ocp.pxelocal.local:443 check</span>
        <span class="token comment"># server master02 master02.ocp.pxelocal.local:443 check</span>
        <span class="token comment"># server master03 master03.ocp.pxelocal.local:443 check</span>
    ```

::: tip NOTE

The load balancer configuration should contain values that are aligned to the installation environment.

:::</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6c1bb9d7.js" defer></script><script src="/assets/js/2.41475481.js" defer></script><script src="/assets/js/30.36cb63bf.js" defer></script>
  </body>
</html>
